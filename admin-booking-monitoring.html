<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Booking Monitoring | BlkPages</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .admin-header {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .admin-header h1 {
            color: #2D3748;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .admin-header p {
            color: #718096;
            font-size: 1.1rem;
        }

        .monitoring-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .section-header h2 {
            color: #2D3748;
            font-size: 1.8rem;
            font-weight: 600;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: #F7FAFC;
            border: 1px solid #E2E8F0;
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
        }

        .stat-card.flagged {
            background: #FED7D7;
            border-color: #F56565;
        }

        .stat-card.warning {
            background: #FEF5E7;
            border-color: #F6AD55;
        }

        .stat-card.good {
            background: #C6F6D5;
            border-color: #48BB78;
        }

        .stat-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .stat-card.flagged .stat-icon {
            color: #E53E3E;
        }

        .stat-card.warning .stat-icon {
            color: #DD6B20;
        }

        .stat-card.good .stat-icon {
            color: #38A169;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-card.flagged .stat-value {
            color: #742A2A;
        }

        .stat-card.warning .stat-value {
            color: #744210;
        }

        .stat-card.good .stat-value {
            color: #22543D;
        }

        .stat-label {
            color: #718096;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .businesses-table {
            background: #F7FAFC;
            border: 1px solid #E2E8F0;
            border-radius: 8px;
            overflow: hidden;
        }

        .businesses-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .businesses-table th {
            background: #EDF2F7;
            color: #2D3748;
            font-weight: 600;
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #E2E8F0;
        }

        .businesses-table td {
            padding: 1rem;
            border-bottom: 1px solid #E2E8F0;
            color: #4A5568;
        }

        .businesses-table tr:last-child td {
            border-bottom: none;
        }

        .business-name {
            font-weight: 600;
            color: #2D3748;
        }

        .cancellation-rate {
            font-weight: 600;
        }

        .cancellation-rate.high {
            color: #E53E3E;
        }

        .cancellation-rate.medium {
            color: #DD6B20;
        }

        .cancellation-rate.low {
            color: #38A169;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-badge.flagged {
            background: #FED7D7;
            color: #742A2A;
        }

        .status-badge.monitoring {
            background: #FEF5E7;
            color: #744210;
        }

        .status-badge.good {
            background: #C6F6D5;
            color: #22543D;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
        }

        .btn-primary {
            background: #4299E1;
            color: white;
        }

        .btn-primary:hover {
            background: #3182CE;
        }

        .btn-warning {
            background: #F6AD55;
            color: white;
        }

        .btn-warning:hover {
            background: #ED8936;
        }

        .btn-danger {
            background: #F56565;
            color: white;
        }

        .btn-danger:hover {
            background: #E53E3E;
        }

        .btn-secondary {
            background: #A0AEC0;
            color: white;
        }

        .btn-secondary:hover {
            background: #718096;
        }

        .audit-log {
            background: #F7FAFC;
            border: 1px solid #E2E8F0;
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .audit-log h3 {
            color: #2D3748;
            margin-bottom: 1rem;
        }

        .audit-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            border-bottom: 1px solid #E2E8F0;
        }

        .audit-item:last-child {
            border-bottom: none;
        }

        .audit-details {
            flex: 1;
        }

        .audit-business {
            font-weight: 600;
            color: #2D3748;
        }

        .audit-event {
            color: #4A5568;
            font-size: 0.9rem;
        }

        .audit-time {
            color: #718096;
            font-size: 0.8rem;
        }

        .filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-group label {
            color: #4A5568;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .filter-group select {
            padding: 0.5rem;
            border: 1px solid #E2E8F0;
            border-radius: 6px;
            background: white;
            color: #4A5568;
        }

        .alert-banner {
            background: linear-gradient(135deg, #F56565, #E53E3E);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .alert-banner i {
            font-size: 1.5rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .admin-header h1 {
                font-size: 2rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .filters {
                flex-direction: column;
            }

            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="admin-header">
            <h1><i class="fas fa-shield-alt"></i> Booking Monitoring</h1>
            <p>Monitor business cancellation rates and booking changes across the platform</p>
        </div>

        <!-- Alert Banner for High Cancellation Rates -->
        <div class="alert-banner" id="alertBanner" style="display: none;">
            <i class="fas fa-exclamation-triangle"></i>
            <div>
                <h4>High Cancellation Rate Alert</h4>
                <p>Some businesses have cancellation rates above 5%. Review flagged accounts and take appropriate action.</p>
            </div>
        </div>

        <!-- Overview Stats -->
        <div class="monitoring-section">
            <div class="section-header">
                <h2>Overview Statistics</h2>
                <button class="btn btn-secondary" onclick="refreshData()">
                    <i class="fas fa-sync-alt"></i> Refresh Data
                </button>
            </div>

            <div class="stats-grid" id="statsGrid">
                <!-- Stats will be loaded here -->
            </div>
        </div>

        <!-- Business Monitoring -->
        <div class="monitoring-section">
            <div class="section-header">
                <h2>Business Cancellation Monitoring</h2>
                <div class="filters">
                    <div class="filter-group">
                        <label for="statusFilter">Status Filter</label>
                        <select id="statusFilter" onchange="filterBusinesses()">
                            <option value="all">All Businesses</option>
                            <option value="flagged">Flagged (>5%)</option>
                            <option value="monitoring">Under Review</option>
                            <option value="good">Good Standing</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="timeFilter">Time Period</label>
                        <select id="timeFilter" onchange="filterBusinesses()">
                            <option value="30">Last 30 Days</option>
                            <option value="60">Last 60 Days</option>
                            <option value="90">Last 90 Days</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="businesses-table">
                <table>
                    <thead>
                        <tr>
                            <th>Business Name</th>
                            <th>Cancellation Rate</th>
                            <th>Total Bookings</th>
                            <th>Cancellations</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="businessesTable">
                        <!-- Businesses will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Recent Audit Log -->
        <div class="monitoring-section">
            <div class="section-header">
                <h2>Recent Audit Events</h2>
            </div>

            <div class="audit-log">
                <h3>Booking Changes & Cancellations</h3>
                <div id="auditLogList">
                    <!-- Audit events will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script src="backend/booking-cancellation-system.js"></script>
    <script>
        // Admin monitoring data
        const adminData = {
            totalBusinesses: 156,
            flaggedBusinesses: 8,
            totalBookings: 2847,
            totalCancellations: 142,
            averageCancellationRate: 4.98,
            businesses: [
                {
                    id: 'royal-hair-studio',
                    name: 'Royal Hair Studio',
                    cancellationRate: 7.2,
                    totalBookings: 45,
                    cancellations: 3,
                    status: 'flagged',
                    lastReview: '2024-12-10'
                },
                {
                    id: 'beauty-parlour',
                    name: 'Beauty Parlour',
                    cancellationRate: 3.1,
                    totalBookings: 32,
                    cancellations: 1,
                    status: 'good',
                    lastReview: '2024-12-15'
                },
                {
                    id: 'nail-salon',
                    name: 'Nail Salon',
                    cancellationRate: 6.8,
                    totalBookings: 28,
                    cancellations: 2,
                    status: 'flagged',
                    lastReview: '2024-12-08'
                },
                {
                    id: 'spa-center',
                    name: 'Spa Center',
                    cancellationRate: 2.3,
                    totalBookings: 67,
                    cancellations: 1,
                    status: 'good',
                    lastReview: '2024-12-12'
                },
                {
                    id: 'barber-shop',
                    name: 'Barber Shop',
                    cancellationRate: 4.7,
                    totalBookings: 23,
                    cancellations: 1,
                    status: 'monitoring',
                    lastReview: '2024-12-14'
                }
            ],
            auditEvents: [
                {
                    business: 'Royal Hair Studio',
                    event: 'Booking cancelled - Staff illness',
                    time: '2024-12-16 14:30',
                    type: 'cancellation'
                },
                {
                    business: 'Nail Salon',
                    event: 'Amendment request sent',
                    time: '2024-12-16 11:15',
                    type: 'amendment'
                },
                {
                    business: 'Beauty Parlour',
                    event: 'Cancellation rate review',
                    time: '2024-12-16 09:45',
                    type: 'review'
                }
            ]
        };

        function loadOverviewStats() {
            console.log('Loading overview stats');
            
            const statsGrid = document.getElementById('statsGrid');
            const flaggedCount = adminData.businesses.filter(b => b.status === 'flagged').length;
            const hasHighRates = flaggedCount > 0;

            statsGrid.innerHTML = `
                <div class="stat-card ${hasHighRates ? 'flagged' : 'good'}">
                    <div class="stat-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-value">${flaggedCount}</div>
                    <div class="stat-label">Flagged Businesses</div>
                </div>
                <div class="stat-card good">
                    <div class="stat-icon">
                        <i class="fas fa-building"></i>
                    </div>
                    <div class="stat-value">${adminData.totalBusinesses}</div>
                    <div class="stat-label">Total Businesses</div>
                </div>
                <div class="stat-card good">
                    <div class="stat-icon">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <div class="stat-value">${adminData.totalBookings}</div>
                    <div class="stat-label">Total Bookings</div>
                </div>
                <div class="stat-card ${adminData.averageCancellationRate > 5 ? 'warning' : 'good'}">
                    <div class="stat-icon">
                        <i class="fas fa-percentage"></i>
                    </div>
                    <div class="stat-value">${adminData.averageCancellationRate}%</div>
                    <div class="stat-label">Average Cancellation Rate</div>
                </div>
            `;

            // Show alert banner if there are flagged businesses
            if (hasHighRates) {
                document.getElementById('alertBanner').style.display = 'flex';
            }
        }

        function loadBusinessesTable() {
            console.log('Loading businesses table');
            
            const tableBody = document.getElementById('businessesTable');
            tableBody.innerHTML = '';

            adminData.businesses.forEach(business => {
                const row = document.createElement('tr');
                
                let rateClass = 'low';
                if (business.cancellationRate > 5) rateClass = 'high';
                else if (business.cancellationRate > 3) rateClass = 'medium';

                let statusClass = 'good';
                let statusText = 'Good Standing';
                if (business.status === 'flagged') {
                    statusClass = 'flagged';
                    statusText = 'Flagged';
                } else if (business.status === 'monitoring') {
                    statusClass = 'monitoring';
                    statusText = 'Under Review';
                }

                row.innerHTML = `
                    <td class="business-name">${business.name}</td>
                    <td class="cancellation-rate ${rateClass}">${business.cancellationRate}%</td>
                    <td>${business.totalBookings}</td>
                    <td>${business.cancellations}</td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="viewBusinessDetails('${business.id}')">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button class="btn btn-warning" onclick="reviewBusiness('${business.id}')">
                                <i class="fas fa-search"></i> Review
                            </button>
                            ${business.status === 'flagged' ? `
                                <button class="btn btn-danger" onclick="flagBusiness('${business.id}')">
                                    <i class="fas fa-flag"></i> Flag
                                </button>
                            ` : ''}
                        </div>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        function loadAuditLog() {
            console.log('Loading audit log');
            
            const auditList = document.getElementById('auditLogList');
            auditList.innerHTML = '';

            adminData.auditEvents.forEach(event => {
                const auditItem = document.createElement('div');
                auditItem.className = 'audit-item';
                
                auditItem.innerHTML = `
                    <div class="audit-details">
                        <div class="audit-business">${event.business}</div>
                        <div class="audit-event">${event.event}</div>
                    </div>
                    <div class="audit-time">${event.time}</div>
                `;
                
                auditList.appendChild(auditItem);
            });
        }

        function filterBusinesses() {
            const statusFilter = document.getElementById('statusFilter').value;
            const timeFilter = document.getElementById('timeFilter').value;
            
            console.log('Filtering businesses:', statusFilter, timeFilter);
            
            // In a real implementation, this would filter the data
            // For demo purposes, we'll just reload the table
            loadBusinessesTable();
        }

        function viewBusinessDetails(businessId) {
            const business = adminData.businesses.find(b => b.id === businessId);
            if (business) {
                alert(`Business Details:\n\nName: ${business.name}\nCancellation Rate: ${business.cancellationRate}%\nTotal Bookings: ${business.totalBookings}\nCancellations: ${business.cancellations}\nStatus: ${business.status}`);
            }
        }

        function reviewBusiness(businessId) {
            const business = adminData.businesses.find(b => b.id === businessId);
            if (business) {
                alert(`Reviewing ${business.name}...\n\nThis would open a detailed review interface for the business's cancellation patterns and booking history.`);
            }
        }

        function flagBusiness(businessId) {
            const business = adminData.businesses.find(b => b.id === businessId);
            if (business) {
                if (confirm(`Flag ${business.name} for review?\n\nThis will mark the business for manual review due to high cancellation rates.`)) {
                    alert(`${business.name} has been flagged for review.`);
                    // In a real implementation, this would update the business status
                }
            }
        }

        function refreshData() {
            console.log('Refreshing admin data');
            loadOverviewStats();
            loadBusinessesTable();
            loadAuditLog();
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadOverviewStats();
            loadBusinessesTable();
            loadAuditLog();
        });
    </script>
</body>
</html>

