<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Profile - BLKPAGES</title>
    <link rel="stylesheet" href="css/output.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .business-hero {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border-bottom: 1px solid #333;
        }
        
        .business-image {
            background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%);
            border: 2px solid #444;
        }
        
        .service-card {
            background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%);
            border: 1px solid #444;
            transition: all 0.3s ease;
        }
        
        .service-card:hover {
            border-color: #D4AF37;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.2);
        }
        
        .booking-section {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border: 1px solid #333;
        }
        
        .contact-info {
            background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%);
            border: 1px solid #444;
        }
        
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .gallery-item {
            aspect-ratio: 1;
            background: #333;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #444;
        }
        
        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .gallery-item:hover img {
            transform: scale(1.05);
        }
        
        .tier-badge {
            background: linear-gradient(135deg, #D4AF37 0%, #B8860B 100%);
            color: #000;
            font-weight: bold;
        }
        
        .offer-badge {
            background: rgba(212, 175, 55, 0.2);
            color: #D4AF37;
            border: 1px solid rgba(212, 175, 55, 0.4);
        }
        
        .loading-skeleton {
            background: linear-gradient(90deg, #333 25%, #444 50%, #333 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .error-state {
            background: linear-gradient(135deg, #2a1a1a 0%, #3a2a2a 100%);
            border: 1px solid #444;
        }
    </style>
</head>
<body class="bg-black text-white min-h-screen">
    <!-- Navigation -->
    <nav class="bg-black border-b border-gray-800 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <a href="index.html" class="text-2xl font-bold text-gold">BLKPAGES</a>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="index.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Home</a>
                        <a href="search.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Search</a>
                        <a href="business-register.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">List Business</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Loading State -->
    <div id="loadingState" class="min-h-screen flex items-center justify-center">
        <div class="text-center">
            <div class="loading-skeleton w-16 h-16 rounded-full mx-auto mb-4"></div>
            <div class="loading-skeleton w-48 h-4 rounded mx-auto mb-2"></div>
            <div class="loading-skeleton w-32 h-4 rounded mx-auto"></div>
        </div>
    </div>

    <!-- Error State -->
    <div id="errorState" class="hidden min-h-screen flex items-center justify-center">
        <div class="error-state rounded-lg p-8 text-center max-w-md">
            <i class="fas fa-exclamation-triangle text-red-400 text-4xl mb-4"></i>
            <h2 class="text-xl font-bold mb-2">Business Not Found</h2>
            <p class="text-gray-400 mb-4">The business you're looking for doesn't exist or has been removed.</p>
            <a href="search.html" class="bg-gold text-black px-6 py-2 rounded-lg font-semibold hover:bg-gold-dark transition-colors">
                Browse Businesses
            </a>
        </div>
    </div>

    <!-- Business Profile Content -->
    <div id="businessContent" class="hidden">
        <!-- Hero Section -->
        <section class="business-hero py-12">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Business Image -->
                    <div class="lg:col-span-1">
                        <div class="business-image rounded-lg p-4">
                            <img id="businessMainImage" src="" alt="" class="w-full h-64 object-cover rounded-lg">
                        </div>
                    </div>
                    
                    <!-- Business Info -->
                    <div class="lg:col-span-2">
                        <div class="flex items-start justify-between mb-4">
                            <div>
                                <h1 id="businessName" class="text-3xl font-bold mb-2"></h1>
                                <div class="flex items-center space-x-4 mb-4">
                                    <span id="businessCategory" class="px-3 py-1 rounded-full text-sm font-medium bg-blue-500/20 text-blue-400 border border-blue-500/30"></span>
                                    <span id="businessTier" class="tier-badge px-3 py-1 rounded-full text-sm font-semibold"></span>
                                    <span id="businessOffer" class="offer-badge px-3 py-1 rounded-full text-sm font-medium hidden">
                                        <i class="fas fa-tag mr-1"></i>Special Offer
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Rating -->
                        <div class="flex items-center mb-4">
                            <div id="businessRating" class="flex text-gold mr-3"></div>
                            <span id="businessReviews" class="text-gray-400 text-sm"></span>
                        </div>
                        
                        <!-- Description -->
                        <p id="businessDescription" class="text-gray-300 mb-6"></p>
                        
                        <!-- Contact Info -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="flex items-center text-gray-300">
                                <i class="fas fa-map-marker-alt text-gold mr-3"></i>
                                <span id="businessAddress"></span>
                            </div>
                            <div class="flex items-center text-gray-300">
                                <i class="fas fa-phone text-gold mr-3"></i>
                                <span id="businessPhone"></span>
                            </div>
                            <div class="flex items-center text-gray-300">
                                <i class="fas fa-envelope text-gold mr-3"></i>
                                <span id="businessEmail"></span>
                            </div>
                            <div class="flex items-center text-gray-300">
                                <i class="fas fa-clock text-gold mr-3"></i>
                                <span id="businessHours"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Services Section -->
        <section class="py-12">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-2xl font-bold mb-8">Services</h2>
                <div id="servicesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Services will be populated by JavaScript -->
                </div>
            </div>
        </section>

        <!-- Gallery Section -->
        <section id="gallerySection" class="py-12 bg-gray-900 hidden">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-2xl font-bold mb-8">Gallery</h2>
                <div id="galleryGrid" class="gallery-grid">
                    <!-- Gallery items will be populated by JavaScript -->
                </div>
            </div>
        </section>

        <!-- Booking Section -->
        <section id="bookingSection" class="py-12 booking-section">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center">
                    <h2 class="text-2xl font-bold mb-4">Ready to Book?</h2>
                    <p class="text-gray-400 mb-8">Choose from our available services and book your appointment</p>
                    <button id="bookNowBtn" class="bg-gold text-black px-8 py-3 rounded-lg font-semibold text-lg hover:bg-gold-dark transition-colors">
                        <i class="fas fa-calendar-plus mr-2"></i>Book Now
                    </button>
                </div>
            </div>
        </section>
    </div>

    <script src="js/business-sync-system.js"></script>
    <script>
        // Business Profile System
        class BusinessProfileSystem {
            constructor() {
                this.businessId = null;
                this.businessData = null;
                this.businessManager = null;
                this.syncManager = null;
                this.init();
            }

            init() {
                // Initialize business manager
                if (typeof BusinessManager !== 'undefined') {
                    this.businessManager = new BusinessManager();
                }

                // Initialize sync manager
                this.syncManager = window.businessProfileSyncManager;

                // Get business ID from URL
                this.businessId = this.getBusinessIdFromUrl();
                
                if (this.businessId) {
                    this.loadBusinessProfile();
                    this.setupSync();
                } else {
                    this.showError();
                }
            }

            getBusinessIdFromUrl() {
                const path = window.location.pathname;
                const segments = path.split('/');
                
                // Handle /business/{id} pattern
                if (segments.length >= 3 && segments[1] === 'business') {
                    return segments[2];
                }
                
                // Fallback to query parameter (for development/testing)
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get('business') || urlParams.get('id');
            }

            async loadBusinessProfile() {
                try {
                    this.showLoading();
                    
                    // Try to load from sync system first
                    if (this.syncManager) {
                        this.businessData = this.syncManager.getBusiness(this.businessId);
                    }

                    // Fallback to business manager
                    if (!this.businessData && this.businessManager) {
                        const businesses = this.businessManager.getBusinesses();
                        this.businessData = businesses.find(b => 
                            b.id === this.businessId || 
                            b.name.toLowerCase().replace(/\s+/g, '-') === this.businessId
                        );
                    }

                    // If not found, try demo data
                    if (!this.businessData) {
                        this.businessData = this.getDemoBusinessData();
                    }

                    if (this.businessData) {
                        this.renderBusinessProfile();
                        this.hideLoading();
                    } else {
                        this.showError();
                    }
                } catch (error) {
                    console.error('Error loading business profile:', error);
                    this.showError();
                }
            }

            getDemoBusinessData() {
                // Demo data for testing
                const demoBusinesses = {
                    'royal-hair-studio': {
                        id: 'royal-hair-studio',
                        name: 'Royal Hair Studio',
                        category: 'hair',
                        description: 'Professional hair salon offering cutting-edge styles and premium treatments. Our experienced stylists are dedicated to making you look and feel your best.',
                        address: '123 High Street, London, SW1A 1AA',
                        phone: '020 7123 4567',
                        email: 'info@royalhairstudio.com',
                        hours: 'Mon-Fri: 9AM-7PM, Sat: 9AM-5PM',
                        subscription: 'professional',
                        hasOffer: true,
                        rating: 4.8,
                        reviews: 127,
                        image: 'https://images.unsplash.com/photo-1560066984-138dadb4c035?w=500&h=300&fit=crop&crop=center',
                        services: [
                            { name: 'Haircut & Style', price: 45, duration: '60 min', description: 'Professional haircut and styling service' },
                            { name: 'Hair Coloring', price: 85, duration: '120 min', description: 'Full hair coloring service with consultation' },
                            { name: 'Hair Treatment', price: 35, duration: '45 min', description: 'Deep conditioning and treatment service' }
                        ],
                        gallery: [
                            'https://images.unsplash.com/photo-1560066984-138dadb4c035?w=300&h=300&fit=crop',
                            'https://images.unsplash.com/photo-1522337360788-8b13dee7a37e?w=300&h=300&fit=crop',
                            'https://images.unsplash.com/photo-1516975080664-ed2fc6a32937?w=300&h=300&fit=crop'
                        ]
                    },
                    'elite-barber': {
                        id: 'elite-barber',
                        name: 'Elite Barber Shop',
                        category: 'barber',
                        description: 'Traditional barber shop with modern techniques. We provide classic cuts, beard grooming, and premium grooming services.',
                        address: '456 King Street, London, E1 6AN',
                        phone: '020 7987 6543',
                        email: 'hello@elitebarber.com',
                        hours: 'Mon-Sat: 8AM-6PM',
                        subscription: 'starter',
                        hasOffer: false,
                        rating: 4.6,
                        reviews: 89,
                        image: 'https://images.unsplash.com/photo-1585747860715-2ba37e788b70?w=500&h=300&fit=crop&crop=center',
                        services: [
                            { name: 'Classic Cut', price: 25, duration: '30 min', description: 'Traditional men\'s haircut' },
                            { name: 'Beard Trim', price: 15, duration: '20 min', description: 'Professional beard trimming and shaping' },
                            { name: 'Hot Towel Shave', price: 35, duration: '45 min', description: 'Traditional hot towel shave experience' }
                        ],
                        gallery: []
                    }
                };

                return demoBusinesses[this.businessId];
            }

            renderBusinessProfile() {
                const business = this.businessData;
                
                // Update page title
                document.title = `${business.name} - BLKPAGES`;
                
                // Render business info
                document.getElementById('businessName').textContent = business.name;
                document.getElementById('businessCategory').textContent = business.category.charAt(0).toUpperCase() + business.category.slice(1);
                document.getElementById('businessDescription').textContent = business.description;
                document.getElementById('businessAddress').textContent = business.address;
                document.getElementById('businessPhone').textContent = business.phone;
                document.getElementById('businessEmail').textContent = business.email;
                document.getElementById('businessHours').textContent = business.hours || 'Contact for hours';
                
                // Set main image
                const mainImage = document.getElementById('businessMainImage');
                mainImage.src = business.image;
                mainImage.alt = business.name;
                
                // Render tier badge
                const tier = this.getBusinessTier(business);
                const tierBadge = document.getElementById('businessTier');
                tierBadge.textContent = tier === 'professional' ? 'Professional' : 'Starter';
                
                // Show offer badge if applicable
                if (business.hasOffer) {
                    document.getElementById('businessOffer').classList.remove('hidden');
                }
                
                // Render rating
                this.renderRating(business.rating);
                document.getElementById('businessReviews').textContent = `${business.rating} (${business.reviews} reviews)`;
                
                // Render services
                this.renderServices(business.services || []);
                
                // Render gallery if available
                if (business.gallery && business.gallery.length > 0) {
                    this.renderGallery(business.gallery);
                    document.getElementById('gallerySection').classList.remove('hidden');
                }
                
                // Show/hide booking section based on tier
                if (tier === 'basic') {
                    document.getElementById('bookingSection').classList.add('hidden');
                } else {
                    document.getElementById('bookingSection').classList.remove('hidden');
                }
                
                // Show content
                document.getElementById('businessContent').classList.remove('hidden');
            }

            getBusinessTier(business) {
                if (business.subscription === 'free' || !business.subscription) {
                    return 'basic';
                } else if (business.subscription === 'starter') {
                    return 'starter';
                } else if (business.subscription === 'professional' || business.subscription === 'premium') {
                    return 'professional';
                }
                return 'basic';
            }

            renderRating(rating) {
                const ratingContainer = document.getElementById('businessRating');
                ratingContainer.innerHTML = '';
                
                for (let i = 1; i <= 5; i++) {
                    const star = document.createElement('i');
                    star.className = `fas fa-star ${i <= Math.floor(rating) ? 'text-gold' : 'text-gray-600'}`;
                    ratingContainer.appendChild(star);
                }
            }

            renderServices(services) {
                const servicesGrid = document.getElementById('servicesGrid');
                servicesGrid.innerHTML = '';
                
                services.forEach(service => {
                    const serviceCard = document.createElement('div');
                    serviceCard.className = 'service-card rounded-lg p-6';
                    serviceCard.innerHTML = `
                        <h3 class="text-lg font-semibold mb-2">${service.name}</h3>
                        <p class="text-gray-400 text-sm mb-4">${service.description}</p>
                        <div class="flex justify-between items-center">
                            <span class="text-gold font-semibold">£${service.price}</span>
                            <span class="text-gray-400 text-sm">${service.duration}</span>
                        </div>
                    `;
                    servicesGrid.appendChild(serviceCard);
                });
            }

            renderGallery(gallery) {
                const galleryGrid = document.getElementById('galleryGrid');
                galleryGrid.innerHTML = '';
                
                gallery.forEach(imageUrl => {
                    const galleryItem = document.createElement('div');
                    galleryItem.className = 'gallery-item';
                    galleryItem.innerHTML = `<img src="${imageUrl}" alt="Gallery image" loading="lazy">`;
                    galleryGrid.appendChild(galleryItem);
                });
            }

            showLoading() {
                document.getElementById('loadingState').classList.remove('hidden');
                document.getElementById('errorState').classList.add('hidden');
                document.getElementById('businessContent').classList.add('hidden');
            }

            hideLoading() {
                document.getElementById('loadingState').classList.add('hidden');
            }

            showError() {
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('businessContent').classList.add('hidden');
                document.getElementById('errorState').classList.remove('hidden');
            }

            setupSync() {
                if (this.syncManager) {
                    // Register for sync updates
                    this.syncManager.setCurrentBusiness(this.businessId, (updates) => {
                        this.handleBusinessUpdate(updates);
                    });
                }
            }

            handleBusinessUpdate(updates) {
                if (this.businessData) {
                    // Update business data
                    this.businessData = { ...this.businessData, ...updates };
                    
                    // Re-render the profile with updated data
                    this.renderBusinessProfile();
                    
                    console.log('Business profile updated:', updates);
                }
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new BusinessProfileSystem();
        });

        // Handle Book Now button
        document.addEventListener('click', (e) => {
            if (e.target.id === 'bookNowBtn' || e.target.closest('#bookNowBtn')) {
                // Redirect to booking page with business ID
                const businessId = new BusinessProfileSystem().businessId;
                window.location.href = `booking.html?business=${businessId}`;
            }
        });
    </script>
</body>
</html>