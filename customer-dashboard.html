<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Bookings - BlkPages</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Access control temporarily disabled for testing -->
    <!-- <script src="js/access-control.js"></script> -->
    
    <!-- Security & GDPR Features -->
    <script src="js/security-utils.js"></script>
    <script src="js/cookie-consent.js"></script>
    
    <!-- Basket Count Sync Fix -->
    <script src="assets/js/basket.js"></script>
    
    <!-- SMS System -->
    <script src="backend/sms-credit-system.js"></script>
    <script src="backend/verified-business-numbers.js"></script>
    <script src="backend/verified-customer-numbers.js"></script>
    <script src="backend/sms-messaging-system.js"></script>
    <script src="backend/customer-phone-verification.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #121212 0%, #1A1A1A 50%, #0F0F0F 100%);
            color: #ffffff;
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header */
        .header {
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #FF3CAC, #784BA0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .basket-icon {
            position: relative;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            background: rgba(13, 148, 136, 0.1);
            border: 1px solid rgba(13, 148, 136, 0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }
        
        .basket-icon:hover {
            background: rgba(13, 148, 136, 0.2);
            transform: scale(1.1);
        }
        
        .basket-icon i {
            color: #0D9488;
            font-size: 1.2rem;
        }
        
        .basket-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
            border: 2px solid #1a1a1a;
        }
        
        .customer-menu {
            position: relative;
        }
        
        .customer-initial {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #0D9488, #10B981);
            color: white;
            border: none;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(13, 148, 136, 0.3);
        }
        
        .customer-initial:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(13, 148, 136, 0.5);
        }
        
        .customer-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            min-width: 150px;
            z-index: 1000;
            margin-top: 0.5rem;
        }
        
        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: #ffffff;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .dropdown-item:last-child {
            border-bottom: none;
        }
        
        .dropdown-item:hover {
            background: rgba(13, 148, 136, 0.2);
            color: #0D9488;
        }
        
        .dropdown-item i {
            font-size: 0.8rem;
            width: 16px;
        }
        
        .header-link {
            color: #cccccc;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        
        .header-link:hover {
            color: #FF3CAC;
        }
        
        /* Page Header */
        .page-header {
            padding: 3rem 0;
        }
        
        .page-header .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .sign-out-btn {
            background: linear-gradient(135deg, #ff4444, #cc0000);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .sign-out-btn:hover {
            background: linear-gradient(135deg, #ff6666, #ff0000);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 68, 68, 0.3);
        }
        
        .sign-out-btn i {
            font-size: 0.8rem;
        }
        
        .page-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 1rem;
        }
        
        .page-subtitle {
            color: #cccccc;
            font-size: 1.2rem;
        }
        
        /* Dashboard Navigation */
        .dashboard-nav {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            background: #1A1A1A;
            border-radius: 12px;
            padding: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .nav-tab {
            flex: 1;
            background: transparent;
            border: none;
            color: #cccccc;
            padding: 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-weight: 500;
        }
        
        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
        }
        
        .nav-tab.active {
            background: linear-gradient(135deg, #FF3CAC, #784BA0);
            color: white;
        }
        
        .nav-tab i {
            font-size: 1.1rem;
        }
        
        /* Dashboard Content */
        .dashboard-content {
            position: relative;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .section-header {
            margin-bottom: 2rem;
        }
        
        .section-header h2 {
            color: #FF3CAC;
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }
        
        .section-header p {
            color: #cccccc;
            font-size: 1.1rem;
        }
        
        /* Favorites Grid */
        .favorites-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
        }
        
        .favorite-card {
            background: #1A1A1A;
            border-radius: 12px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }
        
        .favorite-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .favorite-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
        }
        
        .favorite-header .business-logo {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            background: linear-gradient(135deg, #FF3CAC, #784BA0);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.2rem;
        }
        
        .favorite-header .business-details h3 {
            font-size: 1.2rem;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 0.25rem;
        }
        
        .favorite-header .business-category {
            color: #FF3CAC;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .favorite-header .business-rating {
            color: #cccccc;
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }
        
        .favorite-btn {
            background: transparent;
            border: 2px solid #FF3CAC;
            color: #FF3CAC;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .favorite-btn.active {
            background: #FF3CAC;
            color: white;
        }
        
        .favorite-btn:hover {
            background: #FF3CAC;
            color: white;
        }
        
        .favorite-actions {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }
        
        /* Recent Searches */
        .recent-searches {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .search-item {
            background: #1A1A1A;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .search-info {
            flex: 1;
        }
        
        .search-query {
            color: #ffffff;
            font-weight: 500;
            margin-bottom: 0.25rem;
        }
        
        .search-time {
            color: #cccccc;
            font-size: 0.9rem;
        }
        
        .search-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .search-btn {
            background: transparent;
            border: 1px solid #cccccc;
            color: #cccccc;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .search-btn:hover {
            background: #cccccc;
            color: #1A1A1A;
        }
        
        /* Account Sections */
        .account-sections {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
        }
        
        .account-section {
            background: #1A1A1A;
            border-radius: 12px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .account-section h3 {
            color: #FF3CAC;
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            color: #ffffff;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }
        
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            background: #2A2A2A;
            color: #ffffff;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #FF3CAC;
        }
        
        .preference-item {
            margin-bottom: 1rem;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            color: #ffffff;
        }
        
        .checkbox-label input[type="checkbox"] {
            margin-right: 0.75rem;
            width: 18px;
            height: 18px;
        }
        
        .account-actions {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #DC2626, #B91C1C);
            color: white;
        }
        
        .btn-danger:hover {
            background: linear-gradient(135deg, #B91C1C, #991B1B);
        }
        
        /* Bookings Grid */
        .bookings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }
        
        .booking-card {
            background: #1A1A1A;
            border-radius: 12px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }
        
        .booking-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .booking-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
        }
        
        .business-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .business-logo {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            background: linear-gradient(135deg, #FF3CAC, #784BA0);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.2rem;
        }
        
        .business-details h3 {
            font-size: 1.2rem;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 0.25rem;
        }
        
        .business-category {
            color: #FF3CAC;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .booking-status {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-confirmed {
            background: rgba(74, 222, 128, 0.2);
            color: #4ADE80;
            border: 1px solid rgba(74, 222, 128, 0.3);
        }
        
        .status-pending {
            background: rgba(255, 193, 7, 0.2);
            color: #FFC107;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }
        
        .status-cancelled {
            background: rgba(239, 68, 68, 0.2);
            color: #EF4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .status-completed {
            background: rgba(16, 185, 129, 0.2);
            color: #10B981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        /* Refund Amount Styling */
        .refund-amount {
            color: #10B981;
            font-weight: 600;
        }

        /* Business Status Information Styles */
        .business-status-info {
            margin-top: 1rem;
            padding: 0.75rem;
            border-radius: 6px;
            border-left: 4px solid #007bff;
            background: rgba(0, 123, 255, 0.1);
        }

        .business-status-warning {
            border-left-color: #ffc107;
            background: rgba(255, 193, 7, 0.1);
        }

        .business-status-error {
            border-left-color: #dc3545;
            background: rgba(220, 53, 69, 0.1);
        }

        .business-status-info .detail-row {
            margin-bottom: 0.25rem;
        }

        .business-status-info .detail-label {
            color: #666;
            font-weight: 500;
        }

        .business-status-info .detail-value {
            color: #333;
            font-weight: 500;
        }

        /* Waiting List Styles */
        .waiting-list-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e9ecef;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        .waiting-list-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .waiting-list-item.waiting {
            border-left: 4px solid #ffc107;
        }

        .waiting-list-item.offered {
            border-left: 4px solid #17a2b8;
        }

        .waiting-list-item.accepted {
            border-left: 4px solid #28a745;
        }

        .business-info {
            flex: 1;
        }

        .business-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.25rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .position-indicator {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        .position-indicator:contains("First in line") {
            background: linear-gradient(135deg, #ffc107, #fd7e14);
            animation: bounce 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-5px); }
            60% { transform: translateY(-3px); }
        }

        .business-details {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .service-info {
            background: #f8f9fa;
            padding: 0.5rem;
            border-radius: 4px;
            font-size: 0.85rem;
        }

        .waiting-list-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.875rem;
            border-radius: 4px;
            border: none;
            cursor: pointer;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .waiting-list-empty {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        .waiting-list-empty i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #ddd;
        }

        .tab-badge {
            background: #dc3545;
            color: white;
            border-radius: 50%;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            margin-left: 0.5rem;
        }
        
        /* Notification System */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 10000;
            max-width: 400px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease-out;
        }
        
        .notification-success {
            background: #10B981;
        }
        
        .notification-error {
            background: #EF4444;
        }
        
        .notification-info {
            background: #3B82F6;
        }
        
        .notification-content {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Past Booking Styling */
        .past-booking {
            opacity: 0.9;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .past-booking:hover {
            opacity: 1;
            transform: translateY(-2px);
        }
        
        .past-booking .booking-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .past-booking .business-details h3 {
            color: #cccccc;
        }
        
        .past-booking .detail-value {
            color: #999;
        }
        
        .past-booking .service-name {
            color: #cccccc;
        }
        
        .past-booking .service-price {
            color: #999;
        }
        
        .booking-details {
            margin-bottom: 1.5rem;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        
        .detail-label {
            color: #cccccc;
            font-size: 0.9rem;
        }
        
        .detail-value {
            color: #ffffff;
            font-weight: 500;
        }
        
        /* Loyalty Rewards Styles */
        .loyalty-programs {
            display: grid;
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .loyalty-card {
            background: #1A1A1A;
            border-radius: 12px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }
        
        .loyalty-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .loyalty-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
        }
        
        .loyalty-status {
            display: flex;
            align-items: center;
        }
        
        .status-badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .status-badge.active {
            background: rgba(59, 130, 246, 0.2);
            color: #3B82F6;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        .status-badge.unlocked {
            background: rgba(16, 185, 129, 0.2);
            color: #10B981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .loyalty-progress {
            background: #2A2A2A;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .progress-text {
            color: #ffffff;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .progress-percentage {
            color: #FF3CAC;
            font-weight: 700;
            font-size: 1.2rem;
        }
        
        .progress-bar {
            background: #444;
            border-radius: 4px;
            height: 8px;
            margin-bottom: 0.5rem;
            overflow: hidden;
        }
        
        .progress-fill {
            background: linear-gradient(135deg, #FF3CAC, #784BA0);
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .progress-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .progress-label {
            color: #cccccc;
        }
        
        .progress-remaining {
            color: #FF3CAC;
            font-weight: 600;
        }
        
        .loyalty-reward {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: #2A2A2A;
            border-radius: 8px;
            padding: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .loyalty-reward.unlocked {
            background: rgba(16, 185, 129, 0.1);
            border-color: rgba(16, 185, 129, 0.3);
        }
        
        .loyalty-empty {
            text-align: center;
            padding: 3rem 2rem;
            background: #2A2A2A;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .loyalty-empty h3 {
            color: #ffffff;
            margin-bottom: 0.5rem;
        }
        
        .loyalty-empty p {
            color: #cccccc;
            font-size: 0.9rem;
        }
        
        .reward-card {
            background: linear-gradient(135deg, #10B981, #059669);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1rem;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .reward-card-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .reward-card-header .reward-icon {
            font-size: 2rem;
        }
        
        .reward-card-header .reward-title {
            color: #ffffff;
            font-size: 1.2rem;
            font-weight: 700;
        }
        
        .reward-details {
            margin-bottom: 1.5rem;
        }
        
        .reward-type {
            color: #ffffff;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .reward-code, .reward-expiry {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .code-label, .expiry-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }
        
        .code-value {
            color: #ffffff;
            font-weight: 700;
            font-family: monospace;
            background: rgba(255, 255, 255, 0.1);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
        }
        
        .expiry-date {
            color: #ffffff;
            font-weight: 600;
        }
        
        .reward-actions {
            text-align: center;
        }
        
        .btn-use-reward {
            background: #ffffff;
            color: #10B981;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-use-reward:hover {
            background: #f0f0f0;
            transform: translateY(-2px);
        }
        
        .reward-redeemed {
            background: rgba(107, 114, 128, 0.1);
            border-color: rgba(107, 114, 128, 0.3);
        }
        
        .redeemed-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: rgba(107, 114, 128, 0.1);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }
        
        .redeemed-icon {
            font-size: 1.5rem;
        }
        
        .redeemed-text {
            flex: 1;
        }
        
        .redeemed-title {
            color: #ffffff;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .redeemed-description {
            color: #cccccc;
            font-size: 0.9rem;
        }
        
        .reset-progress {
            text-align: center;
            margin-top: 1rem;
        }
        
        .btn-reset-progress {
            background: #6B7280;
            color: #ffffff;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-reset-progress:hover {
            background: #4B5563;
            transform: translateY(-2px);
        }
        
        .status-badge.redeemed {
            background: #6B7280;
            color: #ffffff;
        }

        /* Enhanced loyalty card styles with digital punch card design */
        .first-booking-card {
            border: 2px dashed #FF3CAC;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .first-booking-message {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
            background: rgba(255, 60, 172, 0.1);
            border-radius: 8px;
            margin: 1rem 0;
        }

        .message-icon {
            font-size: 2rem;
            color: #FF3CAC;
        }

        .message-content h4 {
            color: #FF3CAC;
            margin: 0 0 0.5rem 0;
            font-size: 1.1rem;
        }

        .message-content p {
            color: #6b7280;
            margin: 0;
            font-size: 0.9rem;
        }

        .status-badge.pending {
            background: #f59e0b;
            color: white;
        }

        .status-available {
            color: #10b981;
            font-weight: 500;
        }

        /* Digital punch card progress dots */
        .progress-dots {
            display: flex;
            gap: 0.5rem;
            margin: 1rem 0;
            justify-content: center;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e5e7eb;
            border: 2px solid #d1d5db;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .progress-dot.completed {
            background: #10b981;
            border-color: #059669;
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.2);
        }

        .progress-dot:hover {
            transform: scale(1.2);
        }

        /* Color coding for loyalty cards */
        .loyalty-card.active {
            border-left: 4px solid #10b981;
        }

        .loyalty-card.unlocked {
            border-left: 4px solid #f59e0b;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        }

        .loyalty-card.expired {
            border-left: 4px solid #6b7280;
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            opacity: 0.7;
        }

        .loyalty-card.first-booking {
            border-left: 4px solid #FF3CAC;
        }

        /* Progress tooltip */
        .progress-tooltip {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            font-size: 0.8rem;
            color: #6b7280;
        }

        .progress-tooltip i {
            color: #FF3CAC;
        }

        /* Enhanced reward card styles */
        .reward-card {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
            position: relative;
            overflow: hidden;
        }

        .reward-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #f59e0b, #fbbf24, #f59e0b);
        }

        .reward-card-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .reward-card-header .reward-icon {
            font-size: 2rem;
        }

        .reward-card-header .reward-title {
            color: #92400e;
            font-weight: 600;
            font-size: 1.2rem;
        }

        /* Expired reward card */
        .expired-reward-card {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            border: 2px solid #9ca3af;
            color: #6b7280;
        }

        .expired-reward-card .reward-icon {
            color: #9ca3af;
        }

        .expired-reward-card .reward-title {
            color: #6b7280;
        }

        .expired-reward-card .reward-description {
            color: #9ca3af;
        }
        
        .reward-icon {
            font-size: 1.5rem;
        }
        
        .reward-info {
            flex: 1;
        }
        
        .reward-title {
            color: #cccccc;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }
        
        .reward-description {
            color: #ffffff;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .reward-status {
            display: flex;
            align-items: center;
        }
        
        .status-locked {
            color: #999;
            font-size: 0.9rem;
        }
        
        .status-unlocked {
            color: #10B981;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        /* Cancellation Note Styles */
        .cancellation-note {
            background: rgba(255, 60, 172, 0.1);
            border: 1px solid rgba(255, 60, 172, 0.3);
            border-radius: 6px;
            padding: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .cancellation-note .detail-label {
            color: #FF3CAC;
            font-weight: 600;
        }
        
        .cancellation-note .detail-value {
            color: #ffffff;
            font-weight: 500;
        }
        
        /* Payment Model Status Styles */
        .payment-model-status {
            background: rgba(255, 60, 172, 0.1);
            border: 1px solid rgba(255, 60, 172, 0.3);
            border-radius: 6px;
            padding: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .payment-model-status .detail-label {
            color: #FF3CAC;
            font-weight: 600;
        }
        
        .payment-model-status .detail-value {
            color: #ffffff;
            font-weight: 500;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        /* Non-refundable Notice Styles */
        .non-refundable-notice {
            background: rgba(255, 60, 172, 0.1);
            border: 1px solid rgba(255, 60, 172, 0.3);
            border-radius: 6px;
            padding: 0.75rem;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .non-refundable-notice i {
            color: #FF3CAC;
            font-size: 0.9rem;
            flex-shrink: 0;
        }
        
        .non-refundable-notice span {
            color: #e5e7eb;
            font-size: 0.85rem;
            line-height: 1.4;
        }
        
        .services-list {
            margin-bottom: 1.5rem;
        }
        
        .services-title {
            color: #FF3CAC;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .service-item {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }
        
        .service-name {
            color: #cccccc;
        }
        
        .service-price {
            color: #4ADE80;
            font-weight: 500;
        }
        
        .booking-actions {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            text-decoration: none;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #2B86C5, #4ADE80);
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #1E40AF, #059669);
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: transparent;
            border: 2px solid #cccccc;
            color: #cccccc;
        }
        
        .btn-secondary:hover {
            background: #cccccc;
            color: #1A1A1A;
        }
        
        .btn-danger {
            background: transparent;
            border: 2px solid #EF4444;
            color: #EF4444;
        }
        
        .btn-danger:hover {
            background: #EF4444;
            color: white;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            background: #1A1A1A;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .empty-icon {
            font-size: 4rem;
            color: #666666;
            margin-bottom: 1rem;
        }
        
        .empty-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 0.5rem;
        }
        
        .empty-subtitle {
            color: #cccccc;
            margin-bottom: 2rem;
        }
        
        .empty-cta {
            background: linear-gradient(135deg, #FF3CAC, #784BA0);
            color: white;
            padding: 1rem 2rem;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .empty-cta:hover {
            background: linear-gradient(135deg, #FF1493, #8A2BE2);
            transform: translateY(-1px);
        }
        
        /* Footer */
        .footer {
            background: #1A1A1A;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding: 2rem 0;
            margin-top: 3rem;
        }
        
        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .footer-links {
            display: flex;
            gap: 2rem;
        }
        
        .footer-link {
            color: #cccccc;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .footer-link:hover {
            color: #FF3CAC;
        }
        
        /* Mobile Styles */
        @media (max-width: 768px) {
            .bookings-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .page-title {
                font-size: 2rem;
            }
            
            .booking-card {
                padding: 1.5rem;
            }
            
            .booking-header {
                flex-direction: column;
                gap: 1rem;
            }
            
            .business-info {
                width: 100%;
            }
            
            .booking-actions {
                flex-direction: column;
            }
            
            .action-btn {
                width: 100%;
                justify-content: center;
            }
            
            .footer-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .footer-links {
                flex-direction: column;
                gap: 1rem;
            }
        }
        
        /* Loyalty FAQ Styles */
        .loyalty-faq-section {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .faq-container {
            display: grid;
            gap: 1rem;
            margin-top: 2rem;
        }
        
        .faq-item {
            background: #1A1A1A;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .faq-item:hover {
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }
        
        .faq-question {
            padding: 1.5rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #2A2A2A;
            border: none;
            color: #ffffff;
            font-weight: 500;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .faq-question:hover {
            background: #333;
        }
        
        .faq-question i {
            color: #0D9488;
            transition: transform 0.3s ease;
            font-size: 0.9rem;
        }
        
        .faq-question.active i {
            transform: rotate(180deg);
        }
        
        .faq-answer {
            padding: 0 1.5rem;
            max-height: 0;
            overflow: hidden;
            background: #1A1A1A;
            color: #cccccc;
            line-height: 1.6;
            transition: all 0.3s ease;
        }
        
        .faq-answer.show {
            padding: 1.5rem;
            max-height: 200px;
        }
        
        @media (max-width: 768px) {
            .loyalty-faq-section {
                margin-top: 2rem;
                padding-top: 1.5rem;
            }
            
            .faq-question {
                padding: 1rem;
                font-size: 0.9rem;
            }
            
            .faq-answer.show {
                padding: 1rem;
            }
        }
        
        /* Phone Verification Styles */
        .phone-verification {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 1.5rem;
        }
        
        .phone-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #ffffff;
            font-weight: 500;
        }
        
        .status-indicator i {
            color: #10B981;
        }
        
        .status-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .status-badge.verified {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: #10B981;
        }
        
        .status-badge.unverified {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            color: #F59E0B;
        }
        
        .phone-input-group {
            display: flex;
            gap: 0.5rem;
            align-items: flex-end;
        }
        
        .phone-input-group .form-input {
            flex: 1;
        }
        
        .btn-verify {
            background: linear-gradient(135deg, #10B981, #059669);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
        }
        
        .btn-verify:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
        }
        
        .btn-verify:disabled {
            background: #6B7280;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .phone-help {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #cccccc;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }
        
        .phone-help i {
            color: #10B981;
        }
        
        .verification-code {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .code-input-group {
            display: flex;
            gap: 0.5rem;
            align-items: flex-end;
        }
        
        .code-input-group .form-input {
            flex: 1;
            text-align: center;
            font-size: 1.2rem;
            letter-spacing: 0.2em;
        }
        
        .code-help {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 0.5rem;
            color: #cccccc;
            font-size: 0.9rem;
        }
        
        .btn-resend {
            background: none;
            border: none;
            color: #10B981;
            cursor: pointer;
            font-size: 0.9rem;
            text-decoration: underline;
            transition: color 0.3s ease;
        }
        
        .btn-resend:hover {
            color: #059669;
        }
        
        .phone-warning {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 6px;
            padding: 1rem;
            margin-top: 1rem;
            color: #F59E0B;
            font-size: 0.9rem;
        }
        
        .phone-warning i {
            color: #F59E0B;
        }
        
        .phone-warning.hidden {
            display: none;
        }
        
        /* Contextual Dashboard Banners */
        .contextual-banners-container {
            margin-bottom: 2rem;
        }
        
        .contextual-banner {
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border: 1px solid;
            transition: all 0.3s ease;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .banner-content {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .banner-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }
        
        .banner-text {
            flex: 1;
        }
        
        .banner-text h3 {
            margin: 0 0 0.5rem 0;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .banner-text p {
            margin: 0;
            font-size: 0.95rem;
            line-height: 1.4;
        }
        
        .banner-actions {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-shrink: 0;
        }
        
        .btn-dismiss {
            background: none;
            border: none;
            color: #999;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        
        .btn-dismiss:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }
        
        /* Banner Types */
        .banner-waiting-list {
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3);
        }
        
        .banner-waiting-list .banner-text h3 {
            color: #3b82f6;
        }
        
        .banner-waiting-list .banner-text p {
            color: #e5e7eb;
        }
        
        .banner-sms-credits {
            background: rgba(245, 158, 11, 0.1);
            border-color: rgba(245, 158, 11, 0.3);
        }
        
        .banner-sms-credits .banner-text h3 {
            color: #f59e0b;
        }
        
        .banner-sms-credits .banner-text p {
            color: #e5e7eb;
        }
        
        .banner-payment-failure {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
        }
        
        .banner-payment-failure .banner-text h3 {
            color: #ef4444;
        }
        
        .banner-payment-failure .banner-text p {
            color: #e5e7eb;
        }
        
        .banner-review-request {
            background: rgba(16, 185, 129, 0.1);
            border-color: rgba(16, 185, 129, 0.3);
        }
        
        .banner-review-request .banner-text h3 {
            color: #10b981;
        }
        
        .banner-review-request .banner-text p {
            color: #e5e7eb;
        }
        
        .banner-privacy-reminder {
            background: rgba(139, 92, 246, 0.1);
            border-color: rgba(139, 92, 246, 0.3);
        }
        
        .banner-privacy-reminder .banner-text h3 {
            color: #8b5cf6;
        }
        
        .banner-privacy-reminder .banner-text p {
            color: #e5e7eb;
        }
        
        /* Button Styles */
        .btn-accept {
            background: #10b981;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s ease;
        }
        
        .btn-accept:hover {
            background: #059669;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s ease;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #e5e7eb;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .banner-content {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .banner-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .contextual-banner {
                padding: 1rem;
            }
            
            .banner-text h3 {
                font-size: 1rem;
            }
            
            .banner-text p {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">BlkPages</div>
                <div class="header-actions">
                    <a href="index.html" class="header-link">
                        <i class="fas fa-home"></i> Home
                    </a>
                    <a href="search-results.html" class="header-link">
                        <i class="fas fa-search"></i> Browse
                    </a>
                    <a href="preview-test.html" class="header-link" style="background: linear-gradient(135deg, #FF3CAC, #784BA0); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 600;">
                        <i class="fas fa-flask"></i> Preview Test
                    </a>
                    
                    <!-- Basket Icon -->
                    <div class="basket-icon" id="basketIcon" onclick="scrollToBooking()">
                        <i class="fas fa-shopping-basket"></i>
                        <span class="basket-count" id="basketCount">0</span>
                </div>
                    
                    <!-- Customer Menu (for logged-in users) -->
                    <div class="customer-menu" id="customerMenu" style="display: none; position: relative;">
                        <button class="customer-initial" id="customerInitial" onclick="toggleCustomerMenu()">
                            <span id="customerInitialText">U</span>
                    </button>
                        <div class="customer-dropdown" id="customerDropdown" style="display: none;">
                            <a href="customer-dashboard.html" class="dropdown-item">
                                <i class="fas fa-user"></i>
                                Account
                            </a>
                            <a href="#" onclick="signOut()" class="dropdown-item">
                                <i class="fas fa-sign-out-alt"></i>
                                Sign Out
                            </a>
                </div>
            </div>
        </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <div class="header-content">
                <div>
                    <h1 class="page-title">My Dashboard</h1>
                    <p class="page-subtitle">Manage your bookings, favorites, and account</p>
                </div>
                <button onclick="signOut()" class="sign-out-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    Sign Out
                </button>
            </div>
        </div>

        <!-- Dashboard Navigation -->
        <div class="dashboard-nav">
            <button class="nav-tab active" onclick="showTab('bookings')">
                <i class="fas fa-calendar"></i> My Bookings
            </button>
            <button class="nav-tab" onclick="showTab('favorites')">
                <i class="fas fa-heart"></i> Favorites
            </button>
            <button class="nav-tab" onclick="showTab('recent')">
                <i class="fas fa-history"></i> Recent Searches
            </button>
            <button class="nav-tab" onclick="showTab('loyalty')">
                <i class="fas fa-gift"></i> Loyalty Rewards
            </button>
            <button class="nav-tab" onclick="showTab('account')">
                <i class="fas fa-user-cog"></i> My Account
            </button>
            <button class="nav-tab" onclick="showTab('waiting-list')">
                <i class="fas fa-clock"></i> Waiting List
                <span class="tab-badge" id="waitingListTabBadge" style="display: none;">0</span>
            </button>
                    </div>

        <!-- Dashboard Content -->
        <div class="dashboard-content">
            <!-- Phone Verification Banner -->
            <div class="phone-verification-banner" id="phoneVerificationBanner" style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem; display: none;">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <div style="color: #f59e0b; font-size: 1.5rem;">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div style="flex: 1;">
                        <h3 style="color: #f59e0b; margin-bottom: 0.5rem; font-size: 1.1rem;">Phone Verification Required</h3>
                        <p style="color: #cccccc; margin: 0; font-size: 0.95rem;">
                             Please verify your phone number  it's used for booking confirmations and updates. You won't receive notifications until it's verified.
                        </p>
                    </div>
                    <button onclick="showPhoneVerificationModal()" style="background: #f59e0b; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 600; transition: background 0.3s ease;">
                        <i class="fas fa-mobile-alt"></i> Verify Now
                    </button>
                </div>
            </div>
            
            <!-- Contextual Dashboard Banners -->
            <div id="contextualBanners" class="contextual-banners-container">
                <!-- Waiting List Offer Banner -->
                <div class="contextual-banner banner-waiting-list" id="waitingListBanner" style="display: none;">
                    <div class="banner-content">
                        <div class="banner-icon"></div>
                        <div class="banner-text">
                            <h3>Waiting List Offer</h3>
                            <p>A slot opened at <strong>Royal Hair Studio</strong> for <strong>Haircut & Style</strong> on <strong>Friday, 15 Dec at 2:00 PM</strong>. This offer expires in <strong>1h 23m</strong>.</p>
                        </div>
                        <div class="banner-actions">
                            <button class="btn-accept" onclick="acceptWaitingListOffer()">Accept Offer</button>
                            <button class="btn-dismiss" onclick="dismissBanner('waitingListBanner')"></button>
                        </div>
                    </div>
                </div>
                
                <!-- Payment Failure Banner -->
                <div class="contextual-banner banner-payment-failure" id="paymentFailureBanner" style="display: none;">
                    <div class="banner-content">
                        <div class="banner-icon"></div>
                        <div class="banner-text">
                            <h3>Payment Failed</h3>
                            <p>Your payment for <strong>29.00</strong> failed on <strong>12 Dec 2024</strong>. Please update your payment method to avoid service interruption.</p>
                        </div>
                        <div class="banner-actions">
                            <button class="btn-primary" onclick="updatePaymentMethod()">Update Payment</button>
                            <button class="btn-dismiss" onclick="dismissBanner('paymentFailureBanner')"></button>
                        </div>
                    </div>
                </div>
                
                <!-- Review Request Banner -->
                <div class="contextual-banner banner-review-request" id="reviewRequestBanner" style="display: none;">
                    <div class="banner-content">
                        <div class="banner-icon"></div>
                        <div class="banner-text">
                            <h3>Leave a Review</h3>
                            <p>How was your experience at <strong>Royal Hair Studio</strong>? Your feedback helps other customers and supports local businesses.</p>
                        </div>
                        <div class="banner-actions">
                            <button class="btn-primary" onclick="writeReview()">Write Review</button>
                            <button class="btn-dismiss" onclick="dismissBanner('reviewRequestBanner')"></button>
                        </div>
                    </div>
                </div>
                
                <!-- Privacy Reminder Banner -->
                <div class="contextual-banner banner-privacy-reminder" id="privacyReminderBanner" style="display: none;">
                    <div class="banner-content">
                        <div class="banner-icon"></div>
                        <div class="banner-text">
                            <h3>Privacy Reminder</h3>
                            <p>Your personal data is protected. You can download your data or delete your account anytime in <strong>Account Settings</strong>.</p>
                        </div>
                        <div class="banner-actions">
                            <button class="btn-secondary" onclick="openAccountSettings()">Account Settings</button>
                            <button class="btn-dismiss" onclick="dismissBanner('privacyReminderBanner')"></button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Bookings Tab -->
            <div class="tab-content active" id="bookingsTab">
                <!-- Upcoming Bookings Section -->
                <div class="section-header">
                    <h2>Upcoming Bookings</h2>
                    <p>Your confirmed and pending appointments</p>
                    </div>
                <div class="bookings-grid" id="bookingsGrid">
            <!-- Sample Booking 1 -->
            <div class="booking-card">
                <div class="booking-header">
                    <div class="business-info">
                        <div class="business-logo">RH</div>
                        <div class="business-details">
                            <h3>Royal Hair Studio</h3>
                            <div class="business-category">Hair Salon</div>
                </div>
                    </div>
                    <div class="booking-status status-confirmed">Confirmed</div>
            </div>
            
                <div class="booking-details">
                    <div class="detail-row">
                        <span class="detail-label">Date:</span>
                        <span class="detail-value">Saturday, Dec 28, 2024</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Time:</span>
                        <span class="detail-value">2:00 PM</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Duration:</span>
                        <span class="detail-value">1h 15m</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Payment:</span>
                        <span class="detail-value">Paid Online</span>
                    </div>
                    <div class="detail-row payment-model-status">
                        <span class="detail-label">Payment Status:</span>
                        <span class="detail-value"> Haircut & Style, 70 paid in full online.</span>
                    </div>
                    <div class="detail-row cancellation-note">
                        <span class="detail-label">Cancellation:</span>
                        <span class="detail-value">48h notice required</span>
                </div>
            </div>
            
                <div class="services-list">
                    <div class="services-title">Services</div>
                    <div class="service-item">
                        <span class="service-name">Haircut & Style</span>
                        <span class="service-price">45</span>
                    </div>
                    <div class="service-item">
                        <span class="service-name">Hair Wash & Blow Dry</span>
                        <span class="service-price">25</span>
                    </div>
                </div>
                
                <div class="booking-actions">
                    <a href="booking-confirmation.html" class="action-btn btn-primary">
                        <i class="fas fa-eye"></i> View Details
                    </a>
                    <div class="cancellation-status" id="cancellationStatus1">
                        <a href="cancel-booking.html?booking=booking1&user=loggedin" class="action-btn btn-danger" id="cancelBtn1">
                            <i class="fas fa-times"></i> Cancel Booking
                        </a>
                        <div class="non-refundable-notice" id="nonRefundableNotice1" style="display: none;">
                            <i class="fas fa-info-circle"></i>
                            <span>This booking is non-refundable under Royal Hair Studio's cancellation policy.</span>
                    </div>
                </div>
            </div>
        </div>

            <!-- Sample Booking 2 -->
            <div class="booking-card">
                <div class="booking-header">
                    <div class="business-info">
                        <div class="business-logo">BS</div>
                        <div class="business-details">
                            <h3>Beauty Studio</h3>
                            <div class="business-category">Beauty Salon</div>
            </div>
                    </div>
                    <div class="booking-status status-pending">Pending</div>
        </div>

                <div class="booking-details">
                    <div class="detail-row">
                        <span class="detail-label">Date:</span>
                        <span class="detail-value">Monday, Dec 30, 2024</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Time:</span>
                        <span class="detail-value">10:00 AM</span>
            </div>
                    <div class="detail-row">
                        <span class="detail-label">Duration:</span>
                        <span class="detail-value">2h 30m</span>
        </div>
                    <div class="detail-row">
                        <span class="detail-label">Payment:</span>
                        <span class="detail-value">Deposit Paid</span>
                    </div>
                    <div class="detail-row payment-model-status">
                        <span class="detail-label">Payment Status:</span>
                        <span class="detail-value"> Full Body Massage, 28 deposit paid, 52 due at venue.</span>
                    </div>
                    <div class="detail-row cancellation-note">
                        <span class="detail-label">Cancellation:</span>
                        <span class="detail-value">24h notice required</span>
            </div>
        </div>

                <div class="services-list">
                    <div class="services-title">Services</div>
                    <div class="service-item">
                        <span class="service-name">Full Body Massage</span>
                        <span class="service-price">80</span>
                    </div>
                    <div class="service-item">
                        <span class="service-name">Facial Treatment</span>
                        <span class="service-price">60</span>
            </div>
        </div>

                <div class="booking-actions">
                    <a href="booking-confirmation.html" class="action-btn btn-primary">
                        <i class="fas fa-eye"></i> View Details
                    </a>
                    <div class="cancellation-status" id="cancellationStatus2">
                        <a href="cancel-booking.html?booking=booking2&user=loggedin" class="action-btn btn-danger" id="cancelBtn2">
                            <i class="fas fa-times"></i> Cancel Booking
                        </a>
                        <div class="non-refundable-notice" id="nonRefundableNotice2" style="display: none;">
                            <i class="fas fa-info-circle"></i>
                            <span>This booking is non-refundable under Beauty Studio's cancellation policy.</span>
                </div>
                    </div>
                </div>
            </div>
            
            <!-- Sample Booking 3 - Pay at Venue -->
            <div class="booking-card">
                <div class="booking-header">
                    <div class="business-info">
                        <div class="business-logo">FS</div>
                        <div class="business-details">
                            <h3>Fitness Studio</h3>
                            <div class="business-category">Wellness Center</div>
                        </div>
                    </div>
                    <div class="booking-status status-confirmed">Confirmed</div>
                </div>
                
                <div class="booking-details">
                    <div class="detail-row">
                        <span class="detail-label">Date:</span>
                        <span class="detail-value">Friday, Jan 19, 2025</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Time:</span>
                        <span class="detail-value">3:00 PM</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Duration:</span>
                        <span class="detail-value">1h 00m</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Payment:</span>
                        <span class="detail-value">Pay at Venue</span>
                    </div>
                    <div class="detail-row payment-model-status">
                        <span class="detail-label">Payment Status:</span>
                        <span class="detail-value"> Massage, 50 payable at the venue. No online payment taken.</span>
                    </div>
                    <div class="detail-row cancellation-note">
                        <span class="detail-label">Cancellation:</span>
                        <span class="detail-value">24h notice required</span>
                    </div>
                </div>
                
                <div class="services-list">
                    <div class="services-title">Services</div>
                    <div class="service-item">
                        <span class="service-name">Massage</span>
                        <span class="service-price">50</span>
                    </div>
                </div>
                
                <div class="booking-actions">
                    <a href="booking-confirmation.html" class="action-btn btn-primary">
                        <i class="fas fa-eye"></i> View Details
                    </a>
                    <div class="cancellation-status" id="cancellationStatus3">
                        <a href="cancel-booking.html?booking=booking3&user=loggedin" class="action-btn btn-danger" id="cancelBtn3">
                            <i class="fas fa-times"></i> Cancel Booking
                        </a>
                        <div class="non-refundable-notice" id="nonRefundableNotice3" style="display: none;">
                            <i class="fas fa-info-circle"></i>
                            <span>This booking is non-refundable under Fitness Studio's cancellation policy.</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Sample Booking 4 - Non-Cancellable (Too Close) -->
            <div class="booking-card">
                <div class="booking-header">
                    <div class="business-info">
                        <div class="business-logo">GS</div>
                        <div class="business-details">
                            <h3>Glow Salon</h3>
                            <div class="business-category">Hair Salon</div>
                </div>
                    </div>
                    <div class="booking-status status-confirmed">Confirmed</div>
                </div>
                
                <div class="booking-details">
                    <div class="detail-row">
                        <span class="detail-label">Date:</span>
                        <span class="detail-value">Tomorrow, Jan 16, 2025</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Time:</span>
                        <span class="detail-value">10:00 AM</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Duration:</span>
                        <span class="detail-value">1h 00m</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Payment:</span>
                        <span class="detail-value">Paid Online</span>
                    </div>
                    <div class="detail-row payment-model-status">
                        <span class="detail-label">Payment Status:</span>
                        <span class="detail-value"> Haircut, 35 paid in full online.</span>
                    </div>
                    <div class="detail-row cancellation-note">
                        <span class="detail-label">Cancellation:</span>
                        <span class="detail-value">24h notice required</span>
                    </div>
                </div>
                
                <div class="services-list">
                    <div class="services-title">Services</div>
                    <div class="service-item">
                        <span class="service-name">Haircut</span>
                        <span class="service-price">35</span>
                    </div>
                </div>
                
                <div class="booking-actions">
                    <a href="booking-confirmation.html" class="action-btn btn-primary">
                        <i class="fas fa-eye"></i> View Details
                    </a>
                    <div class="cancellation-status" id="cancellationStatus4">
                        <div class="non-refundable-notice">
                            <i class="fas fa-info-circle"></i>
                            <span>This booking is outside the cancellation timeframe. Contact the venue directly for assistance.</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

                <!-- Empty State (hidden by default) -->
                <div class="empty-state" id="emptyState" style="display: none;">
                    <div class="empty-icon"></div>
                    <h2 class="empty-title">No Bookings Yet</h2>
                    <p class="empty-subtitle">Start exploring and book your first appointment</p>
                    <a href="search-results.html" class="empty-cta">
                        <i class="fas fa-search"></i> Browse Services
                    </a>
                </div>

                <!-- Past Bookings Section -->
                <div class="section-header" style="margin-top: 3rem;">
                    <h2>Past Bookings</h2>
                    <p>Your completed appointments</p>
                </div>
                <div class="bookings-grid" id="pastBookingsGrid">
                    <!-- Sample Past Booking 1 -->
                    <div class="booking-card past-booking">
                        <div class="booking-header">
                            <div class="business-info">
                                <div class="business-logo">RH</div>
                                <div class="business-details">
                                    <h3>Royal Hair Studio</h3>
                                    <div class="business-category">Hair Salon</div>
                                </div>
                            </div>
                            <div class="booking-status status-completed">Completed</div>
                        </div>
                        
                        <div class="booking-details">
                            <div class="detail-row">
                                <span class="detail-label">Date:</span>
                                <span class="detail-value">Saturday, Dec 14, 2024</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Time:</span>
                                <span class="detail-value">2:00 PM</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Duration:</span>
                                <span class="detail-value">1h 15m</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Payment:</span>
                                <span class="detail-value">Paid Online</span>
                            </div>
                        </div>
                        
                        <div class="services-list">
                            <div class="services-title">Services</div>
                            <div class="service-item">
                                <span class="service-name">Haircut & Style</span>
                                <span class="service-price">45</span>
                            </div>
                            <div class="service-item">
                                <span class="service-name">Hair Wash & Blow Dry</span>
                                <span class="service-price">25</span>
                            </div>
                        </div>
                        
                        <div class="booking-actions">
                            <a href="booking-confirmation.html" class="action-btn btn-primary">
                                <i class="fas fa-eye"></i> View Details
                            </a>
                            <a href="business-profile.html" class="action-btn btn-secondary" onclick="rebookAppointment('Royal Hair Studio', 'business-profile.html')">
                                <i class="fas fa-redo"></i> Rebook
                            </a>
                        </div>
                    </div>

                    <!-- Sample Past Booking 2 -->
                    <div class="booking-card past-booking">
                        <div class="booking-header">
                            <div class="business-info">
                                <div class="business-logo">BS</div>
                                <div class="business-details">
                                    <h3>Beauty Studio</h3>
                                    <div class="business-category">Beauty Salon</div>
                </div>
                            </div>
                            <div class="booking-status status-completed">Completed</div>
                        </div>
                        
                        <div class="booking-details">
                            <div class="detail-row">
                                <span class="detail-label">Date:</span>
                                <span class="detail-value">Wednesday, Dec 11, 2024</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Time:</span>
                                <span class="detail-value">10:00 AM</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Duration:</span>
                                <span class="detail-value">2h 30m</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Payment:</span>
                                <span class="detail-value">Paid at Venue</span>
                            </div>
                        </div>
                        
                        <div class="services-list">
                            <div class="services-title">Services</div>
                            <div class="service-item">
                                <span class="service-name">Full Body Massage</span>
                                <span class="service-price">80</span>
                            </div>
                            <div class="service-item">
                                <span class="service-name">Facial Treatment</span>
                                <span class="service-price">60</span>
                            </div>
                        </div>
                        
                        <div class="booking-actions">
                            <a href="booking-confirmation.html" class="action-btn btn-primary">
                                <i class="fas fa-eye"></i> View Details
                            </a>
                            <a href="business-profile.html" class="action-btn btn-secondary" onclick="rebookAppointment('Beauty Studio', 'business-profile.html')">
                                <i class="fas fa-redo"></i> Rebook
            </a>
        </div>
                    </div>

                    <!-- Sample Past Booking 3 -->
                    <div class="booking-card past-booking">
                        <div class="booking-header">
                            <div class="business-info">
                                <div class="business-logo">NS</div>
                                <div class="business-details">
                                    <h3>Nail Studio</h3>
                                    <div class="business-category">Nail Salon</div>
                </div>
                            </div>
                            <div class="booking-status status-completed">Completed</div>
                        </div>
                        
                        <div class="booking-details">
                            <div class="detail-row">
                                <span class="detail-label">Date:</span>
                                <span class="detail-value">Monday, Dec 9, 2024</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Time:</span>
                                <span class="detail-value">3:30 PM</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Duration:</span>
                                <span class="detail-value">1h 45m</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Payment:</span>
                                <span class="detail-value">Paid Online</span>
                            </div>
                        </div>
                        
                        <div class="services-list">
                            <div class="services-title">Services</div>
                            <div class="service-item">
                                <span class="service-name">Manicure & Pedicure</span>
                                <span class="service-price">55</span>
                            </div>
                            <div class="service-item">
                                <span class="service-name">Gel Polish</span>
                                <span class="service-price">25</span>
                            </div>
                        </div>
                        
                        <div class="booking-actions">
                            <a href="booking-confirmation.html" class="action-btn btn-primary">
                                <i class="fas fa-eye"></i> View Details
                            </a>
                            <a href="business-profile.html" class="action-btn btn-secondary" onclick="rebookAppointment('Nail Studio', 'business-profile.html')">
                                <i class="fas fa-redo"></i> Rebook
            </a>
                            </div>
                            </div>
                        </div>
                        
                        <!-- Sample Past Booking 4 - Cancelled -->
                        <div class="booking-card past-booking">
                            <div class="booking-header">
                                <div class="business-info">
                                    <div class="business-logo">GS</div>
                                    <div class="business-details">
                                        <h3>Glow Salon</h3>
                                        <div class="business-category">Hair Salon</div>
                                    </div>
                                </div>
                                <div class="booking-status status-cancelled">Cancelled</div>
                            </div>
                            
                            <div class="booking-details">
                                <div class="detail-row">
                                    <span class="detail-label">Date:</span>
                                    <span class="detail-value">Monday, Jan 8, 2025</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Time:</span>
                                    <span class="detail-value">2:00 PM</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Duration:</span>
                                    <span class="detail-value">1h 30m</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Payment:</span>
                                    <span class="detail-value">Refunded</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Refund Amount:</span>
                                    <span class="detail-value refund-amount">45.00</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Refund Date:</span>
                                    <span class="detail-value">Jan 8, 2025</span>
                                </div>
                                <div class="detail-row payment-model-status">
                                    <span class="detail-label">Refund Status:</span>
                                    <span class="detail-value"> Refund 45 issued to your payment method.</span>
                                </div>
                            </div>
                            
                            <div class="services-list">
                                <div class="services-title">Services</div>
                                <div class="service-item">
                                    <span class="service-name">Haircut & Style</span>
                                    <span class="service-price">45</span>
                                </div>
                            </div>
                            
                            <div class="booking-actions">
                                <a href="booking-confirmation.html" class="action-btn btn-secondary">
                                    <i class="fas fa-eye"></i> View Details
                                </a>
                                <a href="business-profile.html" class="action-btn btn-primary">
                                    <i class="fas fa-calendar-plus"></i> Book Again
                                </a>
                            </div>
                        </div>

                <!-- Past Bookings Empty State (hidden by default) -->
                <div class="empty-state" id="pastBookingsEmptyState" style="display: none;">
                    <div class="empty-icon"></div>
                    <h2 class="empty-title">No Past Bookings</h2>
                    <p class="empty-subtitle">Your completed appointments will appear here</p>
                    </div>
            </div>

            <!-- Favorites Tab -->
            <div class="tab-content" id="favoritesTab">
                <div class="section-header">
                    <h2>My Favorites</h2>
                    <p>Businesses and services you've saved</p>
                </div>
                <div class="favorites-grid" id="favoritesGrid">
                    <!-- Sample Favorite 1 -->
                    <div class="favorite-card">
                        <div class="favorite-header">
                            <div class="business-logo">RH</div>
                            <div class="business-details">
                                <h3>Royal Hair Studio</h3>
                                <div class="business-category">Hair Salon</div>
                                <div class="business-rating"> 4.8 (120 reviews)</div>
                            </div>
                            <button class="favorite-btn active" onclick="toggleFavorite(this)">
                                <i class="fas fa-heart"></i>
                            </button>
                        </div>
                        <div class="favorite-actions">
                            <a href="business-profile.html" class="action-btn btn-primary">
                                <i class="fas fa-eye"></i> View Profile
                            </a>
                            <a href="business-profile.html" class="action-btn btn-secondary">
                                <i class="fas fa-calendar"></i> Book Now
                            </a>
                        </div>
                    </div>

                    <!-- Sample Favorite 2 -->
                    <div class="favorite-card">
                        <div class="favorite-header">
                            <div class="business-logo">BS</div>
                            <div class="business-details">
                                <h3>Beauty Studio</h3>
                                <div class="business-category">Beauty Salon</div>
                                <div class="business-rating"> 4.6 (89 reviews)</div>
                        </div>
                            <button class="favorite-btn active" onclick="toggleFavorite(this)">
                                <i class="fas fa-heart"></i>
                            </button>
                        </div>
                        <div class="favorite-actions">
                            <a href="business-profile.html" class="action-btn btn-primary">
                                <i class="fas fa-eye"></i> View Profile
                            </a>
                            <a href="business-profile.html" class="action-btn btn-secondary">
                                <i class="fas fa-calendar"></i> Book Now
                            </a>
                    </div>
                    </div>
                </div>
            </div>

            <!-- Recent Searches Tab -->
            <div class="tab-content" id="recentTab">
                <div class="section-header">
                    <h2>Recent Searches</h2>
                    <p>Your recent search history</p>
                            </div>
                <div class="recent-searches" id="recentSearches">
                    <!-- Sample Recent Search 1 -->
                    <div class="search-item">
                        <div class="search-info">
                            <div class="search-query">Hair salons in London</div>
                            <div class="search-time">2 hours ago</div>
                            </div>
                        <div class="search-actions">
                            <button class="search-btn" onclick="repeatSearch('Hair salons in London')">
                                <i class="fas fa-search"></i> Search Again
                            </button>
                            <button class="search-btn" onclick="removeSearch(this)">
                                <i class="fas fa-times"></i> Remove
                    </button>
                </div>
                    </div>

                    <!-- Sample Recent Search 2 -->
                    <div class="search-item">
                        <div class="search-info">
                            <div class="search-query">Beauty treatments near me</div>
                            <div class="search-time">1 day ago</div>
                        </div>
                        <div class="search-actions">
                            <button class="search-btn" onclick="repeatSearch('Beauty treatments near me')">
                                <i class="fas fa-search"></i> Search Again
                            </button>
                            <button class="search-btn" onclick="removeSearch(this)">
                                <i class="fas fa-times"></i> Remove
                            </button>
                        </div>
                    </div>

                    <!-- Sample Recent Search 3 -->
                    <div class="search-item">
                        <div class="search-info">
                            <div class="search-query">Barbers in Manchester</div>
                            <div class="search-time">3 days ago</div>
                        </div>
                        <div class="search-actions">
                            <button class="search-btn" onclick="repeatSearch('Barbers in Manchester')">
                                <i class="fas fa-search"></i> Search Again
                            </button>
                            <button class="search-btn" onclick="removeSearch(this)">
                                <i class="fas fa-times"></i> Remove
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Waiting List Tab -->
            <div class="tab-content" id="waitingListTab">
                <div class="section-header">
                    <h2>My Waiting Lists</h2>
                    <p>Track your waiting list positions and manage offers</p>
                </div>
                
                <div class="waiting-list-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalWaitingList">0</div>
                        <div class="stat-label">Total Waiting</div>
                                </div>
                    <div class="stat-card">
                        <div class="stat-number" id="offersReceived">0</div>
                        <div class="stat-label">Offers Received</div>
                            </div>
                    <div class="stat-card">
                        <div class="stat-number" id="offersAccepted">0</div>
                        <div class="stat-label">Offers Accepted</div>
                            </div>
                        </div>
                        
                <div id="waitingListContent">
                    <!-- Waiting list items will be loaded here -->
                            </div>
                        </div>
                        
            <!-- Loyalty Rewards Tab -->
            <div class="tab-content" id="loyaltyTab">
                <div class="section-header">
                    <h2>Loyalty Rewards</h2>
                    <p>Track your progress and unlock rewards with your favorite businesses</p>
                    </div>
                    
                <div class="loyalty-programs" id="loyaltyPrograms">
                    <!-- Dynamic loyalty programs will be loaded here -->
                    </div>
                </div>
                
                <!-- Loyalty Rewards FAQ Section -->
                <div class="loyalty-faq-section">
                    <div class="section-header">
                        <h2>Loyalty Rewards FAQ</h2>
                        <p>Everything you need to know about earning and using rewards</p>
                    </div>
                    
                    <div class="faq-container">
                        <div class="faq-item">
                            <div class="faq-question" onclick="toggleLoyaltyFAQ(this)">
                                How do I earn loyalty rewards?
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="faq-answer">
                                Each business sets their own loyalty programme. You might unlock a reward by booking a certain number of times, spending a certain amount, or booking within a timeframe.
                            </div>
                        </div>
                        
                        <div class="faq-item">
                            <div class="faq-question" onclick="toggleLoyaltyFAQ(this)">
                                How do I know if I'm close to unlocking a reward?
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="faq-answer">
                                You can track your progress in your customer dashboard. You'll also receive an email (and SMS if enabled) when you're close.
                            </div>
                        </div>
                        
                        <div class="faq-item">
                            <div class="faq-question" onclick="toggleLoyaltyFAQ(this)">
                                How do I use my reward?
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="faq-answer">
                                Rewards apply automatically at checkout once unlocked. You'll see the discount or free service before you confirm payment.
                            </div>
                        </div>
                        
                        <div class="faq-item">
                            <div class="faq-question" onclick="toggleLoyaltyFAQ(this)">
                                Do rewards expire?
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="faq-answer">
                                Each business sets their own rules. Some rewards may not expire, while others may need to be used within a timeframe (e.g., 6 weeks or 6 months). Check the details in your dashboard.
                            </div>
                        </div>
                        
                        <div class="faq-item">
                            <div class="faq-question" onclick="toggleLoyaltyFAQ(this)">
                                Can I transfer rewards between businesses?
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="faq-answer">
                                No. Rewards are tied to the business where you earned them.
                            </div>
                        </div>
                        
                        <div class="faq-item">
                            <div class="faq-question" onclick="toggleLoyaltyFAQ(this)">
                                Can I save a reward for later?
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="faq-answer">
                                Yes. If you don't use it immediately, you can save it for your next booking (until expiry if the business has set one).
                            </div>
                        </div>
                        
                        <div class="faq-item">
                            <div class="faq-question" onclick="toggleLoyaltyFAQ(this)">
                                Do I need a code to redeem rewards?
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="faq-answer">
                                No. Rewards are applied automatically at checkout when you book online.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Account Tab -->
            <div class="tab-content" id="accountTab">
                <div class="section-header">
                    <h2>Account Settings</h2>
                    <p>Manage your account details and preferences</p>
                </div>
                
                <div class="account-sections">
                    <!-- Profile Information -->
                    <div class="account-section">
                        <h3>Profile Information</h3>
                        <div class="form-group">
                            <label>Full Name</label>
                            <input type="text" id="profileName" value="Test User" class="form-input">
                        </div>
                        <div class="form-group">
                            <label>Email Address</label>
                            <input type="email" id="profileEmail" value="test@example.com" class="form-input">
                        </div>
                        <div class="form-group">
                            <label>Phone Number</label>
                            <input type="tel" id="profilePhone" value="07123456789" class="form-input">
                    </div>
                        <button class="action-btn btn-primary" onclick="updateProfile()">
                            <i class="fas fa-save"></i> Update Profile
                    </button>
                </div>
                
                    <!-- Phone Number Verification -->
                    <div class="account-section">
                        <h3>Phone Number Verification</h3>
                        <div class="phone-verification">
                            <div class="phone-status" id="phoneStatus">
                                <div class="status-indicator">
                                    <i class="fas fa-mobile-alt"></i>
                                    <span>Phone Number Verification</span>
                                </div>
                                <div class="status-badge" id="phoneStatusBadge">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    Unverified
                                </div>
                            </div>
                            
                            <div class="phone-form" id="phoneForm">
                                <div class="form-group">
                                    <label>Phone Number</label>
                                    <div class="phone-input-group">
                                        <input type="tel" id="phoneNumber" placeholder="+44 7700 900000" class="form-input">
                                        <button class="btn-verify" id="verifyPhoneBtn" onclick="initiatePhoneVerification()">
                                            <i class="fas fa-paper-plane"></i> Send Code
                                        </button>
                                    </div>
                                    <div class="phone-help">
                                        <i class="fas fa-info-circle"></i>
                                        <span>We'll send a verification code to confirm your phone number for booking notifications.</span>
                                    </div>
                                </div>
                                
                                <div class="verification-code" id="verificationCodeSection" style="display: none;">
                                    <div class="form-group">
                                        <label>Verification Code</label>
                                        <div class="code-input-group">
                                            <input type="text" id="verificationCode" placeholder="123456" class="form-input" maxlength="6">
                                            <button class="btn-verify" onclick="verifyPhoneCode()">
                                                <i class="fas fa-check"></i> Verify
                                            </button>
                                        </div>
                                        <div class="code-help">
                                            <span>Enter the 6-digit code sent to your phone</span>
                                            <button class="btn-resend" onclick="resendVerificationCode()">Resend Code</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="phone-warning" id="phoneWarning">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span>Please verify your phone number  it's used for booking confirmations and updates. You won't receive notifications until it's verified.</span>
                            </div>
                        </div>
                    </div>

                    <!-- Change Password -->
                    <div class="account-section">
                        <h3>Change Password</h3>
                        <div class="form-group">
                            <label>Current Password</label>
                            <input type="password" id="currentPassword" class="form-input">
                        </div>
                        <div class="form-group">
                            <label>New Password</label>
                            <input type="password" id="newPassword" class="form-input">
                        </div>
                        <div class="form-group">
                            <label>Confirm New Password</label>
                            <input type="password" id="confirmPassword" class="form-input">
                        </div>
                        <button class="action-btn btn-primary" onclick="changePassword()">
                            <i class="fas fa-key"></i> Change Password
                    </button>
                </div>

                    <!-- Notification Preferences -->
                    <div class="account-section">
                        <h3>Notification Preferences</h3>
                        <div class="preference-item">
                            <label class="checkbox-label">
                                <input type="checkbox" id="emailNotifications" checked>
                                <span class="checkmark"></span>
                                Email notifications
                            </label>
                        </div>
                        <div class="preference-item">
                            <label class="checkbox-label">
                                <input type="checkbox" id="smsNotifications">
                                <span class="checkmark"></span>
                                SMS notifications
                            </label>
                        </div>
                        <div class="preference-item">
                            <label class="checkbox-label">
                                <input type="checkbox" id="marketingEmails" checked>
                                <span class="checkmark"></span>
                                Marketing emails
                            </label>
                        </div>
                        <button class="action-btn btn-secondary" onclick="updatePreferences()">
                            <i class="fas fa-bell"></i> Update Preferences
                            </button>
                    </div>

                    <!-- Account Actions -->
                    <div class="account-section">
                        <h3>Account Actions</h3>
                        <div class="account-actions">
                            <button class="action-btn btn-secondary" onclick="exportData()">
                                <i class="fas fa-download"></i> Export My Data
                            </button>
                            <button class="action-btn btn-danger" onclick="deleteAccount()">
                                <i class="fas fa-trash"></i> Delete Account
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-links">
                    <a href="about.html" class="footer-link">About</a>
                    <a href="contact.html" class="footer-link">Contact</a>
                    <a href="terms.html" class="footer-link">Terms</a>
                    <a href="privacy.html" class="footer-link">Privacy</a>
                </div>
                <div>
                    <p>&copy; 2025 BlkPages  Supporting Black-owned Businesses</p>
                </div>
                </div>
        </div>
    </footer>

    <script>
        // Tab switching functionality
        /**
         * Phone Verification Functions
         */
        function showPhoneVerificationModal() {
            // TODO: connect SMS verification function when notification system is added
            console.log('TODO: Implement phone verification modal when SMS system is ready');
            
            // Show placeholder modal
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 500px;">
                    <div class="modal-header">
                        <h2>Phone Verification</h2>
                        <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div style="text-align: center; padding: 2rem;">
                            <div style="color: #f59e0b; font-size: 3rem; margin-bottom: 1rem;">
                                <i class="fas fa-mobile-alt"></i>
                            </div>
                            <h3 style="color: #ffffff; margin-bottom: 1rem;">Phone Verification</h3>
                            <p style="color: #cccccc; margin-bottom: 2rem;">
                                Phone verification will be implemented when the SMS notification system is added. 
                                For now, your phone number is stored securely.
                            </p>
                            <button onclick="this.closest('.modal-overlay').remove()" style="background: #f59e0b; color: white; border: none; padding: 0.75rem 2rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                Got It
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function checkPhoneVerificationStatus() {
            // TODO: connect SMS verification function when notification system is added
            // For now, show the banner for demonstration
            const banner = document.getElementById('phoneVerificationBanner');
            if (banner) {
                banner.style.display = 'block';
            }
        }

        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all nav tabs
            const navTabs = document.querySelectorAll('.nav-tab');
            navTabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            const selectedTab = document.getElementById(tabName + 'Tab');
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
            
            // Add active class to clicked nav tab
            event.target.classList.add('active');
        }
        
        // Favorites functionality
        function toggleFavorite(button) {
            const isActive = button.classList.contains('active');
            
            if (isActive) {
                button.classList.remove('active');
                button.innerHTML = '<i class="far fa-heart"></i>';
                showMessage('Removed from favorites', 'success');
            } else {
                button.classList.add('active');
                button.innerHTML = '<i class="fas fa-heart"></i>';
                showMessage('Added to favorites', 'success');
            }
        }
        
        // Recent searches functionality
        function repeatSearch(query) {
            // Redirect to search results with the query
            window.location.href = `search-results.html?q=${encodeURIComponent(query)}`;
        }
        
        function removeSearch(button) {
            const searchItem = button.closest('.search-item');
            searchItem.remove();
            showMessage('Search removed from history', 'success');
        }
        
        // Account management functionality
        function updateProfile() {
            const name = document.getElementById('profileName').value;
            const email = document.getElementById('profileEmail').value;
            const phone = document.getElementById('profilePhone').value;
            
            if (!name || !email || !phone) {
                showMessage('Please fill in all fields', 'error');
                return;
            }
            
            // Simulate profile update
            showMessage('Profile updated successfully', 'success');
        }
        
        function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                showMessage('Please fill in all password fields', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showMessage('New passwords do not match', 'error');
                return;
            }
            
            if (newPassword.length < 8) {
                showMessage('Password must be at least 8 characters long', 'error');
                return;
            }
            
            // Simulate password change
            showMessage('Password changed successfully', 'success');
            
            // Clear password fields
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        }
        
        function updatePreferences() {
            const emailNotifications = document.getElementById('emailNotifications').checked;
            const smsNotifications = document.getElementById('smsNotifications').checked;
            const marketingEmails = document.getElementById('marketingEmails').checked;
            
            showMessage('Notification preferences updated', 'success');
        }
        
        function exportData() {
            showMessage('Data export initiated. You will receive an email with your data shortly.', 'success');
        }
        
        function deleteAccount() {
            if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
                if (confirm('This will permanently delete all your data. Are you absolutely sure?')) {
                    showMessage('Account deletion initiated. You will receive a confirmation email.', 'success');
                }
            }
        }
        
        // Message display function
        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 1rem 2rem;
                border-radius: 8px;
                color: white;
                font-weight: 500;
                z-index: 1000;
                max-width: 300px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            `;
            
            if (type === 'success') {
                messageDiv.style.background = '#4ADE80';
            } else if (type === 'error') {
                messageDiv.style.background = '#DC2626';
            } else {
                messageDiv.style.background = '#2B86C5';
            }
            
            messageDiv.textContent = message;
            document.body.appendChild(messageDiv);
            
            // Auto-remove after 3 seconds
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.parentNode.removeChild(messageDiv);
                }
            }, 3000);
        }
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Check if there are any upcoming bookings
            const bookingsGrid = document.getElementById('bookingsGrid');
            const upcomingBookings = bookingsGrid.querySelectorAll('.booking-card:not(.past-booking)');
            
            if (upcomingBookings.length === 0) {
                document.getElementById('emptyState').style.display = 'block';
            }
            
            // Check if there are any past bookings
            const pastBookingsGrid = document.getElementById('pastBookingsGrid');
            const pastBookings = pastBookingsGrid.querySelectorAll('.booking-card.past-booking');
            
            if (pastBookings.length === 0) {
                document.getElementById('pastBookingsEmptyState').style.display = 'block';
            }
            
            // Load user preferences from localStorage
            loadUserPreferences();
        });
        
        function loadUserPreferences() {
            // Load notification preferences
            const emailNotifications = localStorage.getItem('emailNotifications') === 'true';
            const smsNotifications = localStorage.getItem('smsNotifications') === 'true';
            const marketingEmails = localStorage.getItem('marketingEmails') === 'true';
            
            document.getElementById('emailNotifications').checked = emailNotifications;
            document.getElementById('smsNotifications').checked = smsNotifications;
            document.getElementById('marketingEmails').checked = marketingEmails;
        }
        
        // Save preferences to localStorage
        document.getElementById('emailNotifications').addEventListener('change', function() {
            localStorage.setItem('emailNotifications', this.checked);
        });
        
        document.getElementById('smsNotifications').addEventListener('change', function() {
            localStorage.setItem('smsNotifications', this.checked);
        });
        
        document.getElementById('marketingEmails').addEventListener('change', function() {
            localStorage.setItem('marketingEmails', this.checked);
        });
        
        // Sign out function
        // Basket management
        const BASKET_KEY = 'blkpages_basket';
        let selectedServices = [];
        
        function loadBasket() {
            const savedBasket = localStorage.getItem(BASKET_KEY);
            if (savedBasket) {
                const basketData = JSON.parse(savedBasket);
                selectedServices = basketData.selectedServices || [];
                updateBasketCount();
            }
        }
        
        function updateBasketCount() {
            const basketCount = document.getElementById('basketCount');
            if (basketCount) {
                basketCount.textContent = selectedServices.length;
            }
        }
        
        function scrollToBooking() {
            // For customer dashboard, scroll to a booking section or show message
            if (selectedServices.length > 0) {
                alert('You have ' + selectedServices.length + ' service(s) in your basket. Visit a business profile to complete your booking.');
            } else {
                alert('Your basket is empty. Browse businesses to add services.');
            }
        }
        
        // Customer menu functions
        function toggleCustomerMenu() {
            const dropdown = document.getElementById('customerDropdown');
            if (dropdown.style.display === 'none' || dropdown.style.display === '') {
                dropdown.style.display = 'block';
            } else {
                dropdown.style.display = 'none';
            }
        }
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const customerMenu = document.getElementById('customerMenu');
            const dropdown = document.getElementById('customerDropdown');
            
            if (customerMenu && dropdown && !customerMenu.contains(event.target)) {
                dropdown.style.display = 'none';
            }
        });
        
        // Check login status and show/hide customer menu
        function checkLoginStatus() {
            const isLoggedIn = localStorage.getItem('userLoggedIn') === 'true';
            const customerMenu = document.getElementById('customerMenu');
            const basketIcon = document.getElementById('basketIcon');
            
            if (customerMenu) {
                if (isLoggedIn) {
                    customerMenu.style.display = 'block';
                    
                    // Set customer initial
                    const userName = localStorage.getItem('userName') || 'Demo User';
                    const initial = userName.charAt(0).toUpperCase();
                    document.getElementById('customerInitialText').textContent = initial;
                } else {
                    customerMenu.style.display = 'none';
                }
            }
            
            if (basketIcon) {
                if (isLoggedIn) {
                    basketIcon.style.display = 'flex';
                } else {
                    basketIcon.style.display = 'none';
                }
            }
        }
        
        function signOut() {
            if (confirm('Are you sure you want to sign out?')) {
                // Clear all user data from localStorage
            localStorage.removeItem('userLoggedIn');
            localStorage.removeItem('userEmail');
            localStorage.removeItem('userName');
                localStorage.removeItem('userPhone');
                localStorage.removeItem('basketContents');
                
                // Show success message
                alert('You have been signed out successfully.');
                
                // Redirect to homepage
            window.location.href = 'index.html';
            }
        }

        // Rebook appointment function
        function rebookAppointment(businessName, businessUrl) {
            // Store the business name for potential use in the booking flow
            localStorage.setItem('rebookBusiness', businessName);
            
            // Show confirmation message
            if (confirm(`Redirecting to ${businessName} to book a new appointment. Continue?`)) {
                // Redirect to the business profile page
                window.location.href = businessUrl;
            }
        }
        
        // Cancellation Policy Logic
        function checkCancellationEligibility() {
            // In real implementation, this would check:
            // 1. Business cancellation policy
            // 2. Time until appointment
            // 3. Booking status
            
            // Sample data for demonstration
            const bookings = [
                {
                    id: 'booking1',
                    businessName: 'Royal Hair Studio',
                    appointmentDate: new Date('2024-12-28T14:00:00'), // 2 days from now
                    policy: 'moderate', // 48h notice required
                    canCancel: true
                },
                {
                    id: 'booking2', 
                    businessName: 'Beauty Studio',
                    appointmentDate: new Date('2024-12-30T10:00:00'), // 4 days from now
                    policy: 'strict', // Non-refundable
                    canCancel: false
                }
            ];
            
            bookings.forEach(booking => {
                const cancelBtn = document.getElementById(`cancelBtn${booking.id.slice(-1)}`);
                const nonRefundableNotice = document.getElementById(`nonRefundableNotice${booking.id.slice(-1)}`);
                
                if (booking.canCancel) {
                    cancelBtn.style.display = 'block';
                    nonRefundableNotice.style.display = 'none';
                } else {
                    cancelBtn.style.display = 'none';
                    nonRefundableNotice.style.display = 'block';
                }
            });
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
            loadBasket();
            checkCancellationEligibility();
            loadCustomerWaitingList();
            setupBookingEventListeners();
            checkPhoneVerificationStatus(); // Check phone verification status
            
            // Check if user came from Account Settings link
            if (localStorage.getItem('redirectToAccount') === 'true') {
                // Clear the flag
                localStorage.removeItem('redirectToAccount');
                // Switch to account tab
                showTab('account');
            }
        });

        // Setup booking event listeners
        function setupBookingEventListeners() {
            // Listen for booking.confirmed events
            window.addEventListener('booking.confirmed', function(event) {
                console.log('Booking confirmed event received:', event.detail);
                // Refresh customer bookings display
                loadCustomerBookings();
            });

            // Listen for booking.cancelled events
            window.addEventListener('booking.cancelled', function(event) {
                console.log('Booking cancelled event received:', event.detail);
                // Refresh customer bookings display
                loadCustomerBookings();
            });

            // Listen for booking updates
            window.addEventListener('bookingUpdated', function(event) {
                console.log('Booking updated event received:', event.detail);
                // Refresh customer bookings display
                loadCustomerBookings();
            });

            // Listen for booking.cancel events
            window.addEventListener('booking.cancel', function(event) {
                console.log('Booking cancel event received:', event.detail);
                // Refresh customer bookings display
                loadCustomerBookings();
                // Show cancellation notification
                showNotification('Booking cancelled successfully', 'success');
            });

            // Listen for waitinglist.join events
            window.addEventListener('waitinglist.join', function(event) {
                console.log('Customer received waitinglist.join event:', event.detail);
                // Refresh waiting list display
                loadCustomerWaitingList();
                // Show notification with position
                const position = event.detail.position;
                const message = position === 1 ? 
                    ' You are first in line!' : 
                    `You are position #${position} in the waiting list`;
                showNotification(message, 'success');
            });

            // Listen for waitinglist.offer.accept events
            window.addEventListener('waitinglist.offer.accept', function(event) {
                console.log('Customer received waitinglist.offer.accept event:', event.detail);
                // Refresh waiting list display
                loadCustomerWaitingList();
                // Show notification
                showNotification('Offer accepted - booking created!', 'success');
            });
        }
        
        // Loyalty FAQ toggle function
        function toggleLoyaltyFAQ(element) {
            const answer = element.nextElementSibling;
            const icon = element.querySelector('i');
            
            if (answer.classList.contains('show')) {
                answer.classList.remove('show');
                element.classList.remove('active');
            } else {
                // Close all other FAQ answers
                document.querySelectorAll('.faq-answer.show').forEach(openAnswer => {
                    openAnswer.classList.remove('show');
                });
                document.querySelectorAll('.faq-question.active').forEach(openQuestion => {
                    openQuestion.classList.remove('active');
                });
                
                // Open this answer
                answer.classList.add('show');
                element.classList.add('active');
            }
        }
        
        // Load and display customer bookings from localStorage
        function loadCustomerBookings() {
            const customerId = localStorage.getItem('customerId') || 'customer_1';
            const customerBookings = JSON.parse(localStorage.getItem(`customerBookings_${customerId}`) || '[]');
            const bookingsGrid = document.getElementById('bookingsGrid');
            
            if (!bookingsGrid) return;
            
            // Check business status for each booking
            const bookingsWithStatus = customerBookings.map(booking => {
                const businessStatus = getBusinessStatus(booking.businessId);
                return {
                    ...booking,
                    businessStatus: businessStatus
                };
            });
            
            // Clear existing bookings
            bookingsGrid.innerHTML = '';
            
            if (bookingsWithStatus.length === 0) {
                bookingsGrid.innerHTML = `
                    <div class="no-bookings">
                        <div class="no-bookings-icon"></div>
                        <h3>No bookings yet</h3>
                        <p>Start exploring businesses and book your first appointment!</p>
                        <a href="index.html" class="btn-primary">Browse Businesses</a>
                    </div>
                `;
                return;
            }
            
            // Display each booking
            bookingsWithStatus.forEach(booking => {
                const bookingCard = createBookingCard(booking);
                bookingsGrid.appendChild(bookingCard);
            });
        }
        
        // Get business status
        function getBusinessStatus(businessId) {
            try {
                const businesses = JSON.parse(localStorage.getItem('blkpages_businesses') || '[]');
                const business = businesses.find(b => b.id === businessId);
                return business ? business.status : 'unknown';
            } catch (error) {
                console.error('Error getting business status:', error);
                return 'unknown';
            }
        }
        
        // Create booking card HTML
        function createBookingCard(booking) {
            const card = document.createElement('div');
            card.className = 'booking-card';
            
            const statusClass = booking.status.toLowerCase().replace(' ', '-');
            const statusIcon = booking.status === 'Confirmed' ? '' : 
                             booking.status === 'Pending' ? '' : 
                             booking.status === 'Cancelled' ? '' : '';
            
            // Generate refund information if applicable
            const refundInfo = generateRefundInfo(booking);
            
            // Generate business status information
            const businessStatusInfo = generateBusinessStatusInfo(booking);
            
            card.innerHTML = `
                <div class="booking-header">
                    <div class="business-info">
                        <div class="business-logo">${booking.businessName.charAt(0)}</div>
                        <div class="business-details">
                            <h3>${booking.businessName}</h3>
                            <div class="business-category">Hair Salon</div>
                        </div>
                    </div>
                    <div class="booking-status status-${statusClass}">
                        ${statusIcon} ${booking.status}
                    </div>
                </div>
                
                <div class="booking-details">
                    <div class="detail-row">
                        <span class="detail-label">Date:</span>
                        <span class="detail-value">${booking.date}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Time:</span>
                        <span class="detail-value">${booking.time}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Payment:</span>
                        <span class="detail-value">${booking.paymentMethod === 'payNow' ? 'Paid Online' : 'Pay at Venue'}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Total:</span>
                        <span class="detail-value">${booking.totalAmount}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Booking ID:</span>
                        <span class="detail-value">${booking.bookingId}</span>
                    </div>
                    ${refundInfo}
                    ${businessStatusInfo}
                </div>
                
                <div class="services-list">
                    <div class="services-title">Services</div>
                    ${booking.services.map(service => `
                        <div class="service-item">
                            <span class="service-name">${service.name}</span>
                            <span class="service-price">${service.price}</span>
                        </div>
                    `).join('')}
                </div>
                
                ${booking.status === 'Confirmed' ? `
                    <div class="booking-actions">
                        <button class="btn-cancel" onclick="cancelBooking('${booking.bookingId}')">
                            <i class="fas fa-times"></i> Cancel Booking
                        </button>
                    </div>
                ` : ''}
            `;
            
            return card;
        }
        
        // Generate refund information for cancelled bookings
        function generateRefundInfo(booking) {
            if (booking.status === 'Cancelled' && booking.refundAmount) {
                const refundDate = booking.refundTimestamp ? 
                    new Date(booking.refundTimestamp).toLocaleDateString() : 
                    new Date().toLocaleDateString();
                
                return `
                    <div class="detail-row">
                        <span class="detail-label">Payment Status:</span>
                        <span class="detail-value">${booking.paymentStatus || 'Refunded'}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Refund Amount:</span>
                        <span class="detail-value refund-amount">${booking.refundAmount.toFixed(2)}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Refund Date:</span>
                        <span class="detail-value">${refundDate}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Refund Status:</span>
                        <span class="detail-value">${booking.refundStatus || 'Processed'}</span>
                    </div>
                `;
            } else if (booking.status === 'Cancelled' && booking.refundStatus === 'Non-refundable') {
                return `
                    <div class="detail-row">
                        <span class="detail-label">Payment Status:</span>
                        <span class="detail-value">Non-refundable</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Refund Status:</span>
                        <span class="detail-value">Non-refundable under business policy</span>
                    </div>
                `;
            }
            return '';
        }

        // Generate business status information
        function generateBusinessStatusInfo(booking) {
            const businessStatus = booking.businessStatus || 'unknown';
            
            if (businessStatus === 'active') {
                return '';
            }

            let statusMessage = '';
            let statusClass = 'business-status-info';
            
            switch (businessStatus) {
                case 'suspended':
                    statusMessage = ' This business is currently suspended. Your booking remains valid.';
                    statusClass += ' business-status-warning';
                    break;
                case 'deactivated':
                    statusMessage = ' This business is no longer active. Your booking remains valid.';
                    statusClass += ' business-status-error';
                    break;
                case 'pending':
                    statusMessage = ' This business is under review. Your booking remains valid.';
                    statusClass += ' business-status-info';
                    break;
                default:
                    statusMessage = ' Business status unknown. Your booking remains valid.';
                    statusClass += ' business-status-info';
            }

            return `
                <div class="${statusClass}">
                    <div class="detail-row">
                        <span class="detail-label">Business Status:</span>
                        <span class="detail-value">${statusMessage}</span>
                    </div>
                </div>
            `;
        }
        
        // Enhanced cancel booking function with API integration
        async function cancelBooking(bookingId) {
            if (confirm('Are you sure you want to cancel this booking?')) {
                try {
                    // Show loading state
                    showNotification('Processing cancellation...', 'info');
                    
                    // Call cancellation API
                    const response = await fetch('/api/bookings/cancel', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${localStorage.getItem('customerToken')}`
                        },
                        body: JSON.stringify({
                            bookingId: bookingId,
                            cancellationReason: 'Customer cancellation'
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                // Update booking status to cancelled
                updateBookingStatus(bookingId, 'Cancelled');
                        
                        // Add refund information if applicable
                        if (result.refundAmount > 0) {
                            updateBookingRefundInfo(bookingId, result.refundAmount, result.refundId);
                        }
                
                // Trigger booking.cancelled event
                triggerBookingCancelledEvent(bookingId, result);
                
                // Trigger storage event for real-time sync
                localStorage.setItem(`bookingCancelled_${bookingId}`, Date.now().toString());
                
                        // Show success notification
                        showNotification(result.message, 'success');
                
                // Reload bookings display
                loadCustomerBookings();
                    } else {
                        showNotification(result.message || 'Failed to cancel booking', 'error');
                    }
                } catch (error) {
                    console.error('Cancellation failed:', error);
                    showNotification('Failed to cancel booking. Please try again.', 'error');
                }
            }
        }

        // Trigger booking.cancelled event
        function triggerBookingCancelledEvent(bookingId, cancellationResult) {
            try {
                // Get booking details
                const customerId = localStorage.getItem('customerId') || 'customer_1';
                const customerBookings = JSON.parse(localStorage.getItem(`customerBookings_${customerId}`) || '[]');
                const booking = customerBookings.find(b => b.id === bookingId);
                
                if (!booking) {
                    console.error('Booking not found for cancellation event');
                    return;
                }
                
                // Create booking cancelled event data
                const bookingCancelledData = {
                    bookingId: bookingId,
                    customerId: customerId,
                    businessId: booking.businessId,
                    customerName: booking.customerName,
                    businessName: booking.businessName,
                    serviceName: booking.serviceName,
                    bookingDate: booking.bookingDate,
                    bookingTime: booking.bookingTime,
                    status: 'Cancelled',
                    cancellationReason: 'Customer cancelled',
                    refundAmount: cancellationResult.refundAmount || 0,
                    refundId: cancellationResult.refundId || null,
                    timestamp: new Date().toISOString()
                };
                
                // Dispatch custom event
                window.dispatchEvent(new CustomEvent('booking.cancelled', {
                    detail: bookingCancelledData
                }));
                
                console.log('Booking.cancelled event triggered:', bookingCancelledData);
            } catch (error) {
                console.error('Failed to trigger booking.cancelled event:', error);
            }
        }
        
        // Update booking with refund information
        function updateBookingRefundInfo(bookingId, refundAmount, refundId) {
            const customerId = localStorage.getItem('customerId') || 'customer_1';
            const customerBookings = JSON.parse(localStorage.getItem(`customerBookings_${customerId}`) || '[]');
            const bookingIndex = customerBookings.findIndex(b => b.bookingId === bookingId);
            
            if (bookingIndex !== -1) {
                customerBookings[bookingIndex].refundAmount = refundAmount;
                customerBookings[bookingIndex].refundId = refundId;
                customerBookings[bookingIndex].refundStatus = 'Processed';
                customerBookings[bookingIndex].refundTimestamp = new Date().toISOString();
                customerBookings[bookingIndex].paymentStatus = 'Refunded';
                localStorage.setItem(`customerBookings_${customerId}`, JSON.stringify(customerBookings));
            }
        }
        
        // Enhanced notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            // Add to page
            document.body.appendChild(notification);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 5000);
        }
        
        // Update booking status in localStorage
        function updateBookingStatus(bookingId, newStatus) {
            const customerId = localStorage.getItem('customerId') || 'customer_1';
            const customerBookings = JSON.parse(localStorage.getItem(`customerBookings_${customerId}`) || '[]');
            const bookingIndex = customerBookings.findIndex(b => b.bookingId === bookingId);
            
            if (bookingIndex !== -1) {
                customerBookings[bookingIndex].status = newStatus;
                customerBookings[bookingIndex].updatedAt = new Date().toISOString();
                localStorage.setItem(`customerBookings_${customerId}`, JSON.stringify(customerBookings));
            }
        }
        
        // Listen for booking status updates
        window.addEventListener('storage', function(e) {
            if (e.key && e.key.startsWith('bookingCancelled_')) {
                const bookingId = e.key.replace('bookingCancelled_', '');
                updateBookingStatus(bookingId, 'Cancelled');
                loadCustomerBookings(); // Refresh display
            }
        });
        
        // Initialize bookings on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadCustomerBookings();
            loadLoyaltyRewards();
            loadDemoLoyaltyData(); // Load demo data for punch card display
        });
        // ========================================
        // DEMO LOYALTY DATA LOADING
        // ========================================
        
        /**
         * Load comprehensive demo data for punch card loyalty system
         */
        function loadDemoLoyaltyData() {
            // Demo Businesses with different loyalty programs
            const demoBusinesses = [
                {
                    id: 'biz_glow_hair',
                    name: 'Glow Hair Studio',
                    logo: '',
                    plan: 'Professional',
                    timezone: 'Europe/London'
                },
                {
                    id: 'biz_zen_spa',
                    name: 'Zen Spa & Wellness',
                    logo: '',
                    plan: 'Starter',
                    timezone: 'Europe/London'
                },
                {
                    id: 'biz_city_nails',
                    name: 'City Nails & Beauty',
                    logo: '',
                    plan: 'Starter',
                    timezone: 'Europe/London'
                },
                {
                    id: 'biz_fresh_cuts',
                    name: 'Fresh Cuts Barbershop',
                    logo: '',
                    plan: 'Professional',
                    timezone: 'Europe/London'
                },
                {
                    id: 'biz_luxe_brow',
                    name: 'Luxe Brow Studio',
                    logo: '',
                    plan: 'FreeGrowth',
                    timezone: 'Europe/London'
                }
            ];
            
            // Demo Loyalty Programmes
            const demoLoyaltyProgrammes = [
                {
                    id: 'prog_glow_hair',
                    business_id: 'biz_glow_hair',
                    type: 'Visits',
                    threshold: 5,
                    reward_type: 'Free Service',
                    reward_value: 'Blow Dry',
                    expiry_days: 30,
                    terms: 'Valid for new customers only. Cannot be combined with other offers.',
                    active: true,
                    demo: true
                },
                {
                    id: 'prog_zen_spa',
                    business_id: 'biz_zen_spa',
                    type: 'Spend',
                    threshold: 200.00,
                    reward_type: 'Credit',
                    reward_value: '20',
                    expiry_days: 60,
                    terms: 'Credit can be used towards any service. Expires 60 days from issue.',
                    active: true,
                    demo: true
                },
                {
                    id: 'prog_city_nails',
                    business_id: 'biz_city_nails',
                    type: 'Visits',
                    threshold: 3,
                    reward_type: 'Discount',
                    reward_value: '20%',
                    expiry_days: 14,
                    terms: 'Discount applies to full service bookings only.',
                    active: true,
                    demo: true
                },
                {
                    id: 'prog_fresh_cuts',
                    business_id: 'biz_fresh_cuts',
                    type: 'Time',
                    threshold: 4,
                    reward_type: 'Free Service',
                    reward_value: 'Express Cut',
                    expiry_days: 45,
                    terms: 'Must complete 4 visits within 60 days. Valid for express services only.',
                    active: true,
                    demo: true
                },
                {
                    id: 'prog_luxe_brow',
                    business_id: 'biz_luxe_brow',
                    type: 'Visits',
                    threshold: 5,
                    reward_type: 'Free Service',
                    reward_value: 'Brow Wax',
                    expiry_days: 30,
                    terms: 'Free brow wax with any other service booking.',
                    active: true,
                    demo: true
                }
            ];
            
            // Demo Customer Progress (showing different states)
            const demoLoyaltyProgress = [
                // Customer 1: Glow Hair - 3/5 visits (progress state)
                {
                    id: 'progress_glow_1',
                    customer_id: 'customer_1',
                    business_id: 'biz_glow_hair',
                    total_visits: 3,
                    total_spend: 0,
                    last_visit: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),
                    reward_unlocked: false,
                    reward_redeemed: false,
                    reward_voucher_id: null,
                    demo: true
                },
                // Customer 1: Zen Spa - 2/5 visits (progress state)
                {
                    id: 'progress_zen_1',
                    customer_id: 'customer_1',
                    business_id: 'biz_zen_spa',
                    total_visits: 0,
                    total_spend: 120.00,
                    last_visit: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString(),
                    reward_unlocked: false,
                    reward_redeemed: false,
                    reward_voucher_id: null,
                    demo: true
                },
                // Customer 1: City Nails - 2/3 visits (progress state)
                {
                    id: 'progress_city_1',
                    customer_id: 'customer_1',
                    business_id: 'biz_city_nails',
                    total_visits: 2,
                    total_spend: 0,
                    last_visit: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
                    reward_unlocked: false,
                    reward_redeemed: false,
                    reward_voucher_id: null,
                    demo: true
                },
                // Customer 1: Fresh Cuts - 4/4 visits (unlocked state)
                {
                    id: 'progress_fresh_1',
                    customer_id: 'customer_1',
                    business_id: 'biz_fresh_cuts',
                    total_visits: 4,
                    total_spend: 0,
                    last_visit: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
                    reward_unlocked: true,
                    reward_redeemed: false,
                    reward_voucher_id: 'voucher_fresh_1',
                    demo: true
                },
                // Customer 1: Luxe Brow - 5/5 visits (redeemed state)
                {
                    id: 'progress_luxe_1',
                    customer_id: 'customer_1',
                    business_id: 'biz_luxe_brow',
                    total_visits: 5,
                    total_spend: 0,
                    last_visit: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString(),
                    reward_unlocked: true,
                    reward_redeemed: true,
                    reward_voucher_id: 'voucher_luxe_1',
                    redeemed_on: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                    demo: true
                }
            ];
            
            // Demo Reward Vouchers
            const demoRewardVouchers = [
                {
                    id: 'voucher_fresh_1',
                    code: 'BP-FR3SH1',
                    customer_id: 'customer_1',
                    business_id: 'biz_fresh_cuts',
                    reward_type: 'Free Service',
                    reward_value: 'Express Cut',
                    expiry_date: new Date(Date.now() + 45 * 24 * 60 * 60 * 1000).toISOString(),
                    redeemed: false,
                    expired: false,
                    created_at: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
                    demo: true
                },
                {
                    id: 'voucher_luxe_1',
                    code: 'BP-LUX3B1',
                    customer_id: 'customer_1',
                    business_id: 'biz_luxe_brow',
                    reward_type: 'Free Service',
                    reward_value: 'Brow Wax',
                    expiry_date: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                    redeemed: true,
                    expired: false,
                    redeemed_on: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                    created_at: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString(),
                    demo: true
                }
            ];
            
            // Demo Customer Bookings (to show booking history)
            const demoCustomerBookings = [
                {
                    id: 'booking_glow_1',
                    customer_id: 'customer_1',
                    business_id: 'biz_glow_hair',
                    service: 'Hair Cut & Style',
                    date: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),
                    status: 'Completed',
                    amount: 45.00,
                    demo: true
                },
                {
                    id: 'booking_glow_2',
                    customer_id: 'customer_1',
                    business_id: 'biz_glow_hair',
                    service: 'Hair Color',
                    date: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString(),
                    status: 'Completed',
                    amount: 85.00,
                    demo: true
                },
                {
                    id: 'booking_glow_3',
                    customer_id: 'customer_1',
                    business_id: 'biz_glow_hair',
                    service: 'Blow Dry',
                    date: new Date(Date.now() - 21 * 24 * 60 * 60 * 1000).toISOString(),
                    status: 'Completed',
                    amount: 25.00,
                    demo: true
                },
                {
                    id: 'booking_zen_1',
                    customer_id: 'customer_1',
                    business_id: 'biz_zen_spa',
                    service: 'Full Body Massage',
                    date: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString(),
                    status: 'Completed',
                    amount: 120.00,
                    demo: true
                },
                {
                    id: 'booking_city_1',
                    customer_id: 'customer_1',
                    business_id: 'biz_city_nails',
                    service: 'Manicure',
                    date: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
                    status: 'Completed',
                    amount: 35.00,
                    demo: true
                },
                {
                    id: 'booking_city_2',
                    customer_id: 'customer_1',
                    business_id: 'biz_city_nails',
                    service: 'Pedicure',
                    date: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString(),
                    status: 'Completed',
                    amount: 45.00,
                    demo: true
                },
                {
                    id: 'booking_fresh_1',
                    customer_id: 'customer_1',
                    business_id: 'biz_fresh_cuts',
                    service: 'Hair Cut',
                    date: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
                    status: 'Completed',
                    amount: 30.00,
                    demo: true
                },
                {
                    id: 'booking_luxe_1',
                    customer_id: 'customer_1',
                    business_id: 'biz_luxe_brow',
                    service: 'Brow Shaping',
                    date: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString(),
                    status: 'Completed',
                    amount: 25.00,
                    demo: true
                }
            ];
            
            // Store demo data in localStorage
            localStorage.setItem('demoBusinesses', JSON.stringify(demoBusinesses));
            localStorage.setItem('loyaltyProgrammes', JSON.stringify(demoLoyaltyProgrammes));
            localStorage.setItem('loyaltyProgress', JSON.stringify(demoLoyaltyProgress));
            localStorage.setItem('rewardVouchers', JSON.stringify(demoRewardVouchers));
            localStorage.setItem('customerBookings', JSON.stringify(demoCustomerBookings));
            
            // Set customer ID for demo
            localStorage.setItem('customerId', 'customer_1');
            
            console.log('Demo loyalty data loaded successfully!');
            console.log('Businesses:', demoBusinesses.length);
            console.log('Loyalty Programmes:', demoLoyaltyProgrammes.length);
            console.log('Progress Records:', demoLoyaltyProgress.length);
            console.log('Vouchers:', demoRewardVouchers.length);
            console.log('Bookings:', demoCustomerBookings.length);
        }
        
        // ========================================
        // LOYALTY REWARDS FUNCTIONS
        // ========================================
        
        /**
         * Load and display loyalty rewards based on progress states
         */
        function loadLoyaltyRewards() {
            const customerId = localStorage.getItem('customerId') || 'customer_1';
            const loyaltyProgress = JSON.parse(localStorage.getItem('loyaltyProgress') || '[]');
            const loyaltyProgrammes = JSON.parse(localStorage.getItem('loyaltyProgrammes') || '[]');
            const rewardVouchers = JSON.parse(localStorage.getItem('rewardVouchers') || '[]');
            
            const container = document.getElementById('loyaltyPrograms');
            
            if (loyaltyProgress.length === 0) {
                container.innerHTML = `
                    <div class="loyalty-empty">
                        <div class="empty-icon"></div>
                        <h3>No Loyalty Programs Yet</h3>
                        <p>Book with businesses that offer loyalty programs to start earning rewards!</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            loyaltyProgress.forEach(progress => {
                const programme = loyaltyProgrammes.find(p => p.business_id === progress.business_id);
                const voucher = rewardVouchers.find(v => v.id === progress.reward_voucher_id);
                
                if (programme) {
                    html += generateLoyaltyCard(progress, programme, voucher);
                }
            });
            
            container.innerHTML = html;
        }
        
        /**
         * Generate loyalty card based on progress state
         */
        function generateLoyaltyCard(progress, programme, voucher) {
            const businessName = getBusinessName(progress.business_id);
            const businessLogo = getBusinessLogo(progress.business_id);
            
            if (progress.reward_unlocked === false) {
                return generateProgressCard(progress, programme, businessName, businessLogo);
            } else if (progress.reward_unlocked === true && progress.reward_redeemed === false) {
                return generateRewardCard(progress, programme, voucher, businessName, businessLogo);
            } else if (progress.reward_redeemed === true) {
                return generateRedeemedCard(progress, programme, voucher, businessName, businessLogo);
            }
        }
        
        /**
         * Check if customer has made bookings with a specific business
         */
        function checkCustomerBookings(customerId, businessId) {
            try {
                const bookings = JSON.parse(localStorage.getItem('customerBookings') || '[]');
                return bookings.some(booking => 
                    booking.customer_id === customerId && 
                    booking.business_id === businessId && 
                    booking.status === 'Completed'
                );
            } catch (error) {
                console.error('Error checking customer bookings:', error);
                return false;
            }
        }

        /**
         * Generate progress card (reward_unlocked == false)
         * Enhanced with first booking check and digital punch card design
         */
        function generateProgressCard(progress, programme, businessName, businessLogo) {
            // Check if customer has made any bookings with this business
            const hasBookings = checkCustomerBookings(progress.customer_id, progress.business_id);
            
            if (!hasBookings) {
                return `
                    <div class="loyalty-card first-booking-card">
                        <div class="loyalty-header">
                            <div class="business-info">
                                <div class="business-logo">${businessLogo}</div>
                                <div class="business-details">
                                    <h3>${businessName}</h3>
                                    <p>Loyalty Program</p>
                                </div>
                            </div>
                            <div class="loyalty-status">
                                <span class="status-badge pending">Pending</span>
                            </div>
                        </div>
                        
                        <div class="first-booking-message">
                            <div class="message-icon"></div>
                            <div class="message-content">
                                <h4>Complete your first booking to start earning rewards!</h4>
                                <p>Your loyalty card will appear here after your first completed booking.</p>
                            </div>
                        </div>
                        
                        <div class="loyalty-reward">
                            <div class="reward-icon"></div>
                            <div class="reward-info">
                                <div class="reward-title">Reward</div>
                                <div class="reward-description">${getRewardDescription(programme)}</div>
                            </div>
                            <div class="reward-status">
                                <span class="status-available">Available after first booking</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            const currentProgress = programme.type === 'Visits' ? progress.total_visits : progress.total_spend;
            const threshold = programme.threshold;
            const percentage = Math.min((currentProgress / threshold) * 100, 100);
            const remaining = threshold - currentProgress;
            
            const progressText = programme.type === 'Visits' 
                ? `${progress.total_visits} of ${threshold} visits completed`
                : `${progress.total_spend.toFixed(2)} of ${threshold} spent`;
            
            const remainingText = programme.type === 'Visits'
                ? `${remaining} more visits needed`
                : `${remaining.toFixed(2)} more to spend`;
            
            return `
                <div class="loyalty-card">
                    <div class="loyalty-header">
                        <div class="business-info">
                            <div class="business-logo">${businessLogo}</div>
                            <div class="business-details">
                                <h3>${businessName}</h3>
                                <p>Loyalty Program</p>
                            </div>
                        </div>
                        <div class="loyalty-status">
                            <span class="status-badge active">Active</span>
                        </div>
                    </div>
                    
                    <div class="loyalty-progress">
                        <div class="progress-info">
                            <div class="progress-text">${progressText}</div>
                            <div class="progress-percentage">${Math.round(percentage)}%</div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percentage}%;"></div>
                        </div>
                        <div class="progress-details">
                            <span class="progress-label">${getProgrammeDescription(programme)}</span>
                            <span class="progress-remaining">${remainingText}</span>
                        </div>
                    </div>
                    
                    <div class="loyalty-reward">
                        <div class="reward-icon"></div>
                        <div class="reward-info">
                            <div class="reward-title">Reward</div>
                            <div class="reward-description">${getRewardDescription(programme)}</div>
                        </div>
                        <div class="reward-status">
                            <span class="status-locked">Locked</span>
                        </div>
                    </div>
                </div>
            `;
        }
        
        /**
         * Generate reward card (reward_unlocked == true, reward_redeemed == false)
         */
        function generateRewardCard(progress, programme, voucher, businessName, businessLogo) {
            const voucherCode = voucher ? voucher.id.substring(0, 8).toUpperCase() : 'BP-' + Math.random().toString(36).substr(2, 6).toUpperCase();
            const expiryDate = voucher ? new Date(voucher.expires_at).toLocaleDateString() : new Date(Date.now() + (programme.expiry_days * 24 * 60 * 60 * 1000)).toLocaleDateString();
            
            return `
                <div class="loyalty-card reward-unlocked">
                    <div class="loyalty-header">
                        <div class="business-info">
                            <div class="business-logo">${businessLogo}</div>
                            <div class="business-details">
                                <h3>${businessName}</h3>
                                <p>Loyalty Program</p>
                            </div>
                        </div>
                        <div class="loyalty-status">
                            <span class="status-badge unlocked">Reward Unlocked!</span>
                        </div>
                    </div>
                    
                    <div class="reward-card">
                        <div class="reward-card-header">
                            <div class="reward-icon"></div>
                            <div class="reward-title">You've unlocked a reward!</div>
                        </div>
                        
                        <div class="reward-details">
                            <div class="reward-type">${getRewardDescription(programme)}</div>
                            <div class="reward-code">
                                <span class="code-label">Code:</span>
                                <span class="code-value">${voucherCode}</span>
                            </div>
                            <div class="reward-expiry">
                                <span class="expiry-label">Expires:</span>
                                <span class="expiry-date">${expiryDate}</span>
                            </div>
                        </div>
                        
                        <div class="reward-actions">
                            <button class="btn-use-reward" onclick="useRewardNow('${progress.id}', '${voucherCode}', '${progress.business_id}')">
                                <i class="fas fa-gift"></i>
                                Use Reward Now
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        /**
         * Generate redeemed card (reward_redeemed == true)
         */
        function generateRedeemedCard(progress, programme, voucher, businessName, businessLogo) {
            const redeemedDate = voucher && voucher.used_at ? new Date(voucher.used_at).toLocaleDateString() : new Date().toLocaleDateString();
            
            return `
                <div class="loyalty-card reward-redeemed">
                    <div class="loyalty-header">
                        <div class="business-info">
                            <div class="business-logo">${businessLogo}</div>
                            <div class="business-details">
                                <h3>${businessName}</h3>
                                <p>Loyalty Program</p>
                            </div>
                        </div>
                        <div class="loyalty-status">
                            <span class="status-badge redeemed">Reward Redeemed</span>
                        </div>
                    </div>
                    
                    <div class="redeemed-info">
                        <div class="redeemed-icon"></div>
                        <div class="redeemed-text">
                            <div class="redeemed-title">Reward redeemed on ${redeemedDate}</div>
                            <div class="redeemed-description">Your progress has been reset. Start earning your next reward!</div>
                        </div>
                    </div>
                    
                    <div class="reset-progress">
                        <button class="btn-reset-progress" onclick="resetLoyaltyProgress('${progress.id}')">
                            <i class="fas fa-refresh"></i>
                            Reset Progress
                        </button>
                    </div>
                </div>
            `;
        }
        
        /**
         * Use reward function
         */
        function useReward(progressId, voucherCode) {
            if (confirm('Are you sure you want to use this reward? This action cannot be undone.')) {
                // Mark reward as redeemed
                const loyaltyProgress = JSON.parse(localStorage.getItem('loyaltyProgress') || '[]');
                const progressIndex = loyaltyProgress.findIndex(p => p.id === progressId);
                
                if (progressIndex !== -1) {
                    loyaltyProgress[progressIndex].reward_redeemed = true;
                    loyaltyProgress[progressIndex].updated_at = new Date().toISOString();
                    localStorage.setItem('loyaltyProgress', JSON.stringify(loyaltyProgress));
                    
                    // Update voucher
                    const rewardVouchers = JSON.parse(localStorage.getItem('rewardVouchers') || '[]');
                    const voucherIndex = rewardVouchers.findIndex(v => v.id === loyaltyProgress[progressIndex].reward_voucher_id);
                    
                    if (voucherIndex !== -1) {
                        rewardVouchers[voucherIndex].used = true;
                        rewardVouchers[voucherIndex].used_at = new Date().toISOString();
                        localStorage.setItem('rewardVouchers', JSON.stringify(rewardVouchers));
                    }
                    
                    // Reload display
                    loadLoyaltyRewards();
                    
                    alert('Reward used successfully! Your progress has been reset.');
                }
            }
        }

        /**
         * Use reward now (enhanced with promo code pre-fill)
         */
        function useRewardNow(progressId, voucherCode, businessId) {
            try {
                // Check if voucher is expired
                const rewardVouchers = JSON.parse(localStorage.getItem('rewardVouchers') || '[]');
                const voucher = rewardVouchers.find(v => v.id === voucherCode);
                
                if (voucher) {
                    const now = new Date();
                    const expiryDate = new Date(voucher.expires_at);
                    
                    if (now > expiryDate) {
                        alert('This reward has expired. Keep booking to earn another!');
                        return;
                    }
                }
                
                // Store the promo code for pre-filling at checkout
                localStorage.setItem('prefillPromoCode', voucherCode);
                localStorage.setItem('prefillBusinessId', businessId);
                
                // Redirect to business profile for booking
                const businessProfileUrl = `business-profile.html?business=${businessId}&promo=${voucherCode}`;
                window.open(businessProfileUrl, '_blank');
                
                // Show confirmation message
                alert('Redirecting to booking page with your reward code pre-filled!');
                
            } catch (error) {
                console.error('Error using reward now:', error);
                alert('Error processing reward. Please try again.');
            }
        }
        
        /**
         * Reset loyalty progress
         */
        function resetLoyaltyProgress(progressId) {
            if (confirm('Are you sure you want to reset your progress? This will start your loyalty journey over.')) {
                const loyaltyProgress = JSON.parse(localStorage.getItem('loyaltyProgress') || '[]');
                const progressIndex = loyaltyProgress.findIndex(p => p.id === progressId);
                
                if (progressIndex !== -1) {
                    loyaltyProgress[progressIndex].total_visits = 0;
                    loyaltyProgress[progressIndex].total_spend = 0;
                    loyaltyProgress[progressIndex].reward_unlocked = false;
                    loyaltyProgress[progressIndex].reward_redeemed = false;
                    loyaltyProgress[progressIndex].reward_voucher_id = null;
                    loyaltyProgress[progressIndex].updated_at = new Date().toISOString();
                    
                    localStorage.setItem('loyaltyProgress', JSON.stringify(loyaltyProgress));
                    loadLoyaltyRewards();
                    
                    alert('Progress reset successfully! Start earning your next reward.');
                }
            }
        }
        
        /**
         * Helper functions
         */
        function getBusinessName(businessId) {
            // Check demo businesses first
            const demoBusinesses = JSON.parse(localStorage.getItem('demoBusinesses') || '[]');
            const demoBusiness = demoBusinesses.find(b => b.id === businessId);
            if (demoBusiness) return demoBusiness.name;
            
            // Fallback to hardcoded names
            const businessNames = {
                'business_001': 'Glow Hair',
                'business_002': 'Spa Haven',
                'business_003': 'Luxe Beauty'
            };
            return businessNames[businessId] || 'Business';
        }
        
        function getBusinessLogo(businessId) {
            // Check demo businesses first
            const demoBusinesses = JSON.parse(localStorage.getItem('demoBusinesses') || '[]');
            const demoBusiness = demoBusinesses.find(b => b.id === businessId);
            if (demoBusiness) return demoBusiness.logo;
            
            // Fallback to hardcoded logos
            const businessLogos = {
                'business_001': 'GH',
                'business_002': 'SH',
                'business_003': 'LB'
            };
            return businessLogos[businessId] || 'B';
        }
        
        function getProgrammeDescription(programme) {
            if (programme.type === 'Visits') {
                return `Book ${programme.threshold} visits, get reward`;
            } else if (programme.type === 'Spend') {
                return `Spend ${programme.threshold}, get reward`;
            } else if (programme.type === 'Time') {
                return `Book ${programme.threshold} visits within time limit, get reward`;
            }
            return 'Complete requirements to earn reward';
        }
        
        function getRewardDescription(programme) {
            if (programme.reward_type === 'Free Service') {
                return '1 Free Service';
            } else if (programme.reward_type === 'Discount') {
                return `${programme.reward_value}% off next booking`;
            } else if (programme.reward_type === 'Credit') {
                return `${programme.reward_value} off next booking`;
            }
            return programme.reward_value;
        }

        // ========================================
        // CUSTOMER WAITING LIST FUNCTIONS
        // ========================================

        /**
         * Load and display customer waiting list
         */
        function loadCustomerWaitingList() {
            const customerId = localStorage.getItem('customerId') || 'customer_1';
            const waitingList = JSON.parse(localStorage.getItem(`customerWaitingList_${customerId}`) || '[]');
            
            updateCustomerWaitingListStats(waitingList);
            displayCustomerWaitingList(waitingList);
        }

        /**
         * Update customer waiting list statistics
         */
        function updateCustomerWaitingListStats(waitingList) {
            const totalWaiting = waitingList.filter(item => item.status === 'waiting').length;
            const offersReceived = waitingList.filter(item => item.status === 'offered').length;
            const offersAccepted = waitingList.filter(item => item.status === 'accepted').length;

            document.getElementById('totalWaitingList').textContent = totalWaiting;
            document.getElementById('offersReceived').textContent = offersReceived;
            document.getElementById('offersAccepted').textContent = offersAccepted;

            // Update tab badge
            const badge = document.getElementById('waitingListTabBadge');
            if (offersReceived > 0) {
                badge.textContent = offersReceived;
                badge.style.display = 'inline';
            } else {
                badge.style.display = 'none';
            }
        }

        /**
         * Display customer waiting list items
         */
        function displayCustomerWaitingList(waitingList) {
            const container = document.getElementById('waitingListContent');
            
            if (waitingList.length === 0) {
                container.innerHTML = `
                    <div class="waiting-list-empty">
                        <i class="fas fa-clock"></i>
                        <h3>No waiting lists</h3>
                        <p>When you join waiting lists for businesses, they'll appear here.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = waitingList.map(item => `
                <div class="waiting-list-item ${item.status}">
                    <div class="business-info">
                        <div class="business-name">
                            ${item.businessName || 'Business'}
                            ${item.position ? `
                                <span class="position-indicator">
                                    ${item.position === 1 ? ' First in line!' : `Position #${item.position}`}
                                </span>
                            ` : ''}
                        </div>
                        <div class="business-details">
                            <div>Joined: ${new Date(item.joinedAt).toLocaleDateString()}</div>
                            <div>Priority: ${item.priority || 0}</div>
                            ${item.availableSlot ? `
                                <div>Available: ${item.availableSlot.date} at ${item.availableSlot.time}</div>
                            ` : ''}
                        </div>
                        <div class="service-info">
                            <strong>${item.serviceData.name}</strong> - ${item.serviceData.price}
                        </div>
                    </div>
                    <div class="waiting-list-actions">
                        ${item.status === 'waiting' ? `
                            <button class="btn-sm btn-secondary" onclick="leaveWaitingList('${item.id}')">
                                <i class="fas fa-times"></i> Leave List
                            </button>
                        ` : item.status === 'offered' ? `
                            <button class="btn-sm btn-success" onclick="acceptOffer('${item.id}')">
                                <i class="fas fa-check"></i> Accept Offer
                            </button>
                            <button class="btn-sm btn-danger" onclick="rejectOffer('${item.id}')">
                                <i class="fas fa-times"></i> Decline
                            </button>
                        ` : `
                            <span class="status-badge">Accepted</span>
                        `}
                    </div>
                </div>
            `).join('');
        }

        /**
         * Accept offer from waiting list
         */
        function acceptOffer(waitingListId) {
            if (!confirm('Are you sure you want to accept this offer? This will create a booking.')) {
                return;
            }

            const customerId = localStorage.getItem('customerId') || 'customer_1';
            const waitingList = JSON.parse(localStorage.getItem(`customerWaitingList_${customerId}`) || '[]');
            const item = waitingList.find(item => item.id === waitingListId);
            
            if (!item) {
                showNotification('Offer not found', 'error');
                return;
            }

            // Create booking from offer
            const booking = {
                id: `booking_${Date.now()}`,
                customerId: customerId,
                businessId: item.businessId,
                businessName: item.businessName,
                services: [item.serviceData],
                date: item.availableSlot.date,
                time: item.availableSlot.time,
                totalAmount: item.serviceData.price,
                status: 'Confirmed',
                paymentMethod: 'payNow',
                source: 'waiting_list',
                createdAt: new Date().toISOString()
            };

            // Save to customer bookings
            const customerBookings = JSON.parse(localStorage.getItem(`customerBookings_${customerId}`) || '[]');
            customerBookings.push(booking);
            localStorage.setItem(`customerBookings_${customerId}`, JSON.stringify(customerBookings));

            // Save to business bookings
            const businessBookings = JSON.parse(localStorage.getItem(`businessBookings_${item.businessId}`) || '[]');
            businessBookings.push(booking);
            localStorage.setItem(`businessBookings_${item.businessId}`, JSON.stringify(businessBookings));

            // Remove from waiting lists
            const updatedWaitingList = waitingList.filter(waitingItem => waitingItem.id !== waitingListId);
            localStorage.setItem(`customerWaitingList_${customerId}`, JSON.stringify(updatedWaitingList));

            // Remove from business waiting list
            const businessWaitingList = JSON.parse(localStorage.getItem(`businessWaitingList_${item.businessId}`) || '[]');
            const updatedBusinessWaitingList = businessWaitingList.filter(businessItem => businessItem.id !== waitingListId);
            localStorage.setItem(`businessWaitingList_${item.businessId}`, JSON.stringify(updatedBusinessWaitingList));

            showNotification('Offer accepted! Booking created successfully.', 'success');
            loadCustomerWaitingList();
        }

        /**
         * Reject offer from waiting list
         */
        function rejectOffer(waitingListId) {
            if (!confirm('Are you sure you want to decline this offer?')) {
                return;
            }

            const customerId = localStorage.getItem('customerId') || 'customer_1';
            const waitingList = JSON.parse(localStorage.getItem(`customerWaitingList_${customerId}`) || '[]');
            const item = waitingList.find(item => item.id === waitingListId);
            
            if (!item) {
                showNotification('Offer not found', 'error');
                return;
            }

            // Update status back to waiting
            item.status = 'waiting';
            item.availableSlot = null;
            item.offerSentAt = null;
            
            localStorage.setItem(`customerWaitingList_${customerId}`, JSON.stringify(waitingList));

            // Also update business waiting list
            const businessWaitingList = JSON.parse(localStorage.getItem(`businessWaitingList_${item.businessId}`) || '[]');
            const businessItem = businessWaitingList.find(businessItem => businessItem.id === waitingListId);
            if (businessItem) {
                businessItem.status = 'waiting';
                businessItem.availableSlot = null;
                businessItem.offerSentAt = null;
                localStorage.setItem(`businessWaitingList_${item.businessId}`, JSON.stringify(businessWaitingList));
            }

            showNotification('Offer declined', 'info');
            loadCustomerWaitingList();
        }

        /**
         * Leave waiting list
         */
        function leaveWaitingList(waitingListId) {
            if (!confirm('Are you sure you want to leave this waiting list?')) {
                return;
            }

            const customerId = localStorage.getItem('customerId') || 'customer_1';
            const waitingList = JSON.parse(localStorage.getItem(`customerWaitingList_${customerId}`) || '[]');
            const item = waitingList.find(item => item.id === waitingListId);
            
            if (!item) {
                showNotification('Waiting list item not found', 'error');
                return;
            }

            // Remove from customer waiting list
            const updatedWaitingList = waitingList.filter(waitingItem => waitingItem.id !== waitingListId);
            localStorage.setItem(`customerWaitingList_${customerId}`, JSON.stringify(updatedWaitingList));

            // Remove from business waiting list
            const businessWaitingList = JSON.parse(localStorage.getItem(`businessWaitingList_${item.businessId}`) || '[]');
            const updatedBusinessWaitingList = businessWaitingList.filter(businessItem => businessItem.id !== waitingListId);
            localStorage.setItem(`businessWaitingList_${item.businessId}`, JSON.stringify(updatedBusinessWaitingList));

            showNotification('Left waiting list successfully', 'success');
            loadCustomerWaitingList();
        }

        // ==================== PHONE VERIFICATION SYSTEM ====================
        
        /**
         * Initialize phone verification system
         */
        function initializePhoneVerification() {
            const customerId = localStorage.getItem('customerId') || 'customer_1';
            
            // Check verification status
            checkPhoneVerificationStatus(customerId);
        }

        /**
         * Check phone verification status
         */
        function checkPhoneVerificationStatus(customerId) {
            try {
                const status = window.verifiedCustomerNumbers.getVerificationStatus(customerId);
                updatePhoneVerificationUI(status);
            } catch (error) {
                console.error('Error checking phone verification status:', error);
            }
        }

        /**
         * Update phone verification UI
         */
        function updatePhoneVerificationUI(status) {
            const statusBadge = document.getElementById('phoneStatusBadge');
            const phoneWarning = document.getElementById('phoneWarning');
            
            if (status.is_verified) {
                if (statusBadge) {
                    statusBadge.className = 'status-badge verified';
                    statusBadge.innerHTML = '<i class="fas fa-check"></i> Verified';
                }
                if (phoneWarning) {
                    phoneWarning.classList.add('hidden');
                }
            } else {
                if (statusBadge) {
                    statusBadge.className = 'status-badge unverified';
                    statusBadge.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Unverified';
                }
                if (phoneWarning) {
                    phoneWarning.classList.remove('hidden');
                }
            }
        }

        /**
         * Initiate phone verification
         */
        async function initiatePhoneVerification() {
            const customerId = localStorage.getItem('customerId') || 'customer_1';
            const phoneNumber = document.getElementById('phoneNumber').value;
            
            if (!phoneNumber) {
                showNotification('Please enter a phone number', 'error');
                return;
            }

            try {
                const result = await window.verifiedCustomerNumbers.initiateVerification(customerId, phoneNumber);
                
                if (result.success) {
                    // Show verification code section
                    document.getElementById('verificationCodeSection').style.display = 'block';
                    document.getElementById('verifyPhoneBtn').disabled = true;
                    document.getElementById('verifyPhoneBtn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Code Sent';
                    
                    showNotification(result.message, 'success');
                }
            } catch (error) {
                console.error('Error initiating phone verification:', error);
                showNotification(error.message, 'error');
            }
        }

        /**
         * Verify phone code
         */
        async function verifyPhoneCode() {
            const customerId = localStorage.getItem('customerId') || 'customer_1';
            const code = document.getElementById('verificationCode').value;
            
            if (!code) {
                showNotification('Please enter the verification code', 'error');
                return;
            }

            try {
                const result = await window.verifiedCustomerNumbers.verifyCode(customerId, code);
                
                if (result.success) {
                    // Update UI
                    document.getElementById('verificationCodeSection').style.display = 'none';
                    document.getElementById('verifyPhoneBtn').disabled = false;
                    document.getElementById('verifyPhoneBtn').innerHTML = '<i class="fas fa-paper-plane"></i> Send Code';
                    document.getElementById('phoneNumber').value = '';
                    document.getElementById('verificationCode').value = '';
                    
                    // Update status
                    checkPhoneVerificationStatus(customerId);
                    
                    showNotification(result.message, 'success');
                }
            } catch (error) {
                console.error('Error verifying phone code:', error);
                showNotification(error.message, 'error');
            }
        }

        /**
         * Resend verification code
         */
        async function resendVerificationCode() {
            const customerId = localStorage.getItem('customerId') || 'customer_1';
            
            try {
                const result = await window.verifiedCustomerNumbers.resendVerificationCode(customerId);
                
                if (result.success) {
                    showNotification(result.message, 'success');
                }
            } catch (error) {
                console.error('Error resending verification code:', error);
                showNotification(error.message, 'error');
            }
        }

        /**
         * Initialize phone verification on page load
         */
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize phone verification after a short delay to ensure systems are loaded
            setTimeout(initializePhoneVerification, 1000);
            
            // Initialize contextual banners
            initializeContextualBanners();
        });
        
        // Contextual Banner Functions
        function initializeContextualBanners() {
            // Simulate different banner states for demo purposes
            // In a real system, these would be determined by actual user data
            
            // Show waiting list offer banner (demo)
            setTimeout(() => {
                showBanner('waitingListBanner');
            }, 2000);
            
            // Show review request banner after completed booking (demo)
            setTimeout(() => {
                showBanner('reviewRequestBanner');
            }, 4000);
        }
        
        function showBanner(bannerId) {
            const banner = document.getElementById(bannerId);
            if (banner) {
                banner.style.display = 'block';
                banner.style.animation = 'slideIn 0.3s ease-out';
            }
        }
        
        function dismissBanner(bannerId) {
            const banner = document.getElementById(bannerId);
            if (banner) {
                banner.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    banner.style.display = 'none';
                }, 300);
            }
        }
        
        function acceptWaitingListOffer() {
            console.log('Accepting waiting list offer...');
            // TODO: Implement waiting list offer acceptance
            alert('Waiting list offer accepted! Redirecting to booking...');
            dismissBanner('waitingListBanner');
        }
        
        function updatePaymentMethod() {
            console.log('Opening payment method update...');
            // TODO: Implement payment method update
            alert('Opening payment method update...');
            dismissBanner('paymentFailureBanner');
        }
        
        function writeReview() {
            console.log('Opening review form...');
            // TODO: Implement review writing
            alert('Opening review form...');
            dismissBanner('reviewRequestBanner');
        }
        
        function openAccountSettings() {
            console.log('Opening account settings...');
            // TODO: Implement account settings navigation
            alert('Opening account settings...');
            dismissBanner('privacyReminderBanner');
        }
        
        // Add slideOut animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideOut {
                from {
                    opacity: 1;
                    transform: translateY(0);
                }
                to {
                    opacity: 0;
                    transform: translateY(-10px);
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>