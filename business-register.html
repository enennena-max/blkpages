<!DOCTYPE html>
<html lang="en" class="bg-[#0A0A0A] text-white">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>List Your Business - BlkPages</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme:{extend:{colors:{gold:"#D4AF37", goldLight: "#E5C96A", blk:"#0A0A0A", grey:"#BFBFBF", fieldBg: "rgba(40,40,40,0.7)", fieldBorder: "rgba(255,255,255,0.18)"},boxShadow:{goldGlow:"0 0 25px rgba(212,175,55,.4)"}}}
    }
  </script>
  <!-- Added Google Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    /* Use Poppins font */
    body{font-family:'Poppins', sans-serif;}
    input,select,textarea{transition:all .25s ease;}
    input:focus,select:focus,textarea:focus{border-color:#D4AF37!important;box-shadow:0 0 8px rgba(212,175,55,.6);outline:none;}
    .plan.active, .addon.active{border-color:#D4AF37!important;box-shadow:0 0 20px rgba(212,175,55,.4);}
    /* Screen-reader only class */
    .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border-width: 0;
    }
     /* Custom checkbox style */
    .day-checkbox:checked {
        background-color: #D4AF37;
        border-color: #D4AF37;
    }
     /* Style addon descriptions */
    .addon-desc {
        flex-basis: 100%; /* Make description take full width below title */
        margin-top: 0.25rem; /* Add some space below title */
    }
    /* Styles for feature lists inside plan cards */
    ul.features {
        list-style: none;
        padding: 0;
        margin: 15px 0; /* Add margin top/bottom */
        text-align: left;
        flex-grow: 1;
    }
    ul.features li {
        display: flex;
        align-items: center;
        margin: 6px 0; /* Adjust spacing */
        font-size: 0.8rem; /* Make features text slightly smaller */
        color: #e6e6e6;
    }
    .tick {
        color: #FFD700;
        font-weight: 700;
        margin-right: 8px; /* Adjust spacing */
        min-width: 15px;
    }
    .cross {
        color: #777;
        font-weight: 700;
        margin-right: 8px; /* Adjust spacing */
        min-width: 15px;
    }
  </style>
</head>
<body class="relative min-h-screen bg-blk text-white overflow-x-hidden">
  <div class="absolute inset-0 bg-[radial-gradient(circle_at_20%_20%,rgba(212,175,55,.18)_0%,transparent_60%),radial-gradient(circle_at_80%_60%,rgba(212,175,55,.1)_0%,transparent_70%)] opacity-30"></div>

  <!-- NAV -->
  <header class="relative z-10 border-b border-[#2a2a2a] bg-black/70 backdrop-blur-md">
    <div class="max-w-7xl mx-auto px-4 py-4 flex flex-wrap justify-between items-center">
      <span class="text-gold font-bold text-lg">BlkPages</span>
      <nav class="flex flex-wrap gap-6 text-sm">
        <a class="hover:text-gold" href="#">Home</a><a class="hover:text-gold" href="#">Browse</a>
        <a class="hover:text-gold" href="#">Offers</a><a class="hover:text-gold" href="#">Showcase</a>
      </nav>
    </div>
  </header>

  <!-- MAIN -->
  <main class="relative z-10 max-w-7xl mx-auto px-4 py-10 grid grid-cols-1 md:grid-cols-2 gap-8">
    <!-- LEFT FORM -->
    <form id="bizForm" class="bg-black/70 border border-[#2a2a2a] rounded-lg p-6 md:p-8 space-y-8 shadow-[0_0_40px_rgba(212,175,55,.07)]" novalidate>
      <h1 class="text-2xl font-semibold text-white">Business Information</h1>
      
      <div>
        <label for="businessName" class="sr-only">Business Name</label>
        <input id="businessName" required name="businessName" placeholder="Business Name*" class="w-full bg-[#1a1a1a] border border-[#333] rounded-md px-3 py-2 text-sm">
      </div>
      
      <div>
        <label for="category" class="sr-only">Category</label>
        <select id="category" required name="category" class="w-full bg-[#1a1a1a] border border-[#333] rounded-md px-3 py-2 text-sm text-gray-400">
          <option value="" class="text-gray-500">Select Category*</option>
          <option class="text-white">Hair Salon</option>
          <option class="text-white">Barber</option>
          <option class="text-white">Nails & Beauty</option>
          <option class="text-white">Makeup Artist</option>
          <option class="text-white">Skin / Aesthetics</option>
          <option class="text-white">Personal Trainer</option>
          <option class="text-white">Other</option>
        </select>
      </div>

      <div>
          <label for="description" class="sr-only">Business Description</label>
          <textarea id="description" required name="description" rows="3" placeholder="Business Description*" class="w-full bg-[#1a1a1a] border border-[#333] rounded-md px-3 py-2 text-sm"></textarea>
      </div>
      
      <!-- CONTACT INFO -->
      <div>
            <h3 class="text-gold text-lg font-semibold mb-4">Contact Information</h3>
            <div class="grid grid-cols-1 gap-5">
              <div>
                <label for="phone" class="sr-only">Phone Number</label>
                <input id="phone" required name="phone" type="tel" placeholder="Phone Number*" class="w-full bg-[#1a1a1a] border border-[#333] rounded-md px-3 py-2 text-sm" />
              </div>

              <div>
                <label for="email" class="sr-only">Email Address</label>
                <input id="email" required type="email" name="email" placeholder="Email Address*" class="w-full bg-[#1a1a1a] border border-[#333] rounded-md px-3 py-2 text-sm" />
              </div>

              <div>
                <label for="website" class="sr-only">Website (Optional)</label>
                <input id="website" type="url" name="website" placeholder="Website (Optional)" class="w-full bg-[#1a1a1a] border border-[#333] rounded-md px-3 py-2 text-sm" />
              </div>
            </div>
       </div>

       <!-- LOCATION -->
       <div>
            <h3 class="text-gold text-lg font-semibold mb-4">Location</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
              <div class="md:col-span-2">
                <label for="street" class="sr-only">Street Address</label>
                <input id="street" required name="street" placeholder="Street Address*" class="w-full bg-[#1a1a1a] border border-[#333] rounded-md px-3 py-2 text-sm" />
              </div>

              <div>
                <label for="city" class="sr-only">City</label>
                <input id="city" required name="city" placeholder="City*" class="w-full bg-[#1a1a1a] border border-[#333] rounded-md px-3 py-2 text-sm" />
              </div>

              <div>
                <label for="county" class="sr-only">County</label>
                <input id="county" required name="county" placeholder="County / Borough*" class="w-full bg-[#1a1a1a] border border-[#333] rounded-md px-3 py-2 text-sm" />
              </div>

              <div>
                <label for="postcode" class="sr-only">Postcode</label>
                <input id="postcode" required name="postcode" placeholder="Postcode*" class="w-full bg-[#1a1a1a] border border-[#333] rounded-md px-3 py-2 text-sm" />
              </div>

              <div>
                <label for="serviceArea" class="sr-only">Service Area</label>
                <input id="serviceArea" required name="serviceArea" placeholder="Service Area (e.g. 10 mile radius)*" class="w-full bg-[#1a1a1a] border border-[#333] rounded-md px-3 py-2 text-sm" />
              </div>
            </div>
       </div>

        <!-- BUSINESS HOURS -->
        <div>
            <h3 class="text-gold text-lg font-semibold mb-4">Business Hours</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
              <div>
                <label for="openTime" class="text-sm font-medium text-gray-400 mb-1 block">Opening Time <span class="text-red-500">*</span></label>
                <input id="openTime" required type="time" name="openTime" class="w-full bg-[#1a1a1a] border border-[#333] text-gray-400 text-sm rounded-md px-3 py-2.5" />
              </div>

              <div>
                <label for="closeTime" class="text-sm font-medium text-gray-400 mb-1 block">Closing Time <span class="text-red-500">*</span></label>
                <input id="closeTime" required type="time" name="closeTime" class="w-full bg-[#1a1a1a] border border-[#333] text-gray-400 text-sm rounded-md px-3 py-2.5" />
              </div>

              <!-- [UPDATED] Days Open Checkboxes -->
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-white mb-2">
                    Days Open <span class="text-red-500">*</span>
                </label>
                <div id="daysOpenContainer" class="grid grid-cols-2 sm:grid-cols-3 gap-x-4 gap-y-3 mt-2 p-3 border border-transparent transition-all bg-[#1a1a1a] border-[#333] rounded-md">
                    <label class="flex items-center space-x-2 cursor-pointer text-sm">
                        <input type="checkbox" name="daysOpen" value="Monday"
                            class="day-checkbox rounded bg-fieldBg border-fieldBorder text-gold focus:ring-gold">
                        <span>Monday</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer text-sm">
                        <input type="checkbox" name="daysOpen" value="Tuesday"
                            class="day-checkbox rounded bg-fieldBg border-fieldBorder text-gold focus:ring-gold">
                        <span>Tuesday</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer text-sm">
                        <input type="checkbox" name="daysOpen" value="Wednesday"
                            class="day-checkbox rounded bg-fieldBg border-fieldBorder text-gold focus:ring-gold">
                        <span>Wednesday</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer text-sm">
                        <input type="checkbox" name="daysOpen" value="Thursday"
                            class="day-checkbox rounded bg-fieldBg border-fieldBorder text-gold focus:ring-gold">
                        <span>Thursday</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer text-sm">
                        <input type="checkbox" name="daysOpen" value="Friday"
                            class="day-checkbox rounded bg-fieldBg border-fieldBorder text-gold focus:ring-gold">
                        <span>Friday</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer text-sm">
                        <input type="checkbox" name="daysOpen" value="Saturday"
                            class="day-checkbox rounded bg-fieldBg border-fieldBorder text-gold focus:ring-gold">
                        <span>Saturday</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer text-sm">
                        <input type="checkbox" name="daysOpen" value="Sunday"
                            class="day-checkbox rounded bg-fieldBg border-fieldBorder text-gold focus:ring-gold">
                        <span>Sunday</span>
                    </label>
                </div>
              </div>
            </div>
       </div>

      <!-- BOOKING POLICY -->
       <div>
            <h3 class="text-gold text-lg font-semibold mb-4">Booking Policy</h3>
            <div class="grid grid-cols-1 gap-5">
              <div>
                <label for="cancellationPolicy" class="text-sm font-medium text-white mb-2 block">Cancellation Policy <span class="text-red-500">*</span></label>
                <select id="cancellationPolicy" required name="cancellationPolicy" class="w-full bg-[#1a1a1a] border border-[#333] text-gray-400 text-sm rounded-md px-3 py-2.5">
                  <option value="" class="text-gray-500">Select Policy*</option>
                  <option class="text-white" value="flexible">Flexible</option>
                  <option class="text-white" value="moderate">Moderate</option>
                  <option class="text-white" value="strict">Strict</option>
                </select>
              </div>

              <div>
                <label for="extraInfo" class="text-sm font-medium text-white mb-2 block">Additional Booking Information</label>
                <textarea id="extraInfo" name="extraInfo" rows="3" class="w-full bg-[#1a1a1a] border border-[#333] text-white text-sm rounded-md px-3 py-2.5"
                  placeholder="Any extra info customers should know (arrival time, policies, etc.)"></textarea>
              </div>

              <div>
                <label for="paymentModel" class="block text-sm font-medium mb-2">Payment Model <span class="text-red-500">*</span></label>
                <select required id="paymentModel" name="paymentModel" class="w-full bg-[#1a1a1a] border border-[#333] rounded-md px-3 py-2 text-sm text-gray-400">
                    <option value="" class="text-gray-500">Select Payment Model*</option>
                    <option class="text-white" value="full_online">Full payment online</option>
                    <option class="text-white" value="deposit_then_balance">Deposit online + pay balance at venue</option>
                    <option class="text-white" value="in_person">Full payment at venue</option>
                </select>
                <p class="text-xs text-grey mt-2">How customers will pay for your services. <b>This cannot be changed after setup.</b></p>
              </div>
            </div>
       </div>

        <!-- ACCOUNT INFO -->
       <div>
            <h3 class="text-gold text-lg font-semibold mb-4">Account Information</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
              <div class="md:col-span-2">
                <label for="ownerName" class="sr-only">Owner / Manager Name</label>
                <input id="ownerName" required name="ownerName" placeholder="Owner / Manager Name*" class="w-full bg-[#1a1a1a] border border-[#333] rounded-md px-3 py-2 text-sm" />
              </div>

              <div>
                <label for="password" class="sr-only">Password</label>
                <input id="password" required type="password" name="password" minlength="6" placeholder="Password*" class="w-full bg-[#1a1a1a] border border-[#333] rounded-md px-3 py-2 text-sm" />
              </div>

              <div>
                <label for="confirmPassword" class="sr-only">Confirm Password</label>
                <input id="confirmPassword" required type="password" name="confirmPassword" minlength="6" placeholder="Confirm Password*" class="w-full bg-[#1a1a1a] border border-[#333] rounded-md px-3 py-2 text-sm" />
              </div>
            </div>
       </div>

      <!-- PAYMENT INFO (hidden until needed) -->
      <div id="paySection" class="hidden space-y-4 pt-4 border-t border-[#333]">
        <h2 class="text-gold font-semibold">Payment Information</h2>
        <div>
            <label for="cardName" class="sr-only">Cardholder Name</label>
            <input id="cardName" name="cardName" placeholder="Cardholder Name" class="w-full bg-[#1a1a1a] border border-[#333] rounded-md px-3 py-2 text-sm">
        </div>
        <div>
            <label for="cardNumber" class="sr-only">Card Number</label>
            <input id="cardNumber" name="cardNumber" placeholder="Card Number" class="w-full bg-[#1a1a1a] border border-[#333] rounded-md px-3 py-2 text-sm">
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label for="cardExpiry" class="sr-only">Expiry MM/YY</label>
            <input id="cardExpiry" name="cardExpiry" placeholder="Expiry MM/YY" class="w-full bg-[#1a1a1a] border border-[#333] rounded-md px-3 py-2 text-sm">
          </div>
          <div>
            <label for="cardCvv" class="sr-only">CVV</label>
            <input id="cardCvv" name="cardCvv" placeholder="CVV" class="w-full bg-[#1a1a1a] border border-[#333] rounded-md px-3 py-2 text-sm">
          </div>
        </div>
        <div>
            <label for="billingAddress" class="sr-only">Billing Address</label>
            <input id="billingAddress" name="billingAddress" placeholder="Billing Address" class="w-full bg-[#1a1a1a] border border-[#333] rounded-md px-3 py-2 text-sm">
        </div>
        
        <!-- Payment Summary -->
        <div id="summary" class="border-t border-[#333] pt-4 text-sm space-y-1">
          <p class="font-semibold text-gold">Payment Summary</p>
          <p id="planSum">Plan: Free (£0)</p>
          <p id="addonsSum">Add-ons: £0</p>
          <p id="todaySum" class="font-semibold">Today: £0</p>
          <p id="monthlySum">Recurring: £0/month</p>
          <p id="yearLine" class="hidden text-grey text-xs">You've selected a yearly plan. You'll be charged yearly.</p>
        </div>
      </div>

      <!-- Error Message Area -->
       <p id="formErrorMsg" class="hidden text-[13px] text-yellow-400 font-medium flex items-start gap-2">
            <span class="text-lg leading-none">⚠</span>
            <span></span> <!-- Error text injected by JS -->
       </p>

      <button id="submitBtn" type="submit" class="w-full bg-gold text-black font-semibold py-3 rounded-md shadow-goldGlow hover:bg-[#E5C96A] transition">Create Business Listing</button>
    </form>

    <!-- RIGHT PLANS -->
    <aside class="bg-black/70 border border-[#2a2a2a] rounded-lg p-6 md:p-8 shadow-[0_0_40px_rgba(212,175,55,.07)] space-y-8 h-fit">
      <h2 class="text-xl font-semibold text-white mb-2">Choose Your Plan</h2>

      <!-- FREE -->
      <div class="plan border border-[#333] rounded-md p-4 cursor-pointer active" data-plan="free" data-price="0">
        <p class="font-semibold">Free Listing</p>
        <p class="text-xs text-grey">£0 / forever</p>
        <!-- ADDED FEATURES -->
        <ul class="features">
          <li><span class="tick">✓</span>Business listing with category visibility</li>
          <li><span class="tick">✓</span>Basic contact details</li>
          <li><span class="tick">✓</span>Standard search placement</li>
          <li><span class="cross">✗</span>Business logo and photo gallery</li>
          <li><span class="cross">✗</span>Customer review highlights</li>
          <li><span class="cross">✗</span>Booking system (basic or advanced)</li>
          <li><span class="cross">✗</span>Analytics or insights</li>
          <li><span class="cross">✗</span>Management dashboard</li>
          <li><span class="cross">✗</span>Marketing tools</li>
        </ul>
        <button type="button" class="select-plan-btn mt-2 text-xs text-gold">✓ Selected</button>
      </div>

      <!-- STARTER -->
      <div class="plan border border-[#333] rounded-md p-4 cursor-pointer" data-plan="starter" data-month="14.99" data-year="164.89">
        <div class="flex justify-between items-center"><p class="font-semibold">Starter</p>
          <label class="text-xs flex items-center gap-1 cursor-pointer"><input type="checkbox" class="yearToggle accent-gold h-3 w-3">Yearly<span class="text-[10px] text-gold">(Save £15)</span></label></div>
        <p class="planPrice text-xs text-grey">£14.99 / mo</p>
        <!-- ADDED FEATURES -->
        <ul class="features">
           <li><span class="tick">✓</span>Everything in Free</li>
           <li><span class="tick">✓</span>Business logo and photo gallery (up to 3 photos)</li>
           <li><span class="tick">✓</span>Customer review highlights</li>
           <li><span class="tick">✓</span>Booking calendar with service management</li>
           <li><span class="tick">✓</span>Automated email confirmations</li>
           <li><span class="tick">✓</span>Customer management dashboard</li>
           <li><span class="tick">✓</span>Priority placement in search</li>
           <li><span class="tick">✓</span>Analytics (basic performance trends)</li>
           <li><span class="cross">✗</span>Stripe integration (Full payment or deposits)</li>
           <li><span class="cross">✗</span>SMS booking confirmations + reminders</li>
        </ul>
        <button type="button" class="select-plan-btn mt-2 text-xs text-gold">Select Plan</button>
      </div>

      <!-- PROFESSIONAL -->
      <div class="plan border border-[#333] rounded-md p-4 cursor-pointer" data-plan="pro" data-month="28.99" data-year="318.89">
        <div class="flex justify-between items-center"><p class="font-semibold">Professional</p>
          <label class="text-xs flex items-center gap-1 cursor-pointer"><input type="checkbox" class="yearToggle accent-gold h-3 w-3">Yearly<span class="text-[10px] text-gold">(Save £29)</span></label></div>
        <p class="planPrice text-xs text-grey">£28.99 / mo</p>
        <!-- ADDED FEATURES -->
         <ul class="features">
           <li><span class="tick">✓</span>Everything in Starter</li>
           <li><span class="tick">✓</span>Photo gallery (up to 10 photos)</li>
           <li><span class="tick">✓</span>Advanced booking system with calendar sync</li>
           <li><span class="tick">✓</span>Stripe integration (Full payment or Deposits 10–50%)</li>
           <li><span class="tick">✓</span>SMS booking confirmations + reminders (50 texts)</li>
           <li><span class="tick">✓</span>Customer management dashboard</li>
           <li><span class="tick">✓</span>Business insights (bookings, revenue, busiest times)</li>
        </ul>
         <button type="button" class="select-plan-btn mt-2 text-xs text-gold">Select Plan</button>
      </div>

      <!-- ADD-ONS -->
      <div>
        <h3 class="text-gold font-semibold mb-2">Premium Add-Ons</h3>
        <!-- Modified Addon structure -->
        <div class="addon border border-[#333] rounded-md p-3 mb-2 cursor-pointer text-sm flex flex-wrap justify-between items-center" data-addon="sms" data-price="3">
            <span class="font-medium">💬 Extra SMS</span>
            <span class="text-xs text-grey">+£3/mo</span>
            <p class="addon-desc text-xs text-grey w-full">Send appointment reminders + updates</p>
            <button type="button" class="select-addon-btn text-xs text-gold mt-1">Add</button>
        </div>
        <div class="addon border border-[#333] rounded-md p-3 mb-2 cursor-pointer text-sm flex flex-wrap justify-between items-center" data-addon="featured" data-price="5">
            <span class="font-medium">⭐ Featured Listing</span>
            <span class="text-xs text-grey">+£5/mo</span>
            <p class="addon-desc text-xs text-grey w-full">Priority placement in search results</p>
            <button type="button" class="select-addon-btn text-xs text-gold mt-1">Add</button>
        </div>
        <div class="addon border border-[#333] rounded-md p-3 mb-2 cursor-pointer text-sm flex flex-wrap justify-between items-center" data-addon="social" data-price="4">
            <span class="font-medium">🔗 Social Widget</span>
            <span class="text-xs text-grey">+£4/mo</span>
             <p class="addon-desc text-xs text-grey w-full">Social media booking link widget</p>
            <button type="button" class="select-addon-btn text-xs text-gold mt-1">Add</button>
        </div>
         <div class="addon border border-[#333] rounded-md p-3 mb-2 cursor-pointer text-sm flex flex-wrap justify-between items-center" data-addon="loyalty" data-price="5">
             <span class="font-medium">🏆 Loyalty Rewards</span>
             <span class="text-xs text-grey">+£5/mo</span>
             <p class="addon-desc text-xs text-grey w-full">Digital punch card system for retention</p>
             <button type="button" class="select-addon-btn text-xs text-gold mt-1">Add</button>
         </div>
          <div class="addon border border-[#333] rounded-md p-3 mb-2 cursor-pointer text-sm flex flex-wrap justify-between items-center" data-addon="analytics" data-price="5">
              <span class="font-medium">📊 Advanced Analytics</span>
              <span class="text-xs text-grey">+£5/mo</span>
              <p class="addon-desc text-xs text-grey w-full">Performance & trends analysis</p>
              <button type="button" class="select-addon-btn text-xs text-gold mt-1">Add</button>
          </div>
           <div class="addon border border-[#333] rounded-md p-3 cursor-pointer text-sm flex flex-wrap justify-between items-center" data-addon="staff" data-price="2">
               <span class="font-medium">👥 Multi-Staff</span>
               <span class="text-xs text-grey">+£2/staff/mo</span>
               <p class="addon-desc text-xs text-grey w-full">Per extra staff member scheduling</p>
               <button type="button" class="select-addon-btn text-xs text-gold mt-1">Add</button>
           </div>
      </div>
    </aside>
  </main>
   <!-- FOOTER -->
  <footer class="relative z-10 bg-black/80 border-t border-[#2a2a2a] py-6 text-center text-sm text-grey">
    <div class="flex flex-col sm:flex-row items-center justify-between max-w-7xl mx-auto px-4">
      <div class="text-white font-semibold">BlkPages</div>
      <div>Quick Links</div>
      <div>Legal</div>
    </div>
  </footer>

  <script>
    const plans = document.querySelectorAll('.plan');
    const addons = document.querySelectorAll('.addon');
    const toggles = document.querySelectorAll('.yearToggle');
    const paySec = document.getElementById('paySection');
    const planSum = document.getElementById('planSum');
    const addonsSum = document.getElementById('addonsSum');
    const todaySum = document.getElementById('todaySum');
    const monthlySum = document.getElementById('monthlySum');
    const yearLine = document.getElementById('yearLine');
    const form = document.getElementById('bizForm');
    const formErrorMsgElement = document.getElementById("formErrorMsg");
    const formErrorMsgText = formErrorMsgElement.querySelector("span:last-child");
    const submitBtn = document.getElementById("submitBtn");
    const pwd = form.querySelector("#password"); // Use ID
    const confPwd = form.querySelector("#confirmPassword"); // Use ID

    let selPlan = 'free';
    let yearMode = false;
    let selAdd = []; // Store selected addon objects {name: 'sms', price: 3}
    let planPrice = 0; // Price of the selected plan (monthly or yearly)
    let addonTotal = 0; // Total monthly price of addons


    function updateSummary() {
        planPrice = 0;
        let planTxt = 'Free (£0)';
        let baseMonthly = 0; // Base monthly cost for recurring calc
        const activePlan = document.querySelector('.plan.active');
        
        if (selPlan !== 'free') {
            const planData = activePlan.dataset;
            yearMode = activePlan.querySelector('.yearToggle')?.checked || false;
            
            if (yearMode) {
                planPrice = parseFloat(planData.year);
                baseMonthly = parseFloat(planData.month); // Still use monthly for recurring calc base
                planTxt = `${activePlan.querySelector('p').textContent} (£${planPrice.toFixed(2)}/yr)`;
                yearLine.classList.remove('hidden');
            } else {
                planPrice = parseFloat(planData.month);
                baseMonthly = planPrice;
                planTxt = `${activePlan.querySelector('p').textContent} (£${planPrice.toFixed(2)}/mo)`;
                yearLine.classList.add('hidden');
            }
        } else {
             yearLine.classList.add('hidden');
             // Ensure yearMode is false if free plan is selected
             yearMode = false;
             // Uncheck any yearly toggles if free plan becomes active
             toggles.forEach(t => t.checked = false);
             plans.forEach(p => updatePlanDisplay(p)); // Update display price text
        }

        addonTotal = selAdd.reduce((sum, addon) => sum + parseFloat(addon.price), 0);

        planSum.textContent = 'Plan: ' + planTxt;
        // Update Addon summary text based on yearMode only if addons are selected
         if (addonTotal > 0) {
             // Addons are always monthly price, bill annually if yearMode
            addonsSum.textContent = `Add-ons: £${(yearMode ? addonTotal * 12 : addonTotal).toFixed(2)} ${yearMode ? '/yr (billed annually)' : '/mo'}`;
         } else {
            addonsSum.textContent = `Add-ons: £0.00`;
         }
        
        // Today's charge calculation
        let todayCharge = 0;
         if (yearMode && selPlan !== 'free') {
             todayCharge = planPrice + addonTotal * 12; // Yearly plan + 12 months of addons upfront
         } else {
             todayCharge = planPrice + addonTotal; // Monthly plan + 1 month of addons (even if free plan, addons cost monthly)
         }

        todaySum.textContent = `Today: £${todayCharge.toFixed(2)}`;

        // Recurring charge calculation
        let recurringMonthly = baseMonthly + addonTotal; // Base monthly plan + monthly addons
        if (selPlan === 'free') recurringMonthly = addonTotal; // Free plan only pays for addons

        if (yearMode && selPlan !== 'free') {
            // Calculate annual recurring (base plan annual price + 12 * monthly addon total)
            let recurringAnnual = planPrice + (addonTotal * 12);
            monthlySum.textContent = `Recurring: £${recurringAnnual.toFixed(2)}/year (renews annually)`;
        } else if (recurringMonthly > 0) {
             monthlySum.textContent = `Recurring: £${recurringMonthly.toFixed(2)}/month`;
        } else {
             monthlySum.textContent = `Recurring: £0/month`; // Handles Free plan with no addons
        }


        // Show payment section if there's a cost today
        paySec.classList.toggle('hidden', todayCharge === 0);
        // Also require payment fields if there's a cost
        paySec.querySelectorAll('input').forEach(input => {
            // Check if input exists before setting required
            if(input) input.required = todayCharge > 0;
        });

    }
    
    // Update plan price display based on toggle
    function updatePlanDisplay(planElement) {
        const planData = planElement.dataset;
        const priceElement = planElement.querySelector('.planPrice');
        const toggle = planElement.querySelector('.yearToggle');
        if (!toggle || !priceElement) return; // Free plan has no toggle or price element like others

        if (toggle.checked) {
             priceElement.textContent = `£${planData.year} / yr (Save £${(parseFloat(planData.month)*12 - parseFloat(planData.year)).toFixed(2)})`;
        } else {
             priceElement.textContent = `£${planData.month} / mo`;
        }
    }


    plans.forEach(p => {
        // Initial display update
        updatePlanDisplay(p); 
        
        p.onclick = (e) => {
            // Prevent toggle click from selecting plan if it was the target
            if (e.target.classList.contains('yearToggle') || e.target.closest('label')?.querySelector('.yearToggle')) {
               return;
            }
            
            // If clicking the already active plan, do nothing extra
            if (p.classList.contains('active')) return;

            plans.forEach(x => x.classList.remove('active'));
            p.classList.add('active');
            selPlan = p.dataset.plan;
             // Update button text
            plans.forEach(card => {
                const btn = card.querySelector('.select-plan-btn');
                if (btn) { // Check if button exists
                    btn.textContent = card === p ? '✓ Selected' : 'Select Plan';
                }
            });
            updateSummary();
        };
    });

    toggles.forEach(t => {
        t.onchange = () => {
             const parentPlan = t.closest('.plan');
             updatePlanDisplay(parentPlan); // Update text first
             if(parentPlan.classList.contains('active')) {
                updateSummary(); // Only update summary if active plan's toggle changed
             }
        };
    });

    addons.forEach(a => {
        const btn = a.querySelector('.select-addon-btn');
        a.onclick = (e) => {
             // Allow clicking anywhere on card except button to toggle
            if (e.target === btn) return; 
             toggleAddon(a); // Use separate function
        };
        // Allow button itself to toggle too
        btn.onclick = () => {
             toggleAddon(a);
        };
    });

    function toggleAddon(addonElement) {
        const btn = addonElement.querySelector('.select-addon-btn');
        const addonName = addonElement.dataset.addon;
        const addonPrice = addonElement.dataset.price;
        const existingIndex = selAdd.findIndex(x => x.name === addonName);

        if (existingIndex > -1) { // If exists, remove it
            selAdd.splice(existingIndex, 1);
            addonElement.classList.remove('active');
            btn.textContent = 'Add';
        } else { // If not exists, add it
            selAdd.push({ name: addonName, price: addonPrice });
            addonElement.classList.add('active');
            btn.textContent = '✓ Added';
        }
        updateSummary();
    }


    // --- Real-time Password Match Validation ---
    function validatePasswords() {
        // Make sure elements exist before accessing value
        const pwdVal = pwd ? pwd.value : '';
        const confPwdVal = confPwd ? confPwd.value : '';

        if(pwd) pwd.classList.remove("border-red-500");
        if(confPwd) confPwd.classList.remove("border-red-500");

        if (pwdVal !== confPwdVal && confPwdVal.length > 0) {
            if(pwd) pwd.classList.add("border-red-500");
            if(confPwd) confPwd.classList.add("border-red-500");
            return false;
        }
        return true;
    }
    if (confPwd) confPwd.addEventListener("input", validatePasswords);
    if (pwd) pwd.addEventListener("input", validatePasswords);


    // --- Form Submission Handler ---
    form.onsubmit = async e => {
        e.preventDefault();
        formErrorMsgElement.classList.add("hidden"); // Reset error
        let hasError = false;
        let firstErrorField = null;

        // 1. Basic required field check
        const requiredFields = form.querySelectorAll("[required]");
        requiredFields.forEach(field => {
            field.classList.remove("border-red-500");
             // Special check for select elements where placeholder is selected
            if ( (field.tagName === 'SELECT' && field.value === "") || (!field.value || field.value.trim() === "")) {
                 // Check if field is inside hidden payment section AND payment is required
                if (!field.closest('#paySection') || paySec.querySelectorAll('[required]').length > 0) {
                    hasError = true;
                    field.classList.add("border-red-500");
                    if (!firstErrorField) firstErrorField = field;
                 } else {
                     // If inside hidden payment section and NOT required, clear error
                     field.classList.remove("border-red-500");
                 }
            }
        });
        
         // 2. Check "Days Open" Checkboxes
        const daysOpenCheckboxes = form.querySelectorAll('input[name="daysOpen"]:checked');
        const daysOpenContainer = document.getElementById('daysOpenContainer'); 
        if(daysOpenContainer) daysOpenContainer.classList.remove("border-red-500"); 
        if (daysOpenCheckboxes.length === 0) {
            hasError = true;
            if(daysOpenContainer) daysOpenContainer.classList.add("border-red-500");
             if (!firstErrorField && daysOpenContainer) firstErrorField = daysOpenContainer; // Scroll to container
        }


        // 3. Password match check
        if (!validatePasswords()) {
            hasError = true;
            if (!firstErrorField && pwd) firstErrorField = pwd;
        }

        if (hasError) {
             formErrorMsgText.textContent = "Please correct the errors highlighted above.";
             formErrorMsgElement.classList.remove("hidden");
             firstErrorField?.scrollIntoView({ behavior: "smooth", block: "center" });
             return;
        }

        // --- If validation passes ---
        updateSummary(); // Ensure summary is final before collecting

        const formData = {
            businessName: form.businessName?.value.trim() || '',
            category: form.category?.value || '',
            description: form.description?.value.trim() || '',
            phone: form.phone?.value.trim() || '',
            email: form.email?.value.trim() || '',
            website: form.website?.value.trim() || '',
            street: form.street?.value.trim() || '',
            city: form.city?.value.trim() || '',
            county: form.county?.value.trim() || '',
            postcode: form.postcode?.value.trim() || '',
            serviceArea: form.serviceArea?.value.trim() || '',
            openTime: form.openTime?.value || '',
            closeTime: form.closeTime?.value || '',
            daysOpen: Array.from(daysOpenCheckboxes).map(cb => cb.value),
            cancellationPolicy: form.cancellationPolicy?.value || '',
            extraInfo: form.extraInfo?.value.trim() || '',
            paymentModel: form.paymentModel?.value || '',
            ownerName: form.ownerName?.value.trim() || '',
            // Don't send password directly, handle securely on backend
            // password: form.password.value, 
            plan: selPlan,
            yearly: yearMode,
            addons: selAdd.map(x => x.name),
            // Include payment details if section is visible (basic example)
            cardName: paySec.classList.contains('hidden') ? null : form.cardName?.value.trim(),
            cardNumber: paySec.classList.contains('hidden') ? null : form.cardNumber?.value.trim(),
            cardExpiry: paySec.classList.contains('hidden') ? null : form.cardExpiry?.value.trim(),
            cardCvv: paySec.classList.contains('hidden') ? null : form.cardCvv?.value.trim(),
            billingAddress: paySec.classList.contains('hidden') ? null : form.billingAddress?.value.trim(),
            // totals: { today: todaySum.textContent, recurring: monthlySum.textContent } // Optional: Send calculated totals
        };
        
        console.log("Form Data Submitted:", formData); // Log for debugging

        submitBtn.disabled = true;
        submitBtn.classList.add("opacity-50","cursor-not-allowed");
        submitBtn.textContent = "Processing...";

        try {
            // SIMULATE BACKEND REQUEST
             await new Promise(resolve => setTimeout(resolve, 1500)); 
            // Replace with actual fetch:
            // const response = await fetch('/api/create-business',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(formData)});
            // if (!response.ok) throw new Error('Network response was not ok');
            // const result = await response.json();
            // console.log('Success:', result);

            alert('✅ Your BlkPages listing has been created! (DEMO)');
             // window.location.href = '/dashboard'; // Redirect on real success

        } catch (error) {
            console.error('Submission Error:', error);
            formErrorMsgText.textContent = "Submission failed. Please try again.";
            formErrorMsgElement.classList.remove("hidden");
        } finally {
            submitBtn.disabled = false;
            submitBtn.classList.remove("opacity-50","cursor-not-allowed");
            submitBtn.textContent = "Create Business Listing";
        }
    };

    updateSummary(); // Initial calculation
  </script>
</body>
</html>