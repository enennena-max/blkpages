<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Confirmed - BlkPages</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Poppins:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Booking Encryption Utility -->
    <script src="js/booking-encryption.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                        'poppins': ['Poppins', 'sans-serif']
                    },
                    colors: {
                        'charcoal': '#121212',
                        'dark-grey': '#1A1A1A',
                        'light-grey': '#CCCCCC',
                        'gold': '#D4AF37',
                        'gold-dark': '#B8860B',
                        'neon-pink': '#FF3CAC',
                        'neon-blue': '#2B86C5',
                        'neon-green': '#4ADE80',
                        'neon-purple': '#784BA0'
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.8s ease-in-out',
                        'slide-up': 'slideUp 0.6s ease-out',
                        'glow': 'glow 2s ease-in-out infinite alternate',
                        'pulse-subtle': 'pulseSubtle 3s ease-in-out infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'shimmer': 'shimmer 2s linear infinite'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(30px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        glow: {
                            '0%': { boxShadow: '0 0 20px rgba(212, 175, 55, 0.2)' },
                            '100%': { boxShadow: '0 0 30px rgba(212, 175, 55, 0.4)' }
                        },
                        pulseSubtle: {
                            '0%, 100%': { opacity: '1' },
                            '50%': { opacity: '0.8' }
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-10px)' }
                        },
                        shimmer: {
                            '0%': { transform: 'translateX(-100%)' },
                            '100%': { transform: 'translateX(100%)' }
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        /* Custom gradient backgrounds */
        .gradient-bg {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 25%, #2a2a2a 50%, #1a1a1a 75%, #000000 100%);
        }
        
        .card-gradient {
            background: linear-gradient(145deg, 
                rgba(26,26,26,0.95) 0%, 
                rgba(42,42,42,0.9) 50%, 
                rgba(26,26,26,0.95) 100%);
        }
        
        .gold-gradient {
            background: linear-gradient(135deg, #D4AF37 0%, #B8860B 100%);
        }
        
        .border-glow {
            border: 1px solid rgba(212, 175, 55, 0.3);
        }
        
        .text-glow {
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }
        
        .hover-glow:hover {
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.3);
        }
        
        /* Success animation */
        .success-checkmark {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: block;
            stroke-width: 3;
            stroke: #D4AF37;
            stroke-miterlimit: 10;
            margin: 0 auto;
            box-shadow: inset 0px 0px 0px #D4AF37;
            animation: fill 0.4s ease-in-out 0.4s forwards, scale 0.3s ease-in-out 0.9s both;
        }
        
        .success-checkmark circle {
            stroke-dasharray: 166;
            stroke-dashoffset: 166;
            stroke-width: 3;
            stroke-miterlimit: 10;
            stroke: #D4AF37;
            fill: none;
            animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
        }
        
        .success-checkmark path {
            transform-origin: 50% 50%;
            stroke-dasharray: 48;
            stroke-dashoffset: 48;
            animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
        }
        
        @keyframes stroke {
            100% {
                stroke-dashoffset: 0;
            }
        }
        
        @keyframes scale {
            0%, 100% {
                transform: none;
            }
            50% {
                transform: scale3d(1.1, 1.1, 1);
            }
        }
        
        @keyframes fill {
            100% {
                box-shadow: inset 0px 0px 0px 30px #D4AF37;
            }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white font-inter">
    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 bg-charcoal/95 backdrop-blur-md border-b border-white/10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <!-- Logo -->
                <div class="flex items-center">
                    <a href="index.html" class="text-2xl font-bold text-white hover:text-gold transition-colors duration-300">BlkPages</a>
        </div>
        
                <!-- Navigation Links -->
                <div class="hidden md:flex items-center space-x-8">
                    <a href="index.html" class="text-light-grey hover:text-gold transition-colors duration-300 font-medium">Home</a>
                    <a href="search-results-new.html" class="text-light-grey hover:text-gold transition-colors duration-300 font-medium">Browse</a>
                    <a href="business-router.html" class="text-gold font-medium" style="background: linear-gradient(135deg, #D4AF37, #B8860B); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 600;">
                        <i class="fas fa-building mr-1"></i>Business Profile 2
                    </a>
        </div>
        
                <!-- Mobile Menu Button -->
                <div class="md:hidden">
                    <button onclick="toggleMobileMenu()" class="text-white hover:text-gold transition-colors duration-300">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Mobile Menu -->
        <div id="mobileMenu" class="md:hidden hidden bg-charcoal/95 backdrop-blur-md border-t border-white/10">
            <div class="px-4 py-4 space-y-4">
                <a href="index.html" class="block text-light-grey hover:text-gold transition-colors duration-300 font-medium">Home</a>
                <a href="search-results-new.html" class="block text-light-grey hover:text-gold transition-colors duration-300 font-medium">Browse</a>
                <a href="business-router.html" class="block text-gold font-medium" style="background: linear-gradient(135deg, #D4AF37, #B8860B); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 600;">
                    <i class="fas fa-building mr-2"></i>Business Profile 2
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="pt-16 pb-8">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Success Header -->
            <div class="text-center mb-12">
                <svg class="success-checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                    <circle class="success-checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
                    <path class="success-checkmark-check" fill="none" d="m14.1 27.2l7.1 7.2 16.7-16.8"/>
                </svg>
                <h1 class="text-4xl md:text-5xl font-bold text-white mt-8 mb-4">Booking Confirmed!</h1>
                <p class="text-xl text-light-grey">Your appointment has been successfully booked</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Booking Details -->
                <div class="lg:col-span-2 space-y-6">
                    <!-- Confirmation Details -->
                    <div class="card-gradient rounded-3xl p-8 border-glow">
                        <h2 class="text-2xl font-bold text-white mb-6 flex items-center">
                            <i class="fas fa-calendar-check mr-3 text-gold"></i>
                            Booking Details
                        </h2>
                        
                        <div id="bookingDetails" class="space-y-6">
                            <!-- Booking details will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Business Information -->
                    <div class="card-gradient rounded-3xl p-8 border-glow">
                        <h2 class="text-2xl font-bold text-white mb-6 flex items-center">
                            <i class="fas fa-building mr-3 text-gold"></i>
                            Business Information
                        </h2>
                        
                        <div id="businessInfo" class="space-y-4">
                            <!-- Business info will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- What's Next -->
                    <div class="card-gradient rounded-3xl p-8 border-glow">
                        <h2 class="text-2xl font-bold text-white mb-6 flex items-center">
                            <i class="fas fa-info-circle mr-3 text-gold"></i>
                            What's Next?
                        </h2>
                        
                        <div class="space-y-4">
                            <div class="flex items-start space-x-4">
                                <div class="flex-shrink-0 w-8 h-8 rounded-full bg-gold text-black flex items-center justify-center font-bold">1</div>
                                <div>
                                    <h3 class="text-lg font-semibold text-white mb-2">Confirmation Email</h3>
                                    <p class="text-light-grey">You'll receive a confirmation email with all the details within the next few minutes.</p>
                                </div>
                            </div>
                            
                            <div class="flex items-start space-x-4">
                                <div class="flex-shrink-0 w-8 h-8 rounded-full bg-gold text-black flex items-center justify-center font-bold">2</div>
                                <div>
                                    <h3 class="text-lg font-semibold text-white mb-2">Reminder Notifications</h3>
                                    <p class="text-light-grey">We'll send you a reminder 24 hours before your appointment.</p>
            </div>
        </div>
        
                            <div class="flex items-start space-x-4">
                                <div class="flex-shrink-0 w-8 h-8 rounded-full bg-gold text-black flex items-center justify-center font-bold">3</div>
                                <div>
                                    <h3 class="text-lg font-semibold text-white mb-2">Arrive on Time</h3>
                                    <p class="text-light-grey">Please arrive 5-10 minutes before your scheduled appointment time.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Privacy Notice -->
                    <div class="card-gradient rounded-3xl p-6 border-glow bg-gold/5">
                        <h2 class="text-xl font-bold text-white mb-4 flex items-center">
                            <i class="fas fa-lock mr-3 text-gold"></i>
                            Privacy Protection
                        </h2>
                        <p class="text-light-grey text-xs italic leading-relaxed">
                            For your privacy, BlkPages does not share your personal details directly with businesses.  
                            All bookings are securely managed through the business's BlkPages dashboard.  
                            Sensitive data such as your name, phone number, and address are encrypted before being sent.
                        </p>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="space-y-6">
                    <!-- Confirmation Number -->
                    <div class="card-gradient rounded-3xl p-6 border-glow">
                        <h3 class="text-xl font-bold text-white mb-4 flex items-center">
                            <i class="fas fa-receipt mr-3 text-gold"></i>
                            Confirmation
                        </h3>
                        <div class="text-center">
                            <p class="text-light-grey text-sm mb-2">Confirmation Number</p>
                            <p class="text-2xl font-bold text-gold" id="confirmationNumber">BK123456</p>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="card-gradient rounded-3xl p-6 border-glow">
                        <h3 class="text-xl font-bold text-white mb-4 flex items-center">
                            <i class="fas fa-tools mr-3 text-gold"></i>
                            Quick Actions
                        </h3>
                        <div class="space-y-3">
                            <button onclick="addToCalendar()" 
                                    class="w-full py-3 rounded-xl border border-white/20 text-white hover:bg-white/10 hover:border-gold/50 transition-all duration-300">
                                <i class="fas fa-calendar-plus mr-2"></i>Add to Calendar
                            </button>
                            <button onclick="shareBooking()" 
                                    class="w-full py-3 rounded-xl border border-white/20 text-white hover:bg-white/10 hover:border-gold/50 transition-all duration-300">
                                <i class="fas fa-share mr-2"></i>Share Booking
                            </button>
                            <button onclick="contactBusiness()" 
                                    class="w-full py-3 rounded-xl border border-white/20 text-white hover:bg-white/10 hover:border-gold/50 transition-all duration-300">
                                <i class="fas fa-phone mr-2"></i>Contact Business
                            </button>
            </div>
        </div>
        
                    <!-- Need Help -->
                    <div class="card-gradient rounded-3xl p-6 border-glow">
                        <h3 class="text-xl font-bold text-white mb-4 flex items-center">
                            <i class="fas fa-question-circle mr-3 text-gold"></i>
                            Need Help?
                        </h3>
                        <p class="text-light-grey text-sm mb-4">
                            If you have any questions about your booking, we're here to help.
                        </p>
                        <button onclick="contactSupport()" 
                                class="w-full py-3 rounded-xl gold-gradient text-black font-bold hover:shadow-lg hover:shadow-gold/30 transition-all duration-300">
                            <i class="fas fa-headset mr-2"></i>Contact Support
                        </button>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="text-center mt-12 space-y-4">
                <button onclick="bookAnother()" 
                        class="px-8 py-4 rounded-2xl gold-gradient text-black font-bold hover:shadow-lg hover:shadow-gold/30 transition-all duration-300 transform hover:scale-105 mr-4">
                    <i class="fas fa-plus mr-2"></i>Book Another Service
                </button>
                <button onclick="goHome()" 
                        class="px-8 py-4 rounded-2xl border border-white/20 text-white hover:bg-white/10 hover:border-gold/50 transition-all duration-300">
                    <i class="fas fa-home mr-2"></i>Back to Home
            </button>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-charcoal border-t border-white/10 py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center text-light-grey">
                <p>&copy; 2024 BlkPages. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        let bookingData = null;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadBookingData();
            
            // Create business notification for new booking
            if (bookingData) {
                createBusinessNotification();
            }
        });

        // Load booking data from localStorage
        function loadBookingData() {
            const stored = localStorage.getItem('bookingConfirmation');
            if (stored) {
                bookingData = JSON.parse(stored);
                displayBookingDetails();
            } else {
                // Fallback data
                bookingData = {
                    business: {
                        name: 'Royal Hair Studio',
                        location: '123 Hair Street, London, SW1A 1AA',
                        phone: '+44 20 7123 4567',
                        email: 'info@royalhairstudio.com'
                    },
                    service: {
                        name: 'Hair Cut & Style',
                        price: 35,
                        duration: 60
                    },
                    date: '2024-01-15',
                    time: '14:00',
                    customer: {
                        firstName: 'John',
                        lastName: 'Doe',
                        email: 'john.doe@example.com',
                        phone: '+44 7123 456789'
                    },
                    confirmationNumber: 'BK' + Date.now(),
                    total: 28
                };
                displayBookingDetails();
            }
        }

        // Display booking details
        function displayBookingDetails() {
            if (!bookingData) return;
            
            // Booking details
            const bookingContainer = document.getElementById('bookingDetails');
            const date = new Date(bookingData.date);
            const formattedDate = date.toLocaleDateString('en-GB', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            bookingContainer.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg font-semibold text-white mb-2">Service</h3>
                        <p class="text-light-grey">${bookingData.service.name}</p>
                        <p class="text-light-grey text-sm">${bookingData.service.duration} minutes</p>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-white mb-2">Date & Time</h3>
                        <p class="text-light-grey">${formattedDate}</p>
                        <p class="text-light-grey">${bookingData.time}</p>
                </div>
                    <div>
                        <h3 class="text-lg font-semibold text-white mb-2">Customer</h3>
                        <p class="text-light-grey">${bookingData.customer.firstName} ${bookingData.customer.lastName}</p>
                        <p class="text-light-grey text-sm">${bookingData.customer.email}</p>
                </div>
                    <div>
                        <h3 class="text-lg font-semibold text-white mb-2">Total Paid</h3>
                        <p class="text-gold font-bold text-xl">£${bookingData.total}</p>
                </div>
                </div>
            `;
            
            // Business info
            const businessContainer = document.getElementById('businessInfo');
            businessContainer.innerHTML = `
                <div class="space-y-4">
                    <div>
                        <h3 class="text-lg font-semibold text-white mb-2">${bookingData.business.name}</h3>
                        <p class="text-light-grey">${bookingData.business.location}</p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <a href="tel:${bookingData.business.phone}" class="flex items-center text-light-grey hover:text-gold transition-colors duration-300">
                            <i class="fas fa-phone mr-2"></i>
                            ${bookingData.business.phone}
                        </a>
                        <a href="mailto:${bookingData.business.email}" class="flex items-center text-light-grey hover:text-gold transition-colors duration-300">
                            <i class="fas fa-envelope mr-2"></i>
                            ${bookingData.business.email}
                        </a>
                </div>
                </div>
            `;
            
            // Confirmation number
            document.getElementById('confirmationNumber').textContent = bookingData.confirmationNumber;
        }

        // Add to calendar
        function addToCalendar() {
            const startDate = new Date(`${bookingData.date}T${bookingData.time}`);
            const endDate = new Date(startDate.getTime() + (bookingData.service.duration * 60000));
            
            const startStr = startDate.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
            const endStr = endDate.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
            
            const calendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(bookingData.service.name)}&dates=${startStr}/${endStr}&details=${encodeURIComponent(`Appointment at ${bookingData.business.name}`)}&location=${encodeURIComponent(bookingData.business.location)}`;
            
            window.open(calendarUrl, '_blank');
        }

        // Share booking
        function shareBooking() {
            const shareText = `I've booked ${bookingData.service.name} at ${bookingData.business.name} on ${new Date(bookingData.date).toLocaleDateString()} at ${bookingData.time}. Confirmation: ${bookingData.confirmationNumber}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'My Booking Confirmation',
                    text: shareText
                });
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('Booking details copied to clipboard!');
                });
            }
        }

        // Contact business
        function contactBusiness() {
            window.location.href = `tel:${bookingData.business.phone}`;
        }

        // Contact support
        function contactSupport() {
            window.location.href = 'mailto:support@blkpages.com?subject=Booking Support - ' + bookingData.confirmationNumber;
        }

        // Book another service
        function bookAnother() {
            window.location.href = 'search-results-new.html';
        }

        // Go home
        function goHome() {
            window.location.href = 'index.html';
        }

        // Mobile menu toggle
        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            menu.classList.toggle('hidden');
        }

        // Create business notification for new booking
        function createBusinessNotification() {
            if (!bookingData) return;
            
            // Encrypt complete booking data before sending to dashboard
            const encryptedBooking = window.BookingEncryption.encryptBookingData({
                customerName: `${bookingData.customer.firstName} ${bookingData.customer.lastName}`,
                email: bookingData.customer.email,
                phone: bookingData.customer.phone,
                address: `${bookingData.customer.addressLine1}, ${bookingData.customer.city}, ${bookingData.customer.postcode}`,
                service: bookingData.service.name,
                time: `${bookingData.date} at ${bookingData.time}`,
                notes: bookingData.specialRequests || '',
                total: bookingData.total,
                confirmationNumber: bookingData.confirmationNumber
            });
            
            // Send encrypted booking to dashboard
            sendToDashboard(encryptedBooking);
            
            // Create notification object with encrypted data
            const notification = {
                id: 'notif_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                type: "New Booking Request",
                customerName: window.BookingEncryption.getCustomerInitials(bookingData.customer), // Only show initials
                bookingDetails: {
                    service: bookingData.service.name,
                    date: bookingData.date,
                    time: bookingData.time,
                    price: `£${bookingData.total}`
                },
                encryptedBookingData: encryptedBooking,
                createdAt: new Date().toISOString(),
                viewed: false,
                businessId: 'royal-hair-studio'
            };
            
            // Get existing notifications
            const existingLogs = JSON.parse(localStorage.getItem('notification_logs') || '[]');
            existingLogs.push(notification);
            
            // Save to localStorage
            localStorage.setItem('notification_logs', JSON.stringify(existingLogs));
            
            console.log('🔒 Encrypted business notification created for new booking:', notification);
        }

        // Send encrypted booking data to dashboard
        function sendToDashboard(encryptedBooking) {
            try {
                const bookingId = 'bk_' + Date.now().toString().padStart(5, '0');
                
                // Create transmission record
                const transmission = {
                    type: "Encrypted Booking Transmission",
                    channel: "SYSTEM",
                    status: "SENT",
                    metadata: {
                        bookingId: bookingId,
                        encrypted: true,
                        readableFields: ["service", "date", "time", "price"],
                        encryptedFields: ["customerName", "email", "phone", "address", "notes"],
                        transmissionId: 'tx_' + Date.now(),
                        timestamp: new Date().toISOString()
                    }
                };
                
                // Store transmission log
                const transmissionLogs = JSON.parse(localStorage.getItem('transmission_logs') || '[]');
                transmissionLogs.push(transmission);
                localStorage.setItem('transmission_logs', JSON.stringify(transmissionLogs));
                
                // Store encrypted booking data
                const dashboardBookings = JSON.parse(localStorage.getItem('dashboard_bookings') || '[]');
                dashboardBookings.push({
                    id: bookingId,
                    encryptedData: encryptedBooking,
                    transmissionId: transmission.metadata.transmissionId,
                    receivedAt: new Date().toISOString(),
                    status: 'new',
                    readableFields: transmission.metadata.readableFields,
                    encryptedFields: transmission.metadata.encryptedFields
                });
                
                localStorage.setItem('dashboard_bookings', JSON.stringify(dashboardBookings));
                
                console.log('📤 Encrypted booking transmission sent:', transmission);
                console.log('🔒 Booking ID:', bookingId, '- Encrypted fields:', transmission.metadata.encryptedFields);
            } catch (error) {
                console.error('❌ Failed to send booking to dashboard:', error);
            }
        }
    </script>
</body>
</html>