<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Royal Hair Studio - BlkPages</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #0A0A0A;
        }

        .gold-gradient-text {
            background: linear-gradient(90deg, #FFD35C, #D4AF37);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .hero-gradient-bg {
             background: radial-gradient(circle at center, rgba(212,175,55,0.35) 0%, rgba(212,175,55,0.15) 35%, #0A0A0A 80%);
        }
        
        .connect-gradient-bg {
             background: linear-gradient(180deg, #1A1A1A 0%, #0A0A0A 100%);
        }
        
        .cta-gradient-bg {
             background: linear-gradient(to bottom, #0a0a0a, #1a1a1a);
        }
        
        .gold-gradient-button {
             background: linear-gradient(90deg, #ffcc00, #ffb700);
        }
        
        .gold-gradient-button-hover:hover {
             background: linear-gradient(90deg, #ffb700, #ffd700);
        }

        /* ===============================
           üñã BLKPAGES SEARCH SUBTEXT STYLE
           =============================== */

        .search-subtext {
         margin-top: 35px; /* increased spacing below search bar */
         display: flex;
         justify-content: center;
         align-items: center;
         flex-wrap: wrap;
         gap: 6px;
         font-size: 0.95rem;
         color: #CFCFCF; /* text colour */
         font-weight: 500;
         letter-spacing: 0.2px;
         text-align: center;
        }

        .search-subtext i {
         color: #FFD700; /* icon gold */
         font-size: 1rem;
        }

        /* Gold separator dot */
        .dot-separator {
         color: #D4AF37;
         padding: 0 6px;
        }

        /* ‚ú® Optional subtle pulse animation for icons */
        @keyframes goldPulse {
         0% { opacity: 0.7; transform: scale(1); }
         50% { opacity: 1; transform: scale(1.1); }
         100% { opacity: 0.7; transform: scale(1); }
        }

        .search-subtext i {
         animation: goldPulse 3s ease-in-out infinite;
        }

        /* üì± Responsive for mobile */
        @media (max-width: 600px) {
         .search-subtext {
           flex-direction: column;
           gap: 4px;
           font-size: 0.9rem;
           margin-top: 25px; /* smaller space on mobile */
         }
         .dot-separator {
           display: none;
         }
        }

        /* Navigation Styles */
        .nav-link {
            transition: all 0.3s ease;
        }
        
        .nav-link:hover {
            color: #D4AF37 !important;
        }
        
        /* Customer Menu Styles */
        .customer-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            min-width: 150px;
            z-index: 1000;
            margin-top: 0.5rem;
        }
        
        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: #ffffff;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .dropdown-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .dropdown-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body class="text-white">
    <header class="bg-[rgba(10,10,10,0.95)] backdrop-blur-md sticky top-0 z-50 border-b border-[#9C7C2E]">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between py-3">
                <!-- Logo and Nav Links -->
                <div class="flex items-center gap-8">
                    <a href="index.html" class="text-2xl font-bold text-[#D4AF37] tracking-wide">BlkPages</a>
                    <nav class="hidden md:flex items-center gap-6">
                        <a href="index.html" class="nav-link text-gray-400 hover:text-[#D4AF37] transition-colors duration-300">Home</a>
                        <a href="search-results.html" class="nav-link text-gray-400 hover:text-[#D4AF37] transition-colors duration-300">Browse</a>
                        <a href="offers.html" class="nav-link text-gray-400 hover:text-[#D4AF37] transition-colors duration-300">Offers</a>
                        <a href="preview-test.html" class="nav-link text-gray-400 hover:text-[#D4AF37] transition-colors duration-300" style="background: linear-gradient(135deg, #FF3CAC, #784BA0); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 600;">
                            <i class="fas fa-flask mr-1"></i>Preview Test
                        </a>
                        <a href="demo-hub.html" class="nav-link text-gray-400 hover:text-[#D4AF37] transition-colors duration-300" style="background: linear-gradient(135deg, #3b82f6, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 600;">
                            <i class="fas fa-cogs mr-1"></i>Demo Hub
                        </a>
                        <a href="dummy-demo.html" class="nav-link text-gray-400 hover:text-[#D4AF37] transition-colors duration-300" style="background: linear-gradient(135deg, #10B981, #059669); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 600;">
                            <i class="fas fa-rocket mr-1"></i>Demo Showcase
                        </a>
                        <a href="demo/contextual-banners-demo.html" class="nav-link text-gray-400 hover:text-[#D4AF37] transition-colors duration-300" style="background: linear-gradient(135deg, #F59E0B, #D97706); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 600;">
                            <i class="fas fa-exclamation-triangle mr-1"></i>Banner Demo
                        </a>
                        <a href="business-profile.html" class="nav-link text-gray-400 hover:text-[#D4AF37] transition-colors duration-300" style="background: linear-gradient(135deg, #10B981, #059669); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 600;">
                            <i class="fas fa-clock mr-1"></i>WLO System
                        </a>
                    </nav>
                </div>

                <!-- Action Buttons -->
                <div class="hidden md:flex items-center gap-4">
                    <!-- Basket Icon -->
                    <div class="basket-icon" id="basketIcon" onclick="scrollToBooking()" style="position: relative; cursor: pointer; padding: 0.5rem; border-radius: 50%; background: rgba(13, 148, 136, 0.1); border: 1px solid rgba(13, 148, 136, 0.3); transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; width: 40px; height: 40px;">
                        <i class="fas fa-shopping-basket" style="color: #0D9488; font-size: 1.2rem;"></i>
                        <span class="basket-count" id="basketCount" style="position: absolute; top: -5px; right: -5px; background: #ff4444; color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: 600; border: 2px solid #1a1a1a;">0</span>
                    </div>
                    
                    <!-- Sign In / Sign Up (for signed out users) -->
                    <div class="auth-links" id="authLinks" style="align-items: center; gap: 0.5rem;">
                        <button id="loginBtn" class="text-white hover:text-[#D4AF37] transition-colors duration-300 text-sm" onclick="redirectToLogin()">
                            <i class="fas fa-sign-in-alt mr-1"></i>Sign In
                        </button>
                        <span class="text-gray-400">/</span>
                        <a href="#" onclick="redirectToRegister()" class="text-white hover:text-[#D4AF37] transition-colors duration-300 text-sm">
                            <i class="fas fa-user-plus mr-1"></i>Sign Up
                        </a>
                    </div>
                    
                    <!-- Customer Menu (for logged-in users) -->
                    <div class="customer-menu" id="customerMenu" style="display: none; position: relative;">
                        <button class="customer-initial" id="customerInitial" onclick="toggleCustomerMenu()" style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #0D9488, #10B981); color: white; border: none; font-size: 1.2rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(13, 148, 136, 0.3);">
                            <span id="customerInitialText">U</span>
                        </button>
                        <div class="customer-dropdown" id="customerDropdown">
                            <a href="customer-dashboard.html" class="dropdown-item">
                                <i class="fas fa-tachometer-alt"></i>
                                Dashboard
                            </a>
                            <a href="customer-dashboard.html" class="dropdown-item" onclick="redirectToAccountTab()">
                                <i class="fas fa-cog"></i>
                                Account Settings
                            </a>
                            <a href="#" onclick="signOut()" class="dropdown-item">
                                <i class="fas fa-sign-out-alt"></i>
                                Sign Out
                            </a>
                        </div>
                    </div>
                    
                    <!-- List Business Button -->
                    <a href="business-register.html" class="text-gray-400 hover:text-green-400 transition-colors duration-300 font-medium text-sm">+ List Business</a>
                </div>

                <!-- Mobile Menu Button -->
                <div class="md:hidden">
                    <button id="menu-btn" class="text-[#D4AF37] focus:outline-none" onclick="toggleMobileMenu()">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                    </button>
                </div>
            </div>
            <!-- Mobile Menu -->
            <div id="mobile-menu" class="hidden md:hidden pb-4">
                <a href="index.html" class="block py-2 text-gray-400 hover:text-[#D4AF37]">Home</a>
                <a href="search-results.html" class="block py-2 text-gray-400 hover:text-[#D4AF37]">Browse</a>
                <a href="offers.html" class="block py-2 text-gray-400 hover:text-[#D4AF37]">Offers</a>
                <a href="preview-test.html" class="block py-2 text-gray-400 hover:text-[#D4AF37]" style="background: linear-gradient(135deg, #FF3CAC, #784BA0); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 600;">
                    <i class="fas fa-flask mr-2"></i>Preview Test
                </a>
                <a href="business-register.html" class="block py-2 text-green-400 hover:text-green-300">
                    <i class="fas fa-plus mr-2"></i>List Business
                </a>
                <a href="#" onclick="redirectToLogin()" class="block py-2 mt-2 text-gray-200 border border-[#9C7C2E] rounded-md text-center hover:bg-[#111111]">Sign In</a>
                <a href="#" onclick="redirectToRegister()" class="block py-2 mt-2 text-black bg-gradient-to-r from-[#FFD35C] to-[#C68B1E] rounded-md text-center hover:opacity-90">Sign Up</a>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <main class="min-h-screen">
        <div class="container mx-auto px-4 py-8">
            <!-- Navigation --><!-- Login Modal --><div><div><div><div><h3>Login</h3><button onclick="toggleLoginModal(event)"><i></i></button></div><form onsubmit="handleLogin(event)"><div><label>Email</label><input type="email" required placeholder="customer@example.com"></div><div><label>Password</label><input type="password" required placeholder="password123"></div><button type="submit"> Login </button></form><div><p>Don't have an account? <a href="#" onclick="redirectToRegister()">Sign up</a></p></div></div></div></div><!-- Hero Banner --><div><div><div><i></i></div><div><h1>Royal Hair Studio</h1><div>Hair Salon</div><div><div>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div><div>4.8 (127 reviews)</div></div><p> Professional hair salon specializing in natural hair care, styling, and treatments for all hair types. Our experienced stylists provide personalized service in a welcoming, modern environment. </p></div></div></div><!-- Photo Gallery --><div><div><h2>Gallery</h2><div><div><div></div><div></div><div></div></div><button onclick="changeSlide(-1)"><i></i></button><button onclick="changeSlide(1)"><i></i></button><div><button onclick="currentSlide(1)"></button><button onclick="currentSlide(2)"></button><button onclick="currentSlide(3)"></button></div></div></div></div><!-- Main Content --><div><div><div><!-- About Section --><div><h2>About Royal Hair Studio</h2><p> With over 10 years of experience in the hair industry, Royal Hair Studio has become a trusted name in London's beauty scene. We specialize in natural hair care, protective styling, and modern cuts that enhance your natural beauty. </p><p> Our team of certified stylists stays up-to-date with the latest techniques and trends, ensuring you receive the highest quality service. We use premium products and maintain the highest standards of hygiene and professionalism. </p></div><!-- Services Section --><div><h2>Services & Prices</h2><!-- Payment Method Information --><div><div><i></i><span>Select services to see payment options</span></div></div><div><p><i></i> Start by selecting a service below to begin your booking </p><button onclick="testButtonUpdate()"> Test Button Update </button><button onclick="testAddService()"> Test Add Service </button></div><div><div><div><div>Hair Cut & Style</div><div>¬£45</div><div>Professional cut and styling for all hair types</div></div><button onclick="addService('Hair Cut & Style', 45, 30);"><i></i> Add </button></div><div><div><div>Hair Coloring</div><div>¬£85</div><div>Full color service with premium products</div></div><button onclick="addService('Hair Coloring', 85, 90)"><i></i> Add </button></div><div><div><div>Deep Conditioning</div><div>¬£35</div><div>Intensive treatment for damaged hair</div></div><button onclick="addService('Deep Conditioning', 35, 45)"><i></i> Add </button></div><div><div><div>Bridal Package</div><div>¬£150</div><div>Complete bridal hair styling package</div></div><button onclick="addService('Bridal Package', 150, 120)"><i></i> Add </button></div></div><!-- Waiting List Section --><div><div><h3><i></i> Join Waiting List</h3><p>This service is currently full. Join the waiting list and we'll notify you if a slot opens up.</p></div><div><form onsubmit="joinWaitingList(event)"><div><label for="waitingListName">Name *</label><input type="text" name="name" required placeholder="Enter your full name"></div><div><label for="waitingListEmail">Email *</label><input type="email" name="email" required placeholder="Enter your email address"></div><div><label for="waitingListPhone">Phone Number (Optional)</label><input type="tel" name="phone" placeholder="Enter your phone number for SMS notifications"><div>We'll send SMS notifications if you provide your phone number</div></div><div><label><input type="checkbox" name="consent" required><span></span> By joining, you agree to receive one-time notifications if a slot opens up for this service. You won't receive marketing texts. <a href="waiting-list-terms.html" target="_blank">View Terms</a> | <a href="terms-appendix-waiting-list.html" target="_blank">Full Appendix</a></label></div><div><button type="submit"><i></i> Join Waiting List </button><button type="button" onclick="hideWaitingListForm()"> Cancel </button></div></form></div></div><!-- Selected Services Display --><div><h3>Selected Services</h3><div></div><div><strong>Total: ¬£<span>0</span></strong></div></div></div></div><!-- Waiting List Section --><div><div><h3><i></i> Join Waiting List</h3><p>This service is currently full. Join the waiting list and we'll notify you if a slot opens up.</p></div><div><form onsubmit="joinWaitingList(event)"><div><label for="waitingListName">Name *</label><input type="text" name="name" required placeholder="Enter your full name"></div><div><label for="waitingListEmail">Email *</label><input type="email" name="email" required placeholder="Enter your email address"></div><div><label for="waitingListPhone">Phone Number (Optional)</label><input type="tel" name="phone" placeholder="Enter your phone number for SMS notifications"><div>We'll send SMS notifications if you provide your phone number</div></div><div><label><input type="checkbox" name="consent" required><span></span> By joining, you agree to receive one-time notifications if a slot opens up for this service. You won't receive marketing texts. <a href="waiting-list-terms.html" target="_blank">View Terms</a> | <a href="terms-appendix-waiting-list.html" target="_blank">Full Appendix</a></label></div><div><button type="submit"><i></i> Join Waiting List </button><button type="button" onclick="hideWaitingListForm()"> Cancel </button></div></form></div></div><div><!-- Contact Information --><div><h2>Contact Information</h2><div><div><div>üìç</div><div><h4>Address</h4><p>123 Beauty Street<br>London SW1A 1AA</p></div></div><div><div>üìû</div><div><h4>Phone</h4><p>+44 20 7123 4567</p></div></div><div><div>üåê</div><div><h4>Website</h4><p>www.royalhairstudio.com</p></div></div><div><div>‚è∞</div><div><h4>Opening Hours</h4><p>Mon-Fri: 9:00 AM - 6:00 PM<br>Sat: 9:00 AM - 5:00 PM<br>Sun: Closed</p></div></div></div></div><!-- Quick Actions --><div><h2>Quick Actions</h2><div><button onmouseover="this.style.background='#FF3CAC'; this.style.color='white'" onmouseout="this.style.background='transparent'; this.style.color='#FF3CAC'" onclick="trackContactClick('call')"><i></i> Call Now </button><button onmouseover="this.style.background='#FF3CAC'; this.style.color='white'" onmouseout="this.style.background='transparent'; this.style.color='#FF3CAC'"><i></i> Share </button></div></div><!-- Map --><div><h2>Location</h2><div><iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2483.123456789!2d-0.1278!3d51.5074!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2zNTHCsDMwJzI2LjYiTiAwwrAwNyc0MC4xIlc!5e0!3m2!1sen!2suk!4v1234567890123!5m2!1sen!2suk" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe></div></div></div></div></div><!-- Booking Section --><div><div><!-- Progress Indicator --><div><div><div>1</div><div>Service</div></div><div><div>2</div><div>Date & Time</div></div><div><div>3</div><div>Details</div></div><div><div>4</div><div>Confirm</div></div></div><div><div><h2>Complete Your Booking</h2><!-- Selected Services --><div><h3>Selected Services</h3><div></div><div><button onclick="showServiceSelection()"><i></i> Add Another Treatment </button></div></div><!-- Date & Time Selection --><div><h3>Select Date & Time</h3><div><div><button onclick="changeMonth(-1)"><i></i></button><div>December 2024</div><button onclick="changeMonth(1)"><i></i></button></div><div></div></div><div></div></div><!-- Account Choice Section --><div><h3>üîê Save Your Details</h3><p>Sign in or create an account to save your bookings and manage future appointments.</p><div><button>Sign In</button><button>Sign Up</button><button>Continue as Guest</button></div></div><!-- No Services Message (Hidden by default) --><div><div><i></i><h3>No Services Selected</h3><p>You haven't selected any services yet. Choose from our range of treatments below.</p><button onclick="scrollToServices()"><i></i><span>Add Service</span></button></div></div><!-- Customer Details (Hidden until checkout method selected) --><div><h3>Your Details <span data-booking-data="true"><span>P</span><div><div><i></i> Privacy Protected </div><div>Customer personal details are protected for privacy. Only essential booking information is shared with businesses.</div></div></span></h3><!-- Security Notice --><div><h4><i></i> Security Notice </h4><p>Your data is protected with encryption and secure processing. All form submissions are protected against CSRF attacks.</p></div><!-- Basket Persistence Indicator --><div><i></i><span>Your basket items will be saved when you sign in or create an account</span></div><div><label>Full Name *</label><input type="text" required placeholder="Enter your full name (first & last)"></div><div><label>Email Address *</label><input type="email" required placeholder="Enter your email (e.g., name@example.com)"></div><div><label>Phone Number *</label><input type="tel" required placeholder="Enter your UK mobile or landline (e.g., 07123 456789 or 020 7946 1234)"><div> We use your number to send booking confirmations, changes, and cancellations. It's stored securely and never shown to businesses in full. You can verify or update it in your account at any time. </div><!-- Phone Verification Warning --><div><div><i></i> Phone Verification Required </div><p> Make sure your mobile number is correct. If it's wrong, you may miss important updates about your booking. </p><button type="button" onclick="showPhoneVerificationPlaceholder()"><i></i> Verify Later </button></div></div><div><label>Postcode *</label><input type="text" required placeholder="Enter your UK postcode (e.g., SW1A 1AA)"></div><div><label>Booking Notes (Optional)</label><textarea placeholder="Any special requests or notes for your appointment..."></textarea><div><small>These notes will be passed to the business. BlkPages does not monitor or edit these notes.</small></div></div></div><!-- Staff Allocation Disclaimer --><div><div><i></i></div><div><strong>Staff Allocation:</strong> Appointments are booked with the first available stylist or therapist. If you would like to see a specific person, please contact the business directly to confirm availability. </div></div><!-- Payment Options --><div><h3>Payment Information</h3><div><!-- Payment model information will be populated by JavaScript --></div><!-- Promo Code Input --><div><div><h4>Have a promo code?</h4><button type="button" onclick="togglePromoCode()"><span>Enter Code</span><i></i></button></div><!-- Daily Cron Job Demo Section --><div><h5>Daily Cron Job Demo</h5><p>Test the automated daily processing of expired reward vouchers</p><div><button type="button" onclick="createDemoExpiredVouchers()"><i></i> Create Demo Vouchers </button><button type="button" onclick="runDailyCronDemo()"><i></i> Run Daily Cron </button><button type="button" onclick="testLoyaltyNotifications()"><i></i> Test Notifications </button><button type="button" onclick="testSecurityPrivacyFeatures()"><i></i> Test Security </button></div></div><div><div><input type="text" placeholder="Enter your promo code" maxlength="20"><button type="button" onclick="applyPromoCode()"><i></i> Apply </button></div><div></div></div><div><div><div><i></i><span>Promo code applied successfully!</span></div><div></div></div><button type="button" onclick="removePromoCode()"><i></i> Remove </button></div></div><!-- Pay at Venue Disclaimer --><div><div><i></i></div><div> This business has chosen to allow payment at venue. BlkPages does not handle payments or refunds for this booking. </div></div><!-- Pay Now Disclaimer --><div><div><i></i></div><div> Payments are processed by BlkPages via Stripe, on behalf of Royal Hair Studio. Your contract of service is with Royal Hair Studio, not BlkPages. Refunds are subject to the venue's cancellation policy. <a href="#" onclick="openCancellationPolicyModal(); return false;">View Royal Hair Studio's cancellation policy</a></div></div></div><!-- Policies --><div><div><input type="checkbox"><label for="marketingPlatform">Receive marketing emails from BlkPages</label></div><div><input type="checkbox"><label for="marketingBusiness">Receive marketing emails from Royal Hair Studio</label></div><!-- Required Terms & Conditions Checkbox --><div><input type="checkbox" onchange="updateBookingButton()" required><label for="acceptTerms"><span>*</span> By completing this booking, I agree to BlkPages' booking policy as well as <a href="#" onclick="openCancellationPolicyModal(); return false;">Royal Hair Studio's cancellation policy</a>. </label></div></div></div><!-- Booking Summary Sidebar --><div><h3>Booking Summary</h3><div><div><!-- Services will be populated here --></div><div><small onclick="showServiceSelection()">Add service</small></div><div><span>Date</span><span>-</span></div><div><span>Time</span><span>-</span></div><div><span>Duration</span><span>-</span></div><div><span>Total</span><span>¬£0</span></div></div><!-- Payment Information --><div><!-- Payment model information will be populated by JavaScript --></div><!-- Payment Options --><div><!-- Payment options will be populated based on business model --></div></div></div></div></div><!-- Customer Reviews Section --><div><div><div><h2>Customer Reviews</h2><div><div><div>4.8</div><div>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div><div>Based on 127 reviews</div></div><div><div><span>5</span><div><div></div></div><span>85%</span></div><div><span>4</span><div><div></div></div><span>12%</span></div></div></div><div><!-- Review 1 --><div><div><div><div>Sarah J.</div><div><i></i> Verified Customer </div></div><div>2 days ago</div></div><div>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div><div> "Amazing service! The stylist really understood what I wanted and my hair looks fantastic. The salon is clean and professional. Highly recommend!" </div><!-- Business Reply --><div><div><div><i></i> Business Reply </div><div>1 day ago</div></div><div> "Thank you so much Sarah! We're thrilled you loved your experience. We look forward to seeing you again soon!" </div></div></div><!-- Review 2 --><div><div><div><div>Michael B.</div><div><i></i> Verified Customer </div></div><div>1 week ago</div></div><div>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div><div> "Best haircut I've had in years! The barber was professional and took his time. Great atmosphere and friendly staff." </div></div><!-- Review 3 --><div><div><div><div>Emma W.</div><div><i></i> Verified Customer </div></div><div>2 weeks ago</div></div><div>‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</div><div> "Good service overall. The stylist was friendly and the cut was nice, though it took a bit longer than expected. Would recommend." </div><!-- Business Reply --><div><div><div><i></i> Business Reply </div><div>2 weeks ago</div></div><div> "Thank you for your feedback Emma! We appreciate your patience and are glad you enjoyed the service. We're always working to improve our efficiency." </div></div></div><!-- Review 4 --><div><div><div><div>David L.</div><div><i></i> Verified Customer </div></div><div>3 weeks ago</div></div><div>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div><div> "Excellent experience from start to finish. Professional team, great atmosphere, and my hair looks amazing. Will definitely be back!" </div></div><!-- Review 5 --><div><div><div><div>Lisa M.</div><div><i></i> Verified Customer </div></div><div>1 month ago</div></div><div>‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ</div><div> "The service was okay, but I had to wait longer than my appointment time. The stylist was friendly though and the end result was decent." </div><!-- Business Reply --><div><div><div><i></i> Business Reply </div><div>1 month ago</div></div><div> "Thank you for your feedback Lisa. We apologize for the wait time and are working to improve our scheduling. We're glad you were happy with the final result and hope to serve you better next time." </div></div></div></div></div></div></div><!-- Sticky Booking CTA --><div><div><div><div><span>0 services</span><span>Select date & time</span><span>¬£0</span></div><button onclick="validateAndProceed()" disabled> Book Now </button></div></div></div></div><!-- Cancellation Policy Modal --><div><div><div><div><h3>Cancellation Policy</h3><button onclick="closeCancellationPolicyModal()"><i></i></button></div><div><!-- Policy content will be loaded here --></div></div></div></div><!-- Footer --><script> // Global variables let selectedServices = []; let selectedDate = null; let selectedTime = null; let selectedPayment = null; // Seamless Booking Journey - Core Functions const RequiredFields = ["service", "date", "time", "first_name", "last_name", "email", "phone", "postcode", "terms"]; // Initialize booking journey function initializeBookingJourney() { console.log('Initializing seamless booking journey...'); // Load saved booking data from sessionStorage loadBookingData(); // Set up event listeners setupBookingEventListeners(); // Update UI based on current state updateBookingUI(); // Show sticky CTA if services are selected updateStickyCTA(); console.log('Booking journey initialized. Selected services:', selectedServices.length); console.log('Selected date:', selectedDate); console.log('Selected time:', selectedTime); } // Load booking data from sessionStorage function loadBookingData() { const savedServices = sessionStorage.getItem('booking_services'); const savedDate = sessionStorage.getItem('booking_date'); const savedTime = sessionStorage.getItem('booking_time'); const savedCustomer = sessionStorage.getItem('booking_customer'); if (savedServices) { try { selectedServices = JSON.parse(savedServices); updateBookingServicesList(); } catch (e) { console.error('Error loading saved services:', e); } } if (savedDate) { selectedDate = savedDate; updateCalendarDisplay(); } if (savedTime) { selectedTime = savedTime; updateTimeSlotsDisplay(); } if (savedCustomer) { try { const customerData = JSON.parse(savedCustomer); populateCustomerForm(customerData); } catch (e) { console.error('Error loading saved customer data:', e); } } } // Save booking data to sessionStorage function saveBookingData() { sessionStorage.setItem('booking_services', JSON.stringify(selectedServices)); if (selectedDate) sessionStorage.setItem('booking_date', selectedDate); if (selectedTime) sessionStorage.setItem('booking_time', selectedTime); } // Setup event listeners for booking flow function setupBookingEventListeners() { // Service selection document.addEventListener('click', function(e) { if (e.target.closest('.service-selection-card')) { const card = e.target.closest('.service-selection-card'); const serviceName = card.dataset.serviceName; const servicePrice = parseFloat(card.dataset.servicePrice); const serviceDuration = parseInt(card.dataset.serviceDuration); selectService(serviceName, servicePrice, serviceDuration); } }); // Date selection document.addEventListener('click', function(e) { if (e.target.closest('.calendar-day')) { const day = e.target.closest('.calendar-day'); selectDate(day); } }); // Time slot selection document.addEventListener('click', function(e) { if (e.target.closest('.time-slot')) { const slot = e.target.closest('.time-slot'); selectTime(slot); } }); // Form validation on input const formInputs = document.querySelectorAll('input[name], select[name], textarea[name]'); formInputs.forEach(input => { input.addEventListener('input', function() { clearFieldError(this); saveCustomerData(); }); }); // Terms checkbox const termsCheckbox = document.getElementById('acceptTerms'); if (termsCheckbox) { termsCheckbox.addEventListener('change', function() { updateBookingButton(); saveCustomerData(); }); } } // Select service with visual feedback function selectService(name, price, duration) { console.log('Selecting service:', name, price, duration); // Check if service already selected const existingService = selectedServices.find(s => s.name === name); if (existingService) { // Remove service selectedServices = selectedServices.filter(s => s.name !== name); updateServiceSelectionUI(name, false); } else { // Add service const service = { id: `service_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`, name: name, price: price, duration: duration, quantity: 1 }; selectedServices.push(service); updateServiceSelectionUI(name, true); } // Save to sessionStorage saveBookingData(); // Update UI updateBookingServicesList(); updateBookingSummary(); updateStickyCTA(); updateBookingButton(); // Show booking section if services selected if (selectedServices.length > 0) { showBookingSection(); // Also show the booking section immediately const bookingSection = document.getElementById('booking-section'); if (bookingSection) { bookingSection.style.display = 'block'; console.log('Booking section displayed'); } } } // Update service selection UI function updateServiceSelectionUI(serviceName, isSelected) { const cards = document.querySelectorAll('.service-selection-card'); cards.forEach(card => { if (card.dataset.serviceName === serviceName) { if (isSelected) { card.classList.add('selected'); } else { card.classList.remove('selected'); } } }); } // Select date with visual feedback function selectDate(dateEl) { if (dateEl.classList.contains('closed')) return; // Remove previous selection document.querySelectorAll('.calendar-day').forEach(d => d.classList.remove('selected')); // Add selection to clicked date dateEl.classList.add('selected'); // Save selected date selectedDate = dateEl.dataset.date; saveBookingData(); // Load time slots for selected date loadTimeSlots(selectedDate); // Update UI updateBookingSummary(); updateStickyCTA(); updateBookingButton(); } // Select time with visual feedback function selectTime(timeEl) { if (timeEl.classList.contains('booked')) return; // Remove previous selection document.querySelectorAll('.time-slot').forEach(t => t.classList.remove('selected')); // Add selection to clicked time timeEl.classList.add('selected'); // Save selected time selectedTime = timeEl.dataset.time; saveBookingData(); // Update UI updateBookingSummary(); updateStickyCTA(); updateBookingButton(); } // Load time slots for selected date function loadTimeSlots(date) { console.log('Loading time slots for date:', date); const timeSlotsContainer = document.getElementById('timeSlots'); if (timeSlotsContainer) { timeSlotsContainer.style.display = 'block'; generateTimeSlots(); } } // Generate time slots (simulate backend) function generateTimeSlots(date) { const slots = []; const startHour = 9; const endHour = 17; for (let hour = startHour; hour < endHour; hour++) { for (let minute = 0; minute < 60; minute += 30) { const time = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`; const isBooked = Math.random() < 0.3; // 30% chance of being booked slots.push({ time: time, booked: isBooked }); } } return slots; } // Update booking services list function updateBookingServicesList() { const servicesList = document.getElementById('booking-services-list'); if (!servicesList) return; if (selectedServices.length === 0) { servicesList.innerHTML = '<p>No services selected</p>'; return; } servicesList.innerHTML = selectedServices.map(service => ` <div><div><div>${service.name}</div><div>${service.duration} min ‚Ä¢ ¬£${service.price}</div></div><button onclick="removeService('${service.name}')"><i></i></button></div> `).join(''); } // Remove service function removeService(serviceName) { selectedServices = selectedServices.filter(s => s.name !== serviceName); updateServiceSelectionUI(serviceName, false); updateBookingServicesList(); updateBookingSummary(); updateStickyCTA(); updateBookingButton(); saveBookingData(); } // Update booking summary function updateBookingSummary() { const summaryServices = document.getElementById('summaryServices'); const summaryDateTime = document.getElementById('summaryDateTime'); const bookingTotal = document.getElementById('bookingTotal'); if (summaryServices) { if (selectedServices.length > 0) { summaryServices.innerHTML = selectedServices.map(s => ` <div><span>${s.name}</span><span>¬£${s.price}</span></div> `).join(''); } else { summaryServices.innerHTML = '<small onclick="showServiceSelection()">Add service</small>'; } } if (summaryDateTime) { if (selectedDate && selectedTime) { const dateObj = new Date(selectedDate); const formattedDate = dateObj.toLocaleDateString('en-GB', { weekday: 'short', day: 'numeric', month: 'short' }); summaryDateTime.innerHTML = `<small>${formattedDate} at ${selectedTime}</small>`; } else if (selectedDate) { summaryDateTime.innerHTML = '<small>Select time</small>'; } else { summaryDateTime.innerHTML = '<small>Select date & time</small>'; } } if (bookingTotal) { const total = selectedServices.reduce((sum, service) => sum + service.price, 0); bookingTotal.textContent = `¬£${total}`; } } // Update sticky CTA function updateStickyCTA() { const stickyCTA = document.getElementById('stickyBookingCTA'); const stickyServiceCount = document.getElementById('stickyServiceCount'); const stickyDateTime = document.getElementById('stickyDateTime'); const stickyTotal = document.getElementById('stickyTotal'); if (selectedServices.length > 0) { if (stickyCTA) stickyCTA.style.display = 'block'; if (stickyServiceCount) { stickyServiceCount.textContent = `${selectedServices.length} service${selectedServices.length > 1 ? 's' : ''}`; } if (stickyDateTime) { if (selectedDate && selectedTime) { const dateObj = new Date(selectedDate); const formattedDate = dateObj.toLocaleDateString('en-GB', { day: 'numeric', month: 'short' }); stickyDateTime.textContent = `${formattedDate} at ${selectedTime}`; } else if (selectedDate) { stickyDateTime.textContent = 'Select time'; } else { stickyDateTime.textContent = 'Select date & time'; } } if (stickyTotal) { const total = selectedServices.reduce((sum, service) => sum + service.price, 0); stickyTotal.textContent = `¬£${total}`; } } else { if (stickyCTA) stickyCTA.style.display = 'none'; } } // Update booking button state function updateBookingButton() { const completeBtn = document.getElementById('completeBookingBtn'); const bookNowBtn = document.getElementById('bookNowBtn'); const isValid = validateBookingForm(); const isEnabled = isValid && selectedServices.length > 0; if (completeBtn) { completeBtn.disabled = !isEnabled; } if (bookNowBtn) { bookNowBtn.disabled = !isEnabled; } } // Validate booking form function validateBookingForm() { const errors = []; // Check services if (selectedServices.length === 0) { errors.push({ field: 'service', message: 'Please select at least one service' }); } // Check date if (!selectedDate) { errors.push({ field: 'date', message: 'Please select a date' }); } // Check time if (!selectedTime) { errors.push({ field: 'time', message: 'Please select a time' }); } // Check customer details const firstName = document.getElementById('firstName'); const lastName = document.getElementById('lastName'); const email = document.getElementById('email'); const phone = document.getElementById('phone'); const postcode = document.getElementById('postcode'); const terms = document.getElementById('acceptTerms'); if (!firstName || !firstName.value.trim()) { errors.push({ field: 'first_name', message: 'First name is required' }); } if (!lastName || !lastName.value.trim()) { errors.push({ field: 'last_name', message: 'Last name is required' }); } if (!email || !email.value.trim()) { errors.push({ field: 'email', message: 'Email is required' }); } else if (!isValidEmail(email.value)) { errors.push({ field: 'email', message: 'Please enter a valid email address' }); } if (!phone || !phone.value.trim()) { errors.push({ field: 'phone', message: 'Phone number is required' }); } else if (!isValidPhone(phone.value)) { errors.push({ field: 'phone', message: 'Please enter a valid phone number' }); } if (!postcode || !postcode.value.trim()) { errors.push({ field: 'postcode', message: 'Postcode is required' }); } if (!terms || !terms.checked) { errors.push({ field: 'terms', message: 'Please accept the terms and conditions' }); } return errors.length === 0; } // Validate email format function isValidEmail(email) { const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; return emailRegex.test(email); } // Validate phone format function isValidPhone(phone) { const phoneRegex = /^[\+]?[0-9\s\-\(\)]{10,}$/; return phoneRegex.test(phone.replace(/\s/g, '')); } // Clear field error function clearFieldError(field) { field.classList.remove('error'); const errorMsg = field.parentNode.querySelector('.error-message'); if (errorMsg) { errorMsg.remove(); } } // Show field error function showFieldError(field, message) { field.classList.add('error'); // Remove existing error message const existingError = field.parentNode.querySelector('.error-message'); if (existingError) { existingError.remove(); } // Add new error message const errorMsg = document.createElement('div'); errorMsg.className = 'error-message'; errorMsg.textContent = message; field.parentNode.appendChild(errorMsg); } // Validate and proceed to payment function validateAndProceed() { console.log('Validating booking form...'); const errors = []; // Check services if (selectedServices.length === 0) { errors.push({ field: 'service', message: 'Please select at least one service' }); } // Check date if (!selectedDate) { errors.push({ field: 'date', message: 'Please select a date' }); } // Check time if (!selectedTime) { errors.push({ field: 'time', message: 'Please select a time' }); } // Check customer details const firstName = document.getElementById('firstName'); const lastName = document.getElementById('lastName'); const email = document.getElementById('email'); const phone = document.getElementById('phone'); const postcode = document.getElementById('postcode'); const terms = document.getElementById('acceptTerms'); if (!firstName || !firstName.value.trim()) { errors.push({ field: 'first_name', message: 'First name is required' }); } if (!lastName || !lastName.value.trim()) { errors.push({ field: 'last_name', message: 'Last name is required' }); } if (!email || !email.value.trim()) { errors.push({ field: 'email', message: 'Email is required' }); } else if (!isValidEmail(email.value)) { errors.push({ field: 'email', message: 'Please enter a valid email address' }); } if (!phone || !phone.value.trim()) { errors.push({ field: 'phone', message: 'Phone number is required' }); } else if (!isValidPhone(phone.value)) { errors.push({ field: 'phone', message: 'Please enter a valid phone number' }); } if (!postcode || !postcode.value.trim()) { errors.push({ field: 'postcode', message: 'Postcode is required' }); } if (!terms || !terms.checked) { errors.push({ field: 'terms', message: 'Please accept the terms and conditions' }); } if (errors.length > 0) { // Show first error and scroll to it const firstError = errors[0]; showFieldError(document.querySelector(`[name="${firstError.field}"]`), firstError.message); // Scroll to first error const errorField = document.querySelector(`[name="${firstError.field}"]`); if (errorField) { errorField.scrollIntoView({ behavior: 'smooth', block: 'center' }); } return false; } // All validations passed - proceed to payment proceedToPayment(); return true; } // Proceed to payment function proceedToPayment() { console.log('Proceeding to payment...'); // Collect customer data const customerData = { firstName: document.getElementById('firstName').value, lastName: document.getElementById('lastName').value, email: document.getElementById('email').value, phone: document.getElementById('phone').value, postcode: document.getElementById('postcode').value, notes: document.getElementById('bookingNotes').value || '' }; // Create booking object const booking = { services: selectedServices, date: selectedDate, time: selectedTime, customer: customerData, businessId: 'royal-hair-studio', total: selectedServices.reduce((sum, service) => sum + service.price, 0) }; // Save booking to localStorage localStorage.setItem('pending_booking', JSON.stringify(booking)); // Check if user is logged in const isLoggedIn = localStorage.getItem('customerLoggedIn') === 'true'; if (isLoggedIn) { // Redirect to payment window.location.href = '/payment'; } else { // Show login prompt showLoginPrompt(); } } // Show login prompt function showLoginPrompt() { const modal = document.createElement('div'); modal.className = 'modal-overlay'; modal.innerHTML = ` <div><div><h3>Continue Your Booking</h3><button onclick="this.closest('.modal-overlay').remove()"><i></i></button></div><div><p>Please sign in or continue as a guest to complete your booking securely.</p><div><button onclick="this.closest('.modal-overlay').remove()">Cancel</button><button onclick="window.location.href='/signin-customer'">Sign In</button><button onclick="window.location.href='/payment'">Continue as Guest</button></div></div></div> `; document.body.appendChild(modal); } // Save customer data function saveCustomerData() { const customerData = { firstName: document.getElementById('firstName')?.value || '', lastName: document.getElementById('lastName')?.value || '', email: document.getElementById('email')?.value || '', phone: document.getElementById('phone')?.value || '', postcode: document.getElementById('postcode')?.value || '', notes: document.getElementById('bookingNotes')?.value || '' }; sessionStorage.setItem('booking_customer', JSON.stringify(customerData)); } // Populate customer form function populateCustomerForm(customerData) { if (customerData.firstName) document.getElementById('firstName').value = customerData.firstName; if (customerData.lastName) document.getElementById('lastName').value = customerData.lastName; if (customerData.email) document.getElementById('email').value = customerData.email; if (customerData.phone) document.getElementById('phone').value = customerData.phone; if (customerData.postcode) document.getElementById('postcode').value = customerData.postcode; if (customerData.notes) document.getElementById('bookingNotes').value = customerData.notes; } // Show booking section function showBookingSection() { const bookingSection = document.getElementById('booking-section'); if (bookingSection) { bookingSection.style.display = 'block'; bookingSection.scrollIntoView({ behavior: 'smooth', block: 'start' }); } } // Update booking UI function updateBookingUI() { updateBookingServicesList(); updateBookingSummary(); updateStickyCTA(); updateBookingButton(); } // Update calendar display with selected date function updateCalendarDisplay() { if (!selectedDate) return; const dateObj = new Date(selectedDate); const day = dateObj.getDate(); const month = dateObj.getMonth(); const year = dateObj.getFullYear(); // Find and highlight the selected date const dayElements = document.querySelectorAll('.calendar-day'); dayElements.forEach(dayEl => { if (parseInt(dayEl.textContent) === day) { dayEl.classList.add('selected'); } }); } // Update time slots display with selected time function updateTimeSlotsDisplay() { if (!selectedTime) return; // Find and highlight the selected time const timeElements = document.querySelectorAll('.time-slot'); timeElements.forEach(timeEl => { if (timeEl.dataset.time === selectedTime || timeEl.textContent === selectedTime) { timeEl.classList.add('selected'); } }); } // Scroll to business policy function scrollToBusinessPolicy() { const policySection = document.getElementById('business-policy'); if (policySection) { policySection.scrollIntoView({ behavior: 'smooth', block: 'start' }); } } // Initialize on page load document.addEventListener('DOMContentLoaded', function() { initializeBookingJourney(); // Initialize calendar const currentDate = new Date(); const currentMonthEl = document.getElementById('currentMonth'); if (currentMonthEl) { const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']; currentMonthEl.textContent = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`; } // Generate initial calendar generateCalendarDays(currentDate.getFullYear(), currentDate.getMonth()); // Setup account choice button handlers setupAccountChoiceHandlers(); // Setup basket dropdown setupBasketDropdown(); console.log('Calendar initialized'); }); // Setup account choice button handlers function setupAccountChoiceHandlers() { const signInBtn = document.getElementById('signInBtn'); const signUpBtn = document.getElementById('signUpBtn'); const guestBtn = document.getElementById('guestBtn'); if (signInBtn) { signInBtn.onclick = () => { console.log('Sign In clicked'); window.location.href = '/signin-customer'; }; } if (signUpBtn) { signUpBtn.onclick = () => { console.log('Sign Up clicked'); window.location.href = '/signup-customer'; }; } if (guestBtn) { guestBtn.onclick = () => { console.log('Continue as Guest clicked'); showGuestForm(); }; } } // Show guest form function showGuestForm() { // Hide account choice section const accountChoice = document.querySelector('.account-choice'); if (accountChoice) { accountChoice.style.display = 'none'; } // Show customer details section const customerDetails = document.getElementById('customerDetails'); if (customerDetails) { customerDetails.style.display = 'block'; console.log('Guest form displayed'); } } // Add service function - make it globally accessible window.addService = function(name, price, duration) { console.log('addService called with:', name, price, duration); // Create service object with unique ID const serviceId = `service_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`; const service = { id: serviceId, name: name, price: price, duration: duration, quantity: 1, businessId: 'biz_001', business_id: 'biz_001' }; // Add service to selection selectedServices.push(service); // Clear services error if any clearServicesError(); // Show promo code section when services are selected showPromoCodeSection(); // Add to persistent basket system if (typeof persistentBasketSystem !== 'undefined') { persistentBasketSystem.addServiceToBasket(service); } // Add to basket with single-business rule addToBasket(service); // Dispatch service added event window.dispatchEvent(new CustomEvent('service.added', { detail: service })); // Show basket persistence indicator if not logged in showBasketPersistenceIndicator(); // Update button appearance const buttons = document.querySelectorAll('.add-service-btn'); buttons.forEach(button => { const onclick = button.getAttribute('onclick'); if (onclick && onclick.includes(`'${name}'`)) { button.classList.add('selected'); button.innerHTML = '<i></i> Added'; } }); // Show booking section const bookingSection = document.getElementById('booking-section'); if (bookingSection) { bookingSection.style.display = 'block'; console.log('Booking section displayed from addService'); } // Update the new booking system updateBookingServicesList(); updateBookingSummary(); updateStickyCTA(); updateBookingButton(); // Show customer details section const customerDetails = document.getElementById('customerDetails'); if (customerDetails) { customerDetails.style.display = 'block'; } // Update selected services display updateSelectedServicesDisplay(); // Update progress indicator and payment display updateProgressIndicator(); updatePaymentModelDisplay(); // Update basket count and save basket updateBasketCount(); saveBasket(); } // Basket Dropdown Functions function toggleBasketDropdown() { const dropdown = document.getElementById('basketDropdown'); if (dropdown) { dropdown.classList.toggle('active'); if (dropdown.classList.contains('active')) { renderBasketPreview(); } } } function renderBasketPreview() { const items = JSON.parse(sessionStorage.getItem('basket') || '[]'); const container = document.getElementById('basketItems'); if (!container) return; if (!items.length) { container.innerHTML = "<p class='basket-empty'>Your basket is empty.</p>"; return; } container.innerHTML = items.map(item => ` <div class='basket-item'><p><strong>${item.business || 'Business'}</strong> ‚Äî ${item.name}</p><p>${item.date || ''} ${item.time || ''}</p><p>¬£${item.price}</p><a href='#' onclick='removeFromBasket("${item.id}")'>Remove</a></div> `).join(''); } function removeFromBasket(itemId) { let basket = JSON.parse(sessionStorage.getItem('basket') || '[]'); basket = basket.filter(item => item.id !== itemId); sessionStorage.setItem('basket', JSON.stringify(basket)); // Update basket count updateBasketBadge(); // Re-render dropdown if open const dropdown = document.getElementById('basketDropdown'); if (dropdown && dropdown.classList.contains('active')) { renderBasketPreview(); } // Update selected services selectedServices = selectedServices.filter(service => service.id !== itemId); updateBookingServicesList(); updateBookingSummary(); updateStickyCTA(); updateBookingButton(); } function addToBasket(newItem) { let basket = JSON.parse(sessionStorage.getItem('basket') || '[]'); // Single-business basket rule if (basket.length && basket[0].business_id !== newItem.business_id) { if (!confirm("Your current basket contains services from another business. Clear basket and continue?")) { return false; } basket = []; } basket.push(newItem); sessionStorage.setItem('basket', JSON.stringify(basket)); updateBasketBadge(); return true; } function updateBasketBadge() { const basket = JSON.parse(sessionStorage.getItem('basket') || '[]'); const badge = document.getElementById('basketCount'); if (badge) { badge.textContent = basket.length; badge.style.display = basket.length > 0 ? 'flex' : 'none'; } } // Setup basket dropdown event listeners function setupBasketDropdown() { const viewBasketBtn = document.getElementById('viewBasketBtn'); if (viewBasketBtn) { viewBasketBtn.onclick = () => { window.location.href = '/basket.html'; }; } // Close dropdown when clicking outside document.addEventListener('click', (event) => { const dropdown = document.getElementById('basketDropdown'); const basketIcon = document.getElementById('basketIcon'); if (dropdown && basketIcon && !dropdown.contains(event.target) && !basketIcon.contains(event.target)) { dropdown.classList.remove('active'); } }); } // Waiting List Offer System Functions let currentWaitingListService = null; // Check if business has WLO access function checkBusinessWLOAccess() { const businessId = 'royal-hair-studio'; // Current business return WaitingListOfferSystem.hasWLOAccess(businessId); } // Show waiting list form for a service function showWaitingListForm(serviceName, serviceId) { console.log('WLO: Showing waiting list form for', serviceName, serviceId); // Check if business has WLO access if (!checkBusinessWLOAccess()) { alert('Waiting list is only available for premium businesses. This business is on a basic plan.'); return; } currentWaitingListService = { name: serviceName, id: serviceId }; // Show waiting list section const waitingListSection = document.getElementById('waiting-list-section'); if (waitingListSection) { waitingListSection.style.display = 'block'; waitingListSection.scrollIntoView({ behavior: 'smooth', block: 'center' }); } } // Hide waiting list form function hideWaitingListForm() { const waitingListSection = document.getElementById('waiting-list-section'); if (waitingListSection) { waitingListSection.style.display = 'none'; } currentWaitingListService = null; } // Join waiting list function joinWaitingList(event) { event.preventDefault(); console.log('WLO: Joining waiting list'); if (!currentWaitingListService) { alert('No service selected for waiting list'); return; } // Get form data const formData = new FormData(event.target); const customerData = { id: 'customer_' + Date.now(), name: formData.get('name'), email: formData.get('email'), phone: formData.get('phone') || null, consent: formData.get('consent') === 'on', smsConsent: formData.get('phone') ? true : false }; // Validate required fields if (!customerData.name || !customerData.email || !customerData.consent) { alert('Please fill in all required fields and accept the terms.'); return; } // Join waiting list const result = WaitingListOfferSystem.joinWaitingList( customerData, currentWaitingListService.id, 'royal-hair-studio' ); if (result.success) { // Show success message alert('Successfully joined waiting list! We\'ll notify you if a slot opens up.'); // Hide form hideWaitingListForm(); // Reset form event.target.reset(); } else { alert('Error joining waiting list: ' + result.error); } } // Check if service is fully booked (simulate) function isServiceFullyBooked(serviceName) { // Simulate some services being fully booked const fullyBookedServices = ['Hair Coloring', 'Bridal Package']; return fullyBookedServices.includes(serviceName); } // Add waiting list button to services function addWaitingListButtons() { if (!checkBusinessWLOAccess()) { return; // Don't add buttons if no WLO access } const serviceItems = document.querySelectorAll('.service-item'); serviceItems.forEach(item => { const serviceName = item.querySelector('.service-name').textContent; if (isServiceFullyBooked(serviceName)) { // Add waiting list button const serviceInfo = item.querySelector('.service-info'); const waitingListButton = document.createElement('div'); waitingListButton.className = 'service-fully-booked'; waitingListButton.innerHTML = ` <div><i></i> Fully Booked </div><button onclick="showWaitingListForm('${serviceName}', '${serviceName.toLowerCase().replace(/\s+/g, '-')}')"><i></i> Join Waiting List </button> `; serviceInfo.appendChild(waitingListButton); } }); } // Initialize waiting list system function initializeWaitingListSystem() { console.log('WLO: Initializing waiting list system'); // Check business access const hasAccess = checkBusinessWLOAccess(); console.log('WLO: Business has access:', hasAccess); if (hasAccess) { // Add waiting list buttons to services addWaitingListButtons(); } } // Update selected services display function updateSelectedServicesDisplay() { // Update the main selected services section const selectedServicesDiv = document.getElementById('selected-services'); const selectedServicesList = document.getElementById('selected-services-list'); const totalPriceSpan = document.getElementById('total-price'); if (selectedServices.length === 0) { if (selectedServicesDiv) selectedServicesDiv.style.display = 'none'; return; } if (selectedServicesDiv) selectedServicesDiv.style.display = 'block'; if (selectedServicesList) selectedServicesList.innerHTML = ''; let totalPrice = 0; selectedServices.forEach(service => { const serviceItem = document.createElement('div'); serviceItem.className = 'selected-service-item'; serviceItem.innerHTML = ` <div><div>${service.name}</div><div>¬£${service.price}</div></div><button onclick="event.stopPropagation(); removeService('${service.name}')"><i></i></button> `; if (selectedServicesList) selectedServicesList.appendChild(serviceItem); totalPrice += service.price; }); if (totalPriceSpan) { totalPriceSpan.textContent = totalPrice; } // Also update the booking summary section updateBookingSummarySection(); // Update the booking services list in the "Complete Your Booking" section updateBookingServicesList(); } // Update booking summary section function updateBookingSummarySection() { const summaryServicesList = document.getElementById('summaryServicesList'); const summaryTotalPrice = document.getElementById('summaryTotalPrice'); if (!summaryServicesList) return; summaryServicesList.innerHTML = ''; let totalPrice = 0; let totalDuration = 0; selectedServices.forEach(service => { const serviceItem = document.createElement('div'); serviceItem.className = 'summary-service-item'; serviceItem.innerHTML = ` <div>${service.name}</div><div>¬£${service.price}</div> `; summaryServicesList.appendChild(serviceItem); totalPrice += service.price; totalDuration += service.duration; }); if (summaryTotalPrice) { summaryTotalPrice.textContent = totalPrice; } // Update duration in the booking summary const summaryDuration = document.getElementById('summaryDuration'); if (summaryDuration) { summaryDuration.textContent = `${totalDuration} min`; } } // Remove service function window.removeService = function(name) { selectedServices = selectedServices.filter(service => service.name !== name); // Reset button appearance const buttons = document.querySelectorAll('.add-service-btn'); buttons.forEach(button => { const onclick = button.getAttribute('onclick'); if (onclick && onclick.includes(`'${name}'`)) { button.classList.remove('selected'); button.innerHTML = '<i></i> Add'; } }); // Update display updateSelectedServicesDisplay(); // Update basket count and save basket updateBasketCount(); saveBasket(); // Show/hide promo code section based on services showPromoCodeSection(); // Hide booking section if no services and clear date/time if (selectedServices.length === 0) { const bookingSection = document.getElementById('booking-section'); if (bookingSection) { bookingSection.style.display = 'none'; } // Clear date and time selections when basket is empty clearDateAndTime(); } } // Date and time selection functions function selectDate(day, month, year) { selectedDate = new Date(year, month, day); document.querySelectorAll('.calendar-day').forEach(el => el.classList.remove('selected')); event.target.classList.add('selected'); // Clear date error if any clearDateError(); // Generate time slots for selected date generateTimeSlots(); } function selectTime(time) { selectedTime = time; document.querySelectorAll('.time-slot').forEach(el => el.classList.remove('selected')); event.target.classList.add('selected'); // Clear time error if any clearTimeError(); } function generateTimeSlots() { const timeSlots = document.getElementById('timeSlots'); const slots = [ { time: '9:00 AM', available: true }, { time: '10:00 AM', available: true }, { time: '11:00 AM', available: true }, { time: '12:00 PM', available: true }, { time: '1:00 PM', available: true }, { time: '2:00 PM', available: true }, { time: '3:00 PM', available: true }, { time: '4:00 PM', available: true }, { time: '5:00 PM', available: true } ]; timeSlots.innerHTML = ''; slots.forEach(slot => { const slotElement = document.createElement('div'); slotElement.className = 'time-slot'; slotElement.textContent = slot.time; if (slot.available) { slotElement.onclick = () => selectTime(slot.time); } timeSlots.appendChild(slotElement); }); } // Check business status before allowing bookings function checkBusinessStatus() { try { // Get business ID from URL or page data const businessId = getBusinessIdFromPage(); if (!businessId) { console.error('Business ID not found'); return true; // Allow booking if ID not found (fallback) } // Get business data const businesses = JSON.parse(localStorage.getItem('blkpages_businesses') || '[]'); const business = businesses.find(b => b.id === businessId); if (!business) { console.error('Business not found'); return true; // Allow booking if business not found (fallback) } // Check if business is active if (business.status !== 'active') { showBusinessStatusError(business.status); return false; } // Check if bookings are disabled if (business.bookingsDisabled) { showBookingsDisabledError(); return false; } return true; } catch (error) { console.error('Error checking business status:', error); return true; // Allow booking on error (fallback) } } // Get business ID from page function getBusinessIdFromPage() { // Try to get from URL parameters const urlParams = new URLSearchParams(window.location.search); const businessId = urlParams.get('businessId'); if (businessId) return businessId; // Try to get from page data const businessIdElement = document.querySelector('[data-business-id]'); if (businessIdElement) { return businessIdElement.getAttribute('data-business-id'); } // Try to get from localStorage (for demo purposes) return localStorage.getItem('currentBusinessId') || 'business_1'; } // Show business status error function showBusinessStatusError(status) { let message = ''; let title = ''; switch (status) { case 'suspended': title = 'Business Temporarily Suspended'; message = 'This business is currently suspended and not accepting new bookings. Please check back later or contact the business directly.'; break; case 'deactivated': title = 'Business No Longer Available'; message = 'This business is no longer accepting bookings. Please try another business.'; break; case 'pending': title = 'Business Under Review'; message = 'This business is currently under review and not accepting bookings yet. Please check back later.'; break; default: title = 'Booking Not Available'; message = 'This business is currently not accepting new bookings.'; } // Create and show modal showBusinessStatusModal(title, message); } // Show bookings disabled error function showBookingsDisabledError() { const title = 'Bookings Temporarily Disabled'; const message = 'This business has temporarily disabled new bookings. Please check back later or contact the business directly.'; showBusinessStatusModal(title, message); } // Show business status modal function showBusinessStatusModal(title, message) { // Remove existing modal if any const existingModal = document.getElementById('businessStatusModal'); if (existingModal) { existingModal.remove(); } // Create modal const modal = document.createElement('div'); modal.id = 'businessStatusModal'; modal.className = 'business-status-modal'; modal.innerHTML = ` <div onclick="closeBusinessStatusModal()"><div onclick="event.stopPropagation()"><div><h3>${title}</h3><button onclick="closeBusinessStatusModal()"><i></i></button></div><div><div><i></i></div><p>${message}</p><div><button onclick="closeBusinessStatusModal()">Close</button><button onclick="findAlternativeBusiness()">Find Alternative</button></div></div></div></div> `; document.body.appendChild(modal); } // Close business status modal function closeBusinessStatusModal() { const modal = document.getElementById('businessStatusModal'); if (modal) { modal.remove(); } } // Find alternative business function findAlternativeBusiness() { closeBusinessStatusModal(); // Redirect to search page or show alternatives window.location.href = 'search-results.html'; } // Book appointment function with step-by-step validation function bookAppointment() { // Clear any existing errors clearAllErrors(); // Step 0: Check business status before proceeding if (!checkBusinessStatus()) { return; } // Step 1: Check if services are selected if (selectedServices.length === 0) { showServicesError(); return; } // Step 2: Check if date is selected if (!selectedDate) { showDateError(); return; } // Step 3: Check if time is selected if (!selectedTime) { showTimeError(); return; } // Step 4: Check customer details one by one with UK-specific validation const fullName = document.getElementById('fullName').value.trim(); const nameValidation = validateName(fullName); if (!nameValidation.isValid) { showFieldError('fullName', nameValidation.message); return; } const email = document.getElementById('email').value.trim(); const emailValidation = validateEmail(email); if (!emailValidation.isValid) { showFieldError('email', emailValidation.message); return; } const phone = document.getElementById('phone').value.trim(); const phoneValidation = validatePhone(phone); if (!phoneValidation.isValid) { showFieldError('phone', phoneValidation.message); return; } const postcode = document.getElementById('postcode').value.trim(); const postcodeValidation = validatePostcode(postcode); if (!postcodeValidation.isValid) { showFieldError('postcode', postcodeValidation.message); return; } // Step 5: Check terms acceptance if (!document.getElementById('acceptTerms').checked) { showTermsError(); return; } // All validations passed - show booking summary showBookingSummary(); } // Clear all error states function clearAllErrors() { document.querySelectorAll('.error').forEach(el => el.classList.remove('error')); document.querySelectorAll('.inline-error').forEach(el => el.remove()); document.querySelectorAll('.field-error').forEach(el => el.remove()); document.querySelectorAll('.error-border').forEach(el => el.classList.remove('error-border')); document.querySelectorAll('.services-error').forEach(el => el.remove()); } // Enhanced UK-specific validation functions function validateName(name) { if (!name || !name.trim()) { return { isValid: false, message: 'Please enter your full name.' }; } const trimmedName = name.trim(); // Check minimum length if (trimmedName.length < 2) { return { isValid: false, message: 'Name must be at least 2 characters long.' }; } // Check maximum length if (trimmedName.length > 50) { return { isValid: false, message: 'Name must be 50 characters or less.' }; } // Check if only one word (no space) if (!trimmedName.includes(' ')) { return { isValid: false, message: 'Please enter your first and last name.' }; } // Check for invalid characters (only letters, hyphens, apostrophes, and spaces) const nameRegex = /^[a-zA-Z\s\-']+$/; if (!nameRegex.test(trimmedName)) { return { isValid: false, message: 'Names can only include letters, hyphens, or apostrophes.' }; } // Check for consecutive spaces if (trimmedName.includes(' ')) { return { isValid: false, message: 'Name cannot contain consecutive spaces.' }; } // Check for names starting or ending with spaces, hyphens, or apostrophes if (trimmedName.startsWith(' ') || trimmedName.endsWith(' ') || trimmedName.startsWith('-') || trimmedName.endsWith('-') || trimmedName.startsWith("'") || trimmedName.endsWith("'")) { return { isValid: false, message: 'Name cannot start or end with spaces, hyphens, or apostrophes.' }; } // Enhanced validation: Check for common name patterns const nameParts = trimmedName.split(' '); if (nameParts.length < 2) { return { isValid: false, message: 'Please enter both your first and last name.' }; } // Check each name part for validity for (let part of nameParts) { if (part.length < 1) { return { isValid: false, message: 'Each name part must be at least 1 character long.' }; } if (part.startsWith('-') || part.endsWith('-') || part.startsWith("'") || part.endsWith("'")) { return { isValid: false, message: 'Name parts cannot start or end with hyphens or apostrophes.' }; } } return { isValid: true }; } function validateEmail(email) { if (!email || !email.trim()) { return { isValid: false, message: 'Please enter your email address.' }; } const trimmedEmail = email.trim(); // Check maximum length if (trimmedEmail.length > 254) { return { isValid: false, message: 'Email address is too long (maximum 254 characters).' }; } // Check minimum length if (trimmedEmail.length < 5) { return { isValid: false, message: 'Email address is too short (minimum 5 characters).' }; } // Enhanced email regex for better validation const emailRegex = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/; if (!emailRegex.test(trimmedEmail)) { return { isValid: false, message: 'Please enter a valid email address (e.g., name@example.com).' }; } // Check for consecutive dots if (trimmedEmail.includes('..')) { return { isValid: false, message: 'Email cannot contain consecutive dots.' }; } // Check for spaces if (trimmedEmail.includes(' ')) { return { isValid: false, message: 'Email cannot contain spaces.' }; } // Check for invalid characters at start/end if (trimmedEmail.startsWith('.') || trimmedEmail.endsWith('.')) { return { isValid: false, message: 'Email cannot start or end with a dot.' }; } // Check for @ symbol const atCount = (trimmedEmail.match(/@/g) || []).length; if (atCount !== 1) { return { isValid: false, message: 'Email must contain exactly one @ symbol.' }; } // Check domain part const [localPart, domainPart] = trimmedEmail.split('@'); if (!domainPart || domainPart.length < 3) { return { isValid: false, message: 'Email domain is too short.' }; } // Check for valid domain extension if (!domainPart.includes('.')) { return { isValid: false, message: 'Email domain must include a valid extension (e.g., .com, .co.uk).' }; } return { isValid: true }; } function validatePhone(phone) { if (!phone || !phone.trim()) { return { isValid: false, message: 'Please enter your phone number.' }; } const trimmedPhone = phone.trim(); // Remove all spaces, hyphens, and parentheses for validation const cleanPhone = trimmedPhone.replace(/[\s\-\(\)]/g, ''); // Check if phone contains only valid characters const validPhoneRegex = /^[\d\+\s\-\(\)]+$/; if (!validPhoneRegex.test(trimmedPhone)) { return { isValid: false, message: 'Phone number can only contain digits, spaces, hyphens, parentheses, and + sign.' }; } // Check minimum length (UK numbers are at least 10 digits) if (cleanPhone.length < 10) { return { isValid: false, message: 'Phone number is too short. UK numbers must be at least 10 digits.' }; } // Check maximum length (UK numbers are at most 15 digits including country code) if (cleanPhone.length > 15) { return { isValid: false, message: 'Phone number is too long. Please check your number.' }; } // Enhanced UK phone number patterns with more comprehensive coverage const ukMobileRegex = /^(\+44|0)7[0-9]{9}$/; // Mobile numbers starting with 07 const ukLandlineRegex = /^(\+44|0)[1-9][0-9]{8,9}$/; // Landline numbers const ukSpecialRegex = /^(\+44|0)800[0-9]{6,7}$/; // Freephone numbers const ukPremiumRegex = /^(\+44|0)9[0-9]{8,9}$/; // Premium rate numbers const ukInternationalRegex = /^\+44[1-9][0-9]{8,9}$/; // International format // Check for common invalid patterns if (cleanPhone.startsWith('00') && !cleanPhone.startsWith('0044')) { return { isValid: false, message: 'Please use +44 for international format or 0 for UK format.' }; } // Check for repeated digits (likely invalid) if (/(\d)\1{6,}/.test(cleanPhone)) { return { isValid: false, message: 'Phone number appears to have too many repeated digits.' }; } if (!ukMobileRegex.test(cleanPhone) && !ukLandlineRegex.test(cleanPhone) && !ukSpecialRegex.test(cleanPhone) && !ukPremiumRegex.test(cleanPhone) && !ukInternationalRegex.test(cleanPhone)) { return { isValid: false, message: 'Please enter a valid UK phone number (mobile, landline, freephone, or premium rate).' }; } return { isValid: true }; } function validatePostcode(postcode) { if (!postcode || !postcode.trim()) { return { isValid: false, message: 'Please enter your postcode.' }; } const trimmedPostcode = postcode.trim().toUpperCase(); // Check maximum length if (trimmedPostcode.length > 8) { return { isValid: false, message: 'Postcode is too long. UK postcodes are maximum 8 characters.' }; } // Check minimum length if (trimmedPostcode.length < 5) { return { isValid: false, message: 'Postcode is too short. UK postcodes are minimum 5 characters.' }; } // Enhanced UK postcode regex pattern with more comprehensive coverage const ukPostcodeRegex = /^[A-Z]{1,2}[0-9R][0-9A-Z]? [0-9][A-Z]{2}$/; if (!ukPostcodeRegex.test(trimmedPostcode)) { return { isValid: false, message: 'Please enter a valid UK postcode (e.g., SW1A 1AA, M1 1AA, B33 8TH).' }; } // Additional validation for specific invalid patterns if (trimmedPostcode.includes(' ')) { return { isValid: false, message: 'Postcode cannot contain consecutive spaces.' }; } // Check for invalid characters const invalidChars = /[^A-Z0-9 ]/; if (invalidChars.test(trimmedPostcode)) { return { isValid: false, message: 'Postcode can only contain letters, numbers, and spaces.' }; } // Check for common invalid patterns if (trimmedPostcode.startsWith(' ') || trimmedPostcode.endsWith(' ')) { return { isValid: false, message: 'Postcode cannot start or end with spaces.' }; } // Validate specific UK postcode patterns const patterns = [ /^[A-Z]{1,2}[0-9][A-Z0-9]? [0-9][A-Z]{2}$/, // Standard format /^[A-Z]{1,2}[0-9] [0-9][A-Z]{2}$/, // Short format /^[A-Z]{1,2}[0-9][A-Z] [0-9][A-Z]{2}$/ // With letter in outward code ]; const isValidPattern = patterns.some(pattern => pattern.test(trimmedPostcode)); if (!isValidPattern) { return { isValid: false, message: 'Please enter a valid UK postcode format.' }; } return { isValid: true }; } // Individual error functions function showServicesError() { const servicesSection = document.querySelector('.services-section') || document.getElementById('services-section'); if (servicesSection) { servicesSection.classList.add('error'); servicesSection.scrollIntoView({ behavior: 'smooth', block: 'center' }); // Remove existing error const existingError = servicesSection.querySelector('.services-error'); if (existingError) existingError.remove(); // Add new error message const errorDiv = document.createElement('div'); errorDiv.className = 'services-error'; errorDiv.innerHTML = '<i></i> Please select a service to continue.'; servicesSection.appendChild(errorDiv); } } function showDateError() { const bookingSection = document.getElementById('booking-section'); if (bookingSection) { bookingSection.classList.add('error'); bookingSection.scrollIntoView({ behavior: 'smooth', block: 'center' }); // Remove existing error const existingError = bookingSection.querySelector('.date-error'); if (existingError) existingError.remove(); // Add new error message const errorDiv = document.createElement('div'); errorDiv.className = 'field-error date-error'; errorDiv.innerHTML = '<i></i> Please select a date to continue.'; const calendarContainer = bookingSection.querySelector('.booking-calendar'); if (calendarContainer) { calendarContainer.appendChild(errorDiv); } } } function showTimeError() { const bookingSection = document.getElementById('booking-section'); if (bookingSection) { bookingSection.classList.add('error'); bookingSection.scrollIntoView({ behavior: 'smooth', block: 'center' }); // Remove existing error const existingError = bookingSection.querySelector('.time-error'); if (existingError) existingError.remove(); // Add new error message const errorDiv = document.createElement('div'); errorDiv.className = 'field-error time-error'; errorDiv.innerHTML = '<i></i> Please select a time to continue.'; const timeSlotsContainer = bookingSection.querySelector('.time-slots'); if (timeSlotsContainer) { timeSlotsContainer.appendChild(errorDiv); } } } function showFieldError(fieldId, message) { const field = document.getElementById(fieldId); if (field) { field.classList.add('error-border'); field.scrollIntoView({ behavior: 'smooth', block: 'center' }); field.focus(); // Remove existing error const existingError = field.parentNode.querySelector('.field-error'); if (existingError) existingError.remove(); // Add new error message const errorDiv = document.createElement('div'); errorDiv.className = 'field-error'; errorDiv.innerHTML = `<i></i> ${message}`; field.parentNode.appendChild(errorDiv); } } function showTermsError() { const termsCheckbox = document.getElementById('acceptTerms'); if (termsCheckbox) { termsCheckbox.scrollIntoView({ behavior: 'smooth', block: 'center' }); termsCheckbox.focus(); // Remove existing error const existingError = termsCheckbox.parentNode.querySelector('.field-error'); if (existingError) existingError.remove(); // Add new error message const errorDiv = document.createElement('div'); errorDiv.className = 'field-error'; errorDiv.innerHTML = '<i></i> Please accept the terms and conditions.'; termsCheckbox.parentNode.appendChild(errorDiv); } } // Clear individual error functions function clearFieldError(fieldId) { const field = document.getElementById(fieldId); if (field) { field.classList.remove('error-border'); const error = field.parentNode.querySelector('.field-error'); if (error) error.remove(); } } function clearServicesError() { const servicesSection = document.querySelector('.services-section') || document.getElementById('services-section'); if (servicesSection) { servicesSection.classList.remove('error'); const error = servicesSection.querySelector('.services-error'); if (error) error.remove(); } } function clearDateError() { const bookingSection = document.getElementById('booking-section'); if (bookingSection) { bookingSection.classList.remove('error'); const error = bookingSection.querySelector('.date-error'); if (error) error.remove(); } } function clearTimeError() { const bookingSection = document.getElementById('booking-section'); if (bookingSection) { bookingSection.classList.remove('error'); const error = bookingSection.querySelector('.time-error'); if (error) error.remove(); } } function clearTermsError() { const termsCheckbox = document.getElementById('acceptTerms'); if (termsCheckbox) { const error = termsCheckbox.parentNode.querySelector('.field-error'); if (error) error.remove(); } } // Update booking button state function updateCompleteBookingButton() { // This function can be used to update the booking button state // For now, it's a placeholder to prevent the error } // Update booking button when terms are accepted function updateBookingButton() { // This function is called when the terms checkbox changes // For now, it's a placeholder to prevent the error } // Scroll to booking section (without scrolling to end of page) function scrollToBooking() { const bookingSection = document.getElementById('booking-section'); if (bookingSection) { bookingSection.scrollIntoView({ behavior: 'smooth', block: 'start' }); } } // Enhanced real-time validation with loyalty programme integration function setupRealTimeValidation() { // Name field validation with enhanced feedback const nameField = document.getElementById('fullName'); if (nameField) { nameField.addEventListener('input', function() { const nameValidation = validateName(this.value.trim()); if (nameValidation.isValid) { clearFieldError('fullName'); showFieldSuccess('fullName', 'Name looks good!'); } else { showFieldError('fullName', nameValidation.message); } }); nameField.addEventListener('blur', function() { const nameValidation = validateName(this.value.trim()); if (!nameValidation.isValid) { showFieldError('fullName', nameValidation.message); } }); } // Email field validation with enhanced feedback const emailField = document.getElementById('email'); if (emailField) { emailField.addEventListener('input', function() { const emailValidation = validateEmail(this.value.trim()); if (emailValidation.isValid) { clearFieldError('email'); showFieldSuccess('email', 'Email format is valid!'); } else { showFieldError('email', emailValidation.message); } }); emailField.addEventListener('blur', function() { const emailValidation = validateEmail(this.value.trim()); if (!emailValidation.isValid) { showFieldError('email', emailValidation.message); } }); } // Phone field validation with enhanced feedback const phoneField = document.getElementById('phone'); if (phoneField) { phoneField.addEventListener('input', function() { const phoneValidation = validatePhone(this.value.trim()); if (phoneValidation.isValid) { clearFieldError('phone'); showFieldSuccess('phone', 'Phone number is valid!'); } else { showFieldError('phone', phoneValidation.message); } }); phoneField.addEventListener('blur', function() { const phoneValidation = validatePhone(this.value.trim()); if (!phoneValidation.isValid) { showFieldError('phone', phoneValidation.message); } }); } // Postcode field validation with enhanced feedback const postcodeField = document.getElementById('postcode'); if (postcodeField) { postcodeField.addEventListener('input', function() { const postcodeValidation = validatePostcode(this.value.trim()); if (postcodeValidation.isValid) { clearFieldError('postcode'); showFieldSuccess('postcode', 'Postcode is valid!'); } else { showFieldError('postcode', postcodeValidation.message); } }); postcodeField.addEventListener('blur', function() { const postcodeValidation = validatePostcode(this.value.trim()); if (!postcodeValidation.isValid) { showFieldError('postcode', postcodeValidation.message); } }); } // Terms checkbox validation const termsCheckbox = document.getElementById('acceptTerms'); if (termsCheckbox) { termsCheckbox.addEventListener('change', function() { if (this.checked) { clearTermsError(); showFieldSuccess('acceptTerms', 'Terms accepted!'); } else { showFieldError('acceptTerms', 'Please accept the terms and conditions to continue.'); } }); } // Enhanced validation for loyalty programme integration setupLoyaltyValidation(); } // Loyalty programme validation integration function setupLoyaltyValidation() { // Check if customer is eligible for loyalty programmes const emailField = document.getElementById('email'); if (emailField) { emailField.addEventListener('blur', async function() { const email = this.value.trim(); if (email && validateEmail(email).isValid) { await checkLoyaltyEligibility(email); } }); } } // Check loyalty programme eligibility with progress tracking async function checkLoyaltyEligibility(email) { try { const businessId = getBusinessIdFromPage(); if (!businessId) return; // Get loyalty programmes and customer progress const [loyaltyProgrammes, loyaltyProgress] = await Promise.all([ getLoyaltyProgrammesForBusiness(), getCustomerLoyaltyProgress(email, businessId) ]); if (loyaltyProgrammes && loyaltyProgrammes.length > 0) { // Check if customer is close to unlocking rewards const progressInfo = checkRewardProgress(loyaltyProgrammes, loyaltyProgress); if (progressInfo && progressInfo.length > 0) { showProgressNotification(progressInfo, loyaltyProgress); } else { showLoyaltyNotification(loyaltyProgrammes, loyaltyProgress); } } } catch (error) { console.log('Loyalty programme check failed:', error); } } // Get loyalty programmes for current business async function getLoyaltyProgrammesForBusiness() { // Simulate database query for loyalty programmes const businessId = getBusinessIdFromPage(); if (!businessId) return null; // Mock loyalty programmes data based on the database structure const mockLoyaltyProgrammes = [ { id: 'lp_001', business_id: businessId, type: 'Visits', threshold: 5, reward_type: 'Free Service', reward_value: 'Hair Wash', expiry_days: 90, terms: 'Valid for 90 days from earning', active: true }, { id: 'lp_002', business_id: businessId, type: 'Spend', threshold: 200, reward_type: 'Discount', reward_value: '20%', expiry_days: 60, terms: 'Valid for 60 days from earning', active: true } ]; return mockLoyaltyProgrammes.filter(lp => lp.active); } // Get customer loyalty progress async function getCustomerLoyaltyProgress(customerEmail, businessId) { try { // Simulate database query for customer loyalty progress const mockLoyaltyProgress = { id: 'lp_progress_001', customer_id: 'customer_123', business_id: businessId, total_visits: 3, total_spend: 150.00, last_visit: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(), // 7 days ago reward_unlocked: false, reward_redeemed: false, reward_voucher_id: null, created_at: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString(), updated_at: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString() }; return mockLoyaltyProgress; } catch (error) { console.error('Failed to get customer loyalty progress:', error); return null; } } // Check if customer is close to unlocking rewards function checkRewardProgress(loyaltyProgrammes, loyaltyProgress) { if (!loyaltyProgress || !loyaltyProgrammes) return null; const progressInfo = []; loyaltyProgrammes.forEach(programme => { let currentProgress = 0; let progressPercentage = 0; let isClose = false; if (programme.type === 'Visits') { currentProgress = loyaltyProgress.total_visits; progressPercentage = (currentProgress / programme.threshold) * 100; isClose = progressPercentage >= 80; // 80% or more } else if (programme.type === 'Spend') { currentProgress = loyaltyProgress.total_spend; progressPercentage = (currentProgress / programme.threshold) * 100; isClose = progressPercentage >= 80; // 80% or more } if (isClose && !loyaltyProgress.reward_unlocked) { progressInfo.push({ programme: programme, currentProgress: currentProgress, threshold: programme.threshold, progressPercentage: Math.round(progressPercentage), remaining: programme.threshold - currentProgress }); } }); return progressInfo.length > 0 ? progressInfo : null; } // Show loyalty programme notification function showLoyaltyNotification(programmes, loyaltyProgress = null) { const notification = document.createElement('div'); notification.className = 'loyalty-notification'; let progressText = ''; if (loyaltyProgress) { progressText = ` <div><p><strong>Your Progress:</strong></p><p>Total Visits: ${loyaltyProgress.total_visits} | Total Spent: ¬£${loyaltyProgress.total_spend.toFixed(2)}</p><p>Last Visit: ${new Date(loyaltyProgress.last_visit).toLocaleDateString()}</p></div> `; } notification.innerHTML = ` <div><i></i><div><strong>Loyalty Programmes Available!</strong><p>Join our loyalty programmes and earn rewards:</p><ul> ${programmes.map(p => `<li>${p.type}: ${p.threshold} ${p.type === 'Visits' ? 'visits' : p.type === 'Spend' ? 'spent' : 'days'} = ${p.reward_type} (${p.reward_value})</li>`).join('')} </ul> ${progressText} </div><button onclick="this.parentElement.parentElement.remove()">√ó</button></div> `; document.body.appendChild(notification); // Auto-remove after 10 seconds setTimeout(() => { if (notification.parentElement) { notification.remove(); } }, 10000); } // Show progress notification for customers close to rewards function showProgressNotification(progressInfo, loyaltyProgress) { const notification = document.createElement('div'); notification.className = 'loyalty-progress-notification'; const progressItems = progressInfo.map(info => ` <div><div><strong>${info.programme.type} Programme</strong><span>${info.progressPercentage}%</span></div><div><div></div></div><div><p>${info.currentProgress} / ${info.threshold} ${info.programme.type === 'Visits' ? 'visits' : 'spent'}</p><p>Only ${info.remaining} more ${info.programme.type === 'Visits' ? 'visits' : 'spent'} needed!</p></div><div><strong>Reward:</strong> ${info.programme.reward_type} (${info.programme.reward_value}) </div></div> `).join(''); notification.innerHTML = ` <div><i></i><div><strong>You're Almost There! üéØ</strong><p>You're close to unlocking rewards:</p> ${progressItems} <div><p><strong>Your Stats:</strong></p><p>Total Visits: ${loyaltyProgress.total_visits} | Total Spent: ¬£${loyaltyProgress.total_spend.toFixed(2)}</p><p>Last Visit: ${new Date(loyaltyProgress.last_visit).toLocaleDateString()}</p></div></div><button onclick="this.parentElement.parentElement.remove()">√ó</button></div> `; document.body.appendChild(notification); // Auto-remove after 15 seconds (longer for progress notifications) setTimeout(() => { if (notification.parentElement) { notification.remove(); } }, 15000); } // Enhanced field success feedback function showFieldSuccess(fieldId, message) { const field = document.getElementById(fieldId); if (!field) return; // Remove existing success message const existingSuccess = field.parentElement.querySelector('.field-success'); if (existingSuccess) existingSuccess.remove(); // Add success message const successDiv = document.createElement('div'); successDiv.className = 'field-success'; successDiv.innerHTML = `<i></i> ${message}`; field.parentElement.appendChild(successDiv); // Add success styling field.classList.add('success-border'); field.classList.remove('error-border'); // Auto-remove success message after 3 seconds setTimeout(() => { if (successDiv.parentElement) { successDiv.remove(); field.classList.remove('success-border'); } }, 3000); } // Enhanced booking completion with loyalty progress tracking async function completeBookingWithLoyaltyTracking(bookingData) { try { // Complete the booking const bookingResult = await completeBooking(); if (bookingResult.success) { // Trigger booking completion event await triggerBookingCompletionEvent(bookingData); // Update loyalty progress await updateLoyaltyProgress(bookingData); // Show loyalty progress notification if applicable await showLoyaltyProgressUpdate(bookingData); } return bookingResult; } catch (error) { console.error('Booking completion with loyalty tracking failed:', error); return { success: false, error: error.message }; } } // Trigger booking completion event async function triggerBookingCompletionEvent(bookingData) { try { const businessId = getBusinessIdFromPage(); const customerEmail = document.getElementById('email').value.trim(); if (!businessId || !customerEmail) return; // Simulate booking completion event const bookingCompletionData = { bookingId: generateBookingId(), customerId: getCustomerIdFromEmail(customerEmail), businessId: businessId, status: 'Completed', amount: parseFloat(bookingData.totalAmount || 0), services: selectedServices, completedAt: new Date().toISOString(), timestamp: new Date().toISOString() }; // Process booking completion await processBookingCompletion(bookingCompletionData); console.log('Booking completion event triggered:', bookingCompletionData); } catch (error) { console.error('Failed to trigger booking completion event:', error); } } // Process booking completion with loyalty programme integration async function processBookingCompletion(bookingData) { try { const { businessId, customerId, amount, services, completedAt } = bookingData; // 1. Check if business has active LoyaltyProgramme const loyaltyProgrammes = await getActiveLoyaltyProgrammes(businessId); if (!loyaltyProgrammes || loyaltyProgrammes.length === 0) { console.log('No active loyalty programmes found for business:', businessId); return; } // 2. Fetch programme details for (const programme of loyaltyProgrammes) { console.log('Processing loyalty programme:', programme); // 3. Update or create LoyaltyProgress record const loyaltyProgress = await updateLoyaltyProgressRecord(customerId, businessId, programme, amount, completedAt); // 4. Check if progress >= threshold if (loyaltyProgress && await checkRewardThreshold(loyaltyProgress, programme)) { // Set reward_unlocked = true loyaltyProgress.reward_unlocked = true; loyaltyProgress.updated_at = new Date().toISOString(); // Generate reward voucher const voucher = await generateRewardVoucher(customerId, businessId, programme); // Notify both parties await notifyRewardUnlocked(customerId, businessId, programme, voucher); console.log('Reward unlocked for customer:', customerId, 'Programme:', programme.type); } } } catch (error) { console.error('Failed to process booking completion:', error); } } // Get active loyalty programmes for business async function getActiveLoyaltyProgrammes(businessId) { try { const programmes = JSON.parse(localStorage.getItem('loyaltyProgrammes') || '[]'); return programmes.filter(p => p.business_id === businessId && p.active === true); } catch (error) { console.error('Failed to get active loyalty programmes:', error); return []; } } // Update loyalty progress record async function updateLoyaltyProgressRecord(customerId, businessId, programme, amount, completedAt) { try { // Get existing progress or create new let loyaltyProgress = await getLoyaltyProgressRecord(customerId, businessId); if (!loyaltyProgress) { // Create new progress record loyaltyProgress = { id: generateUUID(), customer_id: customerId, business_id: businessId, total_visits: 0, total_spend: 0, last_visit: null, reward_unlocked: false, reward_redeemed: false, reward_voucher_id: null, created_at: new Date().toISOString(), updated_at: new Date().toISOString() }; } // Update based on programme type if (programme.type === 'Visits') { loyaltyProgress.total_visits += 1; } else if (programme.type === 'Spend') { loyaltyProgress.total_spend += amount; } else if (programme.type === 'Time') { // Include visit if within rolling window const timeWindow = programme.threshold * 7; // Convert weeks to days const lastVisit = loyaltyProgress.last_visit ? new Date(loyaltyProgress.last_visit) : null; const now = new Date(completedAt); if (!lastVisit || (now - lastVisit) <= (timeWindow * 24 * 60 * 60 * 1000)) { loyaltyProgress.total_visits += 1; } } loyaltyProgress.last_visit = completedAt; loyaltyProgress.updated_at = new Date().toISOString(); // Save updated progress await saveLoyaltyProgressRecord(loyaltyProgress); return loyaltyProgress; } catch (error) { console.error('Failed to update loyalty progress record:', error); return null; } } // Get loyalty progress record async function getLoyaltyProgressRecord(customerId, businessId) { try { const progressRecords = JSON.parse(localStorage.getItem('loyaltyProgress') || '[]'); return progressRecords.find(p => p.customer_id === customerId && p.business_id === businessId); } catch (error) { console.error('Failed to get loyalty progress record:', error); return null; } } // Save loyalty progress record async function saveLoyaltyProgressRecord(loyaltyProgress) { try { const progressRecords = JSON.parse(localStorage.getItem('loyaltyProgress') || '[]'); const existingIndex = progressRecords.findIndex(p => p.id === loyaltyProgress.id); if (existingIndex >= 0) { progressRecords[existingIndex] = loyaltyProgress; } else { progressRecords.push(loyaltyProgress); } localStorage.setItem('loyaltyProgress', JSON.stringify(progressRecords)); console.log('Loyalty progress record saved:', loyaltyProgress); } catch (error) { console.error('Failed to save loyalty progress record:', error); } } // Check if reward threshold is met async function checkRewardThreshold(loyaltyProgress, programme) { try { if (programme.type === 'Visits') { return loyaltyProgress.total_visits >= programme.threshold; } else if (programme.type === 'Spend') { return loyaltyProgress.total_spend >= programme.threshold; } else if (programme.type === 'Time') { // For time-based, check if visits within time window const timeWindow = programme.threshold * 7; // Convert weeks to days const lastVisit = new Date(loyaltyProgress.last_visit); const now = new Date(); const daysSinceLastVisit = (now - lastVisit) / (24 * 60 * 60 * 1000); return loyaltyProgress.total_visits >= programme.threshold && daysSinceLastVisit <= timeWindow; } return false; } catch (error) { console.error('Failed to check reward threshold:', error); return false; } } // Generate reward voucher async function generateRewardVoucher(customerId, businessId, programme) { try { const voucher = { id: generateUUID(), customer_id: customerId, business_id: businessId, programme_id: programme.id, reward_type: programme.reward_type, reward_value: programme.reward_value, expiry_days: programme.expiry_days, terms: programme.terms, created_at: new Date().toISOString(), expires_at: new Date(Date.now() + (programme.expiry_days * 24 * 60 * 60 * 1000)).toISOString(), used: false, used_at: null }; // Save voucher const vouchers = JSON.parse(localStorage.getItem('rewardVouchers') || '[]'); vouchers.push(voucher); localStorage.setItem('rewardVouchers', JSON.stringify(vouchers)); // Update loyalty progress with voucher ID const loyaltyProgress = await getLoyaltyProgressRecord(customerId, businessId); if (loyaltyProgress) { loyaltyProgress.reward_voucher_id = voucher.id; await saveLoyaltyProgressRecord(loyaltyProgress); } console.log('Reward voucher generated:', voucher); return voucher; } catch (error) { console.error('Failed to generate reward voucher:', error); return null; } } // Notify both parties about reward unlock async function notifyRewardUnlocked(customerId, businessId, programme, voucher) { try { // Notify customer await notifyCustomerRewardUnlocked(customerId, programme, voucher); // Notify business await notifyBusinessRewardUnlocked(businessId, customerId, programme, voucher); console.log('Reward unlock notifications sent'); } catch (error) { console.error('Failed to send reward unlock notifications:', error); } } // Notify customer about reward unlock async function notifyCustomerRewardUnlocked(customerId, programme, voucher) { try { // Simulate customer notification console.log(`Customer ${customerId} has unlocked a reward:`, { programme: programme.type, reward: programme.reward_type, value: programme.reward_value, voucherId: voucher.id, expiresAt: voucher.expires_at }); // In a real app, this would send email/SMS notification return true; } catch (error) { console.error('Failed to notify customer:', error); return false; } } // Notify business about reward unlock async function notifyBusinessRewardUnlocked(businessId, customerId, programme, voucher) { try { // Simulate business notification console.log(`Business ${businessId} - Customer ${customerId} has unlocked a reward:`, { programme: programme.type, reward: programme.reward_type, value: programme.reward_value, voucherId: voucher.id }); // In a real app, this would send email notification to business return true; } catch (error) { console.error('Failed to notify business:', error); return false; } } // Generate booking ID function generateBookingId() { return 'BK-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9); } // Get customer ID from email (simulate) function getCustomerIdFromEmail(email) { // In a real app, this would query the database return 'customer_' + email.replace('@', '_').replace('.', '_'); } // Update loyalty progress after booking completion async function updateLoyaltyProgress(bookingData) { try { const businessId = getBusinessIdFromPage(); const customerEmail = document.getElementById('email').value.trim(); if (!businessId || !customerEmail) return; // Simulate updating loyalty progress in database const loyaltyProgress = await getCustomerLoyaltyProgress(customerEmail, businessId); if (loyaltyProgress) { // Update progress based on booking loyaltyProgress.total_visits += 1; loyaltyProgress.total_spend += parseFloat(bookingData.totalAmount || 0); loyaltyProgress.last_visit = new Date().toISOString(); loyaltyProgress.updated_at = new Date().toISOString(); // Check if any rewards are unlocked const loyaltyProgrammes = await getLoyaltyProgrammesForBusiness(); const progressInfo = checkRewardProgress(loyaltyProgrammes, loyaltyProgress); if (progressInfo && progressInfo.length > 0) { // Check if any rewards are actually unlocked (100% progress) const unlockedRewards = progressInfo.filter(info => info.progressPercentage >= 100); if (unlockedRewards.length > 0) { loyaltyProgress.reward_unlocked = true; await showRewardUnlockedNotification(unlockedRewards, loyaltyProgress); } } // Save updated progress (simulate database update) console.log('Updated loyalty progress:', loyaltyProgress); } } catch (error) { console.error('Failed to update loyalty progress:', error); } } // Show loyalty progress update notification async function showLoyaltyProgressUpdate(bookingData) { try { const businessId = getBusinessIdFromPage(); const customerEmail = document.getElementById('email').value.trim(); if (!businessId || !customerEmail) return; const loyaltyProgress = await getCustomerLoyaltyProgress(customerEmail, businessId); const loyaltyProgrammes = await getLoyaltyProgrammesForBusiness(); if (loyaltyProgress && loyaltyProgrammes) { const progressInfo = checkRewardProgress(loyaltyProgrammes, loyaltyProgress); if (progressInfo && progressInfo.length > 0) { showProgressNotification(progressInfo, loyaltyProgress); } } } catch (error) { console.error('Failed to show loyalty progress update:', error); } } // Show reward unlocked notification async function showRewardUnlockedNotification(unlockedRewards, loyaltyProgress) { const notification = document.createElement('div'); notification.className = 'reward-unlocked-notification'; const rewardItems = unlockedRewards.map(reward => ` <div><div><i></i><strong>${reward.programme.reward_type} Unlocked!</strong></div><div><p><strong>Reward:</strong> ${reward.programme.reward_type} (${reward.programme.reward_value})</p><p><strong>Programme:</strong> ${reward.programme.type} - ${reward.threshold} ${reward.programme.type === 'Visits' ? 'visits' : 'spent'}</p><p>${reward.programme.terms}</p></div></div> `).join(''); notification.innerHTML = ` <div><i></i><div><strong>üéâ Congratulations! Rewards Unlocked! üéâ</strong><p>You've earned rewards for your loyalty:</p> ${rewardItems} <div><p><strong>Your Loyalty Stats:</strong></p><p>Total Visits: ${loyaltyProgress.total_visits} | Total Spent: ¬£${loyaltyProgress.total_spend.toFixed(2)}</p></div></div><button onclick="this.parentElement.parentElement.remove()">√ó</button></div> `; document.body.appendChild(notification); // Auto-remove after 20 seconds (longer for reward notifications) setTimeout(() => { if (notification.parentElement) { notification.remove(); } }, 20000); } // Step-by-step validation functions function scrollToServicesAndShowError() { const servicesSection = document.querySelector('.services-section') || document.getElementById('services-section'); if (servicesSection) { servicesSection.scrollIntoView({ behavior: 'smooth', block: 'center' }); showInlineError(servicesSection, 'Please select a service to continue.'); } } function scrollToDateAndShowError() { const bookingSection = document.getElementById('booking-section'); if (bookingSection) { bookingSection.scrollIntoView({ behavior: 'smooth', block: 'center' }); showInlineError(bookingSection, 'Please select a date and time to continue.'); } } function scrollToFieldAndShowError(field, message) { if (field) { field.scrollIntoView({ behavior: 'smooth', block: 'center' }); field.focus(); showInlineError(field, message); } } function scrollToTermsAndShowError() { const termsCheckbox = document.getElementById('acceptTerms'); if (termsCheckbox) { termsCheckbox.scrollIntoView({ behavior: 'smooth', block: 'center' }); showInlineError(termsCheckbox, 'Please accept the terms and conditions to continue.'); } } // Show inline error message function showInlineError(element, message) { // Remove any existing error message const existingError = element.parentNode.querySelector('.inline-error'); if (existingError) { existingError.remove(); } // Add error class to element element.classList.add('error'); // Create inline error message const errorDiv = document.createElement('div'); errorDiv.className = 'inline-error'; errorDiv.textContent = message; errorDiv.style.cssText = 'color: #ef4444; font-size: 0.875rem; margin-top: 0.5rem; display: block;'; // Insert error message after the element element.parentNode.insertBefore(errorDiv, element.nextSibling); // Remove error when user interacts with the field const removeError = () => { element.classList.remove('error'); if (errorDiv.parentNode) { errorDiv.remove(); } }; if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') { element.addEventListener('input', removeError, { once: true }); } else { element.addEventListener('click', removeError, { once: true }); } } // Helper functions for enhanced validation feedback function clearValidationStates() { const fields = ['fullName', 'email', 'phone', 'postcode']; fields.forEach(fieldId => { const field = document.getElementById(fieldId); if (field) { field.classList.remove('error', 'success'); field.style.borderColor = '#d1d5db'; field.style.backgroundColor = '#ffffff'; } // Clear error and success messages const errorMsg = document.getElementById(`${fieldId}Error`); const successMsg = document.getElementById(`${fieldId}Success`); if (errorMsg) errorMsg.style.display = 'none'; if (successMsg) successMsg.style.display = 'none'; }); } function showFieldError(field, message) { if (!field) return; field.classList.add('error'); field.classList.remove('success'); field.style.borderColor = '#ef4444'; field.style.backgroundColor = '#fef2f2'; // Show error message let errorElement = document.getElementById(`${field.id}Error`); if (!errorElement) { errorElement = document.createElement('div'); errorElement.id = `${field.id}Error`; errorElement.className = 'error-message'; errorElement.style.color = '#ef4444'; errorElement.style.fontSize = '0.875rem'; errorElement.style.marginTop = '0.25rem'; field.parentNode.appendChild(errorElement); } errorElement.textContent = message; errorElement.style.display = 'block'; } function showFieldSuccess(field, message) { if (!field) return; field.classList.add('success'); field.classList.remove('error'); field.style.borderColor = '#10b981'; field.style.backgroundColor = '#f0fdf4'; // Show success message let successElement = document.getElementById(`${field.id}Success`); if (!successElement) { successElement = document.createElement('div'); successElement.id = `${field.id}Success`; successElement.className = 'success-message'; successElement.style.color = '#10b981'; successElement.style.fontSize = '0.875rem'; successElement.style.marginTop = '0.25rem'; field.parentNode.appendChild(successElement); } successElement.textContent = message; successElement.style.display = 'block'; } // Enhanced UK-specific customer details validation with improved user feedback function validateCustomerDetails() { const fullName = document.getElementById('fullName'); const email = document.getElementById('email'); const phone = document.getElementById('phone'); const postcode = document.getElementById('postcode'); // Clear previous validation states clearValidationStates(); // Validate Full Name if (!fullName || !fullName.value.trim()) { showFieldError(fullName, 'Please enter your full name.'); return { isValid: false, field: fullName, message: 'Please enter your full name.' }; } // Check if name has at least 2 words (first and last) const nameWords = fullName.value.trim().split(/\s+/); if (nameWords.length < 2) { showFieldError(fullName, 'Please enter your first and last name.'); return { isValid: false, field: fullName, message: 'Please enter your first and last name.' }; } // Validate name format (letters, hyphens, apostrophes only) const nameRegex = /^(?=.{2,50}$)[A-Za-z]+(?:['-][A-Za-z]+)?\s+[A-Za-z]+(?:['-][A-Za-z]+)?$/; if (!nameRegex.test(fullName.value.trim())) { showFieldError(fullName, 'Names can only include letters, hyphens, or apostrophes.'); return { isValid: false, field: fullName, message: 'Names can only include letters, hyphens, or apostrophes.' }; } // Show success for valid name showFieldSuccess(fullName, '‚úì Name looks good!'); // Validate Email if (!email || !email.value.trim()) { return { isValid: false, field: email, message: 'Please enter your email address.' }; } const emailRegex = /^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/; if (!emailRegex.test(email.value.trim())) { return { isValid: false, field: email, message: 'Please enter a valid email address (e.g., name@example.com).' }; } // Validate UK Phone Number if (!phone || !phone.value.trim()) { return { isValid: false, field: phone, message: 'Please enter your phone number.' }; } // Remove spaces and dashes for validation const cleanPhone = phone.value.replace(/[\s-]/g, ''); const ukMobileRegex = /^(07\d{9})$/; const ukLandlineRegex = /^(0(1|2|3)\d{8,9})$/; if (!ukMobileRegex.test(cleanPhone) && !ukLandlineRegex.test(cleanPhone)) { return { isValid: false, field: phone, message: 'Please enter a valid UK mobile or landline number.' }; } // Validate UK Postcode if (!postcode || !postcode.value.trim()) { return { isValid: false, field: postcode, message: 'Please enter your postcode.' }; } const ukPostcodeRegex = /^([Gg][Ii][Rr] 0[Aa]{2}|(([A-PR-UWYZ][0-9][0-9]?|[A-PR-UWYZ][A-HK-Y][0-9][0-9]?|[A-PR-UWYZ][0-9][A-HJKSTUW]|[A-PR-UWYZ][A-HK-Y][0-9][ABEHMNPRVWXY]))\s?[0-9][ABD-HJLNP-UW-Z]{2})$/; if (!ukPostcodeRegex.test(postcode.value.trim().toUpperCase())) { return { isValid: false, field: postcode, message: 'Please enter a valid UK postcode (e.g., SW1A 1AA).' }; } return { isValid: true }; } // Show booking summary function showBookingSummary() { const totalPrice = selectedServices.reduce((sum, service) => sum + service.price, 0); const summary = ` <div><h3>Booking Summary</h3><div><h4>Services</h4> ${selectedServices.map(service => ` <div><span>${service.name}</span><span>¬£${service.price}</span></div> `).join('')} </div><div><h4>Appointment</h4><div><span>Date</span><span>${selectedDate.toLocaleDateString()}</span></div><div><span>Time</span><span>${selectedTime}</span></div></div><div><h4>Total</h4><div><span>¬£${totalPrice}</span></div></div><div><button onclick="confirmBooking()"> Confirm Booking </button><button onclick="closeModal()"> Cancel </button></div></div> `; showModal(summary); } // Show modal function showModal(content) { const modal = document.createElement('div'); modal.style.cssText = ` position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); display: flex; align-items: center; justify-content: center; z-index: 1000; `; modal.innerHTML = content; modal.id = 'bookingModal'; document.body.appendChild(modal); } // Close modal function closeModal() { const modal = document.getElementById('bookingModal'); if (modal) { modal.remove(); } } // Confirm booking function confirmBooking() { closeModal(); alert('Your booking is confirmed! üéâ'); } // Progress indicator functions function updateProgressIndicator() { const step1 = document.getElementById('step1'); const step2 = document.getElementById('step2'); const step3 = document.getElementById('step3'); const step4 = document.getElementById('step4'); // Reset all steps [step1, step2, step3, step4].forEach(step => { step.classList.remove('current', 'completed'); const circle = step.querySelector('.step-circle'); circle.classList.remove('current', 'completed', 'pending'); circle.classList.add('pending'); }); // Step 1: Service selection if (selectedServices.length > 0) { step1.classList.add('completed'); step1.querySelector('.step-circle').classList.remove('pending'); step1.querySelector('.step-circle').classList.add('completed'); } else { step1.classList.add('current'); step1.querySelector('.step-circle').classList.remove('pending'); step1.querySelector('.step-circle').classList.add('current'); return; } // Step 2: Date and time if (selectedDate && selectedTime) { step2.classList.add('completed'); step2.querySelector('.step-circle').classList.remove('pending'); step2.querySelector('.step-circle').classList.add('completed'); } else { step2.classList.add('current'); step2.querySelector('.step-circle').classList.remove('pending'); step2.querySelector('.step-circle').classList.add('current'); return; } // Step 3: Customer details const fullName = document.getElementById('fullName'); const email = document.getElementById('email'); const phone = document.getElementById('phone'); const postcode = document.getElementById('postcode'); const terms = document.getElementById('acceptTerms'); if (fullName?.value.trim() && email?.value.trim() && phone?.value.trim() && postcode?.value.trim() && terms?.checked) { step3.classList.add('completed'); step3.querySelector('.step-circle').classList.remove('pending'); step3.querySelector('.step-circle').classList.add('completed'); step4.classList.add('current'); step4.querySelector('.step-circle').classList.remove('pending'); step4.querySelector('.step-circle').classList.add('current'); } else { step3.classList.add('current'); step3.querySelector('.step-circle').classList.remove('pending'); step3.querySelector('.step-circle').classList.add('current'); } } // Payment model display function function updatePaymentModelDisplay() { const paymentModelInfo = document.getElementById('paymentModelInfo'); const paymentOptions = document.getElementById('paymentOptions'); // Calculate total (use 0 if no services selected) const total = selectedServices.length > 0 ? selectedServices.reduce((sum, service) => sum + service.price, 0) : 0; // In real implementation, this would come from business data const businessPaymentModel = 'deposit-balance'; // Options: 'full-online', 'deposit-balance', 'full-venue' const depositPercentage = 30; // In real implementation, this would come from business data let paymentModelHTML = ''; let paymentOptionsHTML = ''; // If no services selected, show placeholder message if (total === 0) { paymentModelHTML = ` <h4>Payment Information</h4><div><p>No current services selected. Select services above to see payment information.</p></div> `; paymentOptionsHTML = ''; } else { // Show payment information based on business model switch (businessPaymentModel) { case 'full-online': paymentModelHTML = ` <h4>Payment Information</h4><div><p><strong>Full Payment Online</strong></p><p>Total Amount: <strong>¬£${total}</strong></p><p>You will be charged the full amount when you complete your booking.</p></div> `; break; case 'deposit-balance': const depositAmount = Math.round(total * (depositPercentage / 100)); const balanceAmount = total - depositAmount; paymentModelHTML = ` <h4>Payment Information</h4><div><p><strong>Deposit + Balance at Venue</strong></p><p>Deposit (${depositPercentage}%): <strong>¬£${depositAmount}</strong></p><p>Balance at Venue: <strong>¬£${balanceAmount}</strong></p><p>Total: <strong>¬£${total}</strong></p></div> `; break; case 'full-venue': paymentModelHTML = ` <h4>Payment Information</h4><div><p><strong>Pay at Venue</strong></p><p>Total Amount: <strong>¬£${total}</strong></p><p>No payment required online. Pay when you arrive.</p></div> `; break; } } if (paymentModelInfo) { paymentModelInfo.innerHTML = paymentModelHTML; } if (paymentOptions) { paymentOptions.innerHTML = paymentOptionsHTML; } } // Initialize progress tracking function initializeProgressTracking() { // Update progress when services are added/removed document.addEventListener('click', function(e) { if (e.target.closest('.add-service-btn') || e.target.closest('.remove-service-btn')) { setTimeout(updateProgressIndicator, 100); } }); // Update progress when form fields change const formInputs = document.querySelectorAll('#fullName, #email, #phone, #postcode, #acceptTerms'); formInputs.forEach(input => { input.addEventListener('input', updateProgressIndicator); input.addEventListener('change', updateProgressIndicator); }); // Update progress when date/time is selected document.addEventListener('click', function(e) { if (e.target.closest('.calendar-day') || e.target.closest('.time-slot')) { setTimeout(updateProgressIndicator, 100); } }); } // Page loaded window.addEventListener('load', function() { console.log('Page loaded successfully!'); // Ensure page starts at the top window.scrollTo(0, 0); }); // Also ensure page starts at top when DOM is ready document.addEventListener('DOMContentLoaded', function() { window.scrollTo(0, 0); }); // Gallery functionality let currentSlideIndex = 0; let slides = document.querySelectorAll('.gallery-slide'); let dots = document.querySelectorAll('.gallery-dot'); let uploadedPhotos = []; // Added this line function showSlide(index) { const slidesContainer = document.getElementById('gallerySlides'); slidesContainer.style.transform = `translateX(-${index * 100}%)`; dots.forEach((dot, i) => { dot.classList.toggle('active', i === index); }); } function changeSlide(direction) { currentSlideIndex += direction; if (currentSlideIndex >= slides.length) currentSlideIndex = 0; if (currentSlideIndex < 0) currentSlideIndex = slides.length - 1; showSlide(currentSlideIndex); } function currentSlide(index) { currentSlideIndex = index - 1; showSlide(currentSlideIndex); } // Auto-slide every 5 seconds setInterval(() => { changeSlide(1); }, 5000); // Test function to check if JavaScript is working function testFunction() { alert('JavaScript is working!'); } // Service selection and booking functionality function clearAllBookingData() { console.log('Basket is empty - clearing all booking data'); // Clear all booking variables selectedDate = null; selectedTime = null; selectedPayment = null; // Clear all form fields const fullName = document.getElementById('fullName'); const email = document.getElementById('email'); const phone = document.getElementById('phone'); const postcode = document.getElementById('postcode'); const acceptTerms = document.getElementById('acceptTerms'); if (fullName) fullName.value = ''; if (email) email.value = ''; if (phone) phone.value = ''; if (postcode) postcode.value = ''; if (acceptTerms) acceptTerms.checked = false; // Clear all visual selections clearDateAndTime(); // Clear payment selections document.querySelectorAll('.payment-option').forEach(option => option.classList.remove('selected')); document.querySelectorAll('.payment-method').forEach(method => method.classList.remove('selected')); // Hide booking section const bookingSection = document.getElementById('booking-section'); if (bookingSection) { bookingSection.style.display = 'none'; } // Show no services message showNoServicesMessage(); // Update progress indicator updateProgressIndicator(); } function clearDateAndTime() { // Clear selected date and time selectedDate = null; selectedTime = null; // Clear visual selections document.querySelectorAll('.calendar-day').forEach(el => el.classList.remove('selected')); document.querySelectorAll('.time-slot').forEach(el => el.classList.remove('selected')); // Clear time slots display const timeSlots = document.getElementById('timeSlots'); if (timeSlots) { timeSlots.innerHTML = '<p>Select a date to see available times</p>'; } } function updateSelectedServices() { const selectedServicesDiv = document.getElementById('selected-services'); const selectedServicesList = document.getElementById('selected-services-list'); const totalPriceSpan = document.getElementById('total-price'); if (selectedServices.length === 0) { selectedServicesDiv.style.display = 'none'; return; } selectedServicesDiv.style.display = 'block'; selectedServicesList.innerHTML = ''; let totalPrice = 0; selectedServices.forEach(service => { const serviceItem = document.createElement('div'); serviceItem.className = 'selected-service-item'; serviceItem.innerHTML = ` <div><div>${service.name}</div><div>¬£${service.price}</div></div><button onclick="event.stopPropagation(); removeService('${service.name}')"><i></i></button> `; selectedServicesList.appendChild(serviceItem); totalPrice += service.price; }); totalPriceSpan.textContent = totalPrice; } function showServiceSelection() { // Scroll back to services section document.querySelector('.services-grid').scrollIntoView({ behavior: 'smooth' }); } // CTA Button functions function selectGuestCheckout() { // Hide checkout options and show customer details document.querySelector('.checkout-options-simple').style.display = 'none'; document.getElementById('customerDetails').style.display = 'block'; console.log('Guest checkout selected'); } // Check if user is logged in and pre-fill details function checkUserLogin() { const isLoggedIn = localStorage.getItem('userLoggedIn') === 'true'; if (isLoggedIn) { // Hide checkout options and show customer details document.querySelector('.checkout-options-simple').style.display = 'none'; document.getElementById('customerDetails').style.display = 'block'; // Pre-fill customer details const userEmail = localStorage.getItem('userEmail'); const userName = localStorage.getItem('userName'); const userPhone = localStorage.getItem('userPhone'); const userPostcode = localStorage.getItem('userPostcode'); if (userEmail) document.getElementById('email').value = userEmail; if (userName) document.getElementById('fullName').value = userName; if (userPhone) document.getElementById('phone').value = userPhone; if (userPostcode) document.getElementById('postcode').value = userPostcode; // Restore basket contents if they exist restoreBasketContents(); console.log('User is logged in, details pre-filled and basket restored'); } } // Save basket contents before redirecting to login/register function saveBasketContents() { const basketData = { selectedServices: selectedServices, selectedDate: selectedDate, selectedTime: selectedTime, selectedPayment: selectedPayment, timestamp: Date.now() }; localStorage.setItem('basketContents', JSON.stringify(basketData)); console.log('Basket contents saved:', basketData); } // Restore basket contents after login/register function restoreBasketContents() { const savedBasket = localStorage.getItem('basketContents'); if (savedBasket) { try { const basketData = JSON.parse(savedBasket); // Only restore if it's recent (within 1 hour) if (Date.now() - basketData.timestamp < 3600000) { selectedServices = basketData.selectedServices || []; selectedDate = basketData.selectedDate ? new Date(basketData.selectedDate) : null; selectedTime = basketData.selectedTime; selectedPayment = basketData.selectedPayment; // Update UI with restored data updateSelectedServices(); updateBookingSummary(); updateBookingServicesList(); // Show booking section if services were restored if (selectedServices.length > 0) { const bookingSection = document.getElementById('booking-section'); if (bookingSection) { bookingSection.style.display = 'block'; initializeCalendar(); } } console.log('Basket contents restored:', basketData); } else { // Clear old basket data localStorage.removeItem('basketContents'); } } catch (error) { console.error('Error restoring basket:', error); } } } // Update Payment Method Information function updatePaymentMethodInfo() { console.log('updatePaymentMethodInfo called'); const paymentMethodText = document.getElementById('paymentMethodText'); if (!paymentMethodText) { console.log('paymentMethodText element not found'); return; } // In real implementation, this would come from business data const businessPaymentModel = 'deposit-balance'; // Options: 'full-online', 'deposit-balance', 'full-venue' const depositPercentage = 30; // In real implementation, this would come from business data let paymentMethodDescription = ''; switch (businessPaymentModel) { case 'full-online': paymentMethodDescription = 'This business accepts <strong>Full Payment Online</strong> payments. <br><br><strong>Next step:</strong> Select a service above to see pricing and payment details.'; break; case 'deposit-balance': paymentMethodDescription = `This business accepts <strong>Deposit Online + Balance at Venue</strong> payments (${depositPercentage}% deposit required). <br><br><strong>Next step:</strong> Select a service above to see pricing and payment details.`; break; case 'full-venue': paymentMethodDescription = 'This business accepts <strong>Full Payment at Venue</strong> payments. No payment is required online - you will pay the full amount when you arrive. <br><br><strong>Next step:</strong> Select a service above to see pricing and booking details.'; break; } console.log('Setting payment method text:', paymentMethodDescription); paymentMethodText.innerHTML = paymentMethodDescription; } // Payment Model Display Function function updatePaymentModelDisplay() { console.log('updatePaymentModelDisplay called'); const paymentModelInfo = document.getElementById('paymentModelInfo'); const paymentOptions = document.getElementById('paymentOptions'); console.log('paymentModelInfo element:', paymentModelInfo); console.log('paymentOptions element:', paymentOptions); // Calculate total (use 0 if no services selected) const total = selectedServices.length > 0 ? selectedServices.reduce((sum, service) => sum + service.price, 0) : 0; console.log('Total calculated:', total); // In real implementation, this would come from business data const businessPaymentModel = 'deposit-balance'; // Options: 'full-online', 'deposit-balance', 'full-venue' const depositPercentage = 30; // In real implementation, this would come from business data let paymentModelHTML = ''; let paymentOptionsHTML = ''; // If no services selected, show placeholder message if (total === 0) { paymentModelHTML = ` <h4>Payment Information</h4><div><p>No current services selected. Select services above to see payment information.</p></div> `; paymentOptionsHTML = ''; } else { switch (businessPaymentModel) { case 'full-online': paymentModelHTML = ` <h4>Full Payment Online</h4><div><div>Full payment of ¬£${total} due now.</div><p>Complete your booking with secure online payment. No additional payment required at the venue.</p><div><p><strong>Payment Processing:</strong> Payments are processed by BlkPages via Stripe, on behalf of Royal Hair Studio. Your contract of service is with Royal Hair Studio, not BlkPages.</p></div></div> `; paymentOptionsHTML = ` <div onclick="selectPayment('payNow')"><div><div><i></i></div><div><div>Complete Booking</div><div>Secure payment with card or digital wallet</div></div></div></div> `; break; case 'deposit-balance': const depositAmount = Math.round(total * (depositPercentage / 100)); const balanceAmount = total - depositAmount; paymentModelHTML = ` <h4>Deposit Online + Balance at Venue</h4><div><div>Pay ¬£${depositAmount} now (${depositPercentage}%), balance ¬£${balanceAmount} at the venue.</div><p>Secure your booking with a ${depositPercentage}% deposit. Pay the remaining balance when you arrive.</p><div><strong>Deposit:</strong> ¬£${depositAmount} (${depositPercentage}%)<br><strong>Balance at venue:</strong> ¬£${balanceAmount} </div><div><p><strong>Payment Processing:</strong> Payments are processed by BlkPages via Stripe, on behalf of Royal Hair Studio. Your contract of service is with Royal Hair Studio, not BlkPages.</p></div></div> `; paymentOptionsHTML = ` <div onclick="selectPayment('payNow')"><div><div><i></i></div><div><div>Complete Booking</div><div>Pay ¬£${depositAmount} deposit online</div></div></div></div> `; break; case 'full-venue': paymentModelHTML = ` <h4>Full Payment at Venue</h4><div><div>No payment due now. Full balance of ¬£${total} payable at the venue.</div><p>Book your appointment without any upfront payment. Pay the full amount when you arrive.</p><div><p><strong>Payment Processing:</strong> No online payment required. You will pay Royal Hair Studio directly at the venue. Your contract of service is with Royal Hair Studio, not BlkPages.</p></div></div> `; paymentOptionsHTML = ` <div onclick="selectPayment('payAtVenue')"><div><div><i></i></div><div><div>Complete Booking</div><div>No payment required now - pay ¬£${total} at the venue</div></div></div></div> `; break; } } paymentModelInfo.innerHTML = paymentModelHTML; paymentOptions.innerHTML = paymentOptionsHTML; } // Run check on page load document.addEventListener('DOMContentLoaded', function() { checkUserLogin(); // Initialize payment method info updatePaymentMethodInfo(); // Setup real-time validation setupRealTimeValidation(); // Initialize payment model display updatePaymentModelDisplay(); // Initialize waiting list system initializeWaitingListSystem(); // Initialize progress tracking initializeProgressTracking(); // Payment buttons are now in the sidebar // Debug: Check if booking section exists const bookingSection = document.getElementById('booking-section'); console.log('Page loaded - Booking section found:', bookingSection); console.log('Booking section display style:', bookingSection ? bookingSection.style.display : 'not found'); // Initialize calendar on page load initializeCalendar(); }); // Back button function function goBack() { if (window.history.length > 1) { window.history.back(); } else { // If no history, go to homepage window.location.href = 'index.html'; } } // No services message functions function showNoServicesMessage() { const noServicesMessage = document.getElementById('noServicesMessage'); if (noServicesMessage) { noServicesMessage.style.display = 'block'; console.log('No services message shown'); } } function hideNoServicesMessage() { const noServicesMessage = document.getElementById('noServicesMessage'); if (noServicesMessage) { noServicesMessage.style.display = 'none'; console.log('No services message hidden'); } } function scrollToServices() { // Find the services section const servicesSection = document.querySelector('.services-section') || document.querySelector('[class*="service"]') || document.querySelector('h2') || document.querySelector('.card'); if (servicesSection) { servicesSection.scrollIntoView({ behavior: 'smooth', block: 'start' }); console.log('Scrolled to services section'); } } function clearAllErrors() { // Remove error classes from all elements document.querySelectorAll('.error').forEach(el => el.classList.remove('error')); document.querySelectorAll('.error-message').forEach(el => el.classList.remove('error-message')); } function showFieldError(element, message, sectionId) { if (!element) return; // Add error class to the element element.classList.add('error'); // Add error message bubble element.classList.add('error-message'); element.setAttribute('data-message', message); // Scroll to the section containing the error const section = document.getElementById(sectionId); if (section) { section.scrollIntoView({ behavior: 'smooth', block: 'center' }); } // Remove error state after 5 seconds setTimeout(() => { element.classList.remove('error', 'error-message'); element.removeAttribute('data-message'); }, 5000); } // Step-by-step validation functions function scrollToServicesAndShowError() { const servicesSection = document.querySelector('.services-section') || document.getElementById('services-section'); if (servicesSection) { servicesSection.scrollIntoView({ behavior: 'smooth', block: 'center' }); showInlineError(servicesSection, 'Please select a service to continue.'); } } function scrollToDateAndShowError() { const bookingSection = document.getElementById('booking-section'); if (bookingSection) { bookingSection.style.display = 'block'; bookingSection.scrollIntoView({ behavior: 'smooth', block: 'center' }); showInlineError(bookingSection, 'Please select a date and time to continue.'); } } function validateCustomerDetails() { const fullName = document.getElementById('fullName'); const email = document.getElementById('email'); const phone = document.getElementById('phone'); const postcode = document.getElementById('postcode'); // Validate Full Name if (!fullName || !fullName.value.trim()) { return { isValid: false, field: fullName, message: 'Please enter your full name.' }; } // Check if name has at least 2 words (first and last) const nameWords = fullName.value.trim().split(/\s+/); if (nameWords.length < 2) { return { isValid: false, field: fullName, message: 'Please enter your first and last name.' }; } // Validate name format (letters, hyphens, apostrophes only) const nameRegex = /^(?=.{2,50}$)[A-Za-z]+(?:['-][A-Za-z]+)?\s+[A-Za-z]+(?:['-][A-Za-z]+)?$/; if (!nameRegex.test(fullName.value.trim())) { return { isValid: false, field: fullName, message: 'Names can only include letters, hyphens, or apostrophes.' }; } // Validate Email if (!email || !email.value.trim()) { return { isValid: false, field: email, message: 'Please enter your email address.' }; } const emailRegex = /^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/; if (!emailRegex.test(email.value.trim())) { return { isValid: false, field: email, message: 'Please enter a valid email address (e.g., name@example.com).' }; } // Validate UK Phone Number if (!phone || !phone.value.trim()) { return { isValid: false, field: phone, message: 'Please enter your phone number.' }; } // Remove spaces and dashes for validation const cleanPhone = phone.value.replace(/[\s-]/g, ''); const ukMobileRegex = /^(07\d{9})$/; const ukLandlineRegex = /^(0(1|2|3)\d{8,9})$/; if (!ukMobileRegex.test(cleanPhone) && !ukLandlineRegex.test(cleanPhone)) { return { isValid: false, field: phone, message: 'Please enter a valid UK mobile or landline number.' }; } // Validate UK Postcode if (!postcode || !postcode.value.trim()) { return { isValid: false, field: postcode, message: 'Please enter your postcode.' }; } const ukPostcodeRegex = /^([Gg][Ii][Rr] 0[Aa]{2}|(([A-PR-UWYZ][0-9][0-9]?|[A-PR-UWYZ][A-HK-Y][0-9][0-9]?|[A-PR-UWYZ][0-9][A-HJKSTUW]|[A-PR-UWYZ][A-HK-Y][0-9][ABEHMNPRVWXY]))\s?[0-9][ABD-HJLNP-UW-Z]{2})$/; if (!ukPostcodeRegex.test(postcode.value.trim().toUpperCase())) { return { isValid: false, field: postcode, message: 'Please enter a valid UK postcode (e.g., SW1A 1AA).' }; } return { isValid: true }; } function scrollToFieldAndShowError(field, message) { if (field) { field.scrollIntoView({ behavior: 'smooth', block: 'center' }); field.focus(); showInlineError(field, message); } } function scrollToTermsAndShowError() { const termsCheckbox = document.getElementById('acceptTerms'); if (termsCheckbox) { termsCheckbox.scrollIntoView({ behavior: 'smooth', block: 'center' }); showInlineError(termsCheckbox, 'Please accept the terms and conditions to continue.'); } } function showInlineError(element, message) { // Remove any existing error message const existingError = element.parentNode.querySelector('.inline-error'); if (existingError) { existingError.remove(); } // Add error class to element element.classList.add('error'); // Create inline error message const errorDiv = document.createElement('div'); errorDiv.className = 'inline-error'; errorDiv.textContent = message; errorDiv.style.cssText = 'color: #ef4444; font-size: 0.875rem; margin-top: 0.5rem; display: block;'; // Insert error message after the element element.parentNode.insertBefore(errorDiv, element.nextSibling); // Remove error when user interacts with the field const removeError = () => { element.classList.remove('error'); if (errorDiv.parentNode) { errorDiv.remove(); } }; if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') { element.addEventListener('input', removeError, { once: true }); } else { element.addEventListener('click', removeError, { once: true }); } } function showBookingSummary() { // Create booking summary modal const summary = createBookingSummary(); showModal(summary); } function createBookingSummary() { const totalPrice = selectedServices.reduce((sum, service) => sum + service.price, 0); return ` <div><h3>Booking Summary</h3><div><h4>Services</h4> ${selectedServices.map(service => ` <div><span>${service.name}</span><span>¬£${service.price}</span></div> `).join('')} </div><div><h4>Appointment</h4><div><span>Date</span><span>${selectedDate.toLocaleDateString()}</span></div><div><span>Time</span><span>${selectedTime}</span></div></div><div><h4>Your Details</h4><div><span>Name</span><span>${document.getElementById('fullName').value}</span></div><div><span>Email</span><span>${document.getElementById('email').value}</span></div><div><span>Phone</span><span>${document.getElementById('phone').value}</span></div><div><span>Postcode</span><span>${document.getElementById('postcode').value.toUpperCase()}</span></div></div><div><h4>Total</h4><div><span>¬£${totalPrice}</span></div></div><div><button onclick="confirmBooking()"> Confirm Booking </button><button onclick="closeModal()"> Cancel </button></div></div> `; } function showModal(content) { const modal = document.createElement('div'); modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50'; modal.innerHTML = ` <div> ${content} </div> `; document.body.appendChild(modal); // Close modal when clicking outside modal.addEventListener('click', (e) => { if (e.target === modal) { closeModal(); } }); } function closeModal() { const modal = document.querySelector('.fixed.inset-0'); if (modal) { modal.remove(); } } function confirmBooking() { // Complete the booking process completeBooking(); closeModal(); } function updateProgressIndicator() { const step1 = document.getElementById('step1'); const step2 = document.getElementById('step2'); const step3 = document.getElementById('step3'); const step4 = document.getElementById('step4'); // Reset all steps [step1, step2, step3, step4].forEach(step => { step.classList.remove('current', 'completed'); const circle = step.querySelector('.step-circle'); circle.classList.remove('current', 'completed', 'pending'); circle.classList.add('pending'); }); // Step 1: Service selection if (selectedServices.length > 0) { step1.classList.add('completed'); step1.querySelector('.step-circle').classList.remove('pending'); step1.querySelector('.step-circle').classList.add('completed'); } else { step1.classList.add('current'); step1.querySelector('.step-circle').classList.remove('pending'); step1.querySelector('.step-circle').classList.add('current'); return; } // Step 2: Date and time if (selectedDate && selectedTime) { step2.classList.add('completed'); step2.querySelector('.step-circle').classList.remove('pending'); step2.querySelector('.step-circle').classList.add('completed'); } else { step2.classList.add('current'); step2.querySelector('.step-circle').classList.remove('pending'); step2.querySelector('.step-circle').classList.add('current'); return; } // Step 3: Customer details const fullName = document.getElementById('fullName'); const email = document.getElementById('email'); const phone = document.getElementById('phone'); const postcode = document.getElementById('postcode'); const terms = document.getElementById('acceptTerms'); if (fullName?.value.trim() && email?.value.trim() && phone?.value.trim() && postcode?.value.trim() && terms?.checked) { step3.classList.add('completed'); step3.querySelector('.step-circle').classList.remove('pending'); step3.querySelector('.step-circle').classList.add('completed'); step4.classList.add('current'); step4.querySelector('.step-circle').classList.remove('pending'); step4.querySelector('.step-circle').classList.add('current'); } else { step3.classList.add('current'); step3.querySelector('.step-circle').classList.remove('pending'); step3.querySelector('.step-circle').classList.add('current'); } } // Add event listeners to update progress indicator function initializeProgressTracking() { // Update progress when services are selected/deselected document.addEventListener('click', function(e) { if (e.target.closest('.service-card')) { setTimeout(updateProgressIndicator, 100); } }); // Update progress when form fields change const formInputs = document.querySelectorAll('#fullName, #email, #phone, #postcode, #acceptTerms'); formInputs.forEach(input => { input.addEventListener('input', updateProgressIndicator); input.addEventListener('change', updateProgressIndicator); }); // Update progress when date/time is selected document.addEventListener('click', function(e) { if (e.target.closest('.calendar-day') || e.target.closest('.time-slot')) { setTimeout(updateProgressIndicator, 100); } }); } function showBookingPopup(missingItems) { // Store missing items for later use window.lastMissingItems = missingItems; // Create popup overlay const overlay = document.createElement('div'); overlay.id = 'booking-popup-overlay'; overlay.style.cssText = ` position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 1000; display: flex; align-items: center; justify-content: center; padding: 1rem; `; // Create popup content const popup = document.createElement('div'); popup.style.cssText = ` background: #1A1A1A; border-radius: 12px; padding: 2rem; max-width: 400px; width: 100%; border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); text-align: center; `; popup.innerHTML = ` <div><i></i></div><h3> Complete Your Booking Details </h3><p> Please complete the following before booking: </p><div> ${missingItems.map(item => ` <div><i></i> ${item} </div> `).join('')} </div><button onclick="closeBookingPopup()"><i></i> Got It </button> `; overlay.appendChild(popup); document.body.appendChild(overlay); // Close popup when clicking overlay overlay.addEventListener('click', function(e) { if (e.target === overlay) { closeBookingPopup(); } }); } function closeBookingPopup() { const overlay = document.getElementById('booking-popup-overlay'); if (overlay) { overlay.remove(); } // Scroll to the first missing field in logical order setTimeout(() => { scrollToFirstMissingField(); }, 300); } function scrollToFirstMissingField() { if (!window.lastMissingItems || window.lastMissingItems.length === 0) { return; } const missingItems = window.lastMissingItems; // Check for missing items in logical order for (let item of missingItems) { if (item === 'Select a Service') { // Scroll to services section - try multiple selectors let servicesSection = document.querySelector('.services-section') || document.querySelector('#services-section') || document.querySelector('[class*="service"]'); // If not found by class, look for heading containing "Services" if (!servicesSection) { const headings = document.querySelectorAll('h2, h3'); for (let heading of headings) { if (heading.textContent.toLowerCase().includes('service')) { servicesSection = heading; break; } } } if (servicesSection) { servicesSection.scrollIntoView({ behavior: 'smooth', block: 'start' }); return; } } else if (item === 'Accept Terms & Conditions') { // Scroll to terms checkbox const termsCheckbox = document.getElementById('acceptTerms'); if (termsCheckbox) { termsCheckbox.scrollIntoView({ behavior: 'smooth', block: 'center' }); termsCheckbox.focus(); return; } } else if (item === 'Select Payment Method') { // Scroll to payment section - try multiple selectors let paymentSection = document.querySelector('.payment-options') || document.querySelector('[id*="payment"]') || document.querySelector('[class*="payment"]'); // If not found, look for heading containing "Payment" if (!paymentSection) { const headings = document.querySelectorAll('h3, h4'); for (let heading of headings) { if (heading.textContent.toLowerCase().includes('payment')) { paymentSection = heading; break; } } } if (paymentSection) { paymentSection.scrollIntoView({ behavior: 'smooth', block: 'center' }); return; } } else if (item === 'Enter Your Name') { // Scroll to name field const nameField = document.getElementById('fullName'); if (nameField) { nameField.scrollIntoView({ behavior: 'smooth', block: 'center' }); nameField.focus(); return; } } else if (item === 'Enter Valid Email') { // Scroll to email field const emailField = document.getElementById('email'); if (emailField) { emailField.scrollIntoView({ behavior: 'smooth', block: 'center' }); emailField.focus(); return; } } else if (item === 'Enter Phone Number') { // Scroll to phone field const phoneField = document.getElementById('phone'); if (phoneField) { phoneField.scrollIntoView({ behavior: 'smooth', block: 'center' }); phoneField.focus(); return; } } } // No fallback scroll - let user stay where they are } function updateBookingServicesList() { const bookingServicesList = document.getElementById('booking-services-list'); bookingServicesList.innerHTML = ''; selectedServices.forEach(service => { const serviceItem = document.createElement('div'); serviceItem.className = 'selected-service-item'; serviceItem.innerHTML = ` <div><div>${service.name}</div><div>¬£${service.price}</div></div><button onclick="event.stopPropagation(); removeService('${service.name}')"><i></i></button> `; bookingServicesList.appendChild(serviceItem); }); } function initializeCalendar() { const today = new Date(); const currentMonth = today.getMonth(); const currentYear = today.getFullYear(); document.getElementById('currentMonth').textContent = new Date(currentYear, currentMonth).toLocaleDateString('en-US', { month: 'long', year: 'numeric' }); generateCalendarDays(currentYear, currentMonth); } function generateCalendarDays(year, month) { const calendarDays = document.getElementById('calendarDays'); const firstDay = new Date(year, month, 1).getDay(); const daysInMonth = new Date(year, month + 1, 0).getDate(); // Business closed days (example: Sundays and Mondays) const businessClosedDays = [0, 1]; // Sunday = 0, Monday = 1 // Clear existing days calendarDays.innerHTML = ''; // Add day headers const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']; dayHeaders.forEach(day => { const dayHeader = document.createElement('div'); dayHeader.textContent = day; dayHeader.style.fontWeight = '600'; dayHeader.style.color = '#cccccc'; dayHeader.style.textAlign = 'center'; dayHeader.style.padding = '0.5rem'; calendarDays.appendChild(dayHeader); }); // Add empty cells for days before month starts for (let i = 0; i < firstDay; i++) { const emptyDay = document.createElement('div'); calendarDays.appendChild(emptyDay); } // Add days of the month for (let day = 1; day <= daysInMonth; day++) { const dayElement = document.createElement('div'); const currentDate = new Date(year, month, day); const dayOfWeek = currentDate.getDay(); // Check if business is closed on this day const isClosed = businessClosedDays.includes(dayOfWeek); if (isClosed) { dayElement.className = 'calendar-day closed'; dayElement.innerHTML = ` <div>${day}</div><div>Closed</div> `; dayElement.style.cursor = 'not-allowed'; dayElement.style.opacity = '0.4'; } else { dayElement.className = 'calendar-day available'; dayElement.textContent = day; dayElement.onclick = () => selectDateFromElement(dayElement); } calendarDays.appendChild(dayElement); } } function changeMonth(direction) { console.log('Change month:', direction); // Get current month display const currentMonthEl = document.getElementById('currentMonth'); if (!currentMonthEl) return; // Parse current month from display const currentText = currentMonthEl.textContent; const currentDate = new Date(currentText + ' 1, 2024'); // Calculate new month const newDate = new Date(currentDate); newDate.setMonth(currentDate.getMonth() + direction); // Update display const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']; currentMonthEl.textContent = `${monthNames[newDate.getMonth()]} ${newDate.getFullYear()}`; // Regenerate calendar generateCalendarDays(newDate.getFullYear(), newDate.getMonth()); } function selectDate(day, month, year) { console.log('selectDate called with:', day, month, year); // Create date string for sessionStorage const dateString = `${year}-${(month + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`; // Update global selectedDate selectedDate = dateString; // Remove previous selection document.querySelectorAll('.calendar-day').forEach(d => d.classList.remove('selected')); // Add selection to clicked date const dayElements = document.querySelectorAll('.calendar-day'); dayElements.forEach(dayEl => { if (dayEl.textContent == day) { dayEl.classList.add('selected'); } }); // Save to sessionStorage sessionStorage.setItem('booking_date', dateString); // Load time slots for selected date loadTimeSlots(dateString); // Update UI updateBookingSummary(); updateStickyCTA(); updateBookingButton(); console.log('Date selected:', dateString); } // Override the old selectDate function with new booking system function selectDateFromElement(dateEl) { if (dateEl.classList.contains('closed')) return; // Get date from element const day = parseInt(dateEl.textContent); const currentMonthEl = document.getElementById('currentMonth'); const currentText = currentMonthEl.textContent; const currentDate = new Date(currentText + ' 1, 2024'); const month = currentDate.getMonth(); const year = currentDate.getFullYear(); // Call the main selectDate function selectDate(day, month, year); } function generateTimeSlots() { const timeSlots = document.getElementById('timeSlots'); const slots = [ { time: '9:00 AM', available: true }, { time: '10:30 AM', available: true }, { time: '12:00 PM', available: true }, { time: '1:30 PM', available: false }, { time: '3:00 PM', available: true }, { time: '4:30 PM', available: true }, { time: '6:00 PM', available: false } ]; timeSlots.innerHTML = ''; slots.forEach(slot => { const slotElement = document.createElement('div'); slotElement.className = `time-slot ${slot.available ? 'available' : 'unavailable'}`; slotElement.textContent = slot.time; slotElement.dataset.time = slot.time; if (slot.available) { slotElement.onclick = () => selectTimeFromElement(slotElement); } timeSlots.appendChild(slotElement); }); } // New function to handle time selection from element function selectTimeFromElement(timeEl) { if (timeEl.classList.contains('booked') || timeEl.classList.contains('unavailable')) return; const time = timeEl.dataset.time || timeEl.textContent; selectTime(time); } function selectTime(time) { console.log('selectTime called with:', time); // Update global selectedTime selectedTime = time; // Remove previous selection document.querySelectorAll('.time-slot').forEach(t => t.classList.remove('selected')); // Add selection to clicked time const timeElements = document.querySelectorAll('.time-slot'); timeElements.forEach(timeEl => { if (timeEl.dataset.time === time || timeEl.textContent === time) { timeEl.classList.add('selected'); } }); // Save to sessionStorage sessionStorage.setItem('booking_time', time); // Update UI updateBookingSummary(); updateStickyCTA(); updateBookingButton(); console.log('Time selected:', time); } function selectPayment(type) { // Step-by-step validation - guide customer one error at a time // Clear any existing errors first clearAllErrors(); // Step 1: Check if services are selected if (selectedServices.length === 0) { showServicesError(); return; } // Step 2: Check if date is selected if (!selectedDate) { showDateError(); return; } // Step 3: Check if time is selected if (!selectedTime) { showTimeError(); return; } // Step 4: Check required customer details one by one const fullName = document.getElementById('fullName').value.trim(); if (!fullName) { showFieldError('fullName', 'This field is required.'); return; } const email = document.getElementById('email').value.trim(); if (!email) { showFieldError('email', 'This field is required.'); return; } const phone = document.getElementById('phone').value.trim(); if (!phone) { showFieldError('phone', 'This field is required.'); return; } const postcode = document.getElementById('postcode').value.trim(); if (!postcode) { showFieldError('postcode', 'This field is required.'); return; } // Step 5: Check terms acceptance if (!document.getElementById('acceptTerms').checked) { showTermsError(); return; } // All validations passed - proceed with payment selection selectedPayment = type; // Update UI document.querySelectorAll('.payment-option').forEach(option => option.classList.remove('selected')); event.target.closest('.payment-option').classList.add('selected'); // Show/hide payment disclaimers const venueDisclaimer = document.getElementById('venuePaymentDisclaimer'); const payNowDisclaimer = document.getElementById('payNowPaymentDisclaimer'); if (type === 'payAtVenue') { venueDisclaimer.style.display = 'flex'; payNowDisclaimer.style.display = 'none'; } else if (type === 'payNow') { venueDisclaimer.style.display = 'none'; payNowDisclaimer.style.display = 'flex'; } else { venueDisclaimer.style.display = 'none'; payNowDisclaimer.style.display = 'none'; } // Update complete booking button updateBookingSummary(); // Update payment model display updatePaymentModelDisplay(); // Complete the booking after successful validation completeBooking(); } function updateBookingSummary() { // Update services list const summaryServicesList = document.getElementById('summaryServicesList'); summaryServicesList.innerHTML = ''; if (selectedServices.length > 0) { selectedServices.forEach(service => { const serviceItem = document.createElement('div'); serviceItem.className = 'summary-service-item'; serviceItem.innerHTML = ` <div>${service.name}</div><div>¬£${service.price}</div><button onclick="event.stopPropagation(); removeService('${service.name}')"><i></i></button> `; summaryServicesList.appendChild(serviceItem); }); const totalDuration = selectedServices.reduce((sum, s) => sum + s.duration, 0); document.getElementById('summaryDuration').textContent = `${totalDuration} min`; const totalPrice = selectedServices.reduce((sum, s) => sum + s.price, 0); document.getElementById('summaryTotal').textContent = `¬£${totalPrice}`; // Update complete booking button } else { // Clear price and duration when no services document.getElementById('summaryDuration').textContent = '0 min'; document.getElementById('summaryTotal').textContent = '¬£0'; console.log('Price and duration cleared - no services selected'); } // Update date if (selectedDate) { document.getElementById('summaryDate').textContent = selectedDate.toLocaleDateString(); } // Update time if (selectedTime) { document.getElementById('summaryTime').textContent = selectedTime; } // Enable button if all required fields are filled const fullName = document.getElementById('fullName').value.trim(); const email = document.getElementById('email').value.trim(); const phone = document.getElementById('phone').value.trim(); const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; const isComplete = selectedServices.length > 0 && selectedDate && selectedTime && selectedPayment && document.getElementById('acceptTerms').checked && fullName && email && phone && emailRegex.test(email); // Payment buttons are now in the sidebar } // ======================================== // PROMO CODE FUNCTIONS // ======================================== let appliedPromoCode = null; let promoDiscount = 0; /** * Toggle promo code input visibility */ function togglePromoCode() { const promoInput = document.getElementById('promoCodeInput'); const toggleButton = document.querySelector('.promo-code-toggle'); const toggleIcon = document.getElementById('promoCodeToggleIcon'); const toggleText = document.getElementById('promoCodeToggleText'); if (promoInput.style.display === 'none') { promoInput.style.display = 'block'; toggleButton.classList.add('expanded'); toggleIcon.style.transform = 'rotate(180deg)'; toggleText.textContent = 'Hide'; } else { promoInput.style.display = 'none'; toggleButton.classList.remove('expanded'); toggleIcon.style.transform = 'rotate(0deg)'; toggleText.textContent = 'Enter Code'; } } /** * Apply promo code validation and processing */ function applyPromoCode() { const promoCode = document.getElementById('promoCode').value.trim().toUpperCase(); const feedback = document.getElementById('promoCodeFeedback'); const applyButton = document.querySelector('.btn-apply-promo'); if (!promoCode) { showPromoFeedback('Please enter a promo code.', 'error'); return; } // Disable button during validation applyButton.disabled = true; applyButton.innerHTML = '<i></i> Validating...'; // Simulate API call delay setTimeout(() => { validateAndApplyPromoCode(promoCode); }, 1000); } /** * Validate promo code and apply discount */ function validateAndApplyPromoCode(promoCode) { const feedback = document.getElementById('promoCodeFeedback'); const applyButton = document.querySelector('.btn-apply-promo'); try { // Get reward vouchers from localStorage const rewardVouchers = JSON.parse(localStorage.getItem('rewardVouchers') || '[]'); const loyaltyProgress = JSON.parse(localStorage.getItem('loyaltyProgress') || '[]'); // Find the voucher by code const voucher = rewardVouchers.find(v => v.id.toUpperCase().includes(promoCode) || v.id === promoCode); if (!voucher) { showPromoFeedback('Invalid code. Please check and try again.', 'error'); resetApplyButton(); return; } // Check if voucher is expired const now = new Date(); const expiryDate = new Date(voucher.expires_at); if (now > expiryDate) { showPromoFeedback('Code expired. Please contact the business for assistance.', 'error'); resetApplyButton(); return; } // Check if voucher is already redeemed if (voucher.used) { showPromoFeedback('Code already used. Each reward can only be used once.', 'error'); resetApplyButton(); return; } // Check if voucher is for the correct business const currentBusinessId = 'royal-hair-studio'; // This should be dynamic if (voucher.business_id !== currentBusinessId) { showPromoFeedback('Code not valid for this business. Please use at the correct venue.', 'error'); resetApplyButton(); return; } // Apply the promo code applyPromoDiscount(voucher); } catch (error) { console.error('Promo code validation error:', error); showPromoFeedback('Unable to validate code. Please try again.', 'error'); resetApplyButton(); } } /** * Apply promo discount and update UI */ function applyPromoDiscount(voucher) { appliedPromoCode = voucher; // Calculate discount based on reward type let discountAmount = 0; let discountDescription = ''; if (voucher.reward_type === 'Free Service') { discountAmount = selectedServices.reduce((sum, service) => sum + service.price, 0); discountDescription = 'Free service applied'; } else if (voucher.reward_type === 'Discount') { const totalAmount = selectedServices.reduce((sum, service) => sum + service.price, 0); discountAmount = (totalAmount * parseFloat(voucher.reward_value)) / 100; discountDescription = `${voucher.reward_value}% discount applied`; } else if (voucher.reward_type === 'Credit') { discountAmount = parseFloat(voucher.reward_value); discountDescription = `¬£${voucher.reward_value} credit applied`; } promoDiscount = discountAmount; // Update UI showAppliedPromo(voucher, discountDescription, discountAmount); updateBookingSummary(); // Mark voucher as redeemed markVoucherAsRedeemed(voucher); // Notify customer and business notifyPromoCodeRedeemed(voucher); } /** * Show applied promo success message */ function showAppliedPromo(voucher, description, discountAmount) { const promoInput = document.getElementById('promoCodeInput'); const appliedPromo = document.getElementById('appliedPromo'); const promoDetails = document.getElementById('promoDetails'); // Hide input, show success promoInput.style.display = 'none'; appliedPromo.style.display = 'block'; // Update details promoDetails.innerHTML = ` <div><strong>Reward:</strong> ${description}</div><div><strong>Discount:</strong> ¬£${discountAmount.toFixed(2)}</div><div><strong>Code:</strong> ${voucher.id.substring(0, 8).toUpperCase()}</div> `; } /** * Mark voucher as redeemed in localStorage */ function markVoucherAsRedeemed(voucher) { try { // Update voucher const rewardVouchers = JSON.parse(localStorage.getItem('rewardVouchers') || '[]'); const voucherIndex = rewardVouchers.findIndex(v => v.id === voucher.id); if (voucherIndex !== -1) { rewardVouchers[voucherIndex].used = true; rewardVouchers[voucherIndex].used_at = new Date().toISOString(); localStorage.setItem('rewardVouchers', JSON.stringify(rewardVouchers)); } // Update loyalty progress const loyaltyProgress = JSON.parse(localStorage.getItem('loyaltyProgress') || '[]'); const progressIndex = loyaltyProgress.findIndex(p => p.reward_voucher_id === voucher.id); if (progressIndex !== -1) { loyaltyProgress[progressIndex].reward_redeemed = true; loyaltyProgress[progressIndex].updated_at = new Date().toISOString(); localStorage.setItem('loyaltyProgress', JSON.stringify(loyaltyProgress)); } } catch (error) { console.error('Failed to mark voucher as redeemed:', error); } } /** * Notify customer and business about promo code redemption */ function notifyPromoCodeRedeemed(voucher) { // Simulate notifications console.log('Promo code redeemed:', { voucher: voucher.id, customer: 'Customer', business: 'Royal Hair Studio', timestamp: new Date().toISOString() }); // In a real implementation, this would send notifications // to both customer and business about the reward redemption } /** * Remove applied promo code */ function removePromoCode() { appliedPromoCode = null; promoDiscount = 0; // Hide applied promo, show input document.getElementById('appliedPromo').style.display = 'none'; document.getElementById('promoCodeInput').style.display = 'block'; // Clear input document.getElementById('promoCode').value = ''; clearPromoFeedback(); // Update booking summary updateBookingSummary(); } /** * Show promo code feedback */ function showPromoFeedback(message, type) { const feedback = document.getElementById('promoCodeFeedback'); feedback.textContent = message; feedback.className = `promo-code-feedback ${type}`; } /** * Clear promo code feedback */ function clearPromoFeedback() { const feedback = document.getElementById('promoCodeFeedback'); feedback.textContent = ''; feedback.className = 'promo-code-feedback'; } /** * Reset apply button */ function resetApplyButton() { const applyButton = document.querySelector('.btn-apply-promo'); applyButton.disabled = false; applyButton.innerHTML = '<i></i> Apply'; } /** * Update booking summary with promo discount */ function updateBookingSummary() { // This would update the booking summary sidebar // to show the applied discount and new total console.log('Booking summary updated with promo discount:', promoDiscount); } /** * Show promo code section when services are selected */ function showPromoCodeSection() { const promoSection = document.getElementById('promoCodeSection'); if (selectedServices.length > 0) { promoSection.style.display = 'block'; } else { promoSection.style.display = 'none'; } } // ======================================== // DAILY CRON JOB DEMO SYSTEM // ======================================== /** * Demo function to simulate daily cron job execution * In production, this would run automatically every 24 hours */ function runDailyCronDemo() { console.log('=== DAILY CRON JOB DEMO ==='); console.log('Simulating daily cron job execution...'); try { // Simulate the daily cron job processExpiredVouchersDemo(); console.log('Daily cron job demo completed successfully'); alert('Daily cron job demo completed! Check console for details.'); } catch (error) { console.error('Daily cron job demo failed:', error); alert('Daily cron job demo failed. Check console for details.'); } } /** * Demo function to process expired vouchers * This simulates the daily cron job functionality */ function processExpiredVouchersDemo() { console.log('Processing expired reward vouchers...'); // Get all reward vouchers const rewardVouchers = JSON.parse(localStorage.getItem('rewardVouchers') || '[]'); const now = new Date(); // Find expired vouchers (expiry_date < now AND redeemed=false) const expiredVouchers = rewardVouchers.filter(voucher => { const expiryDate = new Date(voucher.expires_at); return expiryDate < now && !voucher.used && !voucher.expired; }); console.log(`Found ${expiredVouchers.length} expired vouchers to process`); if (expiredVouchers.length === 0) { console.log('No expired vouchers found'); return; } // Process each expired voucher expiredVouchers.forEach(voucher => { processExpiredVoucherDemo(voucher); }); console.log(`Successfully processed ${expiredVouchers.length} expired vouchers`); } /** * Process a single expired voucher */ function processExpiredVoucherDemo(voucher) { console.log(`Processing expired voucher: ${voucher.id}`); try { // 1. Mark voucher as expired markVoucherAsExpiredDemo(voucher.id); // 2. Send expiration notification (simulated) sendVoucherExpirationNotificationDemo(voucher); // 3. Update loyalty progress updateLoyaltyProgressForExpiredVoucherDemo(voucher); console.log(`Successfully processed expired voucher: ${voucher.id}`); } catch (error) { console.error(`Failed to process expired voucher ${voucher.id}:`, error); } } /** * Mark voucher as expired */ function markVoucherAsExpiredDemo(voucherId) { const rewardVouchers = JSON.parse(localStorage.getItem('rewardVouchers') || '[]'); const voucherIndex = rewardVouchers.findIndex(v => v.id === voucherId); if (voucherIndex !== -1) { rewardVouchers[voucherIndex].expired = true; rewardVouchers[voucherIndex].expired_at = new Date().toISOString(); rewardVouchers[voucherIndex].updated_at = new Date().toISOString(); localStorage.setItem('rewardVouchers', JSON.stringify(rewardVouchers)); console.log(`Marked voucher ${voucherId} as expired`); } } /** * Send voucher expiration notification (simulated) */ function sendVoucherExpirationNotificationDemo(voucher) { console.log(`Sending expiration notification for voucher ${voucher.id}`); // In a real implementation, this would send an email // For demo purposes, we'll just log the notification const notificationData = { customerId: voucher.customer_id, voucherCode: voucher.id.substring(0, 8).toUpperCase(), rewardType: voucher.reward_type, rewardValue: voucher.reward_value, expiryDate: voucher.expires_at, businessId: voucher.business_id, timestamp: new Date().toISOString() }; console.log('Expiration notification data:', notificationData); // Simulate email sending console.log(`Email sent to customer ${voucher.customer_id}: Your reward has expired`); } /** * Update loyalty progress for expired voucher */ function updateLoyaltyProgressForExpiredVoucherDemo(voucher) { const loyaltyProgress = JSON.parse(localStorage.getItem('loyaltyProgress') || '[]'); const progressIndex = loyaltyProgress.findIndex(p => p.reward_voucher_id === voucher.id); if (progressIndex !== -1) { // Reset reward status since voucher expired loyaltyProgress[progressIndex].reward_unlocked = false; loyaltyProgress[progressIndex].reward_redeemed = false; loyaltyProgress[progressIndex].reward_voucher_id = null; loyaltyProgress[progressIndex].updated_at = new Date().toISOString(); localStorage.setItem('loyaltyProgress', JSON.stringify(loyaltyProgress)); console.log(`Updated loyalty progress for expired voucher ${voucher.id}`); } } /** * Create demo expired vouchers for testing */ function createDemoExpiredVouchers() { console.log('Creating demo expired vouchers...'); const demoVouchers = [ { id: 'voucher_expired_001', customer_id: 'customer_1', business_id: 'business_001', reward_type: 'Free Service', reward_value: '1', expires_at: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(), // 1 day ago used: false, expired: false, created_at: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(), // 7 days ago updated_at: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString() }, { id: 'voucher_expired_002', customer_id: 'customer_2', business_id: 'business_002', reward_type: 'Discount', reward_value: '20', expires_at: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(), // 2 days ago used: false, expired: false, created_at: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString(), // 10 days ago updated_at: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString() } ]; // Add to existing vouchers const existingVouchers = JSON.parse(localStorage.getItem('rewardVouchers') || '[]'); const updatedVouchers = [...existingVouchers, ...demoVouchers]; localStorage.setItem('rewardVouchers', JSON.stringify(updatedVouchers)); console.log('Demo expired vouchers created:', demoVouchers); alert('Demo expired vouchers created! Run the daily cron job demo to process them.'); } // ======================================== // LOYALTY NOTIFICATION DEMO SYSTEM // ======================================== /** * Demo function to test loyalty notifications */ function testLoyaltyNotifications() { console.log('=== LOYALTY NOTIFICATION DEMO ==='); console.log('Testing loyalty notification system...'); try { // Test reward unlocked notification testRewardUnlockedNotification(); // Test reward expiring notification testRewardExpiringNotification(); // Test reward redeemed notification testRewardRedeemedNotification(); // Test reward progress notification testRewardProgressNotification(); console.log('Loyalty notification demo completed successfully'); alert('Loyalty notification demo completed! Check console for details.'); } catch (error) { console.error('Loyalty notification demo failed:', error); alert('Loyalty notification demo failed. Check console for details.'); } } /** * Test reward unlocked notification */ function testRewardUnlockedNotification() { console.log('Testing reward unlocked notification...'); const customerData = { id: 'customer_1', name: 'Jane Smith', email: 'jane.smith@email.com', phoneNumber: '+44 7700 900123' }; const businessData = { id: 'business_001', name: 'Glow Hair', package: 'Premium', phone: '+44 20 7123 4567', address: '123 High Street, London, SW1A 1AA' }; const voucherData = { id: 'voucher_unlocked_001', reward_type: 'Free Service', reward_value: '1', expires_at: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString() // 30 days from now }; // Simulate email notification console.log('Email: You\'ve unlocked your reward with Glow Hair! Code: BP-UNLOCK. Expires Friday, 15 March 2024.'); // Simulate SMS notification (Premium business) console.log('SMS: BlkPages: Reward unlocked ‚Äì use code BP-UNLOCK before Friday, 15 March 2024.'); console.log('Reward unlocked notification sent successfully'); } /** * Test reward expiring notification */ function testRewardExpiringNotification() { console.log('Testing reward expiring notification...'); const customerData = { id: 'customer_1', name: 'Jane Smith', email: 'jane.smith@email.com' }; const businessData = { id: 'business_001', name: 'Glow Hair', phone: '+44 20 7123 4567', address: '123 High Street, London, SW1A 1AA' }; const voucherData = { id: 'voucher_expiring_001', reward_type: 'Discount', reward_value: '20', expires_at: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString() // 3 days from now }; // Simulate email notification console.log('Email: Your reward with Glow Hair expires soon! Use code BP-EXPIRE before Friday, 15 March 2024.'); console.log('Reward expiring notification sent successfully'); } /** * Test reward redeemed notification */ function testRewardRedeemedNotification() { console.log('Testing reward redeemed notification...'); const customerData = { id: 'customer_1', name: 'Jane Smith', email: 'jane.smith@email.com' }; const businessData = { id: 'business_001', name: 'Glow Hair', phone: '+44 20 7123 4567', address: '123 High Street, London, SW1A 1AA' }; const voucherData = { id: 'voucher_redeemed_001', reward_type: 'Free Service', reward_value: '1' }; // Simulate email notification console.log('Email: Reward redeemed successfully on Friday, 15 March 2024.'); console.log('Reward redeemed notification sent successfully'); } /** * Test reward progress notification */ function testRewardProgressNotification() { console.log('Testing reward progress notification...'); const customerData = { id: 'customer_1', name: 'Jane Smith', email: 'jane.smith@email.com' }; const businessData = { id: 'business_001', name: 'Glow Hair', phone: '+44 20 7123 4567', address: '123 High Street, London, SW1A 1AA' }; const progressData = { current: 4, required: 5, remaining: '1 booking', type: 'visits', rewardType: 'Free Service', rewardValue: '1' }; // Simulate email notification console.log('Email: You\'re 1 booking away from your reward with Glow Hair!'); console.log('Reward progress notification sent successfully'); } // ======================================== // SECURITY & PRIVACY DEMO SYSTEM // ======================================== /** * Demo function to test security and privacy features */ function testSecurityPrivacyFeatures() { console.log('=== SECURITY & PRIVACY DEMO ==='); console.log('Testing security and privacy features...'); try { // Test secure voucher generation testSecureVoucherGeneration(); // Test data access controls testDataAccessControls(); // Test privacy compliance testPrivacyCompliance(); // Test opt-out functionality testOptOutFunctionality(); console.log('Security & privacy demo completed successfully'); alert('Security & privacy demo completed! Check console for details.'); } catch (error) { console.error('Security & privacy demo failed:', error); alert('Security & privacy demo failed. Check console for details.'); } } /** * Test secure voucher generation */ function testSecureVoucherGeneration() { console.log('Testing secure voucher generation...'); // Simulate server-side generation const secureVoucher = { id: 'voucher_secure_001', code: 'BP-A1B2C3D4', // Non-guessable, server-generated customer_id: 'customer_1', business_id: 'business_001', reward_type: 'Free Service', reward_value: '1', expires_at: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(), used: false, expired: false, created_at: new Date().toISOString(), updated_at: new Date().toISOString(), // Security fields generated_by: 'system', ip_address: '192.168.1.1', user_agent: 'Mozilla/5.0...', // Privacy fields data_processing_basis: 'contract', // UK GDPR Art 6(1)(b) consent_given: true, opt_out_available: true }; console.log('Secure voucher generated:', secureVoucher); console.log('‚úì Server-side generation only'); console.log('‚úì Non-guessable code'); console.log('‚úì Unique index enforced'); console.log('‚úì Security fields included'); console.log('‚úì GDPR compliance fields'); } /** * Test data access controls */ function testDataAccessControls() { console.log('Testing data access controls...'); // Simulate customer view (limited data) const customerView = { id: 'voucher_secure_001', code: 'BP-A1B2C3D4', reward_type: 'Free Service', reward_value: '1', expires_at: '2024-04-15T00:00:00.000Z', used: false, expired: false, created_at: '2024-03-15T00:00:00.000Z', business_name: 'Glow Hair' // No sensitive business data // No other customer data }; // Simulate business view (limited data) const businessView = { id: 'voucher_secure_001', code: 'BP-A1B2C3D4', reward_type: 'Free Service', reward_value: '1', expires_at: '2024-04-15T00:00:00.000Z', used: false, expired: false, created_at: '2024-03-15T00:00:00.000Z', customer_name: 'Jane Smith' // No sensitive customer data // No other business data }; console.log('Customer view (sanitized):', customerView); console.log('Business view (sanitized):', businessView); console.log('‚úì No PII exposed between users'); console.log('‚úì Customers see only relevant records'); console.log('‚úì Businesses see only relevant records'); } /** * Test privacy compliance */ function testPrivacyCompliance() { console.log('Testing privacy compliance...'); const privacyCompliance = { data_controller: 'BlkPages Ltd', legal_basis: 'Contract (UK GDPR Art 6(1)(b))', data_processing_basis: 'Performance of contract', customer_rights: [ 'Right to access', 'Right to rectification', 'Right to erasure', 'Right to restrict processing', 'Right to data portability', 'Right to object' ], data_retention: 'Until loyalty program completion or opt-out', contact: 'privacy@blkpages.com' }; console.log('Privacy compliance:', privacyCompliance); console.log('‚úì UK GDPR Art 6(1)(b) compliance'); console.log('‚úì Customer rights documented'); console.log('‚úì Data retention policy'); console.log('‚úì Contact information provided'); } /** * Test opt-out functionality */ function testOptOutFunctionality() { console.log('Testing opt-out functionality...'); // Simulate opt-out request const optOutRequest = { customer_id: 'customer_1', timestamp: new Date().toISOString(), reason: 'customer_request', actions: [ 'Reset loyalty progress', 'Cancel unredeemed vouchers', 'Remove tracking data', 'Stop loyalty notifications' ], data_retention: 'progress_reset' }; console.log('Opt-out request:', optOutRequest); console.log('‚úì Customer can opt-out anytime'); console.log('‚úì Progress reset on opt-out'); console.log('‚úì Tracking data removed'); console.log('‚úì All activity logged with timestamps'); } /** * Phone Verification Functions */ function showPhoneVerificationPlaceholder() { // TODO: connect SMS verification function when notification system is added console.log('TODO: Implement phone verification when SMS system is ready'); // Show placeholder message alert('Phone verification will be implemented when the SMS notification system is added. For now, your phone number will be stored securely.'); // Hide the warning after user acknowledges const warning = document.getElementById('phoneVerificationWarning'); if (warning) { warning.style.display = 'none'; } } function checkPhoneVerificationStatus() { // TODO: connect SMS verification function when notification system is added const phoneInput = document.getElementById('phone'); if (phoneInput && phoneInput.value) { // Show verification warning for now const warning = document.getElementById('phoneVerificationWarning'); if (warning) { warning.style.display = 'block'; } } } function validatePhoneNumber(phoneNumber) { if (!phoneNumber) return { valid: false, error: 'Phone number is required' }; // Use the phone verification system if (window.customerPhoneVerificationSystem) { return window.customerPhoneVerificationSystem.validatePhoneNumber(phoneNumber); } // Fallback validation const phoneRegex = /^(\+44|0)7[0-9]{9}$/; const cleanPhone = phoneNumber.replace(/[\s\-\(\)]/g, ''); if (!phoneRegex.test(cleanPhone)) { return { valid: false, error: 'Please enter a valid UK mobile number' }; } return { valid: true, formatted: cleanPhone }; } function completeBooking() { console.log('=== BOOKING FLOW DEBUG START ==='); console.log('Booking button pressed - starting validation'); console.log('Device Info:', { userAgent: navigator.userAgent, isMobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent), screenSize: window.innerWidth + 'x' + window.innerHeight, touchSupport: 'ontouchstart' in window }); // Security: Generate CSRF token if (typeof securityUtils !== 'undefined') { const csrfToken = securityUtils.generateCSRFToken(); console.log('CSRF token generated for booking security'); } // Security: Check rate limiting if (typeof securityUtils !== 'undefined') { const clientIP = securityUtils.getClientIP(); if (!securityUtils.checkRateLimit(clientIP, 'booking')) { alert('Too many booking attempts. Please wait before trying again.'); return; } } // Check if terms are accepted const termsAccepted = document.getElementById('acceptTerms').checked; console.log('Terms accepted:', termsAccepted); if (!termsAccepted) { console.log('Terms not accepted'); alert('Please accept the Terms & Conditions to continue.'); return; } // Enhanced validation for required form fields const fullName = document.getElementById('fullName').value.trim(); const email = document.getElementById('email').value.trim(); const phone = document.getElementById('phone').value.trim(); const postcode = document.getElementById('postcode').value.trim(); console.log('Form validation - Full Name:', fullName); console.log('Form validation - Email:', email); console.log('Form validation - Phone:', phone); console.log('Form validation - Postcode:', postcode); console.log('Form validation - Selected Services:', selectedServices); console.log('Form validation - Selected Date:', selectedDate); console.log('Form validation - Selected Time:', selectedTime); console.log('Form validation - Selected Payment:', selectedPayment); // Clear any existing errors first clearAllFieldErrors(); // For logged-in users, only phone is required (name and email are auto-populated) // For guest users, all fields are required const isLoggedIn = localStorage.getItem('userLoggedIn') === 'true'; let validationErrors = []; if (isLoggedIn) { // Only validate phone for logged-in users if (!phone) { validationErrors.push({ field: 'phone', message: 'Please enter your phone number.' }); } } else { // Validate all fields for guest users if (!fullName) { validationErrors.push({ field: 'fullName', message: 'Please enter your full name.' }); } if (!email) { validationErrors.push({ field: 'email', message: 'Please enter your email address.' }); } else { // Enhanced email validation const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; if (!emailRegex.test(email)) { validationErrors.push({ field: 'email', message: 'Please enter a valid email address.' }); } } if (!phone) { validationErrors.push({ field: 'phone', message: 'Please enter your phone number.' }); } else { // Use phone verification system for validation const phoneValidation = validatePhoneNumber(phone); if (!phoneValidation.valid) { validationErrors.push({ field: 'phone', message: phoneValidation.error }); } } if (!postcode) { validationErrors.push({ field: 'postcode', message: 'Please enter your postcode.' }); } else { // Enhanced UK postcode validation const postcodeRegex = /^[A-Z]{1,2}\d[A-Z\d]?\s?\d[A-Z]{2}$/i; if (!postcodeRegex.test(postcode)) { validationErrors.push({ field: 'postcode', message: 'Please enter a valid UK postcode.' }); } } } // Show validation errors if any if (validationErrors.length > 0) { console.log('Validation failed with errors:', validationErrors); validationErrors.forEach(error => { showInlineError(error.field, error.message); }); return; } // Check if all required fields are filled const isComplete = selectedServices.length > 0 && selectedDate && selectedTime && selectedPayment; if (!isComplete) { alert('Please select a service, date, time, and payment method.'); return; } console.log('Payment method selected:', selectedPayment); if (selectedPayment === 'payNow') { console.log('=== PAY NOW FLOW ==='); console.log('Redirecting to payment processing...'); // Show loading state console.log('Processing payment...'); try { // Use direct navigation instead of window.open to avoid mobile popup blockers console.log('Attempting redirect to payment-processing.html'); // Save customer details for future autofill saveCustomerDetails(); // Small delay to show loading state setTimeout(() => { window.location.href = 'payment-processing.html'; }, 500); } catch (error) { console.error('Payment redirect failed:', error); showErrorMessage('Unable to redirect to payment. Please try again.'); // Reset button completeButton.textContent = originalText; completeButton.disabled = false; } } else if (selectedPayment === 'payAtVenue') { console.log('=== PAY AT VENUE FLOW ==='); console.log('Processing Pay at Venue booking...'); // Show loading state console.log('Processing payment...'); try { // Generate booking ID and secure token for guest cancellation const bookingId = generateBookingId(); const isGuest = !localStorage.getItem('userLoggedIn') === 'true'; console.log('Generated booking ID:', bookingId); console.log('Selected services:', selectedServices); console.log('Selected date:', selectedDate); console.log('Selected time:', selectedTime); // Save booking to both customer and business dashboards saveBookingToDashboards(bookingId, { customerName: fullName, customerEmail: email, customerPhone: phone, customerPostcode: postcode, businessName: 'Royal Hair Studio', businessId: 'royal-hair-studio', services: selectedServices, date: selectedDate, time: selectedTime, paymentMethod: selectedPayment, totalAmount: selectedServices.reduce((sum, s) => sum + s.price, 0), status: 'Confirmed', isGuest: isGuest }); // Redirect to confirmation page with booking details const params = new URLSearchParams({ payment: 'Pay at Venue', bookingId: bookingId, guest: isGuest.toString(), business: 'Royal Hair Studio', date: selectedDate || 'Saturday, Dec 28, 2024', time: selectedTime || '2:00 PM', services: selectedServices.map(s => s.name).join(', '), total: selectedServices.reduce((sum, s) => sum + s.price, 0).toString() }); const confirmationUrl = `booking-confirmation.html?${params.toString()}`; console.log('Redirecting to:', confirmationUrl); // Save customer details for future autofill saveCustomerDetails(); // Track enquiry/booking submission trackEnquiry('booking'); // Small delay to show loading state setTimeout(() => { window.location.href = confirmationUrl; }, 500); } catch (error) { console.error('Confirmation redirect failed:', error); showErrorMessage('Unable to process booking. Please try again.'); // Reset button completeButton.textContent = originalText; completeButton.disabled = false; } } else { console.log('No payment method selected'); alert('Please select a payment method first.'); } } function saveCustomerDetails() { // Save customer details to localStorage for future autofill const fullName = document.getElementById('fullName').value; const email = document.getElementById('email').value; const phone = document.getElementById('phone').value; const postcode = document.getElementById('postcode').value; if (fullName) localStorage.setItem('userName', fullName); if (email) localStorage.setItem('userEmail', email); if (phone) localStorage.setItem('userPhone', phone); if (postcode) localStorage.setItem('userPostcode', postcode); // Mark user as logged in (for demo purposes) localStorage.setItem('userLoggedIn', 'true'); } function processPayment() { // Simulate payment processing const paymentMethods = ['Card', 'PayPal', 'Apple Pay', 'Google Pay']; const randomMethod = paymentMethods[Math.floor(Math.random() * paymentMethods.length)]; // Simulate payment success/failure (90% success rate for demo) const paymentSuccess = Math.random() > 0.1; if (paymentSuccess) { showPaymentSuccessConfirmation(randomMethod); } else { showPaymentError(); } } function showPaymentError() { // Create error message above payment form const paymentSection = document.querySelector('.booking-payment'); let errorDiv = document.getElementById('payment-error'); if (!errorDiv) { errorDiv = document.createElement('div'); errorDiv.id = 'payment-error'; errorDiv.style.cssText = ` background: #ff4444; color: white; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; text-align: center; font-weight: 600; `; paymentSection.insertBefore(errorDiv, paymentSection.firstChild); } errorDiv.innerHTML = ` <i></i> Payment could not be processed. Please try another method. `; // Remove error after 5 seconds setTimeout(() => { if (errorDiv) { errorDiv.remove(); } }, 5000); } function showPayAtVenueConfirmation() { const totalPrice = selectedServices.reduce((sum, s) => sum + s.price, 0); const totalDuration = selectedServices.reduce((sum, s) => sum + s.duration, 0); const serviceNames = selectedServices.map(s => s.name).join(', '); // Hide booking form and show confirmation document.querySelector('.booking-form').style.display = 'none'; document.querySelector('.booking-sidebar').style.display = 'none'; // Create confirmation content const confirmationHTML = ` <div><div><div><i></i></div><h1>Booking Confirmed!</h1><p>Please pay at the venue</p></div><div><div><h3>Booking Details</h3><div><span>Services:</span><span>${serviceNames}</span></div><div><span>Duration:</span><span>${totalDuration} minutes</span></div><div><span>Total:</span><span>¬£${totalPrice}</span></div><div><span>Date:</span><span>${selectedDate.toLocaleDateString()}</span></div><div><span>Time:</span><span>${selectedTime}</span></div></div><div><h3>Business Details</h3><div><div>Royal Hair Studio</div><div>123 Beauty Street, London SW1A 1AA</div><div>+44 20 7123 4567</div></div></div><div><div><i></i></div><div><strong>Payment Instructions:</strong><br> Please pay at the venue. Payment will be taken directly by Royal Hair Studio. </div></div></div><div><button onclick="addToCalendar()"><i></i> Add to Calendar </button><button onclick="goToHome()"><i></i> Back to Home </button></div></div> `; document.querySelector('.booking-form').innerHTML = confirmationHTML; document.querySelector('.booking-form').style.display = 'block'; // Simulate sending confirmation email console.log('Sending confirmation email for Pay at Venue booking...'); } function showPaymentSuccessConfirmation(paymentMethod) { const totalPrice = selectedServices.reduce((sum, s) => sum + s.price, 0); const totalDuration = selectedServices.reduce((sum, s) => sum + s.duration, 0); const serviceNames = selectedServices.map(s => s.name).join(', '); const transactionId = 'TXN-' + Math.random().toString(36).substr(2, 9).toUpperCase(); // Hide booking form and show confirmation document.querySelector('.booking-form').style.display = 'none'; document.querySelector('.booking-sidebar').style.display = 'none'; // Create confirmation content const confirmationHTML = ` <div><div><div><i></i></div><h1>Payment Successful!</h1><p>Receipt sent to your email</p></div><div><div><h3>Booking Details</h3><div><span>Services:</span><span>${serviceNames}</span></div><div><span>Duration:</span><span>${totalDuration} minutes</span></div><div><span>Total Paid:</span><span>¬£${totalPrice}</span></div><div><span>Date:</span><span>${selectedDate.toLocaleDateString()}</span></div><div><span>Time:</span><span>${selectedTime}</span></div></div><div><h3>Payment Details</h3><div><div>Payment Method: ${paymentMethod}</div><div>Transaction ID: ${transactionId}</div><div>Status: Confirmed (Paid Online)</div></div></div><div><h3>Business Details</h3><div><div>Royal Hair Studio</div><div>123 Beauty Street, London SW1A 1AA</div><div>+44 20 7123 4567</div></div></div><div><div><i></i></div><div><strong>Payment successful!</strong><br> Your booking is confirmed and payment has been processed. </div></div></div><div><button onclick="addToCalendar()"><i></i> Add to Calendar </button><button onclick="goToHome()"><i></i> Back to Home </button></div></div> `; document.querySelector('.booking-form').innerHTML = confirmationHTML; document.querySelector('.booking-form').style.display = 'block'; // Simulate sending confirmation email with receipt console.log('Sending confirmation email with payment receipt...'); } function addToCalendar() { // Generate calendar event data const eventData = { title: 'Hair Appointment at Royal Hair Studio', start: '20241215T103000', end: '20241215T110000', location: '123 Beauty Street, London SW1A 1AA', description: 'Hair appointment at Royal Hair Studio' }; // Create Google Calendar URL const googleUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(eventData.title)}&dates=${eventData.start}/${eventData.end}&location=${encodeURIComponent(eventData.location)}&details=${encodeURIComponent(eventData.description)}`; // Open in new tab window.open(googleUrl, '_blank'); } function goToHome() { window.location.href = 'index.html'; } function callBusiness() { alert('Calling Royal Hair Studio...\n\nPhone: +44 20 7123 4567\n\nThis would normally initiate a phone call on mobile devices.'); } function generateBookingId() { const timestamp = Date.now().toString(36); const random = Math.random().toString(36).substr(2, 5); return `BP${timestamp}${random}`.toUpperCase(); } function showErrorMessage(message) { // Create error message element const errorDiv = document.createElement('div'); errorDiv.id = 'booking-error'; errorDiv.style.cssText = ` position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #DC2626; color: white; padding: 1rem 2rem; border-radius: 8px; z-index: 1000; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3); font-weight: 500; max-width: 90%; text-align: center; `; errorDiv.textContent = message; // Remove existing error if any const existingError = document.getElementById('booking-error'); if (existingError) { existingError.remove(); } // Add to page document.body.appendChild(errorDiv); // Auto-remove after 5 seconds setTimeout(() => { if (errorDiv.parentNode) { errorDiv.parentNode.removeChild(errorDiv); } }, 5000); } function showInlineError(fieldId, message) { // Remove existing error for this field const existingError = document.getElementById(`${fieldId}-error`); if (existingError) { existingError.remove(); } // Create inline error message const errorDiv = document.createElement('div'); errorDiv.id = `${fieldId}-error`; errorDiv.style.cssText = ` color: #DC2626; font-size: 0.8rem; margin-top: 0.25rem; font-weight: 500; `; errorDiv.textContent = message; // Find the field and add error after it const field = document.getElementById(fieldId); if (field && field.parentNode) { field.parentNode.insertBefore(errorDiv, field.nextSibling); // Add red border to field field.style.borderColor = '#DC2626'; // Remove error and border when user starts typing field.addEventListener('input', function() { errorDiv.remove(); field.style.borderColor = ''; }); } } function clearAllFieldErrors() { // Remove all existing error messages document.querySelectorAll('[id$="-error"]').forEach(error => error.remove()); // Reset all field borders const fields = ['fullName', 'email', 'phone', 'postcode']; fields.forEach(fieldId => { const field = document.getElementById(fieldId); if (field) { field.style.borderColor = ''; } }); } // Add form input listeners document.addEventListener('DOMContentLoaded', function() { const formInputs = ['fullName', 'email', 'phone', 'postcode']; formInputs.forEach(inputId => { const input = document.getElementById(inputId); if (input) { input.addEventListener('input', function() { // Clear error when user starts typing clearFieldError(inputId); updateBookingSummary(); }); input.addEventListener('blur', updateCompleteBookingButton); } }); // Clear services error when service is selected document.querySelectorAll('.add-service-btn').forEach(btn => { btn.addEventListener('click', function() { clearServicesError(); }); }); // Clear date error when date is selected document.addEventListener('click', function(e) { if (e.target.classList.contains('date-option')) { clearDateError(); } }); // Clear time error when time is selected document.addEventListener('click', function(e) { if (e.target.classList.contains('time-slot')) { clearTimeError(); } }); // Clear terms error when checkbox is checked const termsCheckbox = document.getElementById('acceptTerms'); if (termsCheckbox) { termsCheckbox.addEventListener('change', function() { clearTermsError(); }); } // Add event listeners to payment method selection const paymentMethods = document.querySelectorAll('input[name="paymentMethod"]'); paymentMethods.forEach(method => { method.addEventListener('change', function() { // Payment method changed - update display updatePaymentModelDisplay(); }); }); }); // Load uploaded photos function loadUploadedPhotos() { const savedPhotos = localStorage.getItem('royalHairStudioPhotos'); if (savedPhotos) { uploadedPhotos = JSON.parse(savedPhotos); updateGalleryWithPhotos(); } } function updateGalleryWithPhotos() { const gallerySlides = document.getElementById('gallerySlides'); const galleryDots = document.querySelector('.gallery-dots'); if (uploadedPhotos.length === 0) { // Keep default placeholder slides if no photos uploaded // Re-add default slides if they were removed if (gallerySlides.children.length === 0 || !gallerySlides.children[0].style.backgroundImage) { gallerySlides.innerHTML = ` <div></div><div></div><div></div> `; galleryDots.innerHTML = ` <button onclick="currentSlide(1)"></button><button onclick="currentSlide(2)"></button><button onclick="currentSlide(3)"></button> `; } slides = document.querySelectorAll('.gallery-slide'); dots = document.querySelectorAll('.gallery-dot'); currentSlideIndex = 0; showSlide(0); return; } // Clear existing slides and dots gallerySlides.innerHTML = ''; galleryDots.innerHTML = ''; // Create new slides from uploaded photos uploadedPhotos.forEach((photo, index) => { const slide = document.createElement('div'); slide.className = 'gallery-slide'; slide.style.backgroundImage = `url(${photo.url})`; slide.style.backgroundSize = 'cover'; slide.style.backgroundPosition = 'center'; gallerySlides.appendChild(slide); // Create corresponding dot const dot = document.createElement('button'); dot.className = `gallery-dot ${index === 0 ? 'active' : ''}`; dot.onclick = () => currentSlide(index + 1); galleryDots.appendChild(dot); }); // Update slides and dots references slides = document.querySelectorAll('.gallery-slide'); dots = document.querySelectorAll('.gallery-dot'); currentSlideIndex = 0; // Reset gallery to first slide showSlide(0); } // Initialize gallery showSlide(0); // Load uploaded photos when page loads document.addEventListener('DOMContentLoaded', function() { loadUploadedPhotos(); }); // Profile View Tracking function trackProfileView() { const businessId = 'royalHairStudio'; // Business identifier const currentDate = new Date().toISOString().split('T')[0]; // YYYY-MM-DD format const currentTime = new Date().toISOString(); // Full timestamp // Get existing analytics data let analyticsData = JSON.parse(localStorage.getItem('businessAnalytics') || '{}'); // Initialize business analytics if not exists if (!analyticsData[businessId]) { analyticsData[businessId] = { totalViews: 0, dailyViews: {}, lastView: null, viewHistory: [] }; } // Update view counts analyticsData[businessId].totalViews += 1; analyticsData[businessId].lastView = currentTime; // Update daily views if (!analyticsData[businessId].dailyViews[currentDate]) { analyticsData[businessId].dailyViews[currentDate] = 0; } analyticsData[businessId].dailyViews[currentDate] += 1; // Add to view history (keep last 100 views) analyticsData[businessId].viewHistory.push({ timestamp: currentTime, date: currentDate, userAgent: navigator.userAgent, referrer: document.referrer || 'Direct' }); // Keep only last 100 views to prevent localStorage from getting too large if (analyticsData[businessId].viewHistory.length > 100) { analyticsData[businessId].viewHistory = analyticsData[businessId].viewHistory.slice(-100); } // Save updated analytics localStorage.setItem('businessAnalytics', JSON.stringify(analyticsData)); // Trigger analytics update event window.dispatchEvent(new CustomEvent('analyticsUpdated', { detail: { businessId: businessId, totalViews: analyticsData[businessId].totalViews, dailyViews: analyticsData[businessId].dailyViews[currentDate] || 0 } })); console.log('Profile view tracked:', { businessId: businessId, totalViews: analyticsData[businessId].totalViews, todayViews: analyticsData[businessId].dailyViews[currentDate] }); } // Track view when page loads (only for public views, not business dashboard) document.addEventListener('DOMContentLoaded', function() { // Only track if this is a public view (not from business dashboard) const isBusinessDashboard = window.location.search.includes('dashboard=true') || document.referrer.includes('business-dashboard'); if (!isBusinessDashboard) { // Small delay to ensure page is fully loaded setTimeout(trackProfileView, 1000); } }); // Track contact clicks (call, message, etc.) function trackContactClick(action) { const businessId = 'royalHairStudio'; const currentDate = new Date().toISOString().split('T')[0]; const currentTime = new Date().toISOString(); // Get existing analytics data let analyticsData = JSON.parse(localStorage.getItem('businessAnalytics') || '{}'); // Initialize business analytics if not exists if (!analyticsData[businessId]) { analyticsData[businessId] = { totalViews: 0, dailyViews: {}, lastView: null, viewHistory: [], searchImpressions: 0, dailySearchImpressions: {}, contactClicks: 0, dailyContactClicks: {}, enquiries: 0, dailyEnquiries: {} }; } // Update contact clicks analyticsData[businessId].contactClicks += 1; // Update daily contact clicks if (!analyticsData[businessId].dailyContactClicks[currentDate]) { analyticsData[businessId].dailyContactClicks[currentDate] = 0; } analyticsData[businessId].dailyContactClicks[currentDate] += 1; // Save updated analytics localStorage.setItem('businessAnalytics', JSON.stringify(analyticsData)); // Trigger analytics update event window.dispatchEvent(new CustomEvent('analyticsUpdated', { detail: { businessId: businessId, type: 'contactClick', action: action, totalClicks: analyticsData[businessId].contactClicks, todayClicks: analyticsData[businessId].dailyContactClicks[currentDate] } })); console.log(`Contact click tracked (${action}):`, { businessId: businessId, totalClicks: analyticsData[businessId].contactClicks, todayClicks: analyticsData[businessId].dailyContactClicks[currentDate] }); // Show success message showContactClickSuccess(action); } // Show success message for contact clicks function showContactClickSuccess(action) { const actionText = action === 'call' ? 'Call' : 'Message'; const message = document.createElement('div'); message.style.cssText = ` position: fixed; top: 20px; right: 20px; background: rgba(30, 144, 255, 0.95); color: white; padding: 1rem 1.5rem; border-radius: 8px; font-weight: 600; z-index: 10000; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); animation: slideIn 0.3s ease; `; message.innerHTML = `<i></i> ${actionText} action tracked!`; document.body.appendChild(message); setTimeout(() => { message.remove(); }, 3000); } // Track enquiries (bookings, messages, etc.) function trackEnquiry(type) { const businessId = 'royalHairStudio'; const currentDate = new Date().toISOString().split('T')[0]; const currentTime = new Date().toISOString(); // Get existing analytics data let analyticsData = JSON.parse(localStorage.getItem('businessAnalytics') || '{}'); // Initialize business analytics if not exists if (!analyticsData[businessId]) { analyticsData[businessId] = { totalViews: 0, dailyViews: {}, lastView: null, viewHistory: [], searchImpressions: 0, dailySearchImpressions: {}, contactClicks: 0, dailyContactClicks: {}, enquiries: 0, dailyEnquiries: {} }; } // Update enquiries analyticsData[businessId].enquiries += 1; // Update daily enquiries if (!analyticsData[businessId].dailyEnquiries[currentDate]) { analyticsData[businessId].dailyEnquiries[currentDate] = 0; } analyticsData[businessId].dailyEnquiries[currentDate] += 1; // Save updated analytics localStorage.setItem('businessAnalytics', JSON.stringify(analyticsData)); // Trigger analytics update event window.dispatchEvent(new CustomEvent('analyticsUpdated', { detail: { businessId: businessId, type: 'enquiry', enquiryType: type, totalEnquiries: analyticsData[businessId].enquiries, todayEnquiries: analyticsData[businessId].dailyEnquiries[currentDate] } })); console.log(`Enquiry tracked (${type}):`, { businessId: businessId, totalEnquiries: analyticsData[businessId].enquiries, todayEnquiries: analyticsData[businessId].dailyEnquiries[currentDate] }); } // Listen for storage changes to update gallery when photos are uploaded window.addEventListener('storage', function(e) { if (e.key === 'royalHairStudioPhotos') { loadUploadedPhotos(); } }); // Listen for custom photo update events window.addEventListener('photosUpdated', function(e) { loadUploadedPhotos(); }); // Also refresh when page becomes visible (user returns from upload page) document.addEventListener('visibilitychange', function() { if (!document.hidden) { loadUploadedPhotos(); } }); window.addEventListener('focus', function() { loadUploadedPhotos(); }); // Test function to check validation function testButtonUpdate() { console.log('=== TESTING VALIDATION ==='); console.log('Selected services:', selectedServices.length); console.log('Selected date:', selectedDate); console.log('Selected time:', selectedTime); console.log('Selected payment:', selectedPayment); } // Test function to check addService function testAddService() { console.log('=== TESTING ADD SERVICE ==='); console.log('addService function exists:', typeof addService); if (typeof addService === 'function') { console.log('Calling addService...'); addService('Test Service', 25, 30); } else { console.log('addService function not found!'); } } // Mobile debugging function function debugMobileBooking() { console.log('=== MOBILE BOOKING DEBUG ==='); console.log('User Agent:', navigator.userAgent); console.log('Is Mobile:', /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)); console.log('Screen Size:', window.innerWidth + 'x' + window.innerHeight); console.log('Touch Support:', 'ontouchstart' in window); console.log('Payment buttons available:', document.querySelectorAll('.payment-option').length); console.log('Selected Services:', selectedServices); console.log('Selected Date:', selectedDate); console.log('Selected Time:', selectedTime); console.log('Selected Payment:', selectedPayment); console.log('Terms Accepted:', document.getElementById('acceptTerms').checked); console.log('=== END DEBUG ==='); } // Add debug button for testing (remove in production) if (window.location.search.includes('debug=true')) { const debugButton = document.createElement('button'); debugButton.textContent = 'Debug Mobile Booking'; debugButton.style.cssText = ` position: fixed; top: 10px; right: 10px; z-index: 1000; background: #FF3CAC; color: white; border: none; padding: 0.5rem; border-radius: 4px; font-size: 0.8rem; `; debugButton.onclick = debugMobileBooking; document.body.appendChild(debugButton); // Add test data auto-fill button const testDataButton = document.createElement('button'); testDataButton.textContent = 'Fill Test Data'; testDataButton.style.cssText = ` position: fixed; top: 50px; right: 10px; z-index: 1000; background: #2B86C5; color: white; border: none; padding: 0.5rem; border-radius: 4px; font-size: 0.8rem; `; testDataButton.onclick = fillTestData; document.body.appendChild(testDataButton); } // Auto-fill test data for testing function fillTestData() { console.log('Filling test data...'); // Fill form fields document.getElementById('fullName').value = 'Test User'; document.getElementById('email').value = 'test@example.com'; document.getElementById('phone').value = '07123456789'; // Add booking note if field exists const bookingNotesField = document.getElementById('bookingNotes'); if (bookingNotesField) { bookingNotesField.value = 'Test booking, ignore'; } // Accept terms document.getElementById('acceptTerms').checked = true; // Trigger validation updates updateBookingSummary(); console.log('Test data filled successfully'); alert('Test data filled! Now select a service, date, time, and payment method.'); } // Navigation Functions function toggleLoginModal(event) { if (event) { event.preventDefault(); event.stopPropagation(); } const modal = document.getElementById('loginModal'); if (modal) { modal.classList.toggle('hidden'); } } // Cancellation Policy Modal Functions function openCancellationPolicyModal() { const modal = document.getElementById('cancellationPolicyModal'); const modalContent = document.getElementById('policyModalContent'); const modalTitle = document.getElementById('policyModalTitle'); // Get business name (in real implementation, this would come from the business data) const businessName = 'Royal Hair Studio'; // Get cancellation policy (in real implementation, this would come from the business data) const policyType = 'moderate'; // This would be retrieved from business data // Policy templates (same as in business registration) const cancellationTemplates = { flexible: `${businessName} ‚Äì Cancellation Policy: You may cancel your booking up to 24 hours before your appointment for a full refund. Cancellations made within 24 hours and no-shows will be charged 100% of the service price. Refunds are returned to your original payment method within 5‚Äì10 business days. This policy is set by ${businessName}. BlkPages processes payments via Stripe on behalf of the venue but is not responsible for enforcing refunds.`, moderate: `${businessName} ‚Äì Cancellation Policy: You may cancel your booking up to 48 hours before your appointment for a full refund. Cancellations made within 48 hours will be charged 50% of the service price. No-shows will be charged 100% of the service price. Refunds are returned to your original payment method within 5‚Äì10 business days. This policy is set by ${businessName}. BlkPages processes payments via Stripe on behalf of the venue but is not responsible for enforcing refunds.`, strict: `${businessName} ‚Äì Cancellation Policy: This booking is non-refundable once confirmed. No-shows will be charged 100% of the service price. Refunds are returned to your original payment method within 5‚Äì10 business days. This policy is set by ${businessName}. BlkPages processes payments via Stripe on behalf of the venue but is not responsible for enforcing refunds.`, custom: `${businessName} ‚Äì Cancellation Policy: Cancellations: You may cancel your appointment up to [X hours/days] before the scheduled time for a full refund. Late Cancellations: Cancellations made within [X hours/days] will be charged [X%] of the service price. No-Shows: If you do not attend your appointment without notice, you will be charged [100%] of the service price. Refunds: Refunds (where applicable) will be processed back to your original payment method within [X working days]. This policy is set by ${businessName}. BlkPages processes payments via Stripe on behalf of the venue but is not responsible for enforcing refunds.` }; // Set modal content modalTitle.textContent = `${businessName} ‚Äì Cancellation Policy`; modalContent.textContent = cancellationTemplates[policyType] || cancellationTemplates.moderate; // Show modal modal.classList.remove('hidden'); } function closeCancellationPolicyModal() { const modal = document.getElementById('cancellationPolicyModal'); modal.classList.add('hidden'); } function toggleCustomerMenu() { const dropdown = document.getElementById('customerDropdown'); const mobileDropdown = document.getElementById('mobileCustomerDropdown'); if (dropdown) { dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none'; } if (mobileDropdown) { mobileDropdown.style.display = mobileDropdown.style.display === 'none' ? 'block' : 'none'; } } function toggleMobileMenu() { const menu = document.getElementById('mobileMenu'); if (menu) { menu.classList.toggle('hidden'); } } function handleLogin(event) { event.preventDefault(); // Simulate login const email = event.target.querySelector('input[type="email"]').value; const password = event.target.querySelector('input[type="password"]').value; // Simple validation if (email === 'customer@example.com' && password === 'password123') { // Show customer menu, hide login document.getElementById('authLinks').style.display = 'none'; document.getElementById('mobileAuthLinks').style.display = 'none'; document.getElementById('customerMenu').style.display = 'block'; document.getElementById('mobileCustomerMenu').style.display = 'block'; // Close modal toggleLoginModal(); // Show success message alert('Login successful!'); } else { alert('Invalid credentials. Use customer@example.com / password123'); } } function signOut() { // Hide customer menu, show login document.getElementById('authLinks').style.display = 'flex'; document.getElementById('mobileAuthLinks').style.display = 'flex'; document.getElementById('customerMenu').style.display = 'none'; document.getElementById('mobileCustomerMenu').style.display = 'none'; // Close any open dropdowns document.getElementById('customerDropdown').style.display = 'none'; document.getElementById('mobileCustomerDropdown').style.display = 'none'; alert('Signed out successfully!'); } // Close dropdowns when clicking outside document.addEventListener('click', function(event) { const customerMenu = document.getElementById('customerMenu'); const mobileCustomerMenu = document.getElementById('mobileCustomerMenu'); if (customerMenu && !customerMenu.contains(event.target)) { document.getElementById('customerDropdown').style.display = 'none'; } if (mobileCustomerMenu && !mobileCustomerMenu.contains(event.target)) { document.getElementById('mobileCustomerDropdown').style.display = 'none'; } }); // Redirect to login page with return URL function redirectToLogin() { // Store current page URL for redirect after login localStorage.setItem('returnUrl', window.location.href); // Navigate to login page window.location.href = 'customer-login.html'; } // Redirect to register page with return URL function redirectToRegister() { // Store current page URL for redirect after registration localStorage.setItem('returnUrl', window.location.href); // Navigate to register page window.location.href = 'customer-register.html'; } // Basket management functions const BASKET_KEY = 'blkpages_basket'; const GUEST_BASKET_KEY = 'blkpages_guest_basket'; function updateBasketCount() { const basketCount = document.getElementById('basketCount'); const mobileBasketCount = document.getElementById('mobileBasketCount'); const count = selectedServices ? selectedServices.length : 0; if (basketCount) { basketCount.textContent = count; } if (mobileBasketCount) { mobileBasketCount.textContent = count; } } function saveBasket() { const basketData = { selectedServices: selectedServices, timestamp: Date.now() }; const isLoggedIn = localStorage.getItem('userLoggedIn') === 'true'; if (isLoggedIn) { localStorage.setItem(BASKET_KEY, JSON.stringify(basketData)); } else { sessionStorage.setItem(GUEST_BASKET_KEY, JSON.stringify(basketData)); } } function loadBasket() { const isLoggedIn = localStorage.getItem('userLoggedIn') === 'true'; let basketData = null; if (isLoggedIn) { const savedBasket = localStorage.getItem(BASKET_KEY); if (savedBasket) basketData = JSON.parse(savedBasket); } else { const guestBasket = sessionStorage.getItem(GUEST_BASKET_KEY); if (guestBasket) basketData = JSON.parse(guestBasket); } if (basketData) { selectedServices = basketData.selectedServices || []; updateBasketCount(); } } // Show basket persistence indicator function showBasketPersistenceIndicator() { const indicator = document.getElementById('basketPersistenceIndicator'); if (indicator && !persistentBasketSystem.isLoggedIn) { indicator.classList.add('show'); } } // Hide basket persistence indicator function hideBasketPersistenceIndicator() { const indicator = document.getElementById('basketPersistenceIndicator'); if (indicator) { indicator.classList.remove('show'); } } // Simulate customer login (for demo purposes) function simulateCustomerLogin() { const loginData = { customerId: 'customer_1', email: 'john.smith@example.com', firstName: 'John', lastName: 'Smith' }; // Dispatch login event window.dispatchEvent(new CustomEvent('customer.login', { detail: loginData })); console.log('Customer login simulated:', loginData); } // Simulate customer signup (for demo purposes) function simulateCustomerSignup() { const signupData = { customerId: 'customer_new_' + Date.now(), email: 'new.customer@example.com', firstName: 'New', lastName: 'Customer', profile: { first_name: 'New', last_name: 'Customer', email: 'new.customer@example.com', phone: '07123456789', postcode: 'SW1A 1AA' } }; // Dispatch signup event window.dispatchEvent(new CustomEvent('customer.signup', { detail: signupData })); console.log('Customer signup simulated:', signupData); } // Load basket on page load document.addEventListener('DOMContentLoaded', function() { loadBasket(); // Set up persistent basket system integration if (typeof persistentBasketSystem !== 'undefined') { // Listen for login/signup events window.addEventListener('customer.login', function(event) { hideBasketPersistenceIndicator(); console.log('Customer logged in, basket will be merged'); }); window.addEventListener('customer.signup', function(event) { hideBasketPersistenceIndicator(); console.log('Customer signed up, basket will be merged'); }); } }); // Save booking to both customer and business dashboards with privacy protection function saveBookingToDashboards(bookingId, bookingData) { console.log('Saving booking to dashboards:', bookingId, bookingData); // Create customer booking object (full details) const customerBooking = { id: bookingId, customerId: bookingData.isGuest ? 'guest_' + Date.now() : localStorage.getItem('customerId') || 'customer_1', businessId: bookingData.businessId, businessName: bookingData.businessName, customerName: bookingData.customerName, customerEmail: bookingData.customerEmail, customerPhone: bookingData.customerPhone, customerPostcode: bookingData.customerPostcode, serviceName: bookingData.services.map(s => s.name).join(', '), servicePrice: bookingData.totalAmount, bookingDate: bookingData.date, bookingTime: bookingData.time, totalAmount: bookingData.totalAmount, paymentMethod: bookingData.paymentMethod, status: 'Confirmed', isGuest: bookingData.isGuest, createdAt: new Date().toISOString(), updatedAt: new Date().toISOString(), source: 'booking_form' }; // Create business booking object (privacy-protected using privacy enforcement system) const businessBookingRaw = { id: bookingId, customerId: customerBooking.customerId, businessId: bookingData.businessId, businessName: bookingData.businessName, customerFirstName: bookingData.customerName.split(' ')[0], customerLastName: bookingData.customerName.split(' ').slice(1).join(' '), customerEmail: bookingData.customerEmail, // Will be stripped customerPhone: bookingData.customerPhone, // Will be stripped customerPostcode: bookingData.customerPostcode, // Will be stripped serviceName: bookingData.services.map(s => s.name).join(', '), servicePrice: bookingData.totalAmount, bookingDate: bookingData.date, bookingTime: bookingData.time, totalAmount: bookingData.totalAmount, paymentMethod: bookingData.paymentMethod, status: 'Confirmed', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString(), source: 'booking_form' }; // Apply privacy enforcement to strip restricted fields const businessBooking = privacyEnforcement ? privacyEnforcement.stripRestrictedFields(businessBookingRaw, 'bookings') : businessBookingRaw; // Save to customer dashboard (MyBookings[]) const customerId = customerBooking.customerId; const customerBookings = JSON.parse(localStorage.getItem(`customerBookings_${customerId}`) || '[]'); customerBookings.push(customerBooking); localStorage.setItem(`customerBookings_${customerId}`, JSON.stringify(customerBookings)); // Save to business dashboard (Bookings[]) const businessBookings = JSON.parse(localStorage.getItem(`businessBookings_${bookingData.businessId}`) || '[]'); businessBookings.push(businessBooking); localStorage.setItem(`businessBookings_${bookingData.businessId}`, JSON.stringify(businessBookings)); // Trigger booking.confirmed event triggerBookingConfirmedEvent(customerBooking, businessBooking); console.log('Booking saved to both dashboards successfully'); // Security: Log booking completion if (typeof securityUtils !== 'undefined') { securityUtils.logSecurityEvent('booking_completed', { bookingId: bookingData.id, customerId: bookingData.customerId, businessId: bookingData.businessId, totalAmount: bookingData.totalAmount, timestamp: new Date().toISOString() }); } } // Trigger booking.confirmed event function triggerBookingConfirmedEvent(customerBooking, businessBooking) { try { // Create booking confirmed event data const bookingConfirmedData = { bookingId: customerBooking.id, customerId: customerBooking.customerId, businessId: customerBooking.businessId, customerName: customerBooking.customerName, businessName: customerBooking.businessName, serviceName: customerBooking.serviceName, bookingDate: customerBooking.bookingDate, bookingTime: customerBooking.bookingTime, totalAmount: customerBooking.totalAmount, status: 'Confirmed', timestamp: new Date().toISOString() }; // Dispatch custom event window.dispatchEvent(new CustomEvent('booking.confirmed', { detail: bookingConfirmedData })); console.log('Booking.confirmed event triggered:', bookingConfirmedData); } catch (error) { console.error('Failed to trigger booking.confirmed event:', error); } } // Update booking status when customer cancels (real-time sync) function updateBookingStatus(bookingId, newStatus) { console.log('Updating booking status:', bookingId, newStatus); // Update in customer dashboard const customerId = localStorage.getItem('customerId') || 'customer_1'; const customerBookings = JSON.parse(localStorage.getItem(`customerBookings_${customerId}`) || '[]'); const customerBookingIndex = customerBookings.findIndex(b => b.bookingId === bookingId); if (customerBookingIndex !== -1) { customerBookings[customerBookingIndex].status = newStatus; customerBookings[customerBookingIndex].updatedAt = new Date().toISOString(); localStorage.setItem(`customerBookings_${customerId}`, JSON.stringify(customerBookings)); } // Update in business dashboard const businessBookings = JSON.parse(localStorage.getItem(`businessBookings_royal-hair-studio`) || '[]'); const businessBookingIndex = businessBookings.findIndex(b => b.bookingId === bookingId); if (businessBookingIndex !== -1) { businessBookings[businessBookingIndex].status = newStatus; businessBookings[businessBookingIndex].updatedAt = new Date().toISOString(); localStorage.setItem(`businessBookings_royal-hair-studio`, JSON.stringify(businessBookings)); } console.log('Booking status updated in both dashboards:', newStatus); } // Listen for booking cancellations (for real-time updates) window.addEventListener('storage', function(e) { if (e.key && e.key.startsWith('bookingCancelled_')) { const bookingId = e.key.replace('bookingCancelled_', ''); updateBookingStatus(bookingId, 'Cancelled'); } }); // Function to cancel booking (called from customer dashboard) window.cancelBooking = function(bookingId) { if (confirm('Are you sure you want to cancel this booking?')) { // Update booking status to cancelled updateBookingStatus(bookingId, 'Cancelled'); // Trigger storage event for real-time sync localStorage.setItem(`bookingCancelled_${bookingId}`, Date.now().toString()); alert('Booking cancelled successfully.'); // Refresh the page or update UI if (typeof updateBookingsDisplay === 'function') { updateBookingsDisplay(); } } }; // ======================================== // COMPREHENSIVE FORM VALIDATION SYSTEM // ======================================== // Validation rules as specified const ValidationRules = { "service_selection": { "required": true, "errorMessage": "Please select at least one service." }, "date_selection": { "required": true, "errorMessage": "Please choose a date for your booking." }, "time_selection": { "required": true, "errorMessage": "Please select a time slot." }, "first_name": { "required": true, "pattern": "^[A-Za-z\\-']{2,}$", "errorMessage": "Enter a valid first name (letters only)." }, "last_name": { "required": true, "pattern": "^[A-Za-z\\-']{2,}$", "errorMessage": "Enter a valid surname (letters only)." }, "email": { "required": true, "pattern": "^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$", "errorMessage": "Enter a valid UK email address." }, "phone": { "required": true, "pattern": "^(\\+44\\s?7\\d{3}|07\\d{3})\\s?\\d{3}\\s?\\d{3}$|^0\\d{2,4}\\s?\\d{3}\\s?\\d{3,4}$", "errorMessage": "Enter a valid UK phone number." }, "postcode": { "required": true, "pattern": "^[A-Z]{1,2}\\d[A-Z\\d]?\\s?\\d[A-Z]{2}$", "errorMessage": "Enter a valid UK postcode (e.g., SW1A 1AA)." }, "terms_checkbox": { "required": true, "errorMessage": "You must accept the terms and cancellation policy to continue." } }; // Validation state tracking let validationInProgress = false; let currentValidationErrors = []; /** * Main validation function - called when Book Now button is clicked */ function validateAndSubmitBooking() { if (validationInProgress) { console.log('Validation already in progress, ignoring click'); return; } validationInProgress = true; currentValidationErrors = []; // Clear previous errors clearAllValidationErrors(); // Disable button temporarily const bookingBtn = document.getElementById('completeBookingBtn'); const originalText = document.getElementById('bookingBtnText').textContent; bookingBtn.disabled = true; document.getElementById('bookingBtnText').textContent = 'Validating...'; console.log('Starting comprehensive form validation...'); // Run validation checks in order const validationResults = [ validateServiceSelection(), validateDateSelection(), validateTimeSelection(), validateCustomerDetails(), validateTermsAcceptance() ]; // Check if any validation failed const hasErrors = validationResults.some(result => !result.valid); if (hasErrors) { // Show errors and scroll to first invalid field showValidationErrors(); scrollToFirstError(); showButtonShakeAnimation(); // Re-enable button bookingBtn.disabled = false; document.getElementById('bookingBtnText').textContent = originalText; console.log('Validation failed:', currentValidationErrors); } else { // All validations passed - proceed with booking console.log('All validations passed - proceeding with booking'); proceedWithBooking(); } validationInProgress = false; } /** * Validate service selection */ function validateServiceSelection() { const servicesList = document.getElementById('booking-services-list'); const hasServices = servicesList && servicesList.children.length > 0; if (!hasServices) { showFieldError('service_selection', ValidationRules.service_selection.errorMessage); return { valid: false, field: 'service_selection' }; } return { valid: true }; } /** * Validate date selection */ function validateDateSelection() { const selectedDate = localStorage.getItem('selectedDate'); if (!selectedDate) { showFieldError('date_selection', ValidationRules.date_selection.errorMessage); return { valid: false, field: 'date_selection' }; } return { valid: true }; } /** * Validate time selection */ function validateTimeSelection() { const selectedTime = localStorage.getItem('selectedTime'); if (!selectedTime) { showFieldError('time_selection', ValidationRules.time_selection.errorMessage); return { valid: false, field: 'time_selection' }; } return { valid: true }; } /** * Validate customer details */ function validateCustomerDetails() { const fullName = document.getElementById('fullName'); const email = document.getElementById('email'); const phone = document.getElementById('phone'); const postcode = document.getElementById('postcode'); let allValid = true; // Validate full name (split into first and last) if (fullName && fullName.value.trim()) { const nameParts = fullName.value.trim().split(' '); const firstName = nameParts[0]; const lastName = nameParts.slice(1).join(' '); if (!validateField(firstName, 'first_name')) { allValid = false; } if (lastName && !validateField(lastName, 'last_name')) { allValid = false; } } else { showFieldError('fullName', 'Please enter your full name'); allValid = false; } // Validate email if (email && !validateField(email.value, 'email')) { allValid = false; } // Validate phone if (phone && !validateField(phone.value, 'phone')) { allValid = false; } // Validate postcode if (postcode && !validateField(postcode.value.toUpperCase(), 'postcode')) { allValid = false; } return { valid: allValid }; } /** * Validate terms acceptance */ function validateTermsAcceptance() { const termsCheckbox = document.getElementById('acceptTerms'); if (!termsCheckbox || !termsCheckbox.checked) { showFieldError('acceptTerms', ValidationRules.terms_checkbox.errorMessage); return { valid: false, field: 'acceptTerms' }; } return { valid: true }; } /** * Validate individual field against pattern */ function validateField(value, fieldName) { const rule = ValidationRules[fieldName]; if (!rule) return true; if (rule.required && (!value || value.trim() === '')) { showFieldError(fieldName, rule.errorMessage); return false; } if (rule.pattern && value) { const regex = new RegExp(rule.pattern); if (!regex.test(value)) { showFieldError(fieldName, rule.errorMessage); return false; } } return true; } /** * Show field error with inline message */ function showFieldError(fieldId, message) { const field = document.getElementById(fieldId); if (!field) return; // Add error class field.classList.add('field-error'); // Remove existing error message const existingError = field.parentNode.querySelector('.field-error-message'); if (existingError) { existingError.remove(); } // Add new error message const errorDiv = document.createElement('div'); errorDiv.className = 'field-error-message'; errorDiv.textContent = message; errorDiv.setAttribute('aria-live', 'polite'); errorDiv.setAttribute('aria-describedby', fieldId); field.parentNode.appendChild(errorDiv); // Track error for scrolling currentValidationErrors.push({ field: field, message: message }); } /** * Clear all validation errors */ function clearAllValidationErrors() { // Remove error classes document.querySelectorAll('.field-error').forEach(field => { field.classList.remove('field-error'); }); // Remove error messages document.querySelectorAll('.field-error-message').forEach(error => { error.remove(); }); } /** * Clear field error when user starts typing */ function clearFieldError(fieldId) { const field = document.getElementById(fieldId); if (!field) return; field.classList.remove('field-error'); const errorMessage = field.parentNode.querySelector('.field-error-message'); if (errorMessage) { errorMessage.remove(); } } /** * Show validation errors summary */ function showValidationErrors() { if (currentValidationErrors.length === 0) return; console.log('Validation errors found:', currentValidationErrors.length); currentValidationErrors.forEach(error => { console.log(`- ${error.field.id || error.field}: ${error.message}`); }); } /** * Scroll to first error field smoothly */ function scrollToFirstError() { if (currentValidationErrors.length === 0) return; const firstError = currentValidationErrors[0].field; const fieldRect = firstError.getBoundingClientRect(); const isMobile = window.innerWidth <= 768; const offset = isMobile ? 100 : 80; // Account for mobile keyboard window.scrollTo({ top: window.pageYOffset + fieldRect.top - offset, behavior: 'smooth' }); // Focus the field for accessibility setTimeout(() => { firstError.focus(); }, 500); } /** * Show button shake animation */ function showButtonShakeAnimation() { const button = document.getElementById('completeBookingBtn'); button.classList.add('shake-animation'); setTimeout(() => { button.classList.remove('shake-animation'); }, 500); } /** * Proceed with booking after validation passes */ function proceedWithBooking() { console.log('All validations passed - proceeding with booking'); // Re-enable button const bookingBtn = document.getElementById('completeBookingBtn'); bookingBtn.disabled = false; document.getElementById('bookingBtnText').textContent = 'Book Now'; // Call existing booking function if (typeof completeBooking === 'function') { completeBooking(); } else { console.log('Booking function not found - showing success message'); showValidationSuccess(); } } /** * Show validation success message */ function showValidationSuccess() { alert('‚úÖ All fields valid ‚Äî booking can now proceed.'); } // Add real-time validation listeners document.addEventListener('DOMContentLoaded', function() { // Add blur listeners for real-time validation const validationFields = ['fullName', 'email', 'phone', 'postcode']; validationFields.forEach(fieldId => { const field = document.getElementById(fieldId); if (field) { field.addEventListener('blur', function() { if (this.value.trim()) { clearFieldError(fieldId); } }); field.addEventListener('input', function() { clearFieldError(fieldId); }); } }); // Add terms checkbox listener const termsCheckbox = document.getElementById('acceptTerms'); if (termsCheckbox) { termsCheckbox.addEventListener('change', function() { if (this.checked) { clearFieldError('acceptTerms'); } }); } }); </script><!-- Sticky CTA Button --><div><button onclick="validateAndSubmitBooking()"><i></i><span>Book Now</span></button></div><!-- Footer -->
        </div>
    </main>
    
    <footer class="bg-[#111111] py-12 px-4">
        <div class="container mx-auto grid grid-cols-1 md:grid-cols-4 gap-8">
            <!-- About -->
            <div>
                <h3 class="text-lg font-bold text-[#D4AF37] mb-4">BlkPages</h3>
                <p class="text-gray-400">Connecting you to businesses inspired by Black culture and creativity.</p>
            </div>
            <!-- Links -->
            <div>
                <h3 class="text-lg font-semibold text-gray-200 mb-4">Quick Links</h3>
                <ul>
                    <li class="mb-2"><a href="about.html" class="text-gray-400 hover:text-[#D4AF37]">About Us</a></li>
                    <li class="mb-2"><a href="search-results.html" class="text-gray-400 hover:text-[#D4AF37]">Browse</a></li>
                    <li class="mb-2"><a href="business-register.html" class="text-gray-400 hover:text-[#D4AF37]">List a Business</a></li>
                    <li class="mb-2"><a href="contact.html" class="text-gray-400 hover:text-[#D4AF37]">Contact</a></li>
                </ul>
            </div>
            <!-- Legal -->
            <div>
                <h3 class="text-lg font-semibold text-gray-200 mb-4">Legal</h3>
                <ul>
                    <li class="mb-2"><a href="privacy.html" class="text-gray-400 hover:text-[#D4AF37]">Privacy Policy</a></li>
                    <li class="mb-2"><a href="terms.html" class="text-gray-400 hover:text-[#D4AF37]">Terms of Service</a></li>
                </ul>
            </div>
            <!-- Social -->
            <div>
                <h3 class="text-lg font-semibold text-gray-200 mb-4">Connect With Us</h3>
                <div class="flex gap-4">
                    <a href="#" class="text-gray-400 hover:text-[#D4AF37]"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="text-gray-400 hover:text-[#D4AF37]"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="text-gray-400 hover:text-[#D4AF37]"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
        </div>
        <div class="text-center text-gray-500 mt-8 pt-8 border-t border-gray-800">
            <p>&copy; 2024 BlkPages. All rights reserved.</p>
        </div>
    </footer>
</body>
</html>