<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loyalty Demo Admin - BlkPages</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header { background: linear-gradient(135deg, #FF3CAC, #784BA0); color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .stat-card { background: #f8f9fa; padding: 15px; border-radius: 6px; text-align: center; border-left: 4px solid #FF3CAC; }
        .stat-number { font-size: 24px; font-weight: bold; color: #FF3CAC; }
        .stat-label { color: #666; font-size: 14px; }
        .actions { margin-bottom: 20px; }
        .btn { background: #FF3CAC; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin-right: 10px; }
        .btn:hover { background: #e91e63; }
        .btn-secondary { background: #6c757d; }
        .btn-secondary:hover { background: #5a6268; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #f8f9fa; font-weight: 600; }
        .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500; }
        .status-issued { background: #fff3cd; color: #856404; }
        .status-redeemed { background: #d4edda; color: #155724; }
        .status-expired { background: #f8d7da; color: #721c24; }
        .export-section { background: #e9ecef; padding: 15px; border-radius: 6px; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Loyalty Demo Admin Panel</h1>
            <p>Manage and monitor demo loyalty rewards system</p>
        </div>
        
        <div class="stats" id="statsContainer">
            <!-- Stats will be loaded here -->
        </div>
        
        <div class="actions">
            <button class="btn" onclick="downloadCSV()">üì• Download CSV</button>
            <button class="btn btn-secondary" onclick="regenerateVouchers()">üîÑ Re-run Generation</button>
            <button class="btn btn-secondary" onclick="cleanupDemo()">üóëÔ∏è Cleanup Demo Data</button>
        </div>
        
        <div class="export-section">
            <h3>üìä Demo Vouchers Export</h3>
            <p>Export all demo reward vouchers to CSV format for analysis.</p>
            <p><strong>File:</strong> <span id="csvPath">/exports/loyalty_demo_vouchers_${new Date().toISOString().slice(0,10).replace(/-/g,'')}.csv</span></p>
        </div>
        
        <table id="vouchersTable">
            <thead>
                <tr>
                    <th>Code</th>
                    <th>Business</th>
                    <th>Customer</th>
                    <th>Reward Type</th>
                    <th>Reward Value</th>
                    <th>Expiry Date</th>
                    <th>Status</th>
                    <th>Redeemed On</th>
                    <th>Created</th>
                </tr>
            </thead>
            <tbody id="vouchersTableBody">
                <!-- Vouchers will be loaded here -->
            </tbody>
        </table>
    </div>

    <script>
        // Load demo data from localStorage
        function loadDemoData() {
            const vouchers = JSON.parse(localStorage.getItem('demo_RewardVouchers') || '[]');
            const businesses = JSON.parse(localStorage.getItem('demo_Businesses') || '[]');
            const customers = JSON.parse(localStorage.getItem('demo_Customers') || '[]');
            
            // Update stats
            const statsContainer = document.getElementById('statsContainer');
            const totalVouchers = vouchers.length;
            const redeemedVouchers = vouchers.filter(v => v.used).length;
            const expiredVouchers = vouchers.filter(v => v.expired).length;
            const activeVouchers = totalVouchers - redeemedVouchers - expiredVouchers;
            
            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${totalVouchers}</div>
                    <div class="stat-label">Total Vouchers</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${redeemedVouchers}</div>
                    <div class="stat-label">Redeemed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${expiredVouchers}</div>
                    <div class="stat-label">Expired</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${activeVouchers}</div>
                    <div class="stat-label">Active</div>
                </div>
            `;
            
            // Update vouchers table
            const tableBody = document.getElementById('vouchersTableBody');
            tableBody.innerHTML = vouchers.map(voucher => {
                const business = businesses.find(b => b.id === voucher.business_id);
                const customer = customers.find(c => c.id === voucher.customer_id);
                
                let statusClass = 'status-issued';
                let statusText = 'Issued';
                
                if (voucher.used) {
                    statusClass = 'status-redeemed';
                    statusText = 'Redeemed';
                } else if (voucher.expired) {
                    statusClass = 'status-expired';
                    statusText = 'Expired';
                }
                
                return `
                    <tr>
                        <td><strong>${voucher.code}</strong></td>
                        <td>${business ? business.name : 'Unknown'}</td>
                        <td>${customer ? customer.first_name : 'Unknown'}</td>
                        <td>${voucher.reward_type}</td>
                        <td>${voucher.reward_value}</td>
                        <td>${new Date(voucher.expires_at).toLocaleDateString()}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>${voucher.used_at ? new Date(voucher.used_at).toLocaleDateString() : '-'}</td>
                        <td>${new Date(voucher.created_at).toLocaleDateString()}</td>
                    </tr>
                `;
            }).join('');
        }
        
        function downloadCSV() {
            const vouchers = JSON.parse(localStorage.getItem('demo_RewardVouchers') || '[]');
            const businesses = JSON.parse(localStorage.getItem('demo_Businesses') || '[]');
            const customers = JSON.parse(localStorage.getItem('demo_Customers') || '[]');
            
            const csvContent = [
                'code,business_name,customer_name,reward_type,reward_value,expiry_date,redeemed,redeemed_on,expired,created_at'
            ].concat(
                vouchers.map(voucher => {
                    const business = businesses.find(b => b.id === voucher.business_id);
                    const customer = customers.find(c => c.id === voucher.customer_id);
                    
                    return [
                        voucher.code,
                        business ? business.name : 'Unknown',
                        customer ? customer.first_name : 'Unknown',
                        voucher.reward_type,
                        voucher.reward_value,
                        voucher.expires_at,
                        voucher.used ? 'true' : 'false',
                        voucher.used_at || '',
                        voucher.expired ? 'true' : 'false',
                        voucher.created_at
                    ].join(',');
                })
            ).join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `loyalty_demo_vouchers_${new Date().toISOString().slice(0,10).replace(/-/g,'')}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }
        
        function regenerateVouchers() {
            if (confirm('This will regenerate all vouchers. Continue?')) {
                alert('Voucher regeneration would be implemented here in a real system.');
                loadDemoData();
            }
        }
        
        function cleanupDemo() {
            if (confirm('This will delete all demo data. Are you sure?')) {
                const demoKeys = ['demo_Businesses', 'demo_Customers', 'demo_Bookings', 'demo_LoyaltyProgrammes', 'demo_LoyaltyProgress', 'demo_RewardVouchers'];
                demoKeys.forEach(key => localStorage.removeItem(key));
                alert('Demo data cleaned up successfully!');
                loadDemoData();
            }
        }
        
        // Load data on page load
        document.addEventListener('DOMContentLoaded', loadDemoData);
    </script>
</body>
</html>

