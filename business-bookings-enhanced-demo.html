<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Business Bookings Dashboard - BLKPAGES</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .bookings-dashboard {
            padding: 24px;
            color: #fff;
            font-family: system-ui, -apple-system, Inter, Arial, sans-serif;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .summary-card {
            background: #1f1f1f;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .summary-card h3 {
            color: #aaa;
            font-size: 0.9rem;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #fff;
            margin: 0;
        }
        
        .integration-panel {
            background: #222;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .integration-panel h3 {
            color: #fff;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        .integration-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .integration-card {
            background: #333;
            border-radius: 8px;
            padding: 20px;
        }
        
        .integration-card h4 {
            color: #fff;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e74c3c;
        }
        
        .status-indicator.connected {
            background: #2ecc71;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            color: #aaa;
            font-size: 0.9rem;
            margin-bottom: 6px;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #444;
            border-radius: 6px;
            background: #444;
            color: #fff;
            font-size: 1rem;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
        }
        
        .btn-success {
            background: #2ecc71;
            color: white;
        }
        
        .btn-success:hover {
            background: #27ae60;
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-warning {
            background: #f39c12;
            color: white;
        }
        
        .btn-warning:hover {
            background: #e67e22;
        }
        
        .btn-info {
            background: #4BC0C0;
            color: white;
        }
        
        .btn-info:hover {
            background: #3BA8A8;
        }
        
        .feature-highlight {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .feature-highlight h3 {
            color: #fff;
            margin-bottom: 10px;
        }
        
        .feature-highlight p {
            color: #e0e0e0;
            margin-bottom: 15px;
        }
        
        .demo-controls {
            margin: 20px 0;
            text-align: center;
        }
        
        .notification {
            background: #2ecc71;
            color: white;
            padding: 12px 20px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
        }
        
        .notification.error {
            background: #e74c3c;
        }
        
        .notification.warning {
            background: #f39c12;
        }
    </style>
</head>
<body>
    <div class="bookings-dashboard">
        <h2>Enhanced Business Bookings Dashboard</h2>
        <p style="color: #aaa; margin-bottom: 30px;">Now with Google Calendar sync and automatic email notifications</p>

        <div class="feature-highlight">
            <h3>ðŸš€ New Features</h3>
            <p>âœ… Google Calendar Sync â€¢ âœ… Automatic Email Notifications â€¢ âœ… 24h & 1h Reminders</p>
            <p>Bookings are automatically synced to your Google Calendar and customers receive confirmation emails with reminders!</p>
        </div>

        <div id="notification" class="notification"></div>

        <div class="summary-grid">
            <div class="summary-card">
                <h3>Today's Bookings</h3>
                <p class="metric-value" id="todaysCount">0</p>
            </div>
            <div class="summary-card">
                <h3>Total Bookings</h3>
                <p class="metric-value" id="totalCount">0</p>
            </div>
            <div class="summary-card">
                <h3>Completion Rate</h3>
                <p class="metric-value" id="completionRate">0.0%</p>
            </div>
            <div class="summary-card">
                <h3>Monthly Revenue</h3>
                <p class="metric-value" id="monthlyRevenue">Â£0.00</p>
            </div>
        </div>

        <div class="integration-panel">
            <h3>ðŸ”— Integration Settings</h3>
            <div class="integration-grid">
                <div class="integration-card">
                    <h4>
                        <span class="status-indicator" id="googleStatus"></span>
                        Google Calendar
                    </h4>
                    <p style="color: #aaa; margin-bottom: 15px;">Sync bookings to your Google Calendar automatically</p>
                    <div class="form-group">
                        <label>Calendar ID</label>
                        <input type="text" id="calendarId" placeholder="primary" />
                    </div>
                    <div class="form-group">
                        <label>Access Token</label>
                        <input type="text" id="accessToken" placeholder="ya29.a0..." />
                    </div>
                    <div class="form-group">
                        <label>Refresh Token</label>
                        <input type="text" id="refreshToken" placeholder="1//04..." />
                    </div>
                    <button class="btn btn-success" onclick="saveGoogleIntegration()">Save Google Settings</button>
                </div>
                
                <div class="integration-card">
                    <h4>
                        <span class="status-indicator" id="emailStatus"></span>
                        Email Notifications
                    </h4>
                    <p style="color: #aaa; margin-bottom: 15px;">Send automatic confirmation and reminder emails</p>
                    <div class="form-group">
                        <label>Enable Email Notifications</label>
                        <select id="emailEnabled">
                            <option value="false">Disabled</option>
                            <option value="true">Enabled</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>From Address</label>
                        <input type="email" id="fromAddress" placeholder="bookings@yourbusiness.com" />
                    </div>
                    <button class="btn btn-success" onclick="saveEmailIntegration()">Save Email Settings</button>
                </div>
            </div>
        </div>

        <div class="demo-controls">
            <button class="btn btn-primary" onclick="simulateBooking()">Simulate New Booking</button>
            <button class="btn btn-warning" onclick="testGoogleSync()">Test Google Calendar Sync</button>
            <button class="btn btn-info" onclick="testEmailNotification()">Test Email Notification</button>
            <button class="btn btn-success" onclick="generateSampleData()">Generate Sample Data</button>
            <button class="btn btn-danger" onclick="clearAllData()">Clear All Data</button>
        </div>
    </div>

    <script>
        let bookingsData = {
            todaysCount: 0,
            totalCount: 0,
            completionRate: 0,
            monthlyRevenue: 0
        };
        
        let services = [
            { _id: '1', name: 'Haircut', durationMinutes: 30, priceGBP: 25 },
            { _id: '2', name: 'Haircut & Styling', durationMinutes: 60, priceGBP: 45 },
            { _id: '3', name: 'Beard Trim', durationMinutes: 15, priceGBP: 15 },
            { _id: '4', name: 'Full Service', durationMinutes: 90, priceGBP: 65 }
        ];
        
        let bookings = [];
        let integrations = {
            google: null,
            emailSettings: { enabled: false, fromAddress: '' }
        };
        
        // Load data from localStorage
        function loadData() {
            const savedBookings = localStorage.getItem('businessBookings');
            if (savedBookings) {
                bookings = JSON.parse(savedBookings);
            }
            
            const savedIntegrations = localStorage.getItem('businessIntegrations');
            if (savedIntegrations) {
                integrations = JSON.parse(savedIntegrations);
            }
            
            updateDisplay();
            updateIntegrationUI();
        }
        
        // Save data to localStorage
        function saveData() {
            localStorage.setItem('businessBookings', JSON.stringify(bookings));
            localStorage.setItem('businessIntegrations', JSON.stringify(integrations));
        }
        
        // Update summary metrics
        function updateSummary() {
            const now = new Date();
            const today = now.toISOString().split('T')[0];
            
            // Today's bookings
            const todaysBookings = bookings.filter(b => 
                b.startISO.startsWith(today) && 
                (b.status === 'confirmed' || b.status === 'pending')
            );
            
            // Total bookings
            const totalBookings = bookings.length;
            
            // Completion rate (last 30 days)
            const thirtyDaysAgo = new Date(now.getTime() - (30 * 24 * 60 * 60 * 1000));
            const recentBookings = bookings.filter(b => new Date(b.createdAt) >= thirtyDaysAgo);
            const completedBookings = recentBookings.filter(b => b.status === 'completed');
            const completionRate = recentBookings.length > 0 ? (completedBookings.length / recentBookings.length) * 100 : 0;
            
            // Monthly revenue
            const thisMonth = now.getMonth();
            const thisYear = now.getFullYear();
            const monthlyBookings = bookings.filter(b => {
                const bookingDate = new Date(b.confirmedAt || b.createdAt);
                return bookingDate.getMonth() === thisMonth && 
                       bookingDate.getFullYear() === thisYear && 
                       b.status === 'completed';
            });
            const monthlyRevenue = monthlyBookings.reduce((sum, b) => sum + b.priceGBP, 0);
            
            bookingsData = {
                todaysCount: todaysBookings.length,
                totalCount: totalBookings,
                completionRate: completionRate,
                monthlyRevenue: monthlyRevenue
            };
        }
        
        // Update display
        function updateDisplay() {
            updateSummary();
            
            // Update summary cards
            document.getElementById('todaysCount').textContent = bookingsData.todaysCount;
            document.getElementById('totalCount').textContent = bookingsData.totalCount;
            document.getElementById('completionRate').textContent = bookingsData.completionRate.toFixed(1) + '%';
            document.getElementById('monthlyRevenue').textContent = 'Â£' + bookingsData.monthlyRevenue.toFixed(2);
        }
        
        // Update integration UI
        function updateIntegrationUI() {
            // Google Calendar status
            const googleStatus = document.getElementById('googleStatus');
            if (integrations.google && integrations.google.access_token) {
                googleStatus.classList.add('connected');
            } else {
                googleStatus.classList.remove('connected');
            }
            
            // Email status
            const emailStatus = document.getElementById('emailStatus');
            if (integrations.emailSettings && integrations.emailSettings.enabled) {
                emailStatus.classList.add('connected');
            } else {
                emailStatus.classList.remove('connected');
            }
            
            // Populate form fields
            if (integrations.google) {
                document.getElementById('calendarId').value = integrations.google.calendar_id || '';
                document.getElementById('accessToken').value = integrations.google.access_token || '';
                document.getElementById('refreshToken').value = integrations.google.refresh_token || '';
            }
            
            if (integrations.emailSettings) {
                document.getElementById('emailEnabled').value = integrations.emailSettings.enabled ? 'true' : 'false';
                document.getElementById('fromAddress').value = integrations.emailSettings.fromAddress || '';
            }
        }
        
        // Save Google integration
        function saveGoogleIntegration() {
            const calendarId = document.getElementById('calendarId').value;
            const accessToken = document.getElementById('accessToken').value;
            const refreshToken = document.getElementById('refreshToken').value;
            
            if (!accessToken || !refreshToken) {
                showNotification('Please provide both access token and refresh token', 'error');
                return;
            }
            
            integrations.google = {
                calendar_id: calendarId || 'primary',
                access_token: accessToken,
                refresh_token: refreshToken,
                token_expiry: new Date(Date.now() + 3600000) // 1 hour from now
            };
            
            saveData();
            updateIntegrationUI();
            showNotification('Google Calendar integration saved successfully!', 'success');
        }
        
        // Save email integration
        function saveEmailIntegration() {
            const enabled = document.getElementById('emailEnabled').value === 'true';
            const fromAddress = document.getElementById('fromAddress').value;
            
            integrations.emailSettings = {
                enabled: enabled,
                fromAddress: fromAddress
            };
            
            saveData();
            updateIntegrationUI();
            showNotification('Email settings saved successfully!', 'success');
        }
        
        // Simulate booking with Google Calendar sync and email
        function simulateBooking() {
            const service = services[Math.floor(Math.random() * services.length)];
            const customerNames = ['Alice Brown', 'David Lee', 'Emma Davis', 'Tom Wilson', 'Lisa Taylor'];
            const randomName = customerNames[Math.floor(Math.random() * customerNames.length)];
            const randomPhone = '07' + Math.floor(Math.random() * 100000000).toString().padStart(9, '0');
            const randomEmail = randomName.toLowerCase().replace(' ', '.') + '@example.com';
            
            const newBooking = {
                _id: Date.now().toString(),
                serviceId: service._id,
                customer: {
                    name: randomName,
                    phone: randomPhone,
                    email: randomEmail
                },
                startISO: new Date(Date.now() + Math.random() * 7 * 24 * 60 * 60 * 1000).toISOString(),
                endISO: new Date(Date.now() + Math.random() * 7 * 24 * 60 * 60 * 1000 + service.durationMinutes * 60000).toISOString(),
                status: 'pending',
                createdAt: new Date().toISOString(),
                confirmedAt: null,
                priceGBP: service.priceGBP,
                notes: 'Simulated booking with integrations',
                source: 'widget',
                googleEventId: null,
                customerEmailNotified: false
            };
            
            bookings.push(newBooking);
            
            // Simulate Google Calendar sync
            if (integrations.google && integrations.google.access_token) {
                newBooking.googleEventId = 'event_' + Date.now();
                showNotification(`ðŸ“… Google Calendar event created: ${newBooking.googleEventId}`, 'success');
            }
            
            // Simulate email notification
            if (integrations.emailSettings && integrations.emailSettings.enabled && newBooking.customer.email) {
                newBooking.customerEmailNotified = true;
                showNotification(`ðŸ“§ Confirmation email sent to: ${newBooking.customer.email}`, 'success');
            }
            
            saveData();
            updateDisplay();
        }
        
        // Test Google Calendar sync
        function testGoogleSync() {
            if (!integrations.google || !integrations.google.access_token) {
                showNotification('Please configure Google Calendar integration first', 'warning');
                return;
            }
            
            showNotification('ðŸ”„ Testing Google Calendar sync...', 'info');
            
            // Simulate sync
            setTimeout(() => {
                showNotification('âœ… Google Calendar sync test successful!', 'success');
            }, 1000);
        }
        
        // Test email notification
        function testEmailNotification() {
            if (!integrations.emailSettings || !integrations.emailSettings.enabled) {
                showNotification('Please enable email notifications first', 'warning');
                return;
            }
            
            showNotification('ðŸ“§ Testing email notification...', 'info');
            
            // Simulate email
            setTimeout(() => {
                showNotification('âœ… Test email sent successfully!', 'success');
            }, 1000);
        }
        
        // Generate sample data
        function generateSampleData() {
            const sampleBookings = [
                {
                    _id: '1',
                    serviceId: '1',
                    customer: { name: 'John Smith', phone: '07123456789', email: 'john@example.com' },
                    startISO: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString(),
                    endISO: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000 + 30 * 60000).toISOString(),
                    status: 'pending',
                    createdAt: new Date().toISOString(),
                    confirmedAt: null,
                    priceGBP: 25,
                    notes: 'First time customer',
                    source: 'widget',
                    googleEventId: 'event_123456',
                    customerEmailNotified: true
                },
                {
                    _id: '2',
                    serviceId: '2',
                    customer: { name: 'Sarah Johnson', phone: '07987654321', email: 'sarah@example.com' },
                    startISO: new Date(Date.now() + 1 * 24 * 60 * 60 * 1000).toISOString(),
                    endISO: new Date(Date.now() + 1 * 24 * 60 * 60 * 1000 + 60 * 60000).toISOString(),
                    status: 'confirmed',
                    createdAt: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
                    confirmedAt: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString(),
                    priceGBP: 45,
                    notes: 'Regular customer',
                    source: 'widget',
                    googleEventId: 'event_789012',
                    customerEmailNotified: true
                }
            ];
            
            bookings = sampleBookings;
            saveData();
            updateDisplay();
            showNotification('Sample data generated with Google Calendar and email integrations!', 'success');
        }
        
        // Clear all data
        function clearAllData() {
            if (confirm('Are you sure you want to clear all booking data?')) {
                bookings = [];
                saveData();
                updateDisplay();
                showNotification('All data cleared', 'info');
            }
        }
        
        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });
    </script>
</body>
</html>
