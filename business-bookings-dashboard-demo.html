<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Bookings Dashboard - BLKPAGES</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .bookings-dashboard {
            padding: 24px;
            color: #fff;
            font-family: system-ui, -apple-system, Inter, Arial, sans-serif;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .summary-card {
            background: #1f1f1f;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .summary-card h3 {
            color: #aaa;
            font-size: 0.9rem;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #fff;
            margin: 0;
        }
        
        .quick-actions {
            margin-bottom: 30px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
        }
        
        .btn-success {
            background: #2ecc71;
            color: white;
        }
        
        .btn-success:hover {
            background: #27ae60;
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-secondary {
            background: #95a5a6;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #7f8c8d;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 0.8rem;
        }
        
        .create-booking-form {
            background: #222;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .create-booking-form h3 {
            color: #fff;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .form-group label {
            display: block;
            color: #aaa;
            font-size: 0.9rem;
            margin-bottom: 6px;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #444;
            border-radius: 6px;
            background: #333;
            color: #fff;
            font-size: 1rem;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .form-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }
        
        .booking-tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 20px;
            background: #222;
            border-radius: 8px;
            padding: 4px;
        }
        
        .tab {
            flex: 1;
            padding: 12px 16px;
            border: none;
            background: transparent;
            color: #aaa;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .tab.active {
            background: #3498db;
            color: white;
        }
        
        .tab:hover:not(.active) {
            background: #333;
            color: #fff;
        }
        
        .bookings-list {
            background: #222;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .no-bookings {
            padding: 40px;
            text-align: center;
            color: #aaa;
            font-style: italic;
        }
        
        .bookings-table {
            display: flex;
            flex-direction: column;
        }
        
        .table-header {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 120px 80px 120px;
            gap: 16px;
            padding: 16px 20px;
            background: #333;
            font-weight: 600;
            color: #fff;
            border-bottom: 1px solid #444;
        }
        
        .table-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 120px 80px 120px;
            gap: 16px;
            padding: 16px 20px;
            border-bottom: 1px solid #333;
            align-items: center;
        }
        
        .table-row:hover {
            background: #2a2a2a;
        }
        
        .table-row:last-child {
            border-bottom: none;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            color: white;
        }
        
        .actions {
            display: flex;
            gap: 8px;
        }
        
        .actions .btn {
            padding: 4px 8px;
            font-size: 0.75rem;
        }
        
        .demo-controls {
            margin: 20px 0;
            text-align: center;
        }
        
        .btn-warning {
            background: #f39c12;
            color: white;
        }
        
        .btn-warning:hover {
            background: #e67e22;
        }
        
        .btn-info {
            background: #4BC0C0;
            color: white;
        }
        
        .btn-info:hover {
            background: #3BA8A8;
        }
    </style>
</head>
<body>
    <div class="bookings-dashboard">
        <h2>Business Bookings Dashboard</h2>

        <div class="summary-grid">
            <div class="summary-card">
                <h3>Today's Bookings</h3>
                <p class="metric-value" id="todaysCount">0</p>
            </div>
            <div class="summary-card">
                <h3>Total Bookings</h3>
                <p class="metric-value" id="totalCount">0</p>
            </div>
            <div class="summary-card">
                <h3>Completion Rate</h3>
                <p class="metric-value" id="completionRate">0.0%</p>
            </div>
            <div class="summary-card">
                <h3>Monthly Revenue</h3>
                <p class="metric-value" id="monthlyRevenue">£0.00</p>
            </div>
        </div>

        <div class="quick-actions">
            <button class="btn btn-primary" onclick="toggleCreateForm()">
                <span id="createFormToggle">Create Manual Booking</span>
            </button>
        </div>

        <div id="createBookingForm" class="create-booking-form" style="display: none;">
            <h3>Create New Booking</h3>
            <form onsubmit="createBooking(event)">
                <div class="form-group">
                    <label>Service</label>
                    <select id="serviceSelect" required>
                        <option value="">Select Service</option>
                    </select>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Customer Name</label>
                        <input type="text" id="customerName" required />
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" id="customerPhone" required />
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="customerEmail" />
                </div>
                
                <div class="form-group">
                    <label>Start Date & Time</label>
                    <input type="datetime-local" id="startDateTime" required />
                </div>
                
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="bookingNotes" rows="3"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">Create Booking</button>
                    <button type="button" class="btn btn-secondary" onclick="toggleCreateForm()">
                        Cancel
                    </button>
                </div>
            </form>
        </div>

        <div class="booking-tabs">
            <button class="tab active" onclick="setActiveTab('pending')">
                Pending (<span id="pendingCount">0</span>)
            </button>
            <button class="tab" onclick="setActiveTab('confirmed')">
                Confirmed (<span id="confirmedCount">0</span>)
            </button>
            <button class="tab" onclick="setActiveTab('completed')">
                Completed (<span id="completedCount">0</span>)
            </button>
            <button class="tab" onclick="setActiveTab('cancelled')">
                Cancelled (<span id="cancelledCount">0</span>)
            </button>
        </div>

        <div class="bookings-list">
            <div id="bookingsTable" class="bookings-table">
                <div class="table-header">
                    <div>Customer</div>
                    <div>Service</div>
                    <div>Date & Time</div>
                    <div>Status</div>
                    <div>Price</div>
                    <div>Actions</div>
                </div>
                <div id="bookingsList">
                    <div class="no-bookings">No bookings found for this status.</div>
                </div>
            </div>
        </div>
        
        <div class="demo-controls">
            <button class="btn btn-warning" onclick="generateSampleData()">Generate Sample Data</button>
            <button class="btn btn-info" onclick="simulateBooking()">Simulate New Booking</button>
            <button class="btn btn-danger" onclick="clearAllData()">Clear All Data</button>
        </div>
    </div>

    <script>
        let bookingsData = {
            todaysCount: 0,
            totalCount: 0,
            completionRate: 0,
            monthlyRevenue: 0
        };
        
        let services = [
            { _id: '1', name: 'Haircut', durationMinutes: 30, priceGBP: 25 },
            { _id: '2', name: 'Haircut & Styling', durationMinutes: 60, priceGBP: 45 },
            { _id: '3', name: 'Beard Trim', durationMinutes: 15, priceGBP: 15 },
            { _id: '4', name: 'Full Service', durationMinutes: 90, priceGBP: 65 }
        ];
        
        let bookings = [];
        let activeTab = 'pending';
        
        // Load data from localStorage
        function loadData() {
            const savedBookings = localStorage.getItem('businessBookings');
            if (savedBookings) {
                bookings = JSON.parse(savedBookings);
            }
            updateDisplay();
        }
        
        // Save data to localStorage
        function saveData() {
            localStorage.setItem('businessBookings', JSON.stringify(bookings));
        }
        
        // Update summary metrics
        function updateSummary() {
            const now = new Date();
            const today = now.toISOString().split('T')[0];
            
            // Today's bookings
            const todaysBookings = bookings.filter(b => 
                b.startISO.startsWith(today) && 
                (b.status === 'confirmed' || b.status === 'pending')
            );
            
            // Total bookings
            const totalBookings = bookings.length;
            
            // Completion rate (last 30 days)
            const thirtyDaysAgo = new Date(now.getTime() - (30 * 24 * 60 * 60 * 1000));
            const recentBookings = bookings.filter(b => new Date(b.createdAt) >= thirtyDaysAgo);
            const completedBookings = recentBookings.filter(b => b.status === 'completed');
            const completionRate = recentBookings.length > 0 ? (completedBookings.length / recentBookings.length) * 100 : 0;
            
            // Monthly revenue
            const thisMonth = now.getMonth();
            const thisYear = now.getFullYear();
            const monthlyBookings = bookings.filter(b => {
                const bookingDate = new Date(b.confirmedAt || b.createdAt);
                return bookingDate.getMonth() === thisMonth && 
                       bookingDate.getFullYear() === thisYear && 
                       b.status === 'completed';
            });
            const monthlyRevenue = monthlyBookings.reduce((sum, b) => sum + b.priceGBP, 0);
            
            bookingsData = {
                todaysCount: todaysBookings.length,
                totalCount: totalBookings,
                completionRate: completionRate,
                monthlyRevenue: monthlyRevenue
            };
        }
        
        // Update display
        function updateDisplay() {
            updateSummary();
            
            // Update summary cards
            document.getElementById('todaysCount').textContent = bookingsData.todaysCount;
            document.getElementById('totalCount').textContent = bookingsData.totalCount;
            document.getElementById('completionRate').textContent = bookingsData.completionRate.toFixed(1) + '%';
            document.getElementById('monthlyRevenue').textContent = '£' + bookingsData.monthlyRevenue.toFixed(2);
            
            // Update tab counts
            document.getElementById('pendingCount').textContent = bookings.filter(b => b.status === 'pending').length;
            document.getElementById('confirmedCount').textContent = bookings.filter(b => b.status === 'confirmed').length;
            document.getElementById('completedCount').textContent = bookings.filter(b => b.status === 'completed').length;
            document.getElementById('cancelledCount').textContent = bookings.filter(b => b.status === 'cancelled').length;
            
            // Update bookings list
            updateBookingsList();
        }
        
        // Update bookings list
        function updateBookingsList() {
            const filteredBookings = activeTab === 'all' ? bookings : bookings.filter(b => b.status === activeTab);
            const bookingsList = document.getElementById('bookingsList');
            
            if (filteredBookings.length === 0) {
                bookingsList.innerHTML = '<div class="no-bookings">No bookings found for this status.</div>';
                return;
            }
            
            bookingsList.innerHTML = filteredBookings.map(booking => {
                const service = services.find(s => s._id === booking.serviceId);
                const startDate = new Date(booking.startISO);
                const formattedDate = startDate.toLocaleDateString('en-GB', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const statusColor = {
                    'pending': '#f39c12',
                    'confirmed': '#2ecc71',
                    'completed': '#3498db',
                    'cancelled': '#e74c3c'
                }[booking.status] || '#95a5a6';
                
                let actions = '';
                if (booking.status === 'pending') {
                    actions = `
                        <button class="btn btn-sm btn-success" onclick="confirmBooking('${booking._id}')">Confirm</button>
                        <button class="btn btn-sm btn-danger" onclick="cancelBooking('${booking._id}')">Cancel</button>
                    `;
                }
                
                return `
                    <div class="table-row">
                        <div>
                            <strong>${booking.customer.name}</strong><br>
                            <small>${booking.customer.phone}</small>
                        </div>
                        <div>${service ? service.name : 'Unknown Service'}</div>
                        <div>${formattedDate}</div>
                        <div>
                            <span class="status-badge" style="background-color: ${statusColor}">
                                ${booking.status}
                            </span>
                        </div>
                        <div>£${booking.priceGBP}</div>
                        <div class="actions">${actions}</div>
                    </div>
                `;
            }).join('');
        }
        
        // Toggle create form
        function toggleCreateForm() {
            const form = document.getElementById('createBookingForm');
            const toggle = document.getElementById('createFormToggle');
            
            if (form.style.display === 'none') {
                form.style.display = 'block';
                toggle.textContent = 'Cancel';
                
                // Populate services dropdown
                const serviceSelect = document.getElementById('serviceSelect');
                serviceSelect.innerHTML = '<option value="">Select Service</option>' +
                    services.map(s => `<option value="${s._id}">${s.name} - ${s.durationMinutes}min - £${s.priceGBP}</option>`).join('');
            } else {
                form.style.display = 'none';
                toggle.textContent = 'Create Manual Booking';
            }
        }
        
        // Create booking
        function createBooking(event) {
            event.preventDefault();
            
            const serviceId = document.getElementById('serviceSelect').value;
            const customerName = document.getElementById('customerName').value;
            const customerPhone = document.getElementById('customerPhone').value;
            const customerEmail = document.getElementById('customerEmail').value;
            const startDateTime = document.getElementById('startDateTime').value;
            const notes = document.getElementById('bookingNotes').value;
            
            const service = services.find(s => s._id === serviceId);
            if (!service) return;
            
            const newBooking = {
                _id: Date.now().toString(),
                serviceId,
                customer: {
                    name: customerName,
                    phone: customerPhone,
                    email: customerEmail
                },
                startISO: new Date(startDateTime).toISOString(),
                endISO: new Date(new Date(startDateTime).getTime() + service.durationMinutes * 60000).toISOString(),
                status: 'pending',
                createdAt: new Date().toISOString(),
                confirmedAt: null,
                priceGBP: service.priceGBP,
                notes: notes,
                source: 'manual'
            };
            
            bookings.push(newBooking);
            saveData();
            updateDisplay();
            toggleCreateForm();
            
            // Reset form
            document.getElementById('serviceSelect').value = '';
            document.getElementById('customerName').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('customerEmail').value = '';
            document.getElementById('startDateTime').value = '';
            document.getElementById('bookingNotes').value = '';
        }
        
        // Set active tab
        function setActiveTab(tab) {
            activeTab = tab;
            
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            updateBookingsList();
        }
        
        // Confirm booking
        function confirmBooking(bookingId) {
            const booking = bookings.find(b => b._id === bookingId);
            if (booking) {
                booking.status = 'confirmed';
                booking.confirmedAt = new Date().toISOString();
                saveData();
                updateDisplay();
            }
        }
        
        // Cancel booking
        function cancelBooking(bookingId) {
            const reason = prompt('Cancellation reason:');
            if (reason) {
                const booking = bookings.find(b => b._id === bookingId);
                if (booking) {
                    booking.status = 'cancelled';
                    booking.cancelReason = reason;
                    saveData();
                    updateDisplay();
                }
            }
        }
        
        // Generate sample data
        function generateSampleData() {
            const sampleBookings = [
                {
                    _id: '1',
                    serviceId: '1',
                    customer: { name: 'John Smith', phone: '07123456789', email: 'john@example.com' },
                    startISO: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString(),
                    endISO: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000 + 30 * 60000).toISOString(),
                    status: 'pending',
                    createdAt: new Date().toISOString(),
                    confirmedAt: null,
                    priceGBP: 25,
                    notes: 'First time customer',
                    source: 'widget'
                },
                {
                    _id: '2',
                    serviceId: '2',
                    customer: { name: 'Sarah Johnson', phone: '07987654321', email: 'sarah@example.com' },
                    startISO: new Date(Date.now() + 1 * 24 * 60 * 60 * 1000).toISOString(),
                    endISO: new Date(Date.now() + 1 * 24 * 60 * 60 * 1000 + 60 * 60000).toISOString(),
                    status: 'confirmed',
                    createdAt: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
                    confirmedAt: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString(),
                    priceGBP: 45,
                    notes: 'Regular customer',
                    source: 'widget'
                },
                {
                    _id: '3',
                    serviceId: '3',
                    customer: { name: 'Mike Wilson', phone: '07111222333', email: 'mike@example.com' },
                    startISO: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString(),
                    endISO: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000 + 15 * 60000).toISOString(),
                    status: 'completed',
                    createdAt: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
                    confirmedAt: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
                    priceGBP: 15,
                    notes: 'Quick trim',
                    source: 'manual'
                }
            ];
            
            bookings = sampleBookings;
            saveData();
            updateDisplay();
        }
        
        // Simulate new booking
        function simulateBooking() {
            const service = services[Math.floor(Math.random() * services.length)];
            const customerNames = ['Alice Brown', 'David Lee', 'Emma Davis', 'Tom Wilson', 'Lisa Taylor'];
            const randomName = customerNames[Math.floor(Math.random() * customerNames.length)];
            const randomPhone = '07' + Math.floor(Math.random() * 100000000).toString().padStart(9, '0');
            
            const newBooking = {
                _id: Date.now().toString(),
                serviceId: service._id,
                customer: {
                    name: randomName,
                    phone: randomPhone,
                    email: randomName.toLowerCase().replace(' ', '.') + '@example.com'
                },
                startISO: new Date(Date.now() + Math.random() * 7 * 24 * 60 * 60 * 1000).toISOString(),
                endISO: new Date(Date.now() + Math.random() * 7 * 24 * 60 * 60 * 1000 + service.durationMinutes * 60000).toISOString(),
                status: 'pending',
                createdAt: new Date().toISOString(),
                confirmedAt: null,
                priceGBP: service.priceGBP,
                notes: 'Simulated booking',
                source: 'widget'
            };
            
            bookings.push(newBooking);
            saveData();
            updateDisplay();
        }
        
        // Clear all data
        function clearAllData() {
            if (confirm('Are you sure you want to clear all booking data?')) {
                bookings = [];
                saveData();
                updateDisplay();
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });
    </script>
</body>
</html>
