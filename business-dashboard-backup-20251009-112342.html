<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Business Dashboard - BlkPages</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #0A0A0A;
        }

        .gold-gradient-text {
            background: linear-gradient(90deg, #FFD35C, #D4AF37);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .hero-gradient-bg {
             background: radial-gradient(circle at center, rgba(212,175,55,0.35) 0%, rgba(212,175,55,0.15) 35%, #0A0A0A 80%);
        }
        
        .connect-gradient-bg {
             background: linear-gradient(180deg, #1A1A1A 0%, #0A0A0A 100%);
        }
        
        .cta-gradient-bg {
             background: linear-gradient(to bottom, #0a0a0a, #1a1a1a);
        }
        
        .gold-gradient-button {
             background: linear-gradient(90deg, #ffcc00, #ffb700);
        }
        
        .gold-gradient-button-hover:hover {
             background: linear-gradient(90deg, #ffb700, #ffd700);
        }

        /* ===============================
           🖋 BLKPAGES SEARCH SUBTEXT STYLE
           =============================== */

        .search-subtext {
         margin-top: 35px; /* increased spacing below search bar */
         display: flex;
         justify-content: center;
         align-items: center;
         flex-wrap: wrap;
         gap: 6px;
         font-size: 0.95rem;
         color: #CFCFCF; /* text colour */
         font-weight: 500;
         letter-spacing: 0.2px;
         text-align: center;
        }

        .search-subtext i {
         color: #FFD700; /* icon gold */
         font-size: 1rem;
        }

        /* Gold separator dot */
        .dot-separator {
         color: #D4AF37;
         padding: 0 6px;
        }

        /* ✨ Optional subtle pulse animation for icons */
        @keyframes goldPulse {
         0% { opacity: 0.7; transform: scale(1); }
         50% { opacity: 1; transform: scale(1.1); }
         100% { opacity: 0.7; transform: scale(1); }
        }

        .search-subtext i {
         animation: goldPulse 3s ease-in-out infinite;
        }

        /* 📱 Responsive for mobile */
        @media (max-width: 600px) {
         .search-subtext {
           flex-direction: column;
           gap: 4px;
           font-size: 0.9rem;
           margin-top: 25px; /* smaller space on mobile */
         }
         .dot-separator {
           display: none;
         }
        }

        /* Navigation Styles */
        .nav-link {
            transition: all 0.3s ease;
        }
        
        .nav-link:hover {
            color: #D4AF37 !important;
        }
        
        /* Customer Menu Styles */
        .customer-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            min-width: 150px;
            z-index: 1000;
            margin-top: 0.5rem;
        }
        
        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: #ffffff;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .dropdown-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .dropdown-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body class="text-white">
    <header class="bg-[rgba(10,10,10,0.95)] backdrop-blur-md sticky top-0 z-50 border-b border-[#9C7C2E]">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between py-3">
                <!-- Logo and Nav Links -->
                <div class="flex items-center gap-8">
                    <a href="index.html" class="text-2xl font-bold text-[#D4AF37] tracking-wide">BlkPages</a>
                    <nav class="hidden md:flex items-center gap-6">
                        <a href="index.html" class="nav-link text-gray-400 hover:text-[#D4AF37] transition-colors duration-300">Home</a>
                        <a href="search-results.html" class="nav-link text-gray-400 hover:text-[#D4AF37] transition-colors duration-300">Browse</a>
                        <a href="offers.html" class="nav-link text-gray-400 hover:text-[#D4AF37] transition-colors duration-300">Offers</a>
                        <a href="preview-test.html" class="nav-link text-gray-400 hover:text-[#D4AF37] transition-colors duration-300" style="background: linear-gradient(135deg, #FF3CAC, #784BA0); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 600;">
                            <i class="fas fa-flask mr-1"></i>Preview Test
                        </a>
                        <a href="demo-hub.html" class="nav-link text-gray-400 hover:text-[#D4AF37] transition-colors duration-300" style="background: linear-gradient(135deg, #3b82f6, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 600;">
                            <i class="fas fa-cogs mr-1"></i>Demo Hub
                        </a>
                        <a href="dummy-demo.html" class="nav-link text-gray-400 hover:text-[#D4AF37] transition-colors duration-300" style="background: linear-gradient(135deg, #10B981, #059669); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 600;">
                            <i class="fas fa-rocket mr-1"></i>Demo Showcase
                        </a>
                        <a href="demo/contextual-banners-demo.html" class="nav-link text-gray-400 hover:text-[#D4AF37] transition-colors duration-300" style="background: linear-gradient(135deg, #F59E0B, #D97706); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 600;">
                            <i class="fas fa-exclamation-triangle mr-1"></i>Banner Demo
                        </a>
                        <a href="business-profile.html" class="nav-link text-gray-400 hover:text-[#D4AF37] transition-colors duration-300" style="background: linear-gradient(135deg, #10B981, #059669); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 600;">
                            <i class="fas fa-clock mr-1"></i>WLO System
                        </a>
                    </nav>
                </div>

                <!-- Action Buttons -->
                <div class="hidden md:flex items-center gap-4">
                    <!-- Basket Icon -->
                    <div class="basket-icon" id="basketIcon" onclick="scrollToBooking()" style="position: relative; cursor: pointer; padding: 0.5rem; border-radius: 50%; background: rgba(13, 148, 136, 0.1); border: 1px solid rgba(13, 148, 136, 0.3); transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; width: 40px; height: 40px;">
                        <i class="fas fa-shopping-basket" style="color: #0D9488; font-size: 1.2rem;"></i>
                        <span class="basket-count" id="basketCount" style="position: absolute; top: -5px; right: -5px; background: #ff4444; color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: 600; border: 2px solid #1a1a1a;">0</span>
                    </div>
                    
                    <!-- Sign In / Sign Up (for signed out users) -->
                    <div class="auth-links" id="authLinks" style="align-items: center; gap: 0.5rem;">
                        <button id="loginBtn" class="text-white hover:text-[#D4AF37] transition-colors duration-300 text-sm" onclick="redirectToLogin()">
                            <i class="fas fa-sign-in-alt mr-1"></i>Sign In
                        </button>
                        <span class="text-gray-400">/</span>
                        <a href="#" onclick="redirectToRegister()" class="text-white hover:text-[#D4AF37] transition-colors duration-300 text-sm">
                            <i class="fas fa-user-plus mr-1"></i>Sign Up
                        </a>
                    </div>
                    
                    <!-- Customer Menu (for logged-in users) -->
                    <div class="customer-menu" id="customerMenu" style="display: none; position: relative;">
                        <button class="customer-initial" id="customerInitial" onclick="toggleCustomerMenu()" style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #0D9488, #10B981); color: white; border: none; font-size: 1.2rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(13, 148, 136, 0.3);">
                            <span id="customerInitialText">U</span>
                        </button>
                        <div class="customer-dropdown" id="customerDropdown">
                            <a href="customer-dashboard.html" class="dropdown-item">
                                <i class="fas fa-tachometer-alt"></i>
                                Dashboard
                            </a>
                            <a href="customer-dashboard.html" class="dropdown-item" onclick="redirectToAccountTab()">
                                <i class="fas fa-cog"></i>
                                Account Settings
                            </a>
                            <a href="#" onclick="signOut()" class="dropdown-item">
                                <i class="fas fa-sign-out-alt"></i>
                                Sign Out
                            </a>
                        </div>
                    </div>
                    
                    <!-- List Business Button -->
                    <a href="business-register.html" class="text-gray-400 hover:text-green-400 transition-colors duration-300 font-medium text-sm">+ List Business</a>
                </div>

                <!-- Mobile Menu Button -->
                <div class="md:hidden">
                    <button id="menu-btn" class="text-[#D4AF37] focus:outline-none" onclick="toggleMobileMenu()">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                    </button>
                </div>
            </div>
            <!-- Mobile Menu -->
            <div id="mobile-menu" class="hidden md:hidden pb-4">
                <a href="index.html" class="block py-2 text-gray-400 hover:text-[#D4AF37]">Home</a>
                <a href="search-results.html" class="block py-2 text-gray-400 hover:text-[#D4AF37]">Browse</a>
                <a href="offers.html" class="block py-2 text-gray-400 hover:text-[#D4AF37]">Offers</a>
                <a href="preview-test.html" class="block py-2 text-gray-400 hover:text-[#D4AF37]" style="background: linear-gradient(135deg, #FF3CAC, #784BA0); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 600;">
                    <i class="fas fa-flask mr-2"></i>Preview Test
                </a>
                <a href="business-register.html" class="block py-2 text-green-400 hover:text-green-300">
                    <i class="fas fa-plus mr-2"></i>List Business
                </a>
                <a href="#" onclick="redirectToLogin()" class="block py-2 mt-2 text-gray-200 border border-[#9C7C2E] rounded-md text-center hover:bg-[#111111]">Sign In</a>
                <a href="#" onclick="redirectToRegister()" class="block py-2 mt-2 text-black bg-gradient-to-r from-[#FFD35C] to-[#C68B1E] rounded-md text-center hover:opacity-90">Sign Up</a>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <main class="min-h-screen">
        <div class="container mx-auto px-4 py-8">
            <!-- Navigation --><!-- Dashboard Container --><div><!-- Sidebar --><aside><ul><li><a href="#" onclick="showSection('dashboard')"><i></i> Dashboard </a></li><li><a href="business-bookings-dashboard.html"><i></i> Bookings </a></li><li><a href="business-services-dashboard.html"><i></i> Services </a></li><li><a href="business-reviews-dashboard.html"><i></i> Reviews <span>1 new</span></a></li><li><a href="#" onclick="showSection('payouts')"><i></i> Payouts </a></li><li><a href="business-analytics-dashboard.html"><i></i> Analytics </a></li><li><a href="#" onclick="showSection('waiting-list')"><i></i> Waiting List <span>0</span></a></li><li><a href="business-loyalty-dashboard.html"><i></i> Loyalty Rewards </a></li></ul></aside><!-- Main Content --><main><!-- Dashboard Section --><div><div><h1>Business Dashboard</h1><p>Manage your business listing and track your performance</p></div><!-- Stats --><div><div><h3>127</h3><p>Total Reviews</p></div><div><h3>4.9</h3><p>Average Rating</p></div><div><h3>1,234</h3><p>Profile Views</p></div><div><h3>89</h3><p>Bookings This Month</p></div></div><!-- Loyalty Rewards Section --><div><h3>Loyalty Rewards</h3><div><div><div><div>Customer Loyalty Programme</div><div>Create loyalty programs to encourage repeat bookings and reward your customers</div></div><div><a href="business-loyalty-dashboard.html"><i></i> Manage Loyalty Programme </a></div></div></div></div><div><!-- Business Profile --><div><h3>Business Profile</h3><div><span>Business Name</span><span>Royal Hair Studio</span></div><div><span>Category</span><span>Hairdresser</span></div><div><span>Location</span><span>Beauty City, BC</span></div><div><span>Status</span><span>Active</span></div><div><span>Last Updated</span><span>2 days ago</span></div></div><!-- Subscription --><div><h3>Subscription Plan</h3><div><div>Professional Plan</div><div>£29/month</div><div>Included:</div><ul><li><i></i> Business listing with category visibility </li><li><i></i> Basic contact details </li><li><i></i> Standard search placement </li><li><i></i> Business logo and photo gallery (up to 10 photos) </li><li><i></i> Enhanced profile visibility </li><li><i></i> Customer review highlights </li><li><i></i> Basic booking system </li><li><i></i> Advanced booking system with calendar sync </li><li><i></i> Customer management dashboard </li><li><i></i> Priority placement in search </li><li><i></i> Basic analytics </li><li><i></i> Marketing tools </li></ul></div><a href="business-plan-management.html"><i></i> Manage Plan </a></div></div><!-- Booking Options Section --><div><h3>Booking Options</h3><div><div><div><div>Enable Pay at Venue</div><div>Allow customers to book now and pay you directly at your location</div></div><div><label><input type="checkbox" onchange="togglePayAtVenue()"><span></span></label><div><i></i><div> Customers can book now and pay you directly. You are responsible for collecting payment. </div></div></div></div><div><i></i><span>When enabled, customers will see a "Pay at Venue" option on your business profile. You are responsible for collecting payment and handling any payment-related issues.</span></div></div></div><!-- Payment Model Section --><div><h3>Payment Model Configuration</h3><div><div><div><div>Current Payment Model</div><div>How customers pay for your services</div></div><div><div><!-- Payment model will be loaded from registration data --></div></div></div><div><div><div>Payment Model Details</div><div>Detailed breakdown of your payment configuration</div></div><div><div><!-- Payment details will be populated by JavaScript --></div></div></div><div><i></i><span>Your payment model was set during business registration and cannot be changed here. Contact support if you need to modify your payment settings.</span></div></div></div><!-- Cancellation Policy Section --><div><h3>Cancellation Policy</h3><div><div><div><div>Cancellation Terms</div><div>Define your cancellation and refund policy for customers</div></div><div><select onchange="updateCancellationPolicy()"><option value="">Select Cancellation Policy</option><option value="flexible">Flexible - 24h notice for full refund</option><option value="moderate">Moderate - 48h notice for full refund</option><option value="strict">Strict - Non-refundable once confirmed</option><option value="custom">Custom (Professional Package Required)</option></select><div><i></i><span>This policy is set by Royal Hair Studio. BlkPages processes payments via Stripe on behalf of the venue but is not responsible for enforcing refunds.</span></div></div></div><div><div><label>Custom Cancellation Policy</label><textarea placeholder="Enter your custom cancellation policy..." onchange="updateCustomPolicy()" oninput="updateCustomPolicy()">[Business Name] – Cancellation Policy: Cancellations: You may cancel your appointment up to [X hours/days] before the scheduled time for a full refund. Late Cancellations: Cancellations made within [X hours/days] will be charged [X%] of the service price. No-Shows: If you do not attend your appointment without notice, you will be charged [100%] of the service price. Refunds: Refunds (where applicable) will be processed back to your original payment method within [X working days].</textarea><small>You can customize the policy text. Use [Business Name] to insert your business name automatically. Replace [X hours/days] and [X%] with your specific terms.</small></div></div><div><h4>Policy Preview</h4><div> Free cancellation up to 24 hours before appointment </div></div></div></div><!-- Loyalty Rewards Section --><div><h3>Loyalty Rewards</h3><div><div><div><div>Loyalty Program Type</div><div>Choose how customers earn rewards</div></div><div><select onchange="updateLoyaltyType()"><option value="">Select Loyalty Type</option><option value="visitBased">Visit-based: Book X visits, get reward</option><option value="spendBased">Spend-based: Spend £Y, get reward</option><option value="timeLimited">Time-limited: Book X visits within Z weeks, get reward</option></select></div></div><div><div><div>Threshold</div><div>Set the number of visits or amount to spend</div></div><div><input type="number" placeholder="Enter threshold" min="1"></div></div><div><div><div>Time Limit (Weeks)</div><div>How many weeks customers have to complete visits</div></div><div><input type="number" placeholder="Enter weeks" min="1"></div></div><div><div><div>Reward Type</div><div>What reward customers receive</div></div><div><select onchange="updateRewardType()"><option value="">Select Reward Type</option><option value="freeService">1 Free Service</option><option value="fixedDiscount">Fixed £ Discount</option><option value="percentageDiscount">% Discount</option></select></div></div><div><div><div>Reward Value</div><div>Set the discount amount or percentage</div></div><div><input type="number" placeholder="Enter value" min="1"></div></div><div><div><div>Customer Preview</div><div>How customers will see your loyalty program</div></div><div><div><div><i></i><span>Loyalty Rewards</span></div><div><!-- Preview content will be populated here --></div></div></div></div><div><div><div>Enable Loyalty Programme</div><div>Turn your loyalty programme on or off</div></div><div><label><input type="checkbox" onchange="toggleLoyaltyProgram()"><span></span></label></div></div><div><div><button onclick="saveLoyaltyProgram()"><i></i> Save Loyalty Program </button></div></div><!-- Loyalty Analytics Section --><div><h3>Loyalty Analytics</h3><div><div><div><h4>Customer Progress</h4><span>Anonymized customer data</span></div><div><!-- Customer progress items will be loaded here --></div></div><div><div><h4>Issued Rewards</h4><span>Reward codes and redemption status</span></div><div><!-- Issued rewards will be loaded here --></div></div></div></div></div></div><!-- Add-Ons Section --><div><h3>Add-Ons</h3><div><div><div><div>Premium Features</div><div>Additional features and tools to enhance your business listing</div></div><div><span><i></i> Available </span></div></div></div></div><!-- Action Buttons --><div><a href="business-booking-manager.html"><i></i> Generate Booking Link </a><a href="business-profile.html"><i></i> View Public Profile </a><a href="business-analytics-dashboard.html"><i></i> View Analytics </a><a href="business-bookings-dashboard.html"><i></i> Manage Bookings </a><a href="business-photo-upload.html"><i></i> Upload Photos </a></div></div><!-- Reviews Section --><div><div><h2>Customer Reviews</h2><div>3 Pending Reply</div></div><!-- Filters --><div><div><label for="ratingFilter">⭐ Rating</label><select onchange="filterReviews()"><option value="all">All Ratings</option><option value="5">5 Stars</option><option value="4">4 Stars</option><option value="3">3 Stars</option><option value="2">2 Stars</option><option value="1">1 Star</option></select></div><div><label for="dateFilter">📅 Date Range</label><select onchange="filterReviews()"><option value="all">All Time</option><option value="week">Last Week</option><option value="month">Last Month</option><option value="quarter">Last 3 Months</option></select></div><div><label for="replyFilter">📝 Reply Status</label><select onchange="filterReviews()"><option value="all">All Reviews</option><option value="pending">Pending Reply</option><option value="replied">Replied</option></select></div></div><!-- Reviews List --><div><!-- Review 1: Jane S. - 5 stars - Reply posted --><div data-rating="5" data-date="2024-01-15" data-reply="replied"><div><div><div>★★★★★</div><div><h4>Jane S.</h4><p>Haircut • Appointment: Jan 10, 2024</p><div>Booking Ref: #BK-2024-001</div></div></div><div><div>Review: Jan 15, 2024</div><span>Reply posted</span></div></div><div> "Great haircut and friendly staff! Sarah was amazing and really listened to what I wanted. The salon is clean and modern. Will definitely be back!" </div><div><div><h5>Your Reply</h5><span>Posted on Jan 15, 2024</span></div><div> "Thanks Jane, we look forward to seeing you again! Sarah will be thrilled to hear you enjoyed your visit." </div></div></div><!-- Review 2: Tom B. - 3 stars - No reply --><div data-rating="3" data-date="2024-01-14" data-reply="pending"><div><div><div>★★★☆☆</div><div><h4>Tom B.</h4><p>Massage • Appointment: Jan 12, 2024</p><div>Booking Ref: #BK-2024-002</div></div></div><div><div>Review: Jan 14, 2024</div><span>Reply pending</span></div></div><div> "Service was ok but waited 15 minutes past my appointment time. The massage itself was decent but the delay was frustrating." </div><div><textarea placeholder="Write your reply to Tom B..."></textarea><div><button onclick="submitReply(2)">Submit Reply</button><button onclick="cancelReply(2)">Cancel</button></div></div><button onclick="showReplyForm(2)">Reply</button></div><!-- Review 3: Sara L. - 4 stars - No reply --><div data-rating="4" data-date="2024-01-13" data-reply="pending"><div><div><div>★★★★☆</div><div><h4>Sara L.</h4><p>Manicure • Appointment: Jan 11, 2024</p><div>Booking Ref: #BK-2024-003</div></div></div><div><div>Review: Jan 13, 2024</div><span>Reply pending</span></div></div><div> "Good job, but polish chipped the next day. The technician was friendly and the salon was clean. Maybe need better quality polish?" </div><div><textarea placeholder="Write your reply to Sara L..."></textarea><div><button onclick="submitReply(3)">Submit Reply</button><button onclick="cancelReply(3)">Cancel</button></div></div><button onclick="showReplyForm(3)">Reply</button></div><!-- Review 4: Mike D. - 5 stars - No reply --><div data-rating="5" data-date="2024-01-12" data-reply="pending"><div><div><div>★★★★★</div><div><h4>Mike D.</h4><p>Beard Trim • Appointment: Jan 10, 2024</p><div>Booking Ref: #BK-2024-004</div></div></div><div><div>Review: Jan 12, 2024</div><span>Reply pending</span></div></div><div> "Perfect beard trim! The barber was professional and took his time. Great attention to detail. Highly recommend!" </div><div><textarea placeholder="Write your reply to Mike D..."></textarea><div><button onclick="submitReply(4)">Submit Reply</button><button onclick="cancelReply(4)">Cancel</button></div></div><button onclick="showReplyForm(4)">Reply</button></div></div></div><!-- Other sections (Bookings, Services, etc.) --><div><h2>Bookings Management</h2><p>Manage your appointments and availability here.</p></div><div><h2>Services Management</h2><p>Manage your services and pricing here.</p></div><div><h2>Payouts</h2><p>Track your earnings and payouts here.</p></div><div><h2>Analytics</h2><p>View detailed analytics and insights here.</p></div><!-- Waiting List Section --><div><div><h2>Waiting List</h2><p>Manage customers waiting for appointment slots</p></div><div><div><div>0</div><div>Total Waiting</div></div><div><div>0</div><div>Offers Sent</div></div><div><div>0</div><div>Accepted</div></div></div><div><button onclick="sendOfferToNextCustomer()"><i></i> Send Offer to Next Customer </button><button onclick="refreshWaitingList()"><i></i> Refresh List </button></div><div><div><select onchange="filterWaitingList()"><option value="all">All Status</option><option value="waiting">Waiting</option><option value="offered">Offered</option><option value="accepted">Accepted</option></select><select onchange="filterWaitingList()"><option value="all">All Services</option><option value="haircut">Haircut</option><option value="styling">Styling</option><option value="coloring">Coloring</option></select></div><div><!-- Waiting list items will be loaded here --></div></div></div><!-- Loyalty Rewards Tab --><div><div><h2>Loyalty Rewards Programme</h2><p>Create and manage customer loyalty programs to encourage repeat bookings</p></div><div><!-- Loyalty Program Configuration --><div><h3>Configure Your Loyalty Programme</h3><div><!-- Loyalty Type --><div><label for="tabLoyaltyType">Loyalty Program Type</label><select onchange="updateTabLoyaltyType()"><option value="">Select Loyalty Type</option><option value="visitBased">Visit-based: Book X visits, get reward</option><option value="spendBased">Spend-based: Spend £Y, get reward</option><option value="timeLimited">Time-limited: Book X visits within Z weeks, get reward</option></select><small>Choose how customers earn rewards</small></div><!-- Threshold Setting --><div><label for="tabLoyaltyThreshold">Threshold</label><input type="number" placeholder="Enter threshold" min="1" onchange="updateTabLoyaltyPreview()"><small>Set the number of visits or amount to spend</small></div><!-- Time Limit Setting --><div><label for="tabLoyaltyTimeLimit">Time Limit (Weeks)</label><input type="number" placeholder="Enter weeks" min="1" onchange="updateTabLoyaltyPreview()"><small>How many weeks customers have to complete visits</small></div><!-- Reward Type --><div><label for="tabRewardType">Reward Type</label><select onchange="updateTabRewardType()"><option value="">Select Reward Type</option><option value="freeService">1 Free Service</option><option value="fixedDiscount">Fixed £ Discount</option><option value="percentageDiscount">% Discount</option></select><small>What reward customers receive</small></div><!-- Reward Value --><div><label for="tabLoyaltyRewardValue">Reward Value</label><input type="number" placeholder="Enter value" min="1" onchange="updateTabLoyaltyPreview()"><small>Set the discount amount or percentage</small></div><!-- Expiry Days --><div><label for="tabLoyaltyExpiryDays">Reward Expiry Days</label><input type="number" placeholder="Enter days" min="1" max="365" onchange="updateTabLoyaltyPreview()"><small>How many days customers have to use their reward (1-365 days)</small></div><!-- Terms --><div><label for="tabLoyaltyTerms">Terms & Conditions</label><textarea placeholder="Enter terms and conditions (optional)" rows="3" onchange="updateTabLoyaltyPreview()"></textarea><small>Optional terms and conditions for your loyalty programme</small></div><!-- Enable Toggle --><div><label>Enable Loyalty Programme</label><div><label><input type="checkbox" onchange="updateTabLoyaltyPreview()"><span></span></label><span>Turn your loyalty programme on or off</span></div></div><!-- Save Button --><div><button onclick="saveTabLoyaltyProgram()"><i></i> Save Programme </button></div></div></div><!-- Customer Preview --><div><h3>Customer Preview</h3><div><div><i></i><span>How customers will see your loyalty program</span></div><div><!-- Preview content will be populated here --></div></div></div><!-- Dummy Data Examples --><div><h3>Example Loyalty Programmes</h3><div><div><div><i></i><h4>Glow Hair</h4></div><div><p><strong>Type:</strong> Visit-based</p><p><strong>Threshold:</strong> 5 visits</p><p><strong>Reward:</strong> Free haircut</p><p><strong>Customer sees:</strong> "3 of 5 visits complete. Reward: Free haircut."</p></div></div><div><div><i></i><h4>Zen Spa</h4></div><div><p><strong>Type:</strong> Spend-based</p><p><strong>Threshold:</strong> £100 spend</p><p><strong>Reward:</strong> £10 credit</p><p><strong>Customer sees:</strong> "£75 of £100 spent. Reward: £10 off next booking."</p></div></div><div><div><i></i><h4>Fit Gym</h4></div><div><p><strong>Type:</strong> Time-limited</p><p><strong>Threshold:</strong> 3 visits in 6 weeks</p><p><strong>Reward:</strong> 50% off</p><p><strong>Customer sees:</strong> "2 of 3 visits complete (4 weeks remaining). Reward: 50% off next booking."</p></div></div></div></div></div></div></main></div><!-- Loyalty Rewards Modal --><div><div><div><h2><i></i> Loyalty Rewards Programme </h2><button onclick="closeLoyaltyModal()"><i></i></button></div><div><form><!-- Loyalty Type --><div><label for="modalLoyaltyType">Loyalty Program Type</label><select onchange="updateModalLoyaltyType()"><option value="">Select Loyalty Type</option><option value="visitBased">Visit-based: Book X visits, get reward</option><option value="spendBased">Spend-based: Spend £Y, get reward</option><option value="timeLimited">Time-limited: Book X visits within Z weeks, get reward</option></select><small>Choose how customers earn rewards</small></div><!-- Threshold Setting --><div><label for="modalLoyaltyThreshold">Threshold</label><input type="number" placeholder="Enter threshold" min="1" onchange="updateModalLoyaltyPreview()"><small>Set the number of visits or amount to spend</small></div><!-- Time Limit Setting --><div><label for="modalLoyaltyTimeLimit">Time Limit (Weeks)</label><input type="number" placeholder="Enter weeks" min="1" onchange="updateModalLoyaltyPreview()"><small>How many weeks customers have to complete visits</small></div><!-- Reward Type --><div><label for="modalRewardType">Reward Type</label><select onchange="updateModalRewardType()"><option value="">Select Reward Type</option><option value="freeService">1 Free Service</option><option value="fixedDiscount">Fixed £ Discount</option><option value="percentageDiscount">% Discount</option></select><small>What reward customers receive</small></div><!-- Reward Value --><div><label for="modalLoyaltyRewardValue">Reward Value</label><input type="number" placeholder="Enter value" min="1" onchange="updateModalLoyaltyPreview()"><small>Set the discount amount or percentage</small></div><!-- Preview --><div><div><i></i> Customer Preview </div><div><!-- Preview content will be populated here --></div></div><!-- Enable Toggle --><div><label>Enable Loyalty Programme</label><div><label><input type="checkbox" onchange="updateModalLoyaltyPreview()"><span></span></label><span>Turn your loyalty programme on or off</span></div></div></form></div><div><button onclick="closeLoyaltyModal()"><i></i> Cancel </button><button onclick="saveModalLoyaltyProgram()"><i></i> Save Programme </button></div></div></div><!-- Footer --><script> // Load business data from registration function loadBusinessData() { // Try to load from localStorage first (from business registration) const businessRegistrationData = localStorage.getItem('businessRegistrationData'); if (businessRegistrationData) { try { return JSON.parse(businessRegistrationData); } catch (e) { console.error('Error parsing business registration data:', e); } } // Fallback to business manager if available if (typeof window.businessManager !== 'undefined') { const businesses = window.businessManager.getBusinesses(); if (businesses.length > 0) { // Return the first business data (in real app, would match current business) return businesses[0]; } } // Default fallback data return { paymentModel: 'deposit-balance', depositPercentage: '30', businessName: 'Royal Hair Studio' }; } // Get current business plan function getCurrentBusinessPlan() { const businessData = loadBusinessData(); return businessData.selectedTier || 'free'; // Default to free, only show custom for professional } // Update payment model display function updatePaymentModelDisplay() { const businessData = loadBusinessData(); const currentPaymentModel = document.getElementById('currentPaymentModel'); const paymentModelDetails = document.getElementById('paymentModelDetails'); const paymentModel = businessData.paymentModel || 'deposit-balance'; const depositPercentage = parseInt(businessData.depositPercentage) || 30; const businessName = businessData.businessName || 'Royal Hair Studio'; // Update current payment model display let modelTitle = ''; let modelDescription = ''; switch (paymentModel) { case 'full-online': modelTitle = 'Full Payment Online'; modelDescription = 'Customers pay the full amount online when booking'; break; case 'deposit-balance': modelTitle = `Deposit + Balance (${depositPercentage}%)`; modelDescription = `Customers pay ${depositPercentage}% deposit online, balance at venue`; break; case 'full-venue': modelTitle = 'Full Payment at Venue'; modelDescription = 'Customers pay the full amount when they arrive'; break; default: modelTitle = 'Deposit + Balance (30%)'; modelDescription = 'Customers pay 30% deposit online, balance at venue'; } currentPaymentModel.innerHTML = modelTitle; // Update payment model details let detailsHTML = ` <div><i></i><h4>${modelTitle}</h4></div><div> ${modelDescription} </div><div><h5>How it works:</h5><ul> `; switch (paymentModel) { case 'full-online': detailsHTML += ` <li><i></i> Customer selects services and books appointment</li><li><i></i> Full payment is processed online via Stripe</li><li><i></i> No additional payment required at venue</li><li><i></i> Payment is secure and encrypted</li> `; break; case 'deposit-balance': detailsHTML += ` <li><i></i> Customer selects services and books appointment</li><li><i></i> ${depositPercentage}% deposit is processed online via Stripe</li><li><i></i> Remaining balance is paid at the venue</li><li><i></i> Deposit secures the booking</li> `; break; case 'full-venue': detailsHTML += ` <li><i></i> Customer selects services and books appointment</li><li><i></i> No online payment required</li><li><i></i> Full payment is made at the venue</li><li><i></i> You collect payment directly</li> `; break; } detailsHTML += ` </ul></div> `; paymentModelDetails.innerHTML = detailsHTML; } // Load and update analytics data function loadAnalyticsData() { const businessId = 'royalHairStudio'; const analyticsData = JSON.parse(localStorage.getItem('businessAnalytics') || '{}'); if (analyticsData[businessId]) { const data = analyticsData[businessId]; const today = new Date().toISOString().split('T')[0]; const todayViews = data.dailyViews[today] || 0; // Update the stat cards on the dashboard updateDashboardStat('Profile Views', data.totalViews || 0); updateDashboardStat('Rating', '4.6'); // Keep static for now updateDashboardStat('Reviews', '89'); // Keep static for now updateDashboardStat('Bookings This Month', data.enquiries || 0); // Use real enquiries data console.log('Dashboard analytics updated:', { totalViews: data.totalViews, todayViews: todayViews }); } } function updateDashboardStat(label, value) { const statCards = document.querySelectorAll('.stat-card'); statCards.forEach(card => { const labelElement = card.querySelector('p'); if (labelElement && labelElement.textContent.trim() === label) { const numberElement = card.querySelector('h3'); if (numberElement) { numberElement.textContent = value; console.log(`Dashboard updated ${label} to ${value}`); } } }); } // Listen for analytics updates window.addEventListener('analyticsUpdated', function(e) { console.log('Dashboard received analytics update:', e.detail); loadAnalyticsData(); }); // Listen for storage changes window.addEventListener('storage', function(e) { if (e.key === 'businessAnalytics') { loadAnalyticsData(); } }); // Check if user is logged in document.addEventListener('DOMContentLoaded', function() { const isLoggedIn = localStorage.getItem('businessLoggedIn'); console.log('Checking login status:', isLoggedIn); // Load and display payment model updatePaymentModelDisplay(); // Update cancellation policy based on current plan updateCancellationPolicy(); // Load analytics data loadAnalyticsData(); // Setup booking event listeners setupBusinessBookingEventListeners(); // Load loyalty analytics loadLoyaltyAnalytics(); if (isLoggedIn !== 'true') { console.log('User not logged in, but allowing access for testing'); // Set demo login status for testing localStorage.setItem('businessLoggedIn', 'true'); localStorage.setItem('businessEmail', 'demo@royalhairstudio.com'); localStorage.setItem('businessLoginTime', new Date().toISOString()); } else { console.log('User is logged in, showing dashboard'); } // Set user email const userEmail = localStorage.getItem('businessEmail') || 'demo@royalhairstudio.com'; const userEmailElement = document.getElementById('userEmail'); if (userEmailElement) { userEmailElement.textContent = userEmail; } // Load saved settings const payAtVenueEnabled = localStorage.getItem('payAtVenueEnabled'); if (payAtVenueEnabled === 'true') { document.getElementById('payAtVenueToggle').checked = true; document.getElementById('payAtVenueDisclaimer').style.display = 'flex'; } // Check if loyalty add-on is active and show/hide tab const loyaltyAddonActive = localStorage.getItem('loyaltyAddonActive') === 'true'; const loyaltyTab = document.getElementById('loyaltyTab'); if (loyaltyTab) { // Always show tab for testing purposes loyaltyTab.style.display = 'block'; console.log('Loyalty tab is visible for testing'); // Log add-on status if (loyaltyAddonActive) { console.log('Loyalty add-on is active'); } else { console.log('Loyalty add-on is not active (but tab is visible for testing)'); } } }); function logout() { localStorage.removeItem('businessLoggedIn'); localStorage.removeItem('businessEmail'); localStorage.removeItem('businessLoginTime'); window.location.href = 'business-login.html'; } function togglePayAtVenue() { const toggle = document.getElementById('payAtVenueToggle'); const disclaimer = document.getElementById('payAtVenueDisclaimer'); if (toggle.checked) { disclaimer.style.display = 'flex'; localStorage.setItem('payAtVenueEnabled', 'true'); localStorage.setItem('royalHairStudioPayAtVenue', 'true'); console.log('Pay at Venue enabled'); } else { disclaimer.style.display = 'none'; localStorage.setItem('payAtVenueEnabled', 'false'); localStorage.setItem('royalHairStudioPayAtVenue', 'false'); console.log('Pay at Venue disabled'); } } function updateCancellationPolicy() { const policySelect = document.getElementById('cancellationPolicy'); const customPolicy = document.getElementById('customPolicy'); const previewContent = document.getElementById('previewContent'); const businessName = 'Royal Hair Studio'; // In real implementation, get from business data // Check if business has Professional package specifically const currentPlan = getCurrentBusinessPlan(); const hasProfessionalPlan = currentPlan === 'professional'; // Show/hide custom option based on Professional package if (hasProfessionalPlan) { document.getElementById('customOption').style.display = 'block'; } else { document.getElementById('customOption').style.display = 'none'; if (policySelect.value === 'custom') { policySelect.value = ''; return; } } const policies = { 'flexible': `${businessName} – Cancellation Policy: You may cancel your booking up to 24 hours before your appointment for a full refund. Cancellations made within 24 hours and no-shows will be charged 100% of the service price. Refunds are returned to your original payment method within 5–10 business days.`, 'moderate': `${businessName} – Cancellation Policy: You may cancel your booking up to 48 hours before your appointment for a full refund. Cancellations made within 48 hours will be charged 50% of the service price. No-shows will be charged 100% of the service price. Refunds are returned to your original payment method within 5–10 business days.`, 'strict': `${businessName} – Cancellation Policy: This booking is non-refundable once confirmed. No-shows will be charged 100% of the service price. Refunds are returned to your original payment method within 5–10 business days.`, 'custom': 'Custom policy - edit the text above to define your terms' }; if (policySelect.value === 'custom') { customPolicy.style.display = 'block'; previewContent.textContent = policies[policySelect.value]; } else if (policySelect.value === '') { customPolicy.style.display = 'none'; previewContent.textContent = 'Select a cancellation policy to see preview...'; } else { customPolicy.style.display = 'none'; previewContent.textContent = policies[policySelect.value]; } // Save to localStorage localStorage.setItem('cancellationPolicy', policySelect.value); if (policySelect.value === 'custom') { const customText = document.getElementById('customPolicyText').value; localStorage.setItem('customPolicyText', customText); } } function updateCustomPolicy() { const customText = document.getElementById('customPolicyText'); const previewContent = document.getElementById('previewContent'); previewContent.textContent = customText.value || 'Enter your custom policy above...'; localStorage.setItem('customPolicyText', customText.value); } function manageSubscription() { alert('Redirecting to subscription management page...\n\nThis would normally take you to a payment portal where you can:\n- Update payment method\n- Change subscription plan\n- View billing history\n- Cancel subscription'); } // Navigation functionality function showSection(sectionId) { console.log('showSection called with:', sectionId); // Hide all sections document.querySelectorAll('.content-section').forEach(section => { section.classList.remove('active'); }); // Remove active class from all sidebar links document.querySelectorAll('.sidebar-menu a').forEach(link => { link.classList.remove('active'); }); // Show selected section const targetSection = document.getElementById(sectionId); if (targetSection) { targetSection.classList.add('active'); console.log('Section', sectionId, 'is now active'); } else { console.error('Section not found:', sectionId); } // Add active class to clicked link if (event && event.target) { event.target.classList.add('active'); } // Hide reviews badge when viewing reviews if (sectionId === 'reviews') { document.getElementById('reviewsBadge').style.display = 'none'; } } // Enhanced Reviews functionality with Professional plan checks async function showReplyForm(reviewId) { // Check if business has Professional plan const canReply = await checkBusinessReplyCapability(); if (!canReply) { showUpgradeModal(); return; } const form = document.getElementById(`replyForm-${reviewId}`); if (form) { form.style.display = 'block'; } } function cancelReply(reviewId) { const form = document.getElementById(`replyForm-${reviewId}`); if (form) { form.style.display = 'none'; form.querySelector('textarea').value = ''; } } async function submitReply(reviewId) { // Check if business has Professional plan const canReply = await checkBusinessReplyCapability(); if (!canReply) { showUpgradeModal(); return; } const form = document.getElementById(`replyForm-${reviewId}`); const textarea = form.querySelector('textarea'); const replyText = textarea.value.trim(); if (!replyText) { showNotification('Please enter a reply before submitting.', 'error'); return; } // Validate reply length if (replyText.length < 10) { showNotification('Reply must be at least 10 characters long.', 'error'); return; } if (replyText.length > 500) { showNotification('Reply must be 500 characters or less.', 'error'); return; } try { // Show loading state const submitBtn = form.querySelector('.btn-reply'); const originalText = submitBtn.textContent; submitBtn.textContent = 'Submitting...'; submitBtn.disabled = true; // Submit reply to backend const response = await submitBusinessReply(reviewId, replyText); if (response.success) { // Create reply element const reviewCard = form.closest('.review-card'); const replyElement = document.createElement('div'); replyElement.className = 'review-reply'; replyElement.innerHTML = ` <div><h5>Your Reply</h5><span>Posted on ${new Date().toLocaleDateString()}</span></div><div>${replyText}</div> `; // Replace form with reply form.parentNode.replaceChild(replyElement, form); // Update review card data reviewCard.setAttribute('data-reply', 'replied'); reviewCard.classList.remove('new'); // Update status badge updatePendingCount(); showNotification('Reply submitted successfully!', 'success'); } else { showNotification(response.message || 'Failed to submit reply. Please try again.', 'error'); } } catch (error) { console.error('Error submitting reply:', error); showNotification('Failed to submit reply. Please try again.', 'error'); } finally { // Reset button state const submitBtn = form.querySelector('.btn-reply'); if (submitBtn) { submitBtn.textContent = 'Submit Reply'; submitBtn.disabled = false; } } } // Check if business can reply (Professional plan only) async function checkBusinessReplyCapability() { try { // Get business plan from localStorage or API const businessPlan = localStorage.getItem('businessPlan') || 'Basic'; return businessPlan === 'Professional'; } catch (error) { console.error('Error checking business plan:', error); return false; } } // Show upgrade modal for non-Professional plans function showUpgradeModal() { const modal = document.createElement('div'); modal.className = 'modal-overlay'; modal.innerHTML = ` <div><div><h3>Upgrade to Professional Plan</h3><button onclick="closeModal()">&times;</button></div><div><p>Reply to customer reviews is a Professional plan feature.</p><p>Upgrade now to engage with your customers and build better relationships!</p><div><h4>Professional Plan Benefits:</h4><ul><li>✓ Reply to customer reviews</li><li>✓ Advanced analytics</li><li>✓ Priority support</li><li>✓ Custom branding</li></ul></div></div><div><button onclick="upgradeToProfessional()">Upgrade Now</button><button onclick="closeModal()">Maybe Later</button></div></div> `; document.body.appendChild(modal); } function closeModal() { const modal = document.querySelector('.modal-overlay'); if (modal) { modal.remove(); } } function upgradeToProfessional() { // Redirect to upgrade page or handle upgrade window.location.href = '/upgrade?plan=professional'; } // Enhanced notification system function showNotification(message, type = 'info') { const notification = document.createElement('div'); notification.className = `notification notification-${type}`; notification.textContent = message; // Add to page document.body.appendChild(notification); // Auto remove after 5 seconds setTimeout(() => { if (notification.parentNode) { notification.parentNode.removeChild(notification); } }, 5000); } // Submit business reply to backend async function submitBusinessReply(reviewId, replyText) { try { const response = await fetch('/api/reviews/reply', { method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${localStorage.getItem('businessToken')}` }, body: JSON.stringify({ reviewId: reviewId, replyText: replyText }) }); return await response.json(); } catch (error) { console.error('Error submitting reply:', error); return { success: false, message: 'Network error' }; } } function filterReviews() { const ratingFilter = document.getElementById('ratingFilter').value; const dateFilter = document.getElementById('dateFilter').value; const replyFilter = document.getElementById('replyFilter').value; const reviews = document.querySelectorAll('.review-card'); reviews.forEach(review => { let show = true; // Rating filter if (ratingFilter !== 'all' && review.getAttribute('data-rating') !== ratingFilter) { show = false; } // Reply status filter if (replyFilter !== 'all' && review.getAttribute('data-reply') !== replyFilter) { show = false; } // Date filter (simplified) if (dateFilter !== 'all') { const reviewDate = new Date(review.getAttribute('data-date')); const now = new Date(); const daysDiff = (now - reviewDate) / (1000 * 60 * 60 * 24); if (dateFilter === 'week' && daysDiff > 7) show = false; if (dateFilter === 'month' && daysDiff > 30) show = false; if (dateFilter === 'quarter' && daysDiff > 90) show = false; } review.style.display = show ? 'block' : 'none'; }); } function updatePendingCount() { const pendingReviews = document.querySelectorAll('.review-card[data-reply="pending"]'); const pendingCount = pendingReviews.length; const badge = document.getElementById('reviewsBadge'); if (pendingCount > 0) { badge.textContent = `${pendingCount} new`; badge.style.display = 'inline-block'; } else { badge.style.display = 'none'; } } // Initialize reviews badge document.addEventListener('DOMContentLoaded', function() { updatePendingCount(); loadBookingOptions(); }); function loadBookingOptions() { const payAtVenueEnabled = localStorage.getItem('royalHairStudioPayAtVenue'); const toggle = document.getElementById('payAtVenueToggle'); const disclaimer = document.getElementById('payAtVenueDisclaimer'); if (payAtVenueEnabled === 'true') { toggle.checked = true; disclaimer.style.display = 'flex'; } else { toggle.checked = false; disclaimer.style.display = 'none'; } } // Loyalty Rewards Modal Functions function openLoyaltyModal() { console.log('Opening loyalty modal'); const modal = document.getElementById('loyaltyModal'); if (modal) { modal.classList.add('active'); document.body.style.overflow = 'hidden'; // Prevent background scrolling // Load existing loyalty program if available loadExistingLoyaltyProgram(); } else { console.error('Loyalty modal not found'); alert('Loyalty modal not found. Please refresh the page.'); } } function closeLoyaltyModal() { console.log('Closing loyalty modal'); const modal = document.getElementById('loyaltyModal'); if (modal) { modal.classList.remove('active'); document.body.style.overflow = 'auto'; // Restore scrolling } } function loadExistingLoyaltyProgram() { const savedProgram = localStorage.getItem('loyaltyProgram'); if (savedProgram) { try { const program = JSON.parse(savedProgram); document.getElementById('modalLoyaltyType').value = program.type || ''; document.getElementById('modalLoyaltyThreshold').value = program.threshold || ''; document.getElementById('modalLoyaltyTimeLimit').value = program.timeLimit || ''; document.getElementById('modalRewardType').value = program.rewardType || ''; document.getElementById('modalLoyaltyRewardValue').value = program.rewardValue || ''; document.getElementById('modalLoyaltyEnabled').checked = program.isActive || false; // Update form visibility updateModalLoyaltyType(); updateModalRewardType(); updateModalLoyaltyPreview(); } catch (e) { console.error('Error loading loyalty program:', e); } } } function updateModalLoyaltyType() { const loyaltyType = document.getElementById('modalLoyaltyType').value; const thresholdSetting = document.getElementById('modalThresholdSetting'); const timeLimitSetting = document.getElementById('modalTimeLimitSetting'); const rewardTypeSetting = document.getElementById('modalRewardTypeSetting'); const thresholdDescription = document.getElementById('modalThresholdDescription'); // Show threshold setting for all types thresholdSetting.style.display = 'block'; // Show time limit only for time-limited if (loyaltyType === 'timeLimited') { timeLimitSetting.style.display = 'block'; thresholdDescription.textContent = 'Set the number of visits to complete'; } else { timeLimitSetting.style.display = 'none'; if (loyaltyType === 'visitBased') { thresholdDescription.textContent = 'Set the number of visits required'; } else if (loyaltyType === 'spendBased') { thresholdDescription.textContent = 'Set the amount to spend (£)'; } } // Show reward type setting rewardTypeSetting.style.display = 'block'; updateModalLoyaltyPreview(); } function updateLoyaltyType() { const loyaltyType = document.getElementById('loyaltyType').value; const thresholdSetting = document.getElementById('thresholdSetting'); const timeLimitSetting = document.getElementById('timeLimitSetting'); const rewardTypeSetting = document.getElementById('rewardTypeSetting'); const thresholdDescription = document.getElementById('thresholdDescription'); // Show threshold setting for all types thresholdSetting.style.display = 'block'; // Show time limit only for time-limited if (loyaltyType === 'timeLimited') { timeLimitSetting.style.display = 'block'; thresholdDescription.textContent = 'Set the number of visits to complete'; } else { timeLimitSetting.style.display = 'none'; if (loyaltyType === 'visitBased') { thresholdDescription.textContent = 'Set the number of visits required'; } else if (loyaltyType === 'spendBased') { thresholdDescription.textContent = 'Set the amount to spend (£)'; } } // Show reward type setting rewardTypeSetting.style.display = 'block'; updateLoyaltyPreview(); } function updateModalRewardType() { const rewardType = document.getElementById('modalRewardType').value; const rewardValueSetting = document.getElementById('modalRewardValueSetting'); const rewardValueDescription = document.getElementById('modalRewardValueDescription'); if (rewardType) { rewardValueSetting.style.display = 'block'; if (rewardType === 'freeService') { rewardValueDescription.textContent = 'No value needed for free service'; document.getElementById('modalLoyaltyRewardValue').style.display = 'none'; } else if (rewardType === 'fixedDiscount') { rewardValueDescription.textContent = 'Set the discount amount (£)'; document.getElementById('modalLoyaltyRewardValue').style.display = 'block'; document.getElementById('modalLoyaltyRewardValue').placeholder = 'Enter discount amount'; } else if (rewardType === 'percentageDiscount') { rewardValueDescription.textContent = 'Set the discount percentage (%)'; document.getElementById('modalLoyaltyRewardValue').style.display = 'block'; document.getElementById('modalLoyaltyRewardValue').placeholder = 'Enter percentage'; } } else { rewardValueSetting.style.display = 'none'; } updateModalLoyaltyPreview(); } function updateRewardType() { const rewardType = document.getElementById('rewardType').value; const rewardValueSetting = document.getElementById('rewardValueSetting'); const rewardValueDescription = document.getElementById('rewardValueDescription'); if (rewardType) { rewardValueSetting.style.display = 'block'; if (rewardType === 'freeService') { rewardValueDescription.textContent = 'No value needed for free service'; document.getElementById('loyaltyRewardValue').style.display = 'none'; } else if (rewardType === 'fixedDiscount') { rewardValueDescription.textContent = 'Set the discount amount (£)'; document.getElementById('loyaltyRewardValue').style.display = 'block'; document.getElementById('loyaltyRewardValue').placeholder = 'Enter discount amount'; } else if (rewardType === 'percentageDiscount') { rewardValueDescription.textContent = 'Set the discount percentage (%)'; document.getElementById('loyaltyRewardValue').style.display = 'block'; document.getElementById('loyaltyRewardValue').placeholder = 'Enter percentage'; } } else { rewardValueSetting.style.display = 'none'; } updateLoyaltyPreview(); } function updateModalLoyaltyPreview() { const loyaltyType = document.getElementById('modalLoyaltyType').value; const threshold = document.getElementById('modalLoyaltyThreshold').value; const timeLimit = document.getElementById('modalLoyaltyTimeLimit').value; const rewardType = document.getElementById('modalRewardType').value; const rewardValue = document.getElementById('modalLoyaltyRewardValue').value; const loyaltyEnabled = document.getElementById('modalLoyaltyEnabled').checked; if (!loyaltyType || !threshold || !rewardType) { document.getElementById('modalLoyaltyPreview').style.display = 'none'; return; } // Show preview document.getElementById('modalLoyaltyPreview').style.display = 'block'; // Generate preview content let previewText = ''; let progressText = ''; if (loyaltyType === 'visitBased') { previewText = `Book ${threshold} visits, get reward`; progressText = `0 of ${threshold} visits complete`; } else if (loyaltyType === 'spendBased') { previewText = `Spend £${threshold}, get reward`; progressText = `£0 of £${threshold} spent`; } else if (loyaltyType === 'timeLimited') { previewText = `Book ${threshold} visits within ${timeLimit} weeks, get reward`; progressText = `0 of ${threshold} visits complete (${timeLimit} weeks remaining)`; } let rewardText = ''; if (rewardType === 'freeService') { rewardText = '1 Free Service'; } else if (rewardType === 'fixedDiscount') { rewardText = `£${rewardValue} off next booking`; } else if (rewardType === 'percentageDiscount') { rewardText = `${rewardValue}% off next booking`; } const statusText = loyaltyEnabled ? 'Active' : 'Inactive'; const statusColor = loyaltyEnabled ? '#28a745' : '#dc3545'; const previewContent = ` <div><div>${previewText}</div><div>${progressText}</div><div><div></div></div></div><div><div>🎁 Reward</div><div>${rewardText}</div></div><div><div>📱 Customer Preview</div><div> Status: <strong>${statusText}</strong><br> Your customers will see: <strong>${progressText}</strong><br> Reward: <strong>${rewardText}</strong></div></div> `; document.getElementById('modalLoyaltyPreviewContent').innerHTML = previewContent; } function updateLoyaltyPreview() { const loyaltyType = document.getElementById('loyaltyType').value; const threshold = document.getElementById('loyaltyThreshold').value; const timeLimit = document.getElementById('loyaltyTimeLimit').value; const rewardType = document.getElementById('rewardType').value; const rewardValue = document.getElementById('loyaltyRewardValue').value; if (!loyaltyType || !threshold || !rewardType) { document.getElementById('loyaltyPreview').style.display = 'none'; return; } // Show preview document.getElementById('loyaltyPreview').style.display = 'block'; // Generate preview content let previewText = ''; let progressText = ''; if (loyaltyType === 'visitBased') { previewText = `Book ${threshold} visits, get reward`; progressText = `0 of ${threshold} visits complete`; } else if (loyaltyType === 'spendBased') { previewText = `Spend £${threshold}, get reward`; progressText = `£0 of £${threshold} spent`; } else if (loyaltyType === 'timeLimited') { previewText = `Book ${threshold} visits within ${timeLimit} weeks, get reward`; progressText = `0 of ${threshold} visits complete (${timeLimit} weeks remaining)`; } let rewardText = ''; if (rewardType === 'freeService') { rewardText = '1 Free Service'; } else if (rewardType === 'fixedDiscount') { rewardText = `£${rewardValue} off next booking`; } else if (rewardType === 'percentageDiscount') { rewardText = `${rewardValue}% off next booking`; } const previewContent = ` <div><div>${previewText}</div><div>${progressText}</div><div><div></div></div></div><div><div>🎁 Reward</div><div>${rewardText}</div></div><div><div>📱 Customer Preview</div><div> Your customers will see: <strong>${progressText}</strong><br> Reward: <strong>${rewardText}</strong></div></div> `; document.getElementById('loyaltyPreviewContent').innerHTML = previewContent; document.getElementById('saveLoyaltyBtn').style.display = 'block'; } function toggleLoyaltyProgram() { const loyaltyEnabled = document.getElementById('loyaltyEnabled').checked; const loyaltySection = document.getElementById('loyaltySection'); if (loyaltyEnabled) { loyaltySection.style.display = 'block'; } else { loyaltySection.style.display = 'none'; // Reset form when disabled document.getElementById('loyaltyType').value = ''; document.getElementById('loyaltyThreshold').value = ''; document.getElementById('loyaltyTimeLimit').value = ''; document.getElementById('rewardType').value = ''; document.getElementById('loyaltyRewardValue').value = ''; document.getElementById('loyaltyPreview').style.display = 'none'; document.getElementById('saveLoyaltyBtn').style.display = 'none'; } } function saveModalLoyaltyProgram() { const loyaltyType = document.getElementById('modalLoyaltyType').value; const threshold = document.getElementById('modalLoyaltyThreshold').value; const timeLimit = document.getElementById('modalLoyaltyTimeLimit').value; const rewardType = document.getElementById('modalRewardType').value; const rewardValue = document.getElementById('modalLoyaltyRewardValue').value; const loyaltyEnabled = document.getElementById('modalLoyaltyEnabled').checked; // Validate inputs if (!loyaltyType || !threshold || !rewardType) { alert('Please fill in all required fields'); return; } if (loyaltyType === 'timeLimited' && !timeLimit) { alert('Please enter time limit for time-limited program'); return; } if (rewardType !== 'freeService' && !rewardValue) { alert('Please enter reward value'); return; } // Save to localStorage (in real implementation, save to database) const loyaltyProgram = { type: loyaltyType, threshold: parseInt(threshold), timeLimit: timeLimit ? parseInt(timeLimit) : null, rewardType: rewardType, rewardValue: rewardType === 'freeService' ? null : parseFloat(rewardValue), isActive: loyaltyEnabled, createdAt: new Date().toISOString() }; localStorage.setItem('loyaltyProgram', JSON.stringify(loyaltyProgram)); // Close modal closeLoyaltyModal(); alert('Loyalty program saved successfully!\n\nYour customers will now see this loyalty program on your business profile and in their dashboard.'); } function saveLoyaltyProgram() { const loyaltyType = document.getElementById('loyaltyType').value; const threshold = document.getElementById('loyaltyThreshold').value; const timeLimit = document.getElementById('loyaltyTimeLimit').value; const rewardType = document.getElementById('rewardType').value; const rewardValue = document.getElementById('loyaltyRewardValue').value; const loyaltyEnabled = document.getElementById('loyaltyEnabled').checked; // Validate inputs if (!loyaltyEnabled) { alert('Please enable the loyalty programme first'); return; } if (!loyaltyType || !threshold || !rewardType) { alert('Please fill in all required fields'); return; } if (loyaltyType === 'timeLimited' && !timeLimit) { alert('Please enter time limit for time-limited program'); return; } if (rewardType !== 'freeService' && !rewardValue) { alert('Please enter reward value'); return; } // Save to localStorage (in real implementation, save to database) const loyaltyProgram = { type: loyaltyType, threshold: parseInt(threshold), timeLimit: timeLimit ? parseInt(timeLimit) : null, rewardType: rewardType, rewardValue: rewardValue ? parseFloat(rewardValue) : null, isActive: loyaltyEnabled, createdAt: new Date().toISOString() }; localStorage.setItem('loyaltyProgram', JSON.stringify(loyaltyProgram)); alert('Loyalty program saved successfully!\n\nYour customers will now see this loyalty program on your business profile and in their dashboard.'); } // Tab Version Functions function updateTabLoyaltyType() { const loyaltyType = document.getElementById('tabLoyaltyType').value; const thresholdSetting = document.getElementById('tabThresholdSetting'); const timeLimitSetting = document.getElementById('tabTimeLimitSetting'); const rewardTypeSetting = document.getElementById('tabRewardTypeSetting'); const expiryDaysSetting = document.getElementById('tabExpiryDaysSetting'); const termsSetting = document.getElementById('tabTermsSetting'); const thresholdDescription = document.getElementById('tabThresholdDescription'); // Show threshold setting for all types thresholdSetting.style.display = 'block'; // Show time limit only for time-limited if (loyaltyType === 'timeLimited') { timeLimitSetting.style.display = 'block'; thresholdDescription.textContent = 'Set the number of visits to complete'; } else { timeLimitSetting.style.display = 'none'; if (loyaltyType === 'visitBased') { thresholdDescription.textContent = 'Set the number of visits required'; } else if (loyaltyType === 'spendBased') { thresholdDescription.textContent = 'Set the amount to spend (£)'; } } // Show reward type setting and additional fields rewardTypeSetting.style.display = 'block'; expiryDaysSetting.style.display = 'block'; termsSetting.style.display = 'block'; updateTabLoyaltyPreview(); } function updateTabRewardType() { const rewardType = document.getElementById('tabRewardType').value; const rewardValueSetting = document.getElementById('tabRewardValueSetting'); const rewardValueDescription = document.getElementById('tabRewardValueDescription'); if (rewardType) { rewardValueSetting.style.display = 'block'; if (rewardType === 'freeService') { rewardValueDescription.textContent = 'No value needed for free service'; document.getElementById('tabLoyaltyRewardValue').style.display = 'none'; } else if (rewardType === 'fixedDiscount') { rewardValueDescription.textContent = 'Set the discount amount (£)'; document.getElementById('tabLoyaltyRewardValue').style.display = 'block'; document.getElementById('tabLoyaltyRewardValue').placeholder = 'Enter discount amount'; } else if (rewardType === 'percentageDiscount') { rewardValueDescription.textContent = 'Set the discount percentage (%)'; document.getElementById('tabLoyaltyRewardValue').style.display = 'block'; document.getElementById('tabLoyaltyRewardValue').placeholder = 'Enter percentage'; } } else { rewardValueSetting.style.display = 'none'; } updateTabLoyaltyPreview(); } function updateTabLoyaltyPreview() { const loyaltyType = document.getElementById('tabLoyaltyType').value; const threshold = document.getElementById('tabLoyaltyThreshold').value; const timeLimit = document.getElementById('tabLoyaltyTimeLimit').value; const rewardType = document.getElementById('tabRewardType').value; const rewardValue = document.getElementById('tabLoyaltyRewardValue').value; const loyaltyEnabled = document.getElementById('tabLoyaltyEnabled').checked; if (!loyaltyType || !threshold || !rewardType) { document.getElementById('tabLoyaltyPreview').style.display = 'none'; return; } // Show preview document.getElementById('tabLoyaltyPreview').style.display = 'block'; // Generate preview content let previewText = ''; let progressText = ''; if (loyaltyType === 'visitBased') { previewText = `Book ${threshold} visits, get reward`; progressText = `3 of ${threshold} visits complete`; } else if (loyaltyType === 'spendBased') { previewText = `Spend £${threshold}, get reward`; progressText = `£75 of £${threshold} spent`; } else if (loyaltyType === 'timeLimited') { previewText = `Book ${threshold} visits within ${timeLimit} weeks, get reward`; progressText = `2 of ${threshold} visits complete (4 weeks remaining)`; } let rewardText = ''; if (rewardType === 'freeService') { rewardText = 'Free haircut'; } else if (rewardType === 'fixedDiscount') { rewardText = `£${rewardValue} off next booking`; } else if (rewardType === 'percentageDiscount') { rewardText = `${rewardValue}% off next booking`; } const statusText = loyaltyEnabled ? 'Active' : 'Inactive'; const statusColor = loyaltyEnabled ? '#28a745' : '#dc3545'; const previewContent = ` <div><div>${previewText}</div><div>${progressText}</div><div><div></div></div></div><div><div>🎁 Reward</div><div>${rewardText}</div></div><div><div>📱 Customer Preview</div><div> Status: <strong>${statusText}</strong><br> Your customers will see: <strong>${progressText}</strong><br> Reward: <strong>${rewardText}</strong></div></div> `; document.getElementById('tabLoyaltyPreviewContent').innerHTML = previewContent; document.getElementById('tabSaveLoyaltyBtn').style.display = 'block'; } function saveTabLoyaltyProgram() { const loyaltyType = document.getElementById('tabLoyaltyType').value; const threshold = document.getElementById('tabLoyaltyThreshold').value; const timeLimit = document.getElementById('tabLoyaltyTimeLimit').value; const rewardType = document.getElementById('tabRewardType').value; const rewardValue = document.getElementById('tabLoyaltyRewardValue').value; const expiryDays = document.getElementById('tabLoyaltyExpiryDays').value; const terms = document.getElementById('tabLoyaltyTerms').value; const loyaltyEnabled = document.getElementById('tabLoyaltyEnabled').checked; // Validate inputs if (!loyaltyType || !threshold || !rewardType) { alert('Please fill in all required fields'); return; } if (loyaltyType === 'timeLimited' && !timeLimit) { alert('Please enter time limit for time-limited program'); return; } if (rewardType !== 'freeService' && !rewardValue) { alert('Please enter reward value'); return; } // Enhanced validation for new fields if (loyaltyEnabled && (!expiryDays || expiryDays < 1 || expiryDays > 365)) { alert('Please enter a valid expiry days (1-365).'); return; } // Save to localStorage (in real implementation, save to database) const loyaltyProgram = { type: loyaltyType, threshold: parseInt(threshold), timeLimit: timeLimit ? parseInt(timeLimit) : null, rewardType: rewardType, rewardValue: rewardType === 'freeService' ? null : parseFloat(rewardValue), expiryDays: expiryDays ? parseInt(expiryDays) : 90, // Default 90 days terms: terms || 'Valid for the specified period from earning', isActive: loyaltyEnabled, businessId: getCurrentBusinessId(), createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() }; localStorage.setItem('loyaltyProgram', JSON.stringify(loyaltyProgram)); // Save to LoyaltyProgrammes database table saveLoyaltyProgrammeToDatabase(loyaltyProgram); alert('Loyalty program saved successfully!\n\nYour customers will now see this loyalty program on your business profile and in their dashboard.'); } // Load loyalty analytics data function loadLoyaltyAnalytics() { try { // Load customer progress data loadCustomerProgressData(); // Load issued rewards data loadIssuedRewardsData(); } catch (error) { console.error('Error loading loyalty analytics:', error); } } // Load customer progress data (anonymized) function loadCustomerProgressData() { try { const loyaltyProgress = JSON.parse(localStorage.getItem('loyaltyProgress') || '[]'); const currentBusinessId = 'business_001'; // In a real app, get from session // Filter progress for current business const businessProgress = loyaltyProgress.filter(progress => progress.business_id === currentBusinessId ); const progressList = document.getElementById('customerProgressList'); if (!progressList) return; if (businessProgress.length === 0) { progressList.innerHTML = '<p>No customer progress data yet</p>'; return; } // Generate anonymized customer progress items const progressItems = businessProgress.map(progress => { const customerInitials = getCustomerInitials(progress.customer_id); const progressPercentage = Math.round((progress.total_visits / 5) * 100); // Assuming 5 visits threshold return ` <div><div><div>${customerInitials}</div><div><div>Customer ${customerInitials}</div><div>${progress.total_visits} visits completed</div></div></div><div><div><div></div></div><span>${progressPercentage}%</span></div></div> `; }).join(''); progressList.innerHTML = progressItems; } catch (error) { console.error('Error loading customer progress data:', error); } } // Load issued rewards data function loadIssuedRewardsData() { try { const rewardVouchers = JSON.parse(localStorage.getItem('rewardVouchers') || '[]'); const currentBusinessId = 'business_001'; // In a real app, get from session // Filter vouchers for current business const businessVouchers = rewardVouchers.filter(voucher => voucher.business_id === currentBusinessId ); const rewardsList = document.getElementById('issuedRewardsList'); if (!rewardsList) return; if (businessVouchers.length === 0) { rewardsList.innerHTML = '<p>No rewards issued yet</p>'; return; } // Generate issued rewards items const rewardItems = businessVouchers.map(voucher => { const status = voucher.expired ? 'expired' : (voucher.used ? 'redeemed' : 'issued'); const statusText = voucher.expired ? 'Expired' : (voucher.used ? 'Redeemed' : 'Issued'); const issueDate = new Date(voucher.created_at).toLocaleDateString(); return ` <div><div><div>${voucher.id.substring(0, 8).toUpperCase()}</div><div><div>${voucher.reward_type}</div><div>Issued: ${issueDate}</div></div></div><div><div></div><span>${statusText}</span></div></div> `; }).join(''); rewardsList.innerHTML = rewardItems; } catch (error) { console.error('Error loading issued rewards data:', error); } } // Get customer initials for anonymization function getCustomerInitials(customerId) { const customerNames = { 'customer_1': 'JS', 'customer_2': 'JD', 'customer_3': 'SW' }; return customerNames[customerId] || 'CU'; } // Simulate saving to LoyaltyProgrammes database table function saveLoyaltyProgrammeToDatabase(loyaltyData) { try { // Simulate database save const loyaltyProgramme = { id: generateUUID(), business_id: loyaltyData.businessId, type: loyaltyData.type === 'visitBased' ? 'Visits' : loyaltyData.type === 'spendBased' ? 'Spend' : 'Time', threshold: loyaltyData.threshold, reward_type: loyaltyData.rewardType === 'freeService' ? 'Free Service' : loyaltyData.rewardType === 'fixedDiscount' ? 'Discount' : 'Credit', reward_value: loyaltyData.rewardValue ? loyaltyData.rewardValue.toString() : '1', expiry_days: loyaltyData.expiryDays, terms: loyaltyData.terms, active: loyaltyData.isActive, created_at: loyaltyData.createdAt, updated_at: loyaltyData.updatedAt }; // Store in localStorage for demo (in real app, this would be a database call) const existingProgrammes = JSON.parse(localStorage.getItem('loyaltyProgrammes') || '[]'); const updatedProgrammes = existingProgrammes.filter(p => p.business_id !== loyaltyData.businessId); updatedProgrammes.push(loyaltyProgramme); localStorage.setItem('loyaltyProgrammes', JSON.stringify(updatedProgrammes)); console.log('Loyalty programme saved to database:', loyaltyProgramme); } catch (error) { console.error('Failed to save loyalty programme to database:', error); } } // Generate UUID for database records function generateUUID() { return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) { const r = Math.random() * 16 | 0; const v = c == 'x' ? r : (r & 0x3 | 0x8); return v.toString(16); }); } // Get current business ID function getCurrentBusinessId() { // In a real app, this would come from authentication return localStorage.getItem('currentBusinessId') || 'business_001'; } // Load and display business bookings from localStorage function loadBusinessBookings() { const businessId = 'royal-hair-studio'; const businessBookings = JSON.parse(localStorage.getItem(`businessBookings_${businessId}`) || '[]'); // Update the bookings display in the dashboard updateBookingsDisplay(businessBookings); } // Update bookings display in the dashboard function updateBookingsDisplay(bookings) { // Find the bookings section in the dashboard const bookingsSection = document.querySelector('.bookings-section'); if (!bookingsSection) return; // Create bookings HTML let bookingsHTML = ''; if (bookings.length === 0) { bookingsHTML = ` <div><div>📅</div><h3>No bookings yet</h3><p>Bookings will appear here when customers make appointments.</p></div> `; } else { bookingsHTML = bookings.map(booking => ` <div><div><div><h4>${booking.customerName}</h4><p>${booking.customerEmail}</p></div><div> ${booking.status} </div></div><div><div><span>Date:</span><span>${booking.date}</span></div><div><span>Time:</span><span>${booking.time}</span></div><div><span>Services:</span><span>${booking.services.map(s => s.name).join(', ')}</span></div><div><span>Total:</span><span>£${booking.totalAmount}</span></div><div><span>Booking ID:</span><span>${booking.bookingId}</span></div> ${generateRefundInfo(booking)} ${generateNotificationStatus(booking)} </div></div> `).join(''); } // Update the bookings section const bookingsList = bookingsSection.querySelector('.bookings-list'); if (bookingsList) { bookingsList.innerHTML = bookingsHTML; } } // Listen for booking status updates (real-time sync) window.addEventListener('storage', function(e) { if (e.key && e.key.startsWith('bookingCancelled_')) { const bookingId = e.key.replace('bookingCancelled_', ''); updateBusinessBookingStatus(bookingId, 'Cancelled'); loadBusinessBookings(); // Refresh display } }); // Generate refund information for business dashboard function generateRefundInfo(booking) { if (booking.status === 'Refunded' && booking.refundAmount !== undefined) { const refundDate = booking.refundTimestamp ? new Date(booking.refundTimestamp).toLocaleDateString() : new Date().toLocaleDateString(); return ` <div><span>Refund Amount:</span><span>£${booking.refundAmount.toFixed(2)}</span></div><div><span>Refund Date:</span><span>${refundDate}</span></div><div><span>Refund Status:</span><span>${booking.refundStatus || 'Processed'}</span></div><div><span>Net Amount:</span><span>£${booking.netAmount ? booking.netAmount.toFixed(2) : (booking.totalAmount - booking.refundAmount).toFixed(2)}</span></div> `; } else if (booking.status === 'Cancelled' && booking.refundStatus === 'Non-refundable') { return ` <div><span>Refund Status:</span><span>Non-refundable under policy</span></div> `; } return ''; } // Generate notification status for business dashboard function generateNotificationStatus(booking) { // Get notification status for this booking const notificationStatus = getBookingNotificationStatus(booking.id); return ` <div><div><i></i><span>Communication Status</span></div><div><div><span>Confirmation Email:</span><span><i></i> ${notificationStatus.confirmation_email ? 'Sent' : 'Failed'} </span></div> ${notificationStatus.confirmation_sms !== undefined ? ` <div><span>Confirmation SMS:</span><span><i></i> ${notificationStatus.confirmation_sms ? 'Sent' : 'Failed'} </span></div> ` : ''} <div><span>Reminder Email:</span><span><i></i> ${notificationStatus.reminder_email ? 'Sent' : 'Pending'} </span></div> ${notificationStatus.reminder_sms !== undefined ? ` <div><span>Reminder SMS:</span><span><i></i> ${notificationStatus.reminder_sms ? 'Sent' : 'Pending'} </span></div> ` : ''} </div><div><i></i><span>Only delivery status is shown. Message contents and customer details are protected.</span></div></div> `; } // Get notification status for a booking function getBookingNotificationStatus(bookingId) { try { const notificationLogs = JSON.parse(localStorage.getItem('notification_logs') || '{}'); const bookingLogs = {}; // Find all logs for this booking Object.keys(notificationLogs).forEach(key => { if (key.startsWith(`${bookingId}_`)) { const log = notificationLogs[key]; const statusKey = `${log.notificationType}_${log.method}`; bookingLogs[statusKey] = log.sent; } }); return { confirmation_email: bookingLogs.confirmation_email || false, confirmation_sms: bookingLogs.confirmation_sms || false, reminder_email: bookingLogs.reminder_email || false, reminder_sms: bookingLogs.reminder_sms || false }; } catch (error) { console.error('Failed to get notification status:', error); return { confirmation_email: false, confirmation_sms: false, reminder_email: false, reminder_sms: false }; } } // Update booking status in business dashboard function updateBusinessBookingStatus(bookingId, newStatus) { const businessId = 'royal-hair-studio'; const businessBookings = JSON.parse(localStorage.getItem(`businessBookings_${businessId}`) || '[]'); const bookingIndex = businessBookings.findIndex(b => b.bookingId === bookingId); if (bookingIndex !== -1) { businessBookings[bookingIndex].status = newStatus; businessBookings[bookingIndex].updatedAt = new Date().toISOString(); localStorage.setItem(`businessBookings_${businessId}`, JSON.stringify(businessBookings)); } } // Setup business booking event listeners function setupBusinessBookingEventListeners() { // Listen for booking.confirmed events window.addEventListener('booking.confirmed', function(event) { console.log('Business received booking confirmed event:', event.detail); // Refresh business bookings display loadBusinessBookings(); }); // Listen for booking.cancelled events window.addEventListener('booking.cancelled', function(event) { console.log('Business received booking cancelled event:', event.detail); // Refresh business bookings display loadBusinessBookings(); }); // Listen for business booking updates window.addEventListener('businessBookingUpdated', function(event) { console.log('Business booking updated event received:', event.detail); // Refresh business bookings display loadBusinessBookings(); }); // Listen for booking.cancel events window.addEventListener('booking.cancel', function(event) { console.log('Business received booking cancel event:', event.detail); // Refresh business bookings display loadBusinessBookings(); // Show cancellation notification showBusinessNotification('Booking cancelled by customer', 'info'); }); // Listen for waitinglist.join events window.addEventListener('waitinglist.join', function(event) { console.log('Business received waitinglist.join event:', event.detail); // Refresh waiting list display loadWaitingList(); // Show notification showBusinessNotification(`New customer joined waiting list: ${event.detail.customerFirstName}`, 'info'); }); // Listen for waitinglist.offer.accept events window.addEventListener('waitinglist.offer.accept', function(event) { console.log('Business received waitinglist.offer.accept event:', event.detail); // Refresh waiting list display loadWaitingList(); // Show notification showBusinessNotification('Customer accepted offer - booking created!', 'success'); }); // Listen for notification status updates window.addEventListener('notification.status.update', function(event) { console.log('Business received notification status update:', event.detail); // Refresh business bookings display to show updated notification status loadBusinessBookings(); // Show notification status update const { notificationType, method, sent } = event.detail; const statusText = sent ? 'sent successfully' : 'failed to send'; showBusinessNotification(`${notificationType} ${method} ${statusText}`, sent ? 'success' : 'error'); }); } // Show business notification function showBusinessNotification(message, type = 'info') { const notification = document.createElement('div'); notification.className = `business-notification business-notification-${type}`; notification.innerHTML = ` <div><i></i><span>${message}</span></div> `; document.body.appendChild(notification); // Auto remove after 5 seconds setTimeout(() => { notification.remove(); }, 5000); } // Initialize bookings on page load document.addEventListener('DOMContentLoaded', function() { loadBusinessBookings(); }); // ======================================== // WAITING LIST FUNCTIONS // ======================================== /** * Load and display waiting list */ function loadWaitingList() { const businessId = localStorage.getItem('businessId') || 'business_1'; const waitingList = JSON.parse(localStorage.getItem(`businessWaitingList_${businessId}`) || '[]'); updateWaitingListStats(waitingList); displayWaitingList(waitingList); } /** * Update waiting list statistics */ function updateWaitingListStats(waitingList) { const totalWaiting = waitingList.filter(item => item.status === 'waiting').length; const offersSent = waitingList.filter(item => item.status === 'offered').length; const acceptedOffers = waitingList.filter(item => item.status === 'accepted').length; document.getElementById('totalWaiting').textContent = totalWaiting; document.getElementById('offersSent').textContent = offersSent; document.getElementById('acceptedOffers').textContent = acceptedOffers; // Update badge const badge = document.getElementById('waitingListBadge'); if (totalWaiting > 0) { badge.textContent = totalWaiting; badge.style.display = 'inline'; } else { badge.style.display = 'none'; } } /** * Display waiting list items */ function displayWaitingList(waitingList) { const container = document.getElementById('waitingListContent'); if (waitingList.length === 0) { container.innerHTML = ` <div><i></i><h3>No customers waiting</h3><p>When customers join your waiting list, they'll appear here.</p></div> `; return; } const filteredList = filterWaitingList(waitingList); container.innerHTML = filteredList.map(item => ` <div><div><div> ${item.customerName || 'Customer'} <span>Position #${item.position || 'N/A'}</span></div><div><div>Joined: ${new Date(item.joinedAt).toLocaleDateString()}</div><div>Priority: ${item.priority || 0}</div></div><div><strong>${item.serviceData.name}</strong> - £${item.serviceData.price} </div><div><i></i> ${item.privacyNotice || 'Contact details are securely stored by BlkPages'} </div></div><div> ${item.status === 'waiting' ? ` <button onclick="sendOffer('${item.id}')"><i></i> Send Offer </button><button onclick="removeFromWaitingList('${item.id}')"><i></i> Remove </button> ` : item.status === 'offered' ? ` <span>Offer Sent</span> ` : ` <span>Accepted</span> `} </div></div> `).join(''); } /** * Filter waiting list based on selected filters */ function filterWaitingList(waitingList) { const statusFilter = document.getElementById('statusFilter')?.value || 'all'; const serviceFilter = document.getElementById('serviceFilter')?.value || 'all'; return waitingList.filter(item => { const statusMatch = statusFilter === 'all' || item.status === statusFilter; const serviceMatch = serviceFilter === 'all' || item.serviceData.name.toLowerCase().includes(serviceFilter.toLowerCase()); return statusMatch && serviceMatch; }); } /** * Send offer to next customer */ function sendOfferToNextCustomer() { const businessId = localStorage.getItem('businessId') || 'business_1'; const waitingList = JSON.parse(localStorage.getItem(`businessWaitingList_${businessId}`) || '[]'); const waitingCustomers = waitingList.filter(item => item.status === 'waiting'); if (waitingCustomers.length === 0) { showNotification('No customers waiting for offers', 'info'); return; } // Get next customer (highest priority) const nextCustomer = waitingCustomers.sort((a, b) => (b.priority || 0) - (a.priority || 0))[0]; // Create available slot (mock data) const availableSlot = { date: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString().split('T')[0], time: '10:00 AM', duration: '1h 30m' }; sendOffer(nextCustomer.id, availableSlot); } /** * Send offer to specific customer */ function sendOffer(waitingListId, availableSlot) { const businessId = localStorage.getItem('businessId') || 'business_1'; const waitingList = JSON.parse(localStorage.getItem(`businessWaitingList_${businessId}`) || '[]'); const item = waitingList.find(item => item.id === waitingListId); if (!item) { showNotification('Customer not found in waiting list', 'error'); return; } // Update status to offered item.status = 'offered'; item.offerSentAt = new Date().toISOString(); item.availableSlot = availableSlot; localStorage.setItem(`businessWaitingList_${businessId}`, JSON.stringify(waitingList)); // Also update customer waiting list const customerWaitingList = JSON.parse(localStorage.getItem(`customerWaitingList_${item.customerId}`) || '[]'); const customerItem = customerWaitingList.find(customerItem => customerItem.id === waitingListId); if (customerItem) { customerItem.status = 'offered'; customerItem.offerSentAt = new Date().toISOString(); customerItem.availableSlot = availableSlot; localStorage.setItem(`customerWaitingList_${item.customerId}`, JSON.stringify(customerWaitingList)); } showNotification(`Offer sent to ${item.customerName || 'customer'}`, 'success'); loadWaitingList(); } /** * Remove customer from waiting list */ function removeFromWaitingList(waitingListId) { if (!confirm('Are you sure you want to remove this customer from the waiting list?')) { return; } const businessId = localStorage.getItem('businessId') || 'business_1'; const waitingList = JSON.parse(localStorage.getItem(`businessWaitingList_${businessId}`) || '[]'); const item = waitingList.find(item => item.id === waitingListId); if (!item) { showNotification('Customer not found in waiting list', 'error'); return; } // Remove from business waiting list const updatedList = waitingList.filter(item => item.id !== waitingListId); localStorage.setItem(`businessWaitingList_${businessId}`, JSON.stringify(updatedList)); // Remove from customer waiting list const customerWaitingList = JSON.parse(localStorage.getItem(`customerWaitingList_${item.customerId}`) || '[]'); const updatedCustomerList = customerWaitingList.filter(customerItem => customerItem.id !== waitingListId); localStorage.setItem(`customerWaitingList_${item.customerId}`, JSON.stringify(updatedCustomerList)); showNotification('Customer removed from waiting list', 'success'); loadWaitingList(); } /** * Refresh waiting list */ function refreshWaitingList() { loadWaitingList(); showNotification('Waiting list refreshed', 'info'); } /** * Filter waiting list */ function filterWaitingList() { const businessId = localStorage.getItem('businessId') || 'business_1'; const waitingList = JSON.parse(localStorage.getItem(`businessWaitingList_${businessId}`) || '[]'); displayWaitingList(waitingList); } </script>
        </div>
    </main>
    
    <footer class="bg-[#111111] py-12 px-4">
        <div class="container mx-auto grid grid-cols-1 md:grid-cols-4 gap-8">
            <!-- About -->
            <div>
                <h3 class="text-lg font-bold text-[#D4AF37] mb-4">BlkPages</h3>
                <p class="text-gray-400">Connecting you to businesses inspired by Black culture and creativity.</p>
            </div>
            <!-- Links -->
            <div>
                <h3 class="text-lg font-semibold text-gray-200 mb-4">Quick Links</h3>
                <ul>
                    <li class="mb-2"><a href="about.html" class="text-gray-400 hover:text-[#D4AF37]">About Us</a></li>
                    <li class="mb-2"><a href="search-results.html" class="text-gray-400 hover:text-[#D4AF37]">Browse</a></li>
                    <li class="mb-2"><a href="business-register.html" class="text-gray-400 hover:text-[#D4AF37]">List a Business</a></li>
                    <li class="mb-2"><a href="contact.html" class="text-gray-400 hover:text-[#D4AF37]">Contact</a></li>
                </ul>
            </div>
            <!-- Legal -->
            <div>
                <h3 class="text-lg font-semibold text-gray-200 mb-4">Legal</h3>
                <ul>
                    <li class="mb-2"><a href="privacy.html" class="text-gray-400 hover:text-[#D4AF37]">Privacy Policy</a></li>
                    <li class="mb-2"><a href="terms.html" class="text-gray-400 hover:text-[#D4AF37]">Terms of Service</a></li>
                </ul>
            </div>
            <!-- Social -->
            <div>
                <h3 class="text-lg font-semibold text-gray-200 mb-4">Connect With Us</h3>
                <div class="flex gap-4">
                    <a href="#" class="text-gray-400 hover:text-[#D4AF37]"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="text-gray-400 hover:text-[#D4AF37]"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="text-gray-400 hover:text-[#D4AF37]"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
        </div>
        <div class="text-center text-gray-500 mt-8 pt-8 border-t border-gray-800">
            <p>&copy; 2024 BlkPages. All rights reserved.</p>
        </div>
    </footer>
</body>
</html>