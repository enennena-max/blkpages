<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browse Businesses - BlkPages</title>
    <script src="https://cdn.tailwindcss.com?v=2"></script>
    <script src="js/suppress-tailwind-warning.js"></script>
    
    <!-- Basket Count Sync Fix -->
    <script src="assets/js/basket.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Poppins:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css?v=2">
    
    <!-- Business Management System -->
    <script src="business-manager.js"></script>
    
    <!-- Analytics Tracking System -->
    <script src="analytics-tracker.js"></script>
    
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                        'poppins': ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        'neon-pink': '#FF3CAC',
                        'neon-purple': '#784BA0',
                        'neon-blue': '#2B86C5',
                        'neon-green': '#4ADE80',
                        'charcoal': '#121212',
                        'dark-grey': '#1A1A1A',
                        'light-grey': '#E5E5E5',
                        'gold': '#D4AF37',
                        'gold-dark': '#B8941F',
                        'black': '#000000',
                        'white': '#FFFFFF',
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.8s ease-in-out',
                        'slide-up': 'slideUp 0.6s ease-out',
                        'glow': 'glow 2s ease-in-out infinite alternate',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(30px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        glow: {
                            '0%': { boxShadow: '0 0 20px rgba(255, 60, 172, 0.3)' },
                            '100%': { boxShadow: '0 0 30px rgba(255, 60, 172, 0.6)' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .list-business-btn:hover{box-shadow:0 0 16px rgba(16,185,129,0.6);}/* green glow */
        body {
            font-family: 'Inter', sans-serif;
            background: #000000;
            min-height: 100vh;
            color: #FFFFFF;
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #2B86C5, #4ADE80);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 3s ease-in-out infinite;
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }
        
        .neon-glow:hover {
            box-shadow: 0 0 20px rgba(255, 60, 172, 0.5);
        }
        
        .back-btn {
            background: rgba(33, 150, 243, 0.1);
            border: 1px solid rgba(33, 150, 243, 0.3);
            transition: all 0.3s ease;
            gap: 0.5rem;
        }

        .back-btn:hover {
            background: rgba(33, 150, 243, 0.2);
            border-color: rgba(33, 150, 243, 0.4);
            transform: translateX(-2px);
        }

        .back-btn i {
            font-size: 0.8rem;
        }

        /* Gold theme enhancements */
        .gold-gradient {
            background: linear-gradient(135deg, #D4AF37, #B8941F);
        }

        .gold-text {
            color: #D4AF37;
        }

        .gold-border {
            border-color: #D4AF37;
        }

        .gold-shadow {
            box-shadow: 0 4px 20px rgba(212, 175, 55, 0.3);
        }

        .business-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.2);
        }

        /* Map container styling */
        #map, #mobileMap {
            border-radius: 12px;
            overflow: hidden;
        }

        /* Mobile toggle button styling */
        .view-toggle-btn {
            transition: all 0.3s ease;
        }

        .view-toggle-btn.active {
            background: linear-gradient(135deg, #D4AF37, #B8941F);
            color: #000;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4);
        }

        /* Responsive adjustments */
        @media (max-width: 1024px) {
            .desktop-layout {
                display: none;
            }
        }

        @media (min-width: 1025px) {
            .mobile-layout {
                display: none;
            }
        }
    </style>
</head>
<body class="bg-charcoal text-white font-inter">
    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 bg-charcoal/95 backdrop-blur-md border-b border-white/10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Desktop Navigation -->
            <div class="hidden lg:flex items-center justify-between h-16">
                <!-- Left: Logo -->
                <div class="flex items-center">
                    <a href="index.html" class="text-2xl font-bold text-white hover:text-neon-pink transition-colors duration-300">BlkPages</a>
                </div>
                
                <!-- Center: Main Navigation -->
                <div class="flex items-center space-x-8">
                    <a href="index.html" class="text-text-secondary hover:text-neon-pink transition-colors duration-300 font-medium">Home</a>
                    <a href="search-results.html" class="text-text-secondary hover:text-neon-pink transition-colors duration-300 font-medium">Browse</a>
                    <a href="offers.html" class="text-text-secondary hover:text-neon-pink transition-colors duration-300 font-medium">Offers</a>
                    <a href="why-list-with-us.html#pricing" class="text-text-secondary hover:text-neon-pink transition-colors duration-300 font-medium">Plans</a>
                </div>
                
                <!-- Right: Actions -->
                <div class="flex items-center space-x-4">
                    <!-- Basket Icon -->
                    <div class="relative">
                        <button onclick="scrollToBooking()" class="p-2 text-white hover:text-neon-pink transition-colors duration-300 relative">
                            <i class="fas fa-shopping-basket text-xl"></i>
                            <span id="basketCount" class="absolute -top-1 -right-1 bg-neon-pink text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold"></span>
                        </button>
                    </div>
                    
                    <!-- Auth Links (shown when not logged in) -->
                    <div id="authLinks" class="flex items-center space-x-3">
                        <button onclick="redirectToLogin()" class="px-4 py-2 text-white hover:text-neon-pink transition-colors duration-300 font-medium">Sign In</button>
                        <button onclick="redirectToRegister()" class="px-4 py-2 bg-gradient-to-r from-neon-pink to-neon-purple text-white rounded-lg hover:from-neon-purple hover:to-neon-blue transition-all duration-300 font-medium">Sign Up</button>
                    </div>
                    
                    <!-- Customer Menu (shown when logged in) -->
                    <div id="customerMenu" class="relative hidden">
                        <button onclick="toggleCustomerMenu()" class="flex items-center space-x-2 text-white hover:text-neon-pink transition-colors duration-300">
                            <div class="w-8 h-8 bg-gold rounded-full flex items-center justify-center text-black font-bold" id="customerInitialText">U</div>
                            <i class="fas fa-chevron-down text-sm"></i>
                        </button>
                        <div id="customerDropdown" class="absolute right-0 mt-2 w-48 bg-dark-grey border border-white/20 rounded-lg shadow-lg z-10 hidden">
                            <div class="py-2">
                                <a href="customer-dashboard.html" class="block px-4 py-2 text-white hover:bg-white/10 transition-colors duration-300">Dashboard</a>
                                <a href="customer-bookings.html" class="block px-4 py-2 text-white hover:bg-white/10 transition-colors duration-300">My Bookings</a>
                                <a href="customer-profile.html" class="block px-4 py-2 text-white hover:bg-white/10 transition-colors duration-300">Profile</a>
                                <hr class="border-white/10 my-2">
                                <button onclick="signOut()" class="block w-full text-left px-4 py-2 text-white hover:bg-white/10 transition-colors duration-300">Sign Out</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Mobile Navigation -->
            <div class="lg:hidden flex items-center justify-between h-16">
                <a href="index.html" class="text-xl font-bold text-white">BlkPages</a>
                <div class="flex items-center space-x-4">
                    <!-- Mobile Basket -->
                    <button onclick="scrollToBooking()" class="p-2 text-white hover:text-neon-pink transition-colors duration-300 relative">
                        <i class="fas fa-shopping-basket text-lg"></i>
                        <span id="mobileBasketCount" class="absolute -top-1 -right-1 bg-neon-pink text-white text-xs rounded-full h-4 w-4 flex items-center justify-center font-bold"></span>
                    </button>
                    
                    <!-- Mobile Auth Links -->
                    <div id="mobileAuthLinks" class="flex items-center space-x-2">
                        <button onclick="redirectToLogin()" class="px-3 py-1 text-white hover:text-neon-pink transition-colors duration-300 text-sm">Sign In</button>
                        <button onclick="redirectToRegister()" class="px-3 py-1 bg-gradient-to-r from-neon-pink to-neon-purple text-white rounded text-sm">Sign Up</button>
                    </div>
                    
                    <!-- Mobile Customer Menu -->
                    <div id="mobileCustomerMenu" class="relative hidden">
                        <button onclick="toggleCustomerMenu()" class="flex items-center space-x-1 text-white">
                            <div class="w-6 h-6 bg-gold rounded-full flex items-center justify-center text-black font-bold text-sm" id="mobileCustomerInitialText">U</div>
                        </button>
                        <div id="mobileCustomerDropdown" class="absolute right-0 mt-2 w-40 bg-dark-grey border border-white/20 rounded-lg shadow-lg z-10 hidden">
                            <div class="py-2">
                                <a href="customer-dashboard.html" class="block px-3 py-2 text-white hover:bg-white/10 text-sm">Dashboard</a>
                                <a href="customer-bookings.html" class="block px-3 py-2 text-white hover:bg-white/10 text-sm">Bookings</a>
                                <button onclick="signOut()" class="block w-full text-left px-3 py-2 text-white hover:bg-white/10 text-sm">Sign Out</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Mobile Menu Button -->
                    <button onclick="toggleMobileMenu()" class="p-2 text-white hover:text-neon-pink transition-colors duration-300">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
            
            <!-- Mobile Menu -->
            <div id="mobileMenu" class="lg:hidden hidden bg-dark-grey border-t border-white/10">
                <div class="px-4 py-6 space-y-4">
                    <a href="index.html" class="block text-white hover:text-neon-pink transition-colors duration-300 font-medium">Home</a>
                    <a href="search-results.html" class="block text-white hover:text-neon-pink transition-colors duration-300 font-medium">Browse</a>
                    <a href="offers.html" class="block text-white hover:text-neon-pink transition-colors duration-300 font-medium">Offers</a>
                    <a href="why-list-with-us.html#pricing" class="block text-white hover:text-neon-pink transition-colors duration-300 font-medium">Plans</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="pt-24 pb-12 bg-black">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h1 class="text-4xl md:text-6xl font-bold text-white mb-6 font-poppins">
                Browse Businesses
            </h1>
            <p class="text-xl text-light-grey" id="dynamicSubheading">
                Discover amazing businesses near you
            </p>
        </div>
    </section>

    <!-- Search Panel -->
    <section class="py-8 bg-charcoal">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="bg-dark-grey rounded-2xl p-6 border border-white/10">
                <!-- Initial Search Interface -->
                <div id="initialSearch" class="text-center">
                    <h2 class="text-2xl font-bold text-white mb-4 font-poppins">Find Your Perfect Business</h2>
                    <p class="text-light-grey mb-8">Search for businesses near you</p>
                    
                    <div class="max-w-4xl mx-auto">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                            <!-- Business Name Search -->
                            <div class="lg:col-span-2">
                                <label class="block text-sm font-medium text-light-grey mb-2 text-left">Business Name</label>
                                <input type="text" id="businessNameSearch" placeholder="Search by business name..." class="w-full px-4 py-3 bg-charcoal border border-white/20 rounded-lg text-white placeholder-light-grey focus:border-neon-pink focus:ring-2 focus:ring-neon-pink/20 transition-all duration-300">
                            </div>
                            
                            <!-- Location/Postcode -->
                            <div>
                                <label class="block text-sm font-medium text-light-grey mb-2 text-left">Location</label>
                                <input type="text" id="locationSearch" placeholder="Enter postcode or city" class="w-full px-4 py-3 bg-charcoal border border-white/20 rounded-lg text-white placeholder-light-grey focus:border-neon-pink focus:ring-2 focus:ring-neon-pink/20 transition-all duration-300">
                            </div>
                            
                            <!-- Category -->
                            <div>
                                <label class="block text-sm font-medium text-light-grey mb-2 text-left">Category</label>
                                <select id="categorySearch" class="w-full px-4 py-3 bg-charcoal border border-white/20 rounded-lg text-white focus:border-neon-pink focus:ring-2 focus:ring-neon-pink/20 transition-all duration-300">
                                    <option value="">All Categories</option>
                                    <option value="hair">Hair Salon</option>
                                    <option value="barber">Barber Shop</option>
                                    <option value="beauty">Beauty Salon</option>
                                    <option value="nails">Nail Salon</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="flex flex-col sm:flex-row gap-4 justify-center">
                            <button id="searchBtn" class="px-8 py-3 bg-gradient-to-r from-neon-pink to-neon-purple text-white font-semibold rounded-lg hover:from-neon-purple hover:to-neon-blue transition-all duration-300 neon-glow">
                                <i class="fas fa-search mr-2"></i>Search
                            </button>
                            <button id="nearMeBtn" class="px-8 py-3 bg-gradient-to-r from-neon-blue to-neon-green text-white font-semibold rounded-lg hover:from-neon-green hover:to-neon-blue transition-all duration-300">
                                <i class="fas fa-map-marker-alt mr-2"></i>Near Me
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Advanced Controls (Hidden initially) -->
                <div id="advancedControls" class="hidden mt-6 pt-6 border-t border-white/10">
                    <div class="flex flex-wrap items-center justify-between gap-4">
                        <div class="flex flex-wrap items-center gap-4">
                            <!-- Filter Menu -->
                            <div class="relative">
                                <button id="filterMenuBtn" class="px-4 py-2 rounded-lg bg-charcoal border border-white/20 text-white hover:border-neon-pink focus:border-neon-pink transition-all duration-300 flex items-center gap-2">
                                    <i class="fas fa-filter"></i>
                                    <span>Filters</span>
                                    <i class="fas fa-chevron-down text-sm"></i>
                                </button>
                                <div id="filterMenu" class="absolute top-full right-0 mt-2 w-64 bg-charcoal border border-white/20 rounded-lg shadow-lg z-10 hidden">
                                    <div class="p-4 space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-light-grey mb-2">Min Rating</label>
                                            <select id="ratingFilter" class="w-full px-3 py-2 bg-dark-grey border border-white/20 rounded text-white focus:border-neon-pink transition-all duration-300">
                                                <option value="">Any Rating</option>
                                                <option value="4">4+ Stars</option>
                                                <option value="4.5">4.5+ Stars</option>
                                                <option value="5">5 Stars</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-light-grey mb-2">Distance</label>
                                            <select id="distanceFilter" class="w-full px-3 py-2 bg-dark-grey border border-white/20 rounded text-white focus:border-neon-pink transition-all duration-300">
                                                <option value="5">5 miles</option>
                                                <option value="10">10 miles</option>
                                                <option value="25">25 miles</option>
                                                <option value="50">50 miles</option>
                                            </select>
                                        </div>
                                        <div class="flex gap-2 pt-2">
                                            <button id="applyFiltersBtn" class="flex-1 px-4 py-2 rounded bg-gradient-to-r from-neon-pink to-neon-purple text-white font-semibold hover:from-neon-purple hover:to-neon-blue transition-all duration-300">
                                                Apply
                                            </button>
                                            <button id="clearFiltersBtn" class="flex-1 px-4 py-2 rounded border border-white/20 text-light-grey hover:text-white hover:bg-white/10 transition-all duration-300">
                                                Clear
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Sort Hamburger Menu -->
                            <div class="relative">
                                <button id="sortMenuBtn" class="px-4 py-2 rounded-lg bg-charcoal border border-white/20 text-white hover:border-neon-pink focus:border-neon-pink transition-all duration-300 flex items-center gap-2">
                                    <i class="fas fa-sort"></i>
                                    <span id="sortMenuText">Sort</span>
                                    <i class="fas fa-chevron-down text-sm"></i>
                                </button>
                                <div id="sortMenu" class="absolute top-full right-0 mt-2 w-48 bg-charcoal border border-white/20 rounded-lg shadow-lg z-10 hidden">
                                    <div class="py-2">
                                        <button class="w-full px-4 py-3 text-left text-white hover:bg-white/10 transition-colors duration-300" data-sort="relevance">Relevance</button>
                                        <button class="w-full px-4 py-3 text-left text-white hover:bg-white/10 transition-colors duration-300" data-sort="price">Price</button>
                                        <button class="w-full px-4 py-3 text-left text-white hover:bg-white/10 transition-colors duration-300" data-sort="distance">Distance</button>
                                        <button class="w-full px-4 py-3 text-left text-white hover:bg-white/10 transition-colors duration-300" data-sort="reviews">Reviews</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content - List and Map Layout -->
    <section class="py-12 bg-black">
        <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Mobile View Toggle -->
            <div class="lg:hidden mb-6">
                <div class="flex bg-dark-grey rounded-xl p-1 border border-white/10">
                    <button id="listViewBtn" class="flex-1 py-3 px-4 rounded-lg bg-gold text-black font-semibold transition-all duration-300">
                        <i class="fas fa-list mr-2"></i>List View
                    </button>
                    <button id="mapViewBtn" class="flex-1 py-3 px-4 rounded-lg text-white hover:bg-gold hover:text-black transition-all duration-300">
                        <i class="fas fa-map mr-2"></i>Map View
                    </button>
                </div>
            </div>
            
            <!-- Desktop Layout: 50% List + 50% Map -->
            <div class="hidden lg:flex h-screen">
                <!-- Left 50%: Business List -->
                <div class="w-1/2 bg-black border-r border-white/10">
                    <div class="p-6 border-b border-white/10">
                        <h2 class="text-2xl font-bold text-white mb-2" id="resultsHeading">All Businesses</h2>
                        <p class="text-light-grey" id="resultsCount">12 businesses found</p>
                    </div>
                    <div class="h-full overflow-y-auto p-6">
                        <div class="space-y-4" id="businessResults">
                            <!-- Business cards will be populated here -->
                        </div>
                    </div>
                </div>
                
                <!-- Right 50%: Google Map -->
                <div class="w-1/2">
                    <div id="map" class="h-full w-full"></div>
                </div>
            </div>
            
            <!-- Mobile Layout: Toggle between List and Map -->
            <div class="lg:hidden">
                <!-- List View (Mobile) -->
                <div id="mobileListView" class="space-y-4">
                    <div class="bg-dark-grey rounded-2xl p-6 border border-white/10">
                        <h2 class="text-2xl font-bold text-white mb-2" id="mobileResultsHeading">All Businesses</h2>
                        <p class="text-light-grey" id="mobileResultsCount">12 businesses found</p>
                    </div>
                    <div class="space-y-4" id="mobileBusinessResults">
                        <!-- Mobile business cards will be populated here -->
                    </div>
                </div>
                
                <!-- Map View (Mobile) -->
                <div id="mobileMapView" class="hidden">
                    <div id="mobileMap" class="h-screen w-full"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-dark-grey py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <div class="mb-8">
                    <h3 class="text-2xl font-bold font-poppins gradient-text mb-4">BlkPages</h3>
                    <p class="text-light-grey mb-8">© 2025 BlkPages – Supporting Black-owned Businesses</p>
                    <div class="flex justify-center space-x-8 text-light-grey mb-6">
                        <a href="about.html" class="hover:text-neon-blue transition-colors font-medium">About</a>
                        <a href="contact.html" class="hover:text-neon-blue transition-colors font-medium">Contact</a>
                        <a href="privacy.html" class="hover:text-neon-blue transition-colors font-medium">Privacy</a>
                        <a href="terms.html" class="hover:text-neon-blue transition-colors font-medium">Terms</a>
                        <a href="blog.html" class="hover:text-neon-blue transition-colors font-medium">Blog</a>
                    </div>
                    <div class="max-w-4xl mx-auto mb-6">
                        <p class="text-xs text-light-grey leading-relaxed">
                            <strong>Disclaimer:</strong> BlkPages is a third-party directory and booking facilitator. Each business listed on our platform is an independent provider and is solely responsible for its own services, pricing, availability, and cancellation or refund policies. By booking through BlkPages, you agree that any cancellations, changes, or disputes must be resolved directly with the business.
                        </p>
                    </div>
                </div>
                <div class="flex justify-center space-x-6">
                    <a href="#" class="text-light-grey hover:text-neon-pink transition-colors duration-300 text-2xl">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="#" class="text-light-grey hover:text-neon-pink transition-colors duration-300 text-2xl">
                        <i class="fab fa-tiktok"></i>
                    </a>
                    <a href="#" class="text-light-grey hover:text-neon-pink transition-colors duration-300 text-2xl">
                        <i class="fab fa-twitter"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Mobile menu functions
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            mobileMenu.classList.toggle('hidden');
        }
        
        function closeMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            mobileMenu.classList.add('hidden');
        }
        
        // Modal functions (placeholder - these would need to be implemented)
        function toggleLoginModal(event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            alert('Login modal would open here');
        }
        
        function toggleSignupModal(event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            alert('Signup modal would open here');
        }
        
        // Basket management
        const BASKET_KEY = 'blkpages_basket';
        const GUEST_BASKET_KEY = 'blkpages_guest_basket';
        let selectedServices = [];
        
        function saveBasket() {
            const basketData = {
                selectedServices: selectedServices,
                timestamp: Date.now()
            };
            
            const isLoggedIn = localStorage.getItem('userLoggedIn') === 'true';
            if (isLoggedIn) {
                localStorage.setItem(BASKET_KEY, JSON.stringify(basketData));
            } else {
                sessionStorage.setItem(GUEST_BASKET_KEY, JSON.stringify(basketData));
            }
        }
        
        function loadBasket() {
            const isLoggedIn = localStorage.getItem('userLoggedIn') === 'true';
            let basketData = null;
            
            if (isLoggedIn) {
                const savedBasket = localStorage.getItem(BASKET_KEY);
                if (savedBasket) basketData = JSON.parse(savedBasket);
            } else {
                const guestBasket = sessionStorage.getItem(GUEST_BASKET_KEY);
                if (guestBasket) basketData = JSON.parse(guestBasket);
            }
            
            if (basketData) {
                selectedServices = basketData.selectedServices || [];
                updateBasketCount();
            }
        }
        
        function updateBasketCount() {
            const basketCount = document.getElementById('basketCount');
            const mobileBasketCount = document.getElementById('mobileBasketCount');
            if (basketCount) {
                basketCount.textContent = selectedServices.length;
            }
            if (mobileBasketCount) {
                mobileBasketCount.textContent = selectedServices.length;
            }
        }
        
        function scrollToBooking() {
            if (selectedServices.length > 0) {
                alert('You have ' + selectedServices.length + ' service(s) in your basket. Visit a business profile to complete your booking.');
            } else {
                alert('Your basket is empty. Browse businesses to add services.');
            }
        }
        
        // Customer menu functions
        function toggleCustomerMenu() {
            const dropdown = document.getElementById('customerDropdown');
            const mobileDropdown = document.getElementById('mobileCustomerDropdown');
            
            if (dropdown) dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
            if (mobileDropdown) mobileDropdown.style.display = mobileDropdown.style.display === 'none' ? 'block' : 'none';
        }
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('customerDropdown');
            const mobileDropdown = document.getElementById('mobileCustomerDropdown');
            
            if (dropdown && !event.target.closest('#customerMenu')) {
                dropdown.style.display = 'none';
            }
            if (mobileDropdown && !event.target.closest('#mobileCustomerMenu')) {
                mobileDropdown.style.display = 'none';
            }
        });

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Check login status and update UI
            const isLoggedIn = localStorage.getItem('userLoggedIn') === 'true';
            const userInitial = localStorage.getItem('userInitial') || 'U';
            
            // Update navigation based on login status
            const authLinks = document.getElementById('authLinks');
            const customerMenu = document.getElementById('customerMenu');
            const customerInitialText = document.getElementById('customerInitialText');
            const basketIcon = document.getElementById('basketCount');
            
            // Mobile elements
            const mobileAuthLinks = document.getElementById('mobileAuthLinks');
            const mobileCustomerMenu = document.getElementById('mobileCustomerMenu');
            const mobileCustomerInitialText = document.getElementById('mobileCustomerInitialText');
            const mobileBasketIcon = document.getElementById('mobileBasketCount');
            
            if (isLoggedIn) {
                // Show customer menu, hide sign in
                if (authLinks) authLinks.style.display = 'none';
                if (customerMenu) customerMenu.style.display = 'block';
                if (customerInitialText) customerInitialText.textContent = userInitial;
                
                // Mobile
                if (mobileAuthLinks) mobileAuthLinks.style.display = 'none';
                if (mobileCustomerMenu) mobileCustomerMenu.style.display = 'block';
                if (mobileCustomerInitialText) mobileCustomerInitialText.textContent = userInitial;
            } else {
                // Show sign in, hide customer menu
                if (authLinks) authLinks.style.display = 'flex';
                if (customerMenu) customerMenu.style.display = 'none';
                
                // Mobile
                if (mobileAuthLinks) mobileAuthLinks.style.display = 'flex';
                if (mobileCustomerMenu) mobileCustomerMenu.style.display = 'none';
            }
            
            // Basket is always visible
            if (basketIcon) basketIcon.style.display = 'flex';
            if (mobileBasketIcon) mobileBasketIcon.style.display = 'flex';
        });

        // Modal functions
        function toggleLoginModal(event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            const modal = document.getElementById('loginModal');
            modal.classList.toggle('hidden');
        }

        function toggleSignupModal(event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            const modal = document.getElementById('signupModal');
            modal.classList.toggle('hidden');
        }

        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            mobileMenu.classList.toggle('hidden');
        }

        function closeMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            mobileMenu.classList.add('hidden');
        }

        function toggleCustomerMenu() {
            const dropdown = document.getElementById('customerDropdown');
            const mobileDropdown = document.getElementById('mobileCustomerDropdown');
            
            if (dropdown) {
                dropdown.style.display = dropdown.style.display === 'none' || dropdown.style.display === '' ? 'block' : 'none';
            }
            if (mobileDropdown) {
                mobileDropdown.style.display = mobileDropdown.style.display === 'none' || mobileDropdown.style.display === '' ? 'block' : 'none';
            }
        }

        // Sign out function
        function signOut() {
            // Clear user data
            localStorage.removeItem('userLoggedIn');
            localStorage.removeItem('userInitial');
            localStorage.removeItem('userName');
            localStorage.removeItem('userEmail');
            
            // Clear basket on logout
            if (typeof clearBasketOnLogout === 'function') {
                clearBasketOnLogout();
            }
            
            // Update navigation
            updateNavVisibility();
            
            // Redirect to homepage
            window.location.href = 'index.html';
        }

        function updateNavVisibility() {
            const isLoggedIn = localStorage.getItem('userLoggedIn') === 'true';
            const userInitial = localStorage.getItem('userInitial') || 'U';
            
            const authLinks = document.getElementById('authLinks');
            const customerMenu = document.getElementById('customerMenu');
            const customerInitialText = document.getElementById('customerInitialText');
            
            const mobileAuthLinks = document.getElementById('mobileAuthLinks');
            const mobileCustomerMenu = document.getElementById('mobileCustomerMenu');
            const mobileCustomerInitialText = document.getElementById('mobileCustomerInitialText');
            
            if (isLoggedIn) {
                // Show customer menu, hide sign in
                if (authLinks) authLinks.style.display = 'none';
                if (customerMenu) customerMenu.style.display = 'block';
                if (customerInitialText) customerInitialText.textContent = userInitial;
                
                // Mobile
                if (mobileAuthLinks) mobileAuthLinks.style.display = 'none';
                if (mobileCustomerMenu) mobileCustomerMenu.style.display = 'block';
                if (mobileCustomerInitialText) mobileCustomerInitialText.textContent = userInitial;
            } else {
                // Show sign in, hide customer menu
                if (authLinks) authLinks.style.display = 'flex';
                if (customerMenu) customerMenu.style.display = 'none';
                
                // Mobile
                if (mobileAuthLinks) mobileAuthLinks.style.display = 'flex';
                if (mobileCustomerMenu) mobileCustomerMenu.style.display = 'none';
            }
        }

        // Redirect to login page with return URL
        function redirectToLogin() {
            console.log('redirectToLogin function called');
            // Store current page URL for redirect after login
            const currentUrl = window.location.href;
            localStorage.setItem('returnUrl', currentUrl);
            console.log('Return URL stored:', currentUrl);
            console.log('Return URL in localStorage:', localStorage.getItem('returnUrl'));
            // Navigate to login page
            window.location.href = 'customer-login.html';
        }

        // Redirect to register page with return URL
        function redirectToRegister() {
            // Store current page URL for redirect after registration
            localStorage.setItem('returnUrl', window.location.href);
            // Navigate to register page
            window.location.href = 'customer-register.html';
        }

        // Business search and display functionality
        let businessData = [];
        let currentFilters = {
            category: '',
            rating: '',
            distance: '5',
            sortBy: 'relevance'
        };

        // Helper function to determine business tier
        function getBusinessTier(business) {
            if (business.subscription === 'free' || !business.subscription) {
                return 'basic';
            } else if (business.subscription === 'starter') {
                return 'starter';
            } else if (business.subscription === 'professional' || business.subscription === 'premium') {
                return 'professional';
            }
            return 'basic'; // Default fallback
        }

        // Google Maps integration
        let map, mobileMap;
        let businessMarkers = [];
        let selectedBusiness = null;


        function initializeMap(businesses) {
            // Initialize desktop map
            const mapElement = document.getElementById('map');
            if (mapElement) {
                map = new google.maps.Map(mapElement, {
                    center: { lat: 51.5074, lng: -0.1278 }, // London coordinates
                    zoom: 12,
                    styles: [
                        {
                            featureType: "all",
                            elementType: "geometry",
                            stylers: [{ color: "#242f3e" }]
                        },
                        {
                            featureType: "all",
                            elementType: "labels.text.stroke",
                            stylers: [{ color: "#242f3e" }]
                        },
                        {
                            featureType: "all",
                            elementType: "labels.text.fill",
                            stylers: [{ color: "#746855" }]
                        },
                        {
                            featureType: "poi",
                            elementType: "labels.text.fill",
                            stylers: [{ color: "#d59563" }]
                        },
                        {
                            featureType: "poi.park",
                            elementType: "geometry",
                            stylers: [{ color: "#263c3f" }]
                        },
                        {
                            featureType: "poi.park",
                            elementType: "labels.text.fill",
                            stylers: [{ color: "#6b9a76" }]
                        },
                        {
                            featureType: "road",
                            elementType: "geometry",
                            stylers: [{ color: "#38414e" }]
                        },
                        {
                            featureType: "road",
                            elementType: "geometry.stroke",
                            stylers: [{ color: "#212a37" }]
                        },
                        {
                            featureType: "road",
                            elementType: "labels.text.fill",
                            stylers: [{ color: "#9ca5b3" }]
                        },
                        {
                            featureType: "road.highway",
                            elementType: "geometry",
                            stylers: [{ color: "#746855" }]
                        },
                        {
                            featureType: "road.highway",
                            elementType: "geometry.stroke",
                            stylers: [{ color: "#1f2835" }]
                        },
                        {
                            featureType: "road.highway",
                            elementType: "labels.text.fill",
                            stylers: [{ color: "#f3d19c" }]
                        },
                        {
                            featureType: "transit",
                            elementType: "geometry",
                            stylers: [{ color: "#2f3948" }]
                        },
                        {
                            featureType: "transit.station",
                            elementType: "labels.text.fill",
                            stylers: [{ color: "#d59563" }]
                        },
                        {
                            featureType: "water",
                            elementType: "geometry",
                            stylers: [{ color: "#17263c" }]
                        },
                        {
                            featureType: "water",
                            elementType: "labels.text.fill",
                            stylers: [{ color: "#515c6d" }]
                        },
                        {
                            featureType: "water",
                            elementType: "labels.text.stroke",
                            stylers: [{ color: "#17263c" }]
                        }
                    ]
                });
            }

            // Initialize mobile map
            const mobileMapElement = document.getElementById('mobileMap');
            if (mobileMapElement) {
                mobileMap = new google.maps.Map(mobileMapElement, {
                    center: { lat: 51.5074, lng: -0.1278 },
                    zoom: 12,
                    styles: map.styles // Use same dark theme
                });
            }

            // Add markers for Starter and Professional businesses
            addBusinessMarkers(businesses);
        }

        function addBusinessMarkers(businesses) {
            // Clear existing markers
            businessMarkers.forEach(marker => marker.setMap(null));
            businessMarkers = [];

            businesses.forEach((business, index) => {
                const tier = getBusinessTier(business);
                
                // Only add markers for Starter and Professional businesses
                if (tier === 'starter' || tier === 'professional') {
                    // Generate coordinates (in real app, these would come from business data)
                    const lat = 51.5074 + (Math.random() - 0.5) * 0.1;
                    const lng = -0.1278 + (Math.random() - 0.5) * 0.1;
                    
                    const marker = new google.maps.Marker({
                        position: { lat, lng },
                        map: map,
                        title: business.name,
                        icon: {
                            url: `data:image/svg+xml;charset=UTF-8,${encodeURIComponent(`
                                <svg width="40" height="40" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="20" cy="20" r="18" fill="#D4AF37" stroke="#000" stroke-width="2"/>
                                    <text x="20" y="26" text-anchor="middle" fill="#000" font-family="Arial" font-size="12" font-weight="bold">${tier === 'professional' ? 'P' : 'S'}</text>
                                </svg>
                            `)}`,
                            scaledSize: new google.maps.Size(40, 40)
                        }
                    });

                    // Add click listener
                    marker.addListener('click', () => {
                        selectBusinessOnMap(business, index);
                    });

                    // Add hover info
                    const infoWindow = new google.maps.InfoWindow({
                        content: `
                            <div style="color: #000; font-family: Arial;">
                                <h3 style="margin: 0 0 8px 0; color: #D4AF37; font-weight: bold;">${business.name}</h3>
                                <p style="margin: 0 0 4px 0; color: #666;">${business.category}</p>
                                <p style="margin: 0; color: #666; font-size: 12px;">${business.location}</p>
                            </div>
                        `
                    });

                    marker.addListener('mouseover', () => {
                        infoWindow.open(map, marker);
                    });

                    marker.addListener('mouseout', () => {
                        infoWindow.close();
                    });

                    businessMarkers.push(marker);
                }
            });
        }

        function selectBusinessOnMap(business, index) {
            // Center map on selected business
            if (map && businessMarkers[index]) {
                map.setCenter(businessMarkers[index].getPosition());
                map.setZoom(16);
            }

            // Highlight corresponding card in list
            highlightBusinessCard(business.id || business.name);
        }

        function highlightBusinessCard(businessId) {
            // Remove previous highlights
            document.querySelectorAll('.business-card').forEach(card => {
                card.classList.remove('ring-2', 'ring-gold', 'bg-gold/10');
            });

            // Highlight the selected card
            const card = document.querySelector(`[data-business-id="${businessId}"]`);
            if (card) {
                card.classList.add('ring-2', 'ring-gold', 'bg-gold/10');
                card.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        // Add card-to-map interaction
        function addCardToMapInteraction() {
            document.addEventListener('click', function(e) {
                const businessCard = e.target.closest('.business-card');
                if (businessCard) {
                    const businessId = businessCard.getAttribute('data-business-id');
                    if (businessId && map) {
                        // Find the corresponding marker and center map on it
                        const businessIndex = businessMarkers.findIndex(marker => 
                            marker.getTitle() === businessId || 
                            marker.getTitle().toLowerCase().includes(businessId.toLowerCase())
                        );
                        
                        if (businessIndex !== -1 && businessMarkers[businessIndex]) {
                            const marker = businessMarkers[businessIndex];
                            map.setCenter(marker.getPosition());
                            map.setZoom(16);
                            
                            // Open info window
                            const infoWindow = new google.maps.InfoWindow({
                                content: `
                                    <div style="color: #000; font-family: Arial;">
                                        <h3 style="margin: 0 0 8px 0; color: #D4AF37; font-weight: bold;">${marker.getTitle()}</h3>
                                        <p style="margin: 0; color: #666; font-size: 12px;">Click to view profile</p>
                                    </div>
                                `
                            });
                            infoWindow.open(map, marker);
                        }
                    }
                }
            });
        }

        // Initialize card-to-map interaction
        addCardToMapInteraction();

        function displaySearchResults(businesses) {
            const resultsContainer = document.getElementById('businessResults');
            const mobileResultsContainer = document.getElementById('mobileBusinessResults');
            const resultsCount = document.getElementById('resultsCount');
            const mobileResultsCount = document.getElementById('mobileResultsCount');
            
            if (businesses.length === 0) {
                const noResultsHTML = `
                    <div class="bg-dark-grey rounded-2xl p-8 border border-white/10 text-center">
                        <i class="fas fa-search text-4xl text-light-grey mb-4"></i>
                        <h3 class="text-xl font-bold text-white mb-2">No results found</h3>
                        <p class="text-light-grey mb-4">Try broadening your filters or search area.</p>
                        <div class="text-sm text-light-grey mb-6">
                            <p class="mb-2">Suggestions:</p>
                            <ul class="text-left max-w-md mx-auto">
                                <li>• Try different keywords or categories</li>
                                <li>• Expand your search radius</li>
                                <li>• Check nearby areas</li>
                            </ul>
                        </div>
                        <button onclick="clearAllFilters()" class="px-6 py-3 rounded-lg bg-gradient-to-r from-gold to-gold-dark text-black font-semibold hover:from-gold-dark hover:to-gold transition-all duration-300">
                            Clear All Filters
                        </button>
                    </div>
                `;
                
                if (resultsContainer) resultsContainer.innerHTML = noResultsHTML;
                if (mobileResultsContainer) mobileResultsContainer.innerHTML = noResultsHTML;
                if (resultsCount) resultsCount.textContent = '0 businesses found';
                if (mobileResultsCount) mobileResultsCount.textContent = '0 businesses found';
                return;
            }

            if (resultsCount) resultsCount.textContent = `${businesses.length} businesses found`;
            if (mobileResultsCount) mobileResultsCount.textContent = `${businesses.length} businesses found`;

            const businessCardsHTML = businesses.map(business => {
                const tier = getBusinessTier(business);
                const categoryColor = business.category === 'hair' ? 'neon-pink' : 
                                     business.category === 'barber' ? 'neon-blue' : 
                                     business.category === 'beauty' ? 'neon-green' : 'neon-purple';
                const categoryIcon = business.category === 'hair' ? 'fas fa-cut' : 
                                   business.category === 'barber' ? 'fas fa-cut' : 
                                   business.category === 'beauty' ? 'fas fa-spa' : 'fas fa-star';
                
                if (tier === 'basic') {
                    // Basic card - NO links, NO images, informational only
                    return `
                    <div class="bg-dark-grey rounded-2xl p-4 border border-white/10 transition-all duration-300 hover:border-gold/30 hover:shadow-lg hover:shadow-gold/10" role="article" aria-label="Basic business listing for ${business.name}" style="cursor: default;">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-lg font-bold text-white">${business.name}</h3>
                            <span class="px-3 py-1 rounded-full text-xs font-medium bg-${categoryColor}/20 text-${categoryColor} border border-${categoryColor}/30">
                                ${business.category.charAt(0).toUpperCase() + business.category.slice(1)}
                            </span>
                        </div>
                        <div class="space-y-2">
                            ${business.address ? `
                            <p class="text-light-grey text-sm flex items-center">
                                <i class="fas fa-map-marker-alt mr-2 w-4"></i>
                                ${business.address}
                            </p>` : ''}
                            ${business.phone ? `
                            <p class="text-light-grey text-sm flex items-center">
                                <i class="fas fa-phone mr-2 w-4"></i>
                                ${business.phone}
                            </p>` : ''}
                            ${business.email ? `
                            <p class="text-light-grey text-sm flex items-center">
                                <i class="fas fa-envelope mr-2 w-4"></i>
                                ${business.email}
                            </p>` : ''}
                        </div>
                        <div class="text-center mt-4">
                            <p class="text-light-grey text-sm">Contact the business directly for enquiries</p>
                        </div>
                    </div>
                `;
                } else {
                    // Starter/Professional card - with image, links, and Book Now button
                    const businessSlug = business.id || business.name.toLowerCase().replace(/\s+/g, '-');
                    const profileUrl = `/business/${businessSlug}`;
                    
                    return `
                    <div class="business-card bg-dark-grey rounded-2xl p-6 border border-white/10 transition-all duration-300 hover:border-gold/30 hover:shadow-lg hover:shadow-gold/10" 
                         data-business-id="${business.id || business.name}" 
                         role="article" 
                         aria-label="Premium business listing for ${business.name}">
                        <div class="mb-4">
                            <img src="${business.image || 'https://images.unsplash.com/photo-1560066984-138dadb4c035?w=400&h=250&fit=crop&crop=center'}" 
                                 alt="${business.name}" 
                                 class="w-full h-48 object-cover rounded-lg">
                        </div>
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-xl font-bold text-white">
                                <a href="${profileUrl}" class="hover:text-gold transition-colors duration-300">${business.name}</a>
                            </h3>
                            <div class="flex items-center space-x-2">
                                <span class="bg-gradient-to-r from-gold to-gold-dark text-black text-xs px-2 py-1 rounded-full font-semibold">
                                    ${tier === 'professional' ? 'Professional' : 'Starter'}
                                </span>
                                ${business.hasOffer ? `
                                <span class="px-2 py-1 rounded-full text-xs font-medium bg-gold/20 text-gold border border-gold/40 backdrop-blur-sm shadow-sm hover:shadow-gold/30 transition-all duration-300">
                                    <i class="fas fa-tag mr-1"></i>Offer
                                </span>` : ''}
                            </div>
                        </div>
                        <div class="flex items-center mb-2">
                            <div class="flex text-gold mr-2">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                            </div>
                            <span class="text-light-grey text-sm">${business.rating || '4.8'} (${business.reviews || '127'} reviews)</span>
                        </div>
                        <p class="text-${categoryColor} text-sm font-medium mb-2">
                            <i class="${categoryIcon} mr-1"></i>
                            ${business.category.charAt(0).toUpperCase() + business.category.slice(1)}
                        </p>
                        <p class="text-light-grey text-sm mb-4 flex items-center">
                            <i class="fas fa-map-marker-alt mr-2"></i>
                            ${business.address || business.location}
                        </p>
                        <div class="flex space-x-2">
                            <button onclick="goToBusinessProfile('${businessSlug}')" 
                                    class="flex-1 py-2 px-3 rounded-lg bg-gradient-to-r from-gold to-gold-dark text-black font-semibold text-sm hover:from-gold-dark hover:to-gold transition-all duration-300 shadow-lg hover:shadow-xl">
                                Book Now
                            </button>
                            ${business.phone ? `
                            <button onclick="callBusiness('${business.phone}')" 
                                    class="px-3 py-2 rounded-lg border border-white/20 text-white hover:bg-white/10 hover:border-gold/50 transition-all duration-300">
                                <i class="fas fa-phone text-sm"></i>
                            </button>` : ''}
                            ${business.email ? `
                            <button onclick="emailBusiness('${business.email}')" 
                                    class="px-3 py-2 rounded-lg border border-white/20 text-white hover:bg-white/10 hover:border-gold/50 transition-all duration-300">
                                <i class="fas fa-envelope text-sm"></i>
                            </button>` : ''}
                            <button onclick="shareBusiness('${business.id}', '${business.name}', '${business.address || business.location}', '${business.phone}', '${business.email}')" 
                                    class="px-3 py-2 rounded-lg border border-white/20 text-white hover:bg-white/10 hover:border-gold/50 transition-all duration-300">
                                <i class="fas fa-share text-sm"></i>
                            </button>
                        </div>
                    </div>
                `;
                }
            }).join('');

            // Update both desktop and mobile containers
            if (resultsContainer) resultsContainer.innerHTML = businessCardsHTML;
            if (mobileResultsContainer) mobileResultsContainer.innerHTML = businessCardsHTML;

            // Update map markers if map is initialized
            if (typeof google !== 'undefined' && map) {
                addBusinessMarkers(businesses);
            }
        }

        function goToBusinessProfile(businessSlug) {
            // Redirect to business profile page where customers can add services
            window.location.href = `/business/${businessSlug}`;
        }

        function callBusiness(phoneNumber) {
            // Open phone dialer with business phone number
            window.location.href = `tel:${phoneNumber}`;
        }

        // Email business
        function emailBusiness(emailAddress) {
            window.open(`mailto:${emailAddress}`, '_self');
        }

        // Share business
        function shareBusiness(businessId, businessName, address, phone, email) {
            const shareText = `Check out ${businessName} on BlkPages! ${address ? `Located at ${address}.` : ''} ${phone ? `Call: ${phone}` : ''} ${email ? `Email: ${email}` : ''} Find more details and book services at: ${window.location.origin}/business/${businessId}`;
            
            if (navigator.share) {
                navigator.share({
                    title: `${businessName} - BlkPages`,
                    text: shareText,
                    url: `${window.location.origin}/business/${businessId}`
                }).catch(err => {
                    console.log('Error sharing:', err);
                    fallbackShare(shareText);
                });
            } else {
                fallbackShare(shareText);
            }
        }

        // Fallback share function for browsers that don't support Web Share API
        function fallbackShare(shareText) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(shareText).then(() => {
                    showShareSuccess();
                }).catch(() => {
                    showShareModal(shareText);
                });
            } else {
                showShareModal(shareText);
            }
        }

        // Show share success message
        function showShareSuccess() {
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-all duration-300';
            toast.innerHTML = '<i class="fas fa-check mr-2"></i>Business details copied to clipboard!';
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }

        // Show share modal for manual copying
        function showShareModal(shareText) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-md mx-4">
                    <h3 class="text-lg font-bold mb-4">Share Business</h3>
                    <p class="text-gray-600 mb-4">Copy the text below to share this business:</p>
                    <textarea class="w-full p-3 border rounded-lg mb-4" rows="4" readonly>${shareText}</textarea>
                    <div class="flex space-x-3">
                        <button onclick="copyToClipboard('${shareText.replace(/'/g, "\\'")}')" 
                                class="flex-1 bg-gold text-black py-2 px-4 rounded-lg font-semibold hover:bg-gold-dark transition-colors">
                            Copy Text
                        </button>
                        <button onclick="closeShareModal()" 
                                class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg font-semibold hover:bg-gray-400 transition-colors">
                            Close
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Copy text to clipboard
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showShareSuccess();
                closeShareModal();
            });
        }

        // Close share modal
        function closeShareModal() {
            const modal = document.querySelector('.fixed.inset-0.bg-black.bg-opacity-50');
            if (modal) {
                document.body.removeChild(modal);
            }
        }

        function clearAllFilters() {
            document.getElementById('businessNameSearch').value = '';
            document.getElementById('locationSearch').value = '';
            document.getElementById('categorySearch').value = '';
            document.getElementById('ratingFilter').value = '';
            document.getElementById('distanceFilter').value = '5';
            
            // Reset search state and hide advanced controls
            hasSearched = false;
            hideAdvancedControls();
            
            // Show all businesses
            displaySearchResults(businessData);
        }

        function performSearch() {
            searchBusinesses();
            // Show advanced controls after any search is performed
            hasSearched = true;
            showAdvancedControls();
        }

        // Track if search has been performed
        let hasSearched = false;

        // Show advanced controls after search
        function showAdvancedControls() {
            document.getElementById('advancedControls').classList.remove('hidden');
        }

        // Hide advanced controls (reset to initial state)
        function hideAdvancedControls() {
            document.getElementById('advancedControls').classList.add('hidden');
        }

        function searchBusinesses() {
            const businessName = document.getElementById('businessNameSearch').value.toLowerCase();
            const location = document.getElementById('locationSearch').value.toLowerCase();
            const category = document.getElementById('categorySearch').value;
            
            let filteredBusinesses = businessData.filter(business => {
                const matchesName = !businessName || business.name.toLowerCase().includes(businessName);
                const matchesLocation = !location || business.location.toLowerCase().includes(location);
                const matchesCategory = !category || business.category === category;
                
                return matchesName && matchesLocation && matchesCategory;
            });
            
            displaySearchResults(filteredBusinesses);
        }

        function applyFilters() {
            const rating = document.getElementById('ratingFilter').value;
            const distance = document.getElementById('distanceFilter').value;
            
            currentFilters.rating = rating;
            currentFilters.distance = distance;
            
            // Apply filters to current results
            searchBusinesses();
        }

        function clearFilters() {
            document.getElementById('ratingFilter').value = '';
            document.getElementById('distanceFilter').value = '5';
            currentFilters.rating = '';
            currentFilters.distance = '5';
            
            searchBusinesses();
        }

        function selectSortOption(sortType) {
            currentFilters.sortBy = sortType;
            document.getElementById('sortMenuText').textContent = sortType.charAt(0).toUpperCase() + sortType.slice(1);
            searchBusinesses();
        }

        // Initialize search functionality
        function initializeSearch() {
            // Get business data from business manager
            const businessData = window.businessManager.getBusinesses();
            
            // Display all businesses initially
            displaySearchResults(businessData);
            
            // Initialize map if Google Maps is loaded
            if (typeof google !== 'undefined') {
                initializeMap(businessData);
            }
        }

        // Set up event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Set up event listeners
            document.getElementById('searchBtn').addEventListener('click', performSearch);
            document.getElementById('nearMeBtn').addEventListener('click', handleNearMe);
            document.getElementById('filterMenuBtn').addEventListener('click', toggleFilterMenu);
            document.getElementById('sortMenuBtn').addEventListener('click', toggleSortMenu);
            document.getElementById('applyFiltersBtn').addEventListener('click', applyFilters);
            document.getElementById('clearFiltersBtn').addEventListener('click', clearFilters);
            
            // Sort menu options
            document.querySelectorAll('#sortMenu button').forEach(button => {
                button.addEventListener('click', () => selectSortOption(button.dataset.sort));
            });

            // Real-time search as user types in business name or location
            document.getElementById('businessNameSearch').addEventListener('input', function() {
                const query = this.value.toLowerCase();
                const businessData = window.businessManager.getBusinesses();
                
                if (query.length > 0) {
                    hasSearched = true;
                    showAdvancedControls();
                    
                    const filteredBusinesses = businessData.filter(business => 
                        business.name.toLowerCase().includes(query) ||
                        business.category.toLowerCase().includes(query) ||
                        business.location.toLowerCase().includes(query)
                    );
                    
                    displaySearchResults(filteredBusinesses);
                } else {
                    hideAdvancedControls();
                    displaySearchResults(businessData);
                }
            });

            // Mobile view toggle functionality
            const listViewBtn = document.getElementById('listViewBtn');
            const mapViewBtn = document.getElementById('mapViewBtn');
            const mobileListView = document.getElementById('mobileListView');
            const mobileMapView = document.getElementById('mobileMapView');

            if (listViewBtn && mapViewBtn && mobileListView && mobileMapView) {
                listViewBtn.addEventListener('click', function() {
                    // Switch to list view
                    mobileListView.classList.remove('hidden');
                    mobileMapView.classList.add('hidden');
                    
                    // Update button styles
                    listViewBtn.classList.add('bg-gold', 'text-black');
                    listViewBtn.classList.remove('text-white', 'hover:bg-gold', 'hover:text-black');
                    mapViewBtn.classList.remove('bg-gold', 'text-black');
                    mapViewBtn.classList.add('text-white', 'hover:bg-gold', 'hover:text-black');
                });

                mapViewBtn.addEventListener('click', function() {
                    // Switch to map view
                    mobileListView.classList.add('hidden');
                    mobileMapView.classList.remove('hidden');
                    
                    // Update button styles
                    mapViewBtn.classList.add('bg-gold', 'text-black');
                    mapViewBtn.classList.remove('text-white', 'hover:bg-gold', 'hover:text-black');
                    listViewBtn.classList.remove('bg-gold', 'text-black');
                    listViewBtn.classList.add('text-white', 'hover:bg-gold', 'hover:text-black');
                });
            }

            // Show filter controls when user starts typing in location
            document.getElementById('locationSearch').addEventListener('input', function() {
                if (this.value.length > 0) {
                    showAdvancedControls();
                }
            });

            // Update filters when user changes them
            document.getElementById('categorySearch').addEventListener('change', function() {
                currentFilters.category = this.value;
                applyFilters();
            });

            document.getElementById('ratingFilter').addEventListener('change', function() {
                currentFilters.rating = this.value;
                applyFilters();
            });

            document.getElementById('distanceFilter').addEventListener('change', function() {
                currentFilters.distance = this.value;
                applyFilters();
            });

            // Add sort functionality
            const sortBySelect = document.getElementById('sortBySelect');
            if (sortBySelect) {
                sortBySelect.addEventListener('change', function() {
                    currentFilters.sortBy = this.value;
                    applyFilters();
                });
            }

            // Initialize search
            initializeSearch();
        });

        function toggleFilterMenu() {
            const filterMenu = document.getElementById('filterMenu');
            filterMenu.classList.toggle('hidden');
        }

        function toggleSortMenu() {
            const sortMenu = document.getElementById('sortMenu');
            sortMenu.classList.toggle('hidden');
        }

        function handleNearMe() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    // Store location data
                    localStorage.setItem('userLat', position.coords.latitude);
                    localStorage.setItem('userLng', position.coords.longitude);
                    localStorage.setItem('userLocation', 'Current Location');
                    
                    // Update location field
                    document.getElementById('locationSearch').value = 'Current Location';
                    
                    // Perform search with current location
                    performSearch();
                }, function(error) {
                    alert('Unable to get your location. Please enter your location manually.');
                });
            } else {
                alert('Geolocation is not supported by this browser. Please enter your location manually.');
            }
        }
    </script>
</body>
</html>
