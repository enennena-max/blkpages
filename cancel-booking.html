<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cancel Booking - BlkPages</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #121212 0%, #1A1A1A 50%, #0F0F0F 100%);
            color: #ffffff;
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #FF3CAC, #784BA0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .booking-card {
            background: #1A1A1A;
            border: 1px solid #374151;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .booking-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .business-info h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .business-category {
            color: #9CA3AF;
            font-size: 0.9rem;
        }
        
        .booking-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #374151;
        }
        
        .detail-label {
            color: #9CA3AF;
            font-size: 0.9rem;
        }
        
        .detail-value {
            color: #ffffff;
            font-weight: 500;
        }
        
        .cancellation-policy {
            background: rgba(255, 60, 172, 0.1);
            border: 1px solid rgba(255, 60, 172, 0.3);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .cancellation-policy h4 {
            color: #FF3CAC;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .cancellation-policy h4::before {
            content: "üìã";
            font-size: 1.2rem;
        }
        
        .policy-content {
            color: #e5e7eb;
            font-size: 0.9rem;
            line-height: 1.6;
            white-space: pre-line;
        }
        
        .refund-info {
            background: #1A1A1A;
            border: 1px solid #374151;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .refund-info h4 {
            color: #ffffff;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .refund-amount {
            font-size: 1.5rem;
            font-weight: 700;
            color: #10B981;
            margin-bottom: 0.5rem;
        }
        
        .refund-details {
            color: #9CA3AF;
            font-size: 0.9rem;
        }
        
        .non-refundable {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .non-refundable h4 {
            color: #EF4444;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .non-refundable h4::before {
            content: "‚ö†Ô∏è";
            font-size: 1.2rem;
        }
        
        .action-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }
        
        .btn {
            padding: 1rem 2rem;
            border-radius: 8px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 1rem;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #EF4444, #DC2626);
            color: white;
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.3);
        }
        
        .btn-secondary {
            background: #374151;
            color: #ffffff;
            border: 1px solid #4B5563;
        }
        
        .btn-secondary:hover {
            background: #4B5563;
            transform: translateY(-2px);
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        
        .loading i {
            font-size: 2rem;
            color: #FF3CAC;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .success-message {
            display: none;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .success-message h4 {
            color: #10B981;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .success-message h4::before {
            content: "‚úÖ";
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Cancel Booking</h1>
            <p>Review your booking details and cancellation policy</p>
        </div>
        
        <!-- Booking Details -->
        <div class="booking-card" id="bookingCard">
            <div class="booking-header">
                <div class="business-info">
                    <h3 id="businessName">Royal Hair Studio</h3>
                    <div class="business-category">Hair Salon</div>
                </div>
                <div class="booking-status" id="bookingStatus">Confirmed</div>
            </div>
            
            <div class="booking-details">
                <div class="detail-row">
                    <span class="detail-label">Date:</span>
                    <span class="detail-value" id="appointmentDate">Saturday, Dec 28, 2024</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Time:</span>
                    <span class="detail-value" id="appointmentTime">2:00 PM</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Duration:</span>
                    <span class="detail-value">1h 15m</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Total:</span>
                    <span class="detail-value" id="totalAmount">¬£70</span>
                </div>
            </div>
        </div>
        
        <!-- Cancellation Policy -->
        <div class="cancellation-policy">
            <h4>Cancellation Policy</h4>
            <div class="policy-content" id="policyContent">
                Royal Hair Studio ‚Äì Cancellation Policy:
                You may cancel your booking up to 48 hours before your appointment for a full refund.
                Cancellations made within 48 hours will be charged 50% of the service price.
                No-shows will be charged 100% of the service price.
                Refunds are returned to your original payment method within 5‚Äì10 business days.

                This policy is set by Royal Hair Studio. BlkPages processes payments via Stripe on behalf of the venue but is not responsible for enforcing refunds.
            </div>
        </div>
        
        <!-- Refund Information -->
        <div class="refund-info" id="refundInfo">
            <h4>Refund Information</h4>
            <div class="refund-amount" id="refundAmount">¬£35.00</div>
            <div class="refund-details" id="refundDetails">
                You will receive a 50% refund as you are cancelling within 48 hours of your appointment.
                The refund will be processed back to your original payment method within 5-10 business days.
            </div>
        </div>
        
        <!-- Non-refundable Notice -->
        <div class="non-refundable" id="nonRefundableNotice" style="display: none;">
            <h4>Non-Refundable Booking</h4>
            <div class="policy-content">
                This booking is non-refundable under Royal Hair Studio's cancellation policy.
                No refund will be issued for this cancellation.
            </div>
        </div>
        
        <!-- Success Message -->
        <div class="success-message" id="successMessage">
            <h4>Booking Cancelled Successfully</h4>
            <div class="policy-content" id="successContent">
                Your booking has been cancelled. You will receive a confirmation email shortly.
            </div>
        </div>
        
        <!-- Loading State -->
        <div class="loading" id="loadingState">
            <i class="fas fa-spinner"></i>
            <p>Processing cancellation...</p>
        </div>
        
        <!-- Action Buttons -->
        <div class="action-buttons" id="actionButtons">
            <button class="btn btn-danger" onclick="confirmCancellation()">
                <i class="fas fa-times"></i> Cancel Booking
            </button>
            <a href="customer-dashboard.html" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
            </a>
        </div>
    </div>
    
    <script>
        // Get booking details from URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const bookingId = urlParams.get('booking') || 'booking1';
        const userId = urlParams.get('user') || 'loggedin';
        
        // Sample booking data (in real implementation, fetch from API)
        const bookingData = {
            booking1: {
                businessName: 'Royal Hair Studio',
                appointmentDate: '2024-12-28',
                appointmentTime: '2:00 PM',
                totalAmount: 70,
                policy: 'moderate',
                hoursUntilAppointment: 36, // 36 hours until appointment
                canCancel: true
            },
            booking2: {
                businessName: 'Beauty Studio',
                appointmentDate: '2024-12-30',
                appointmentTime: '10:00 AM',
                totalAmount: 140,
                policy: 'strict',
                hoursUntilAppointment: 72,
                canCancel: false
            }
        };
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadBookingData();
            calculateRefund();
        });
        
        function loadBookingData() {
            const booking = bookingData[bookingId];
            if (!booking) {
                alert('Booking not found');
                return;
            }
            
            // Update page content
            document.getElementById('businessName').textContent = booking.businessName;
            document.getElementById('appointmentDate').textContent = booking.appointmentDate;
            document.getElementById('appointmentTime').textContent = booking.appointmentTime;
            document.getElementById('totalAmount').textContent = `¬£${booking.totalAmount}`;
            
            // Show/hide elements based on cancellation eligibility
            if (!booking.canCancel) {
                document.getElementById('refundInfo').style.display = 'none';
                document.getElementById('nonRefundableNotice').style.display = 'block';
                document.getElementById('actionButtons').style.display = 'none';
            }
        }
        
        function calculateRefund() {
            const booking = bookingData[bookingId];
            if (!booking || !booking.canCancel) return;
            
            let refundAmount = 0;
            let refundDetails = '';
            
            switch (booking.policy) {
                case 'flexible':
                    if (booking.hoursUntilAppointment >= 24) {
                        refundAmount = booking.totalAmount;
                        refundDetails = 'Full refund as you are cancelling more than 24 hours before your appointment.';
                    } else {
                        refundAmount = 0;
                        refundDetails = 'No refund as you are cancelling within 24 hours of your appointment.';
                    }
                    break;
                    
                case 'moderate':
                    if (booking.hoursUntilAppointment >= 48) {
                        refundAmount = booking.totalAmount;
                        refundDetails = 'Full refund as you are cancelling more than 48 hours before your appointment.';
                    } else if (booking.hoursUntilAppointment > 0) {
                        refundAmount = booking.totalAmount * 0.5;
                        refundDetails = '50% refund as you are cancelling within 48 hours of your appointment.';
                    } else {
                        refundAmount = 0;
                        refundDetails = 'No refund for no-shows.';
                    }
                    break;
                    
                case 'strict':
                    refundAmount = 0;
                    refundDetails = 'This booking is non-refundable under the business cancellation policy.';
                    break;
            }
            
            // Update refund display
            document.getElementById('refundAmount').textContent = `¬£${refundAmount.toFixed(2)}`;
            document.getElementById('refundDetails').textContent = refundDetails;
            
            if (refundAmount === 0) {
                document.getElementById('refundInfo').style.display = 'none';
                document.getElementById('nonRefundableNotice').style.display = 'block';
            }
        }
        
        async function confirmCancellation() {
            if (!confirm('Are you sure you want to cancel this booking? This action cannot be undone.')) {
                return;
            }
            
            // Show loading state
            document.getElementById('actionButtons').style.display = 'none';
            document.getElementById('loadingState').style.display = 'block';
            
            try {
                // Simulate API call to process cancellation
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Hide loading, show success
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('successMessage').style.display = 'block';
                
                const booking = bookingData[bookingId];
                const refundAmount = parseFloat(document.getElementById('refundAmount').textContent.replace('¬£', ''));
                
                if (refundAmount > 0) {
                    document.getElementById('successContent').textContent = 
                        `Your booking has been cancelled. A refund of ¬£${refundAmount.toFixed(2)} will be processed back to your original payment method within 5-10 business days. You will receive a confirmation email shortly.`;
                } else {
                    document.getElementById('successContent').textContent = 
                        'Your booking has been cancelled. No refund will be issued under the business cancellation policy. You will receive a confirmation email shortly.';
                }
                
                // Update booking status
                document.getElementById('bookingStatus').textContent = 'Cancelled';
                document.getElementById('bookingStatus').style.color = '#EF4444';
                
            } catch (error) {
                console.error('Cancellation failed:', error);
                alert('Failed to cancel booking. Please try again or contact support.');
                
                // Show buttons again
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('actionButtons').style.display = 'flex';
            }
        }
    </script>
</body>
</html>